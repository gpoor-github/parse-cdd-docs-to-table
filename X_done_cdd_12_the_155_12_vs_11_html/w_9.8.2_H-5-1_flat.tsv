"Section"	"section_id"	"req_id"	"full_key"	"manual_search_terms"	"requirement"	"Test Availability"	"class_def"	"method"	"module"	"matched_terms"	"methods_string"	"file_name"	"Comment(internal) e.g. why a test is not possible"	"CTS Bug Id"	"Test Level"
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"SELinuxNeverallowRulesTest"	"isSepolicySplit"	""	"1: UI"	"public void test#!/usr/bin/env python

src_header = """"""/*
 *.
 */

package android.security.cts;

import android.platform.test.annotations.RestrictedBuildTest;
import com.android.compatibility.common.tradefed.build.CompatibilityBuildHelper;
import com.android.compatibility.common.util.PropertyUtil;
import com.android.tradefed.build.IBuildInfo;
import com.android.tradefed.device.ITestDevice;
import com.android.tradefed.testtype.DeviceTestCase;
import com.android.tradefed.testtype.IBuildReceiver;
import com.android.tradefed.testtype.IDeviceTest;

import java.io.BufferedReader;
import java.io.File;
import java.io.InputStream;
import java.io.InputStreamReader;

/**
 * Neverallow Rules SELinux tests.
 */
public class SELinuxNeverallowRulesTest extends DeviceTestCase implements IBuildReceiver, IDeviceTest {
    private File sepolicyAnalyze;
    private File devicePolicyFile;
    private File deviceSystemPolicyFile;

    private IBuildInfo mBuild;
    private int mVendorSepolicyVersion = -1;
    private int mSystemSepolicyVersion = -1;

    /**
     * A reference to the device under test.
     */
    private ITestDevice mDevice;

    /**
     * {@inheritDoc}
     */
    @Override
    public void setBuild(IBuildInfo build) {
        mBuild = build;
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public void setDevice(ITestDevice device) {
        super.setDevice(device);
        mDevice = device;
    }
    @Override
    protected void setUp() throws Exception {
        super.setUp();
        CompatibilityBuildHelper buildHelper = new CompatibilityBuildHelper(mBuild);
        sepolicyAnalyze = android.security.cts.SELinuxHostTest.copyResourceToTempFile(""/sepolicy-analyze"");
        sepolicyAnalyze.setExecutable(true);

        devicePolicyFile = android.security.cts.SELinuxHostTest.getDevicePolicyFile(mDevice);

        if (isSepolicySplit()) {
            deviceSystemPolicyFile =
                    android.security.cts.SELinuxHostTest.getDeviceSystemPolicyFile(mDevice);

            // Caching this variable to save time.
            if (mVendorSepolicyVersion == -1) {
                mVendorSepolicyVersion =
                        android.security.cts.SELinuxHostTest.getVendorSepolicyVersion(mBuild, mDevice);
            }
            if (mSystemSepolicyVersion == -1) {
                mSystemSepolicyVersion =
                        android.security.cts.SELinuxHostTest.getSystemSepolicyVersion(mBuild);
            }
        }
    }

    private boolean isFullTrebleDevice() throws Exception {
        return android.security.cts.SELinuxHostTest.isFullTrebleDevice(mDevice);
    }

    private boolean isDeviceLaunchingWithR() throws Exception {
        return PropertyUtil.getFirstApiLevel(mDevice) > 29;
    }

    private boolean isDeviceLaunchingWithS() throws Exception {
        return PropertyUtil.getFirstApiLevel(mDevice) > 30;
    }

    private boolean isCompatiblePropertyEnforcedDevice() throws Exception {
        return android.security.cts.SELinuxHostTest.isCompatiblePropertyEnforcedDevice(mDevice);
    }

    private boolean isSepolicySplit() throws Exception {
        return android.security.cts.SELinuxHostTest.isSepolicySplit(mDevice);
    }
""""""
src_body = """"
src_footer = """"""}
""""""

src_method = """"""
    @RestrictedBuildTest"	"/home/gpoor/cts-12-source/cts/tools/selinux/SELinuxNeverallowTestFrame.py"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"SELinuxNeverallowRulesTest"	"testNeverallowRules"	""	"3: UI only app"	"public void testNeverallowRules() throws Exception {
        String neverallowRule = ""$NEVERALLOW_RULE_HERE$"";
        boolean fullTrebleOnly = $TREBLE_ONLY_BOOL_HERE$;
        boolean launchingWithROnly = $LAUNCHING_WITH_R_ONLY_BOOL_HERE$;
        boolean launchingWithSOnly = $LAUNCHING_WITH_S_ONLY_BOOL_HERE$;
        boolean compatiblePropertyOnly = $COMPATIBLE_PROPERTY_ONLY_BOOL_HERE$;

        if ((fullTrebleOnly) && (!isFullTrebleDevice())) {
            // This test applies only to Treble devices but this device isn't one
            return;
        }
        if ((launchingWithROnly) && (!isDeviceLaunchingWithR())) {
            // This test applies only to devices launching with R or later but this device isn't one
            return;
        }
        if ((launchingWithSOnly) && (!isDeviceLaunchingWithS())) {
            // This test applies only to devices launching with S or later but this device isn't one
            return;
        }
        if ((compatiblePropertyOnly) && (!isCompatiblePropertyEnforcedDevice())) {
            // This test applies only to devices on which compatible property is enforced but this
            // device isn't one
            return;
        }

        // If sepolicy is split and vendor sepolicy version is behind platform's,
        // only test against platform policy.
        File policyFile =
                (isSepolicySplit() && mVendorSepolicyVersion < mSystemSepolicyVersion) ?
                deviceSystemPolicyFile :
                devicePolicyFile;

        /* run sepolicy-analyze neverallow check on policy file using given neverallow rules */
        ProcessBuilder pb = new ProcessBuilder(sepolicyAnalyze.getAbsolutePath(),
                policyFile.getAbsolutePath(), ""neverallow"", ""-w"", ""-n"",
                neverallowRule);
        pb.redirectOutput(ProcessBuilder.Redirect.PIPE);
        pb.redirectErrorStream(true);
        Process p = pb.start();
        BufferedReader result = new BufferedReader(new InputStreamReader(p.getInputStream()));
        String line;
        StringBuilder errorString = new StringBuilder();
        while ((line = result.readLine()) != null) {
            errorString.append(line);
            errorString.append(""\\n"");
        }
        p.waitFor();
        assertTrue(""The following errors were encountered when validating the SELinux""
                   + ""neverallow rule:\\n"" + neverallowRule + ""\\n"" + errorString,
                   errorString.length() == 0);
    }
"""""""	"/home/gpoor/cts-12-source/cts/tools/selinux/SELinuxNeverallowTestFrame.py"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testVdex"	""	"1: UI"	"public void testVdex() throws Exception {
        String fileName = TEST_VDEX;
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        VdexParser aParser = new VdexParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    /**
     * Test {@link ArtParser} with an Art file
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testArt"	""	"1: UI"	"public void testArt() throws Exception {
        String fileName = TEST_ART;
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        ArtParser aParser = new ArtParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    /**
     * Test {@link OatParser} with an Oat file
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testOat"	""	"1: UI"	"public void testOat() throws Exception {
        String fileName = TEST_OAT;
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        OatParser aParser = new OatParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    /**
     * Test {@link OdexParser} with an Odex file
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testOdex"	""	"1: UI"	"public void testOdex() throws Exception {
        String fileName = TEST_ODEX;
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        OdexParser aParser = new OdexParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    /**
     * Test {@link BuildPropParser} with build.prop file
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testBuildProp"	""	"1: UI"	"public void testBuildProp() throws Exception {
        String fileName = TEST_BUILD_PROP;
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        BuildPropParser aParser = new BuildPropParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    /**
     * Test {@link XmlParser} with a platform.xml file
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.FileParserTest"	"testFeatureXml"	""	"1: UI"	"public void testFeatureXml() throws Exception {
        testXmlParser(TEST_DEVICE_FEATURE_XML);
    }

    private void testXmlParser(String fileName) throws Exception {
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        XmlParser aParser = new XmlParser(aFile);

        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);
        testFileParser(fileName, fileEntryBuilder.build());
    }

    private void testFileParser(String fileName, Entry fileEntry) throws Exception {
        Entry.Builder expectedEntryBuilder = Entry.newBuilder();
        String txtProtobufFileName = fileName + PB_TXT;
        TextFormat.getParser()
                .merge(
                        ClassUtils.openResourceAsStreamReader(getClass(), txtProtobufFileName),
                        expectedEntryBuilder);
        assertTrue(
                String.format(
                        ""Parser does not return the same Entry message of %s with %s.\n%s\n%s"",
                        fileName,
                        txtProtobufFileName,
                        TextFormat.printToString(fileEntry),
                        TextFormat.printToString(expectedEntryBuilder)),
                fileEntry.equals(expectedEntryBuilder.build()));
    }
}"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/FileParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.ApkParserTest"	"testSoApk"	""	"1: UI"	"public void testSoApk() throws Exception {
        testApkParser(TEST_SO_APK);
    }

    private void testApkParser(String fileName) throws Exception {
        File apkFile = ClassUtils.getResrouceFile(getClass(), fileName);
        ApkParser aParser = new ApkParser(apkFile);
        Entry.Builder fileEntryBuilder = aParser.getFileEntryBuilder();
        fileEntryBuilder.setName(fileName);

        Entry fileEntry = fileEntryBuilder.build();
        Entry.Builder expectedfileEntryBuilder = Entry.newBuilder();

        String txtProtobufFileName = fileName + PB_TXT;
        TextFormat.getParser()
                .merge(
                        ClassUtils.openResourceAsStreamReader(getClass(), txtProtobufFileName),
                        expectedfileEntryBuilder);
        assertTrue(
                String.format(
                        ""ApkParser does not return the same Entry of %s as %s.\n%s"",
                        fileName, txtProtobufFileName, TextFormat.printToString(fileEntry)),
                fileEntry.equals(expectedfileEntryBuilder.build()));
    }
}"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/ApkParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.ApkParserTest"	"testSimpleApk"	""	"1: app"	"public void testSimpleApk() throws Exception {
        testApkParser(TEST_SIMPLE_APK);
    }

    /**
     * Test {@link ApkParser} with an Sys(priv-app) APK
     *
     * @throws Exception
     */"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/ApkParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.releaseparser.SoParserTest"	"testCtsGtestExe"	""	"2: UI app"	"public void testCtsGtestExe() throws Exception {
        testSoParser(TEST_CTS_GTEST_EXE, TEST_CTS_GTEST_EXE_PB_TXT, false);
    }

    private void testSoParser(String fileName, String txtProtobufFileName, boolean parseInternalApi)
            throws Exception {
        File aFile = ClassUtils.getResrouceFile(getClass(), fileName);
        SoParser aParser = new SoParser(aFile);
        aParser.setPackageName(fileName);
        aParser.setParseInternalApi(parseInternalApi);
        AppInfo appInfo = aParser.getAppInfo();

        AppInfo.Builder expectedAppInfoBuilder = AppInfo.newBuilder();
        TextFormat.getParser()
                .merge(
                        ClassUtils.getResrouceContentString(getClass(), txtProtobufFileName),
                        expectedAppInfoBuilder);
        assertTrue(
                String.format(
                        ""SoParser does not return the same AppInfo of %s as %s.\n%s"",
                        fileName, txtProtobufFileName, TextFormat.printToString(appInfo)),
                appInfo.equals(expectedAppInfoBuilder.build()));
    }
}"	"/home/gpoor/cts-12-source/cts/tools/release-parser/tests/src/com/android/cts/releaseparser/SoParserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.generator.ManifestGeneratorTest"	"testManifest"	""	"2: UI app"	"public void testManifest() throws Exception {
        List<String> permissions = new ArrayList<>();
        permissions.add(PERMISSION_A);
        permissions.add(PERMISSION_B);
        List<String> activities = new ArrayList<>();
        activities.add(ACTIVITY_A);
        activities.add(ACTIVITY_B);
        List<String> libraries = new ArrayList<>();
        libraries.add(LIBRARY);
        List<String> optionalLibs = new ArrayList<>();
        optionalLibs.add(OPTIONAL_LIBRARY);
        OutputStream output = new OutputStream() {
            private StringBuilder string = new StringBuilder();
            @Override
            public void write(int b) throws IOException {
                this.string.append((char) b);
            }

            @Override
            public String toString(){
                return this.string.toString();
            }
        };
        ManifestGenerator.generate(
                output,
                PACKAGE,
                INSTRUMENT,
                MIN_SDK,
                TARGET_SDK,
                permissions,
                activities,
                libraries,
                optionalLibs);
        String permissionXml = String.format(PERMISSION, PERMISSION_A)
                + String.format(PERMISSION, PERMISSION_B);
        String activityXml = String.format(ACTIVITY, ACTIVITY_A)
                + String.format(ACTIVITY, ACTIVITY_B);
        String libraryXml = String.format(USES_LIBRARY, LIBRARY);
        String optionalLibraryXml = String.format(USES_OPTIONAL_LIBRARY, OPTIONAL_LIBRARY);
        String expected =
                String.format(MANIFEST, permissionXml, libraryXml, optionalLibraryXml, activityXml);
        assertEquals(""Wrong manifest output"", expected, output.toString());
    }

}"	"/home/gpoor/cts-12-source/cts/tools/manifest-generator/tests/src/com/android/compatibility/common/generator/ManifestGeneratorTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.tradefed.CtsTradefedTest"	"testSuiteInfoLoad"	""	"1: UI"	"public void testSuiteInfoLoad() throws Exception {
        // Test the values in the manifest can be loaded
        File root = FileUtil.createTempDir(""root"");
        System.setProperty(PROPERTY_NAME, root.getAbsolutePath());
        File base = new File(root, ""android-cts"");
        base.mkdirs();
        File tests = new File(base, ""testcases"");
        tests.mkdirs();
        CompatibilityBuildProvider provider = new CompatibilityBuildProvider();
        OptionSetter setter = new OptionSetter(provider);
        setter.setOptionValue(""plan"", SUITE_PLAN);
        setter.setOptionValue(""dynamic-config-url"", DYNAMIC_CONFIG_URL);
        IBuildInfo info = provider.getBuild();
        CompatibilityBuildHelper helper = new CompatibilityBuildHelper(info);
        assertEquals(""Incorrect suite full name"", SUITE_FULL_NAME, helper.getSuiteFullName());
        assertEquals(""Incorrect suite name"", SUITE_NAME, helper.getSuiteName());
        FileUtil.recursiveDelete(root);
    }
}"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/tradefed/CtsTradefedTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.tradefed.presubmit.PresubmitSetupValidation"	"testCtsPresubmit_unit_tests"	""	"1: UI"	"public void testCtsPresubmit_unit_tests() {
        IConfigurationFactory factory = ConfigurationFactory.getInstance();
        String[] presubmitCommand = {PRESUBMIT_CTS_UNIT_TESTS, ""--template:map"", ""reporters=empty""};
        try {
            factory.createConfigurationFromArgs(presubmitCommand);
        } catch (ConfigurationException e) {
            CLog.e(e);
            fail(String.format(""ConfigException '%s': One of your change is breaking the presubmit ""
                    + ""CTS unit tests configuration."", e.getMessage()));
        }
    }

    /**
     * Test to ensure that Zip dependency on the Apache Commons Compress coming from TradeFed is
     * properly setup. This dependency is required for some utilities of TradeFed to work.
     */"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/common/tradefed/presubmit/PresubmitSetupValidation.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.tradefed.presubmit.ValidateTestsAbi"	"testApksAbis"	""	"2: UI only"	"public void testApksAbis() {
        String ctsRoot = System.getProperty(""CTS_ROOT"");
        File testcases = new File(ctsRoot, ""/android-cts/testcases/"");
        if (!testcases.exists()) {
            fail(String.format(""%s does not exists"", testcases));
            return;
        }
        File[] listApks = testcases.listFiles(new FilenameFilter() {
            @Override
            public boolean accept(File dir, String name) {
                for (String apk : APK_EXCEPTIONS) {
                    if (name.startsWith(apk)) {
                        return false;
                    }
                }

                return name.endsWith("".apk"");
            }
        });
        assertTrue(listApks.length > 0);
        int maxAbi = 0;
        Map<String, Integer> apkToAbi = new HashMap<>();

        for (File testApk : listApks) {
            AaptParser result = AaptParser.parse(testApk);
            // Retry as we have seen flake with aapt sometimes.
            if (result == null) {
                for (int i = 0; i < 2; i++) {
                    result = AaptParser.parse(testApk);
                    if (result != null) {
                        break;
                    }
                }
                // If still couldn't parse the apk
                if (result == null) {
                    fail(String.format(""Fail to run 'aapt dump badging %s'"",
                            testApk.getAbsolutePath()));
                }
            }
            // We only check the apk that have native code
            if (!result.getNativeCode().isEmpty()) {
                List<String> supportedAbiApk = result.getNativeCode();
                Set<String> buildTarget = AbiUtils.getAbisForArch(
                        TestSuiteInfo.getInstance().getTargetArchs().get(0));
                // first check, all the abis in the buildTarget are supported
                for (String abiBT : buildTarget) {
                    Boolean findMatch = false;
                    for (String abiApk : supportedAbiApk) {
                        if (abiApk.equals(abiBT)) {
                            findMatch = true;
                            break;
                        }
                    }
                    if (!findMatch) {
                        fail(String.format(""apk %s %s does not support our abis [%s]"",
                                testApk.getName(), supportedAbiApk, buildTarget));
                    }
                }
                apkToAbi.put(testApk.getName(), supportedAbiApk.size());
                maxAbi = Math.max(maxAbi, buildTarget.size());
            }
        }

        // We do a second pass to make sure nobody is short on abi
        for (Entry<String, Integer> apk : apkToAbi.entrySet()) {
            if (apk.getValue() < maxAbi) {
                fail(String.format(""apk %s only has %s abi when it should have %s"", apk.getKey(),
                        apk.getValue(), maxAbi));
            }
        }
    }

    /**
     * Test that when CTS has multiple abis, we have binary for each ABI. In this case the abi will
     * be the same with different bitness (only case supported by build system).
     * <p/>
     * If there is only one bitness, then we check that it's the right one.
     */"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/common/tradefed/presubmit/ValidateTestsAbi.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.tradefed.presubmit.ValidateTestsAbi"	"testBinariesAbis"	""	"2: UI app"	"public void testBinariesAbis() {
        String ctsRoot = System.getProperty(""CTS_ROOT"");
        File testcases = new File(ctsRoot, ""/android-cts/testcases/"");
        if (!testcases.exists()) {
            fail(String.format(""%s does not exist"", testcases));
            return;
        }
        String[] listBinaries = testcases.list(new FilenameFilter() {
            @Override
            public boolean accept(File dir, String name) {
                if (name.contains(""."")) {
                    return false;
                }
                if (BINARY_EXCEPTIONS.contains(name)) {
                    return false;
                }
                for (String suffixException : BINARY_SUFFIX_EXCEPTIONS) {
                    if (name.endsWith(suffixException)) {
                        return false;
                    }
                }
                File file = new File(dir, name);
                if (file.isDirectory()) {
                    return false;
                }
                if (!file.canExecute()) {
                    return false;
                }
                try {
                    // Ignore python binaries
                    if (FileUtil.readStringFromFile(file).startsWith(""#!/usr/bin/env python"")) {
                        return false;
                    }
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
                for(String pattern: BINARY_EXCEPTIONS_REGEX) {
                    Matcher matcher = Pattern.compile(pattern).matcher(name);
                    if (matcher.matches()) {
                        return false;
                    }
                }
                return true;
            }
        });
        assertTrue(listBinaries.length > 0);
        List<String> orderedList = Arrays.asList(listBinaries);
        // we sort to have binary starting with same name, next to each other. The last two
        // characters of their name with be the bitness (32 or 64).
        Collections.sort(orderedList);
        Set<String> buildTarget = AbiUtils.getAbisForArch(
                TestSuiteInfo.getInstance().getTargetArchs().get(0));
        // We expect one binary per abi of CTS, they should be appended with 32 or 64
        for (int i = 0; i < orderedList.size(); i=i + buildTarget.size()) {
            List<String> subSet = orderedList.subList(i, i + buildTarget.size());
            if (subSet.size() > 1) {
                String base = subSet.get(0).substring(0, subSet.get(0).length() - 2);
                for (int j = 0; j < subSet.size(); j++) {
                    assertEquals(base, subSet.get(j).substring(0, subSet.get(j).length() - 2));
                }
            } else {
                String bitness = AbiUtils.getBitness(buildTarget.iterator().next());
                assertTrue(subSet.get(i).endsWith(bitness));
            }
        }
    }
}"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/common/tradefed/presubmit/ValidateTestsAbi.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.tradefed.presubmit.CtsConfigLoadingTest"	"testConfigurationLoad"	""	"3: data UI app"	"public void testConfigurationLoad() throws Exception {
        String ctsRoot = System.getProperty(""CTS_ROOT"");
        File testcases = new File(ctsRoot, ""/android-cts/testcases/"");
        if (!testcases.exists()) {
            fail(String.format(""%s does not exists"", testcases));
            return;
        }
        File[] listConfig = testcases.listFiles(new FilenameFilter() {
            @Override
            public boolean accept(File dir, String name) {
                if (name.endsWith("".config"")) {
                    return true;
                }
                return false;
            }
        });
        assertTrue(listConfig.length > 0);
        // Create a FolderBuildInfo to similate the CompatibilityBuildProvider
        FolderBuildInfo stubFolder = new FolderBuildInfo(""-1"", ""-1"");
        stubFolder.setRootDir(new File(ctsRoot));
        stubFolder.addBuildAttribute(CompatibilityBuildHelper.SUITE_NAME, ""CTS"");
        stubFolder.addBuildAttribute(""ROOT_DIR"", ctsRoot);
        TestInformation stubTestInfo = TestInformation.newBuilder().build();
        stubTestInfo.executionFiles().put(FilesKey.TESTS_DIRECTORY, new File(ctsRoot));

        List<String> missingMandatoryParameters = new ArrayList<>();
        // We expect to be able to load every single config in testcases/
        for (File config : listConfig) {
            IConfiguration c = ConfigurationFactory.getInstance()
                    .createConfigurationFromArgs(new String[] {config.getAbsolutePath()});
            if (c.getDeviceConfig().size() > 2) {
                throw new ConfigurationException(String.format(""%s declares more than 2 devices."", config));
            }
            for (IDeviceConfiguration dConfig : c.getDeviceConfig()) {
                // Ensure the deprecated ApkInstaller is not used anymore.
                for (ITargetPreparer prep : dConfig.getTargetPreparers()) {
                    if (prep.getClass().isAssignableFrom(ApkInstaller.class)) {
                        throw new ConfigurationException(
                                String.format(""%s: Use com.android.tradefed.targetprep.suite.""
                                        + ""SuiteApkInstaller instead of com.android.compatibility.""
                                        + ""common.tradefed.targetprep.ApkInstaller, options will be ""
                                        + ""the same."", config));
                    }
                    if (prep.getClass().isAssignableFrom(PreconditionPreparer.class)) {
                        throw new ConfigurationException(
                                String.format(
                                        ""%s: includes a PreconditionPreparer (%s) which is not ""
                                                + ""allowed in modules."",
                                        config.getName(), prep.getClass()));
                    }
                    if (prep.getClass().isAssignableFrom(DeviceSetup.class)) {
                       DeviceSetup deviceSetup = (DeviceSetup) prep;
                       if (!deviceSetup.isForceSkipSystemProps()) {
                           throw new ConfigurationException(
                                   String.format(""%s: %s needs to be configured with ""
                                           + ""<option name=\""force-skip-system-props\"" ""
                                           + ""value=\""true\"" /> in CTS."",
                                                 config.getName(), prep.getClass()));
                       }
                    }
                }
            }
            // We can ensure that Host side tests are not empty.
            for (IRemoteTest test : c.getTests()) {
                // Check that all the tests runners are well supported.
                if (!SUPPORTED_CTS_TEST_TYPE.contains(test.getClass().getCanonicalName())) {
                    throw new ConfigurationException(
                            String.format(
                                    ""testtype %s is not officially supported by CTS. ""
                                            + ""The supported ones are: %s"",
                                    test.getClass().getCanonicalName(), SUPPORTED_CTS_TEST_TYPE));
                }
                if (test instanceof HostTest) {
                    HostTest hostTest = (HostTest) test;
                    // We inject a made up folder so that it can find the tests.
                    hostTest.setBuild(stubFolder);
                    hostTest.setTestInformation(stubTestInfo);
                    int testCount = hostTest.countTestCases();
                    if (testCount == 0) {
                        throw new ConfigurationException(
                                String.format(""%s: %s reports 0 test cases."",
                                        config.getName(), test));
                    }
                }
                if (test instanceof GTest) {
                    if (((GTest) test).isRebootBeforeTestEnabled()) {
                        throw new ConfigurationException(String.format(
                                ""%s: instead of reboot-before-test use a RebootTargetPreparer ""
                                + ""which is more optimized during sharding."", config.getName()));
                    }
                }
                // Tests are expected to implement that interface.
                if (!(test instanceof ITestFilterReceiver)) {
                    throw new IllegalArgumentException(String.format(
                            ""Test in module %s must implement ITestFilterReceiver."",
                            config.getName()));
                }
                // Ensure that the device runner is the AJUR one if explicitly specified.
                if (test instanceof AndroidJUnitTest) {
                    AndroidJUnitTest instru = (AndroidJUnitTest) test;
                    if (instru.getRunnerName() != null &&
                            !ALLOWED_INSTRUMENTATION_RUNNER_NAME.contains(instru.getRunnerName())) {
                        // Some runner are exempt
                        if (!RUNNER_EXCEPTION.contains(instru.getRunnerName())) {
                            throw new ConfigurationException(
                                    String.format(""%s: uses '%s' instead of on of '%s' that are ""
                                            + ""expected"", config.getName(), instru.getRunnerName(),
                                            ALLOWED_INSTRUMENTATION_RUNNER_NAME));
                        }
                    }
                }
            }

            ConfigurationDescriptor cd = c.getConfigurationDescription();
            Assert.assertNotNull(config + "": configuration descriptor is null"", cd);
            List<String> component = cd.getMetaData(METADATA_COMPONENT);
            Assert.assertNotNull(String.format(""Missing module metadata field \""component\"", ""
                    + ""please add the following line to your AndroidTest.xml:\n""
                    + ""<option name=\""config-descriptor:metadata\"" key=\""component\"" ""
                    + ""value=\""...\"" />\nwhere \""value\"" must be one of: %s\n""
                    + ""config: %s"", KNOWN_COMPONENTS, config),
                    component);
            Assert.assertEquals(String.format(""Module config contains more than one \""component\"" ""
                    + ""metadata field: %s\nconfig: %s"", component, config),
                    1, component.size());
            String cmp = component.get(0);
            Assert.assertTrue(String.format(""Module config contains unknown \""component\"" metadata ""
                    + ""field \""%s\"", supported ones are: %s\nconfig: %s"",
                    cmp, KNOWN_COMPONENTS, config), KNOWN_COMPONENTS.contains(cmp));

            if (""misc"".equals(cmp)) {
                String configFileName = config.getName();
                Assert.assertTrue(
                        String.format(
                                ""Adding new module %s to \""misc\"" component is restricted, ""
                                        + ""please pick a component that your module fits in"",
                                configFileName),
                        KNOWN_MISC_MODULES.contains(configFileName));
            }

            // Check that specified parameters are expected
            boolean res =
                    checkModuleParameters(
                            config.getName(), cd.getMetaData(ITestSuite.PARAMETER_KEY));
            if (!res) {
                missingMandatoryParameters.add(config.getName());
            }
            // Check that specified tokens are expected
            checkTokens(config.getName(), cd.getMetaData(ITestSuite.TOKEN_KEY));

            // Ensure each CTS module is tagged with <option name=""test-suite-tag"" value=""cts"" />
            Assert.assertTrue(String.format(
                    ""Module config %s does not contains ""
                    + ""'<option name=\""test-suite-tag\"" value=\""cts\"" />'"", config.getName()),
                    cd.getSuiteTags().contains(""cts""));

            // Check not-shardable: JarHostTest cannot create empty shards so it should never need
            // to be not-shardable.
            if (cd.isNotShardable()) {
                for (IRemoteTest test : c.getTests()) {
                    if (test.getClass().isAssignableFrom(JarHostTest.class)) {
                        throw new ConfigurationException(
                                String.format(""config: %s. JarHostTest does not need the ""
                                    + ""not-shardable option."", config.getName()));
                    }
                }
            }
            // Ensure options have been set
            c.validateOptions();
        }

        // Exempt the allow list
        missingMandatoryParameters.removeAll(ALLOWLIST_MODULE_PARAMETERS);
        // Ensure the mandatory fields are filled
        if (!missingMandatoryParameters.isEmpty()) {
            String msg =
                    String.format(
                            ""The following %s modules are missing some of the mandatory ""
                                    + ""parameters [instant_app, not_instant_app, ""
                                    + ""multi_abi, not_multi_abi, ""
                                    + ""secondary_user, not_secondary_user]: '%s'"",
                            missingMandatoryParameters.size(), missingMandatoryParameters);
            throw new ConfigurationException(msg);
        }
    }

    /** Test that all parameter metadata can be resolved. */
    private boolean checkModuleParameters(String configName, List<String> parameters)
            throws ConfigurationException {
        if (parameters == null) {
            return false;
        }
        Map<String, Boolean> families = createFamilyCheckMap();
        for (String param : parameters) {
            try {
                ModuleParameters p = ModuleParameters.valueOf(param.toUpperCase());
                if (families.containsKey(p.getFamily())) {
                    families.put(p.getFamily(), true);
                }
            } catch (IllegalArgumentException e) {
                throw new ConfigurationException(
                        String.format(""Config: %s includes an unknown parameter '%s'."",
                                configName, param));
            }
        }
        if (families.containsValue(false)) {
            return false;
        }
        return true;
    }

    /** Test that all tokens can be resolved. */
    private void checkTokens(String configName, List<String> tokens) throws ConfigurationException {
        if (tokens == null) {
            return;
        }
        for (String token : tokens) {
            try {
                TokenProperty.valueOf(token.toUpperCase());
            } catch (IllegalArgumentException e) {
                throw new ConfigurationException(
                        String.format(
                                ""Config: %s includes an unknown token '%s'."", configName, token));
            }
        }
    }

    private Map<String, Boolean> createFamilyCheckMap() {
        Map<String, Boolean> families = new HashMap<>();
        for (String family : MANDATORY_PARAMETERS_FAMILY) {
            families.put(family, false);
        }
        return families;
    }
}"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/common/tradefed/presubmit/CtsConfigLoadingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.compatibility.common.tradefed.presubmit.ApkPackageNameCheck"	"testApkPackageNames"	""	"1: app"	"public void testApkPackageNames() throws Exception {
        String ctsRoot = System.getProperty(""CTS_ROOT"");
        File testcases = new File(ctsRoot, ""/android-cts/testcases/"");
        if (!testcases.exists()) {
            fail(String.format(""%s does not exists"", testcases));
            return;
        }
        File[] listConfig = testcases.listFiles(new FilenameFilter() {
            @Override
            public boolean accept(File dir, String name) {
                if (name.endsWith("".config"")) {
                    return true;
                }
                return false;
            }
        });
        assertTrue(listConfig.length > 0);
        // We check all apk installed by all modules
        Map<String, String> packageNames = new HashMap<>();

        for (File config : listConfig) {
            IConfiguration c = ConfigurationFactory.getInstance()
                    .createConfigurationFromArgs(new String[] {config.getAbsolutePath()});
            // For each config, we check all the apk it's going to install
            List<File> apkNames = new ArrayList<>();
            List<String> packageListNames = new ArrayList<>();
            for (IDeviceConfiguration dConfig : c.getDeviceConfig()) {
                for (ITargetPreparer prep : dConfig.getTargetPreparers()) {
                    if (prep instanceof TestAppInstallSetup) {
                        apkNames.addAll(((TestAppInstallSetup) prep).getTestsFileName());
                    }
                    // Ensure the files requested to be pushed exist.
                    if (prep instanceof FilePusher && ((FilePusher) prep).shouldAppendBitness()) {
                        for (File f : ((PushFilePreparer) prep).getPushSpecs(null).values()) {
                            String path = f.getPath();
                            if (!new File(testcases, path + ""32"").exists()
                                    || !new File(testcases, path + ""64"").exists()) {
                                // TODO: Enforce should abort on failure is True in CTS
                                if (((FilePusher) prep).shouldAbortOnFailure()) {
                                    fail(
                                            String.format(
                                                    ""File %s[32/64] wasn't found in testcases/ while ""
                                                            + ""it's expected to be pushed as part of ""
                                                            + ""%s"",
                                                    path, config.getName()));
                                }
                            }
                        }
                    } else if (prep instanceof PushFilePreparer) {
                        for (File f : ((PushFilePreparer) prep).getPushSpecs(null).values()) {
                            String path = f.getPath();
                            if (!new File(testcases, path).exists()) {
                                // TODO: Enforce should abort on failure is True in CTS
                                if (((PushFilePreparer) prep).shouldAbortOnFailure()) {
                                    fail(
                                            String.format(
                                                    ""File %s wasn't found in testcases/ while it's ""
                                                            + ""expected to be pushed as part of %s"",
                                                    path, config.getName()));
                                }
                            }
                        }
                    }
                }
    
                for (File apk : apkNames) {
                    String apkName = apk.getName();
                    File apkFile = new File(testcases, apkName);
                    if (!apkFile.exists()) {
                        fail(String.format(""Module %s is trying to install %s which does not ""
                                + ""exists in testcases/"", config.getName(), apkFile));
                    }
                    AaptParser res = AaptParser.parse(apkFile);
                    assertNotNull(res);
                    String packageName = res.getPackageName();
                    String put = packageNames.put(packageName, apkName);
                    packageListNames.add(packageName);
                    // The package already exists and it's a different apk
                    if (put != null && !apkName.equals(put) && !EXCEPTION_LIST.contains(packageName)) {
                        fail(String.format(""Module %s: Package name '%s' from apk '%s' was already ""
                                + ""added by previous apk '%s'."",
                                config.getName(), packageName, apkName, put));
                    }
                }
            }
            // Catch a test trying to run something it doesn't install.
            List<IRemoteTest> tests = c.getTests();
            for (IRemoteTest test : tests) {
                if (test instanceof InstrumentationTest) {
                    InstrumentationTest instrumentationTest = (InstrumentationTest) test;
                    if (instrumentationTest.getPackageName() != null) {
                        if (!packageListNames.contains(instrumentationTest.getPackageName())) {
                            throw new ConfigurationException(
                                    String.format(""Module %s requests to run '%s' but it's not ""
                                        + ""part of any apks."",
                                        config.getName(), instrumentationTest.getPackageName()));
                        }
                    }
                }
            }
        }
    }
}"	"/home/gpoor/cts-12-source/cts/tools/cts-tradefed/tests/src/com/android/compatibility/common/tradefed/presubmit/ApkPackageNameCheck.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"IncrementalDeqpTest"	"assert_not_called"	""	"4: data called UI only"	"public void test# Lint as: python3
#
#.

""""""Tests for incremental_deqp.""""""

import incremental_deqp
import os
import unittest
from unittest.mock import MagicMock
from unittest.mock import patch

@patch('incremental_deqp.AdbHelper', MagicMock())
class IncrementalDeqpTest(unittest.TestCase):

  def setUp(self):
    testfile_dir = os.path.dirname(os.path.abspath(__file__))
    self.testdata_dir = testfile_dir +'/testdata'
    self.dependency_collector = incremental_deqp.DeqpDependencyCollector(None, None, None)
    self.parser = incremental_deqp._get_parser()

  def test_update_dependency(self):
    """"""Test update_dependency gets correct dEQP dependency from dump file.""""""
    dump_file = 'testdata/perf_dump.txt'
    deps = set()
    self.dependency_collector.update_dependency(deps, dump_file)
    self.assertEqual(len(deps),2)
    self.assertIn('file_2', deps)
    self.assertIn('file_3', deps)

  def test_check_test_log_all_test_executed(self):
    """"""Test check_test_log returns true if all tests are executed.""""""
    test_file = 'testdata/test_list.txt'
    log_file = 'testdata/log_1.qpa'
    self.assertTrue(self.dependency_collector.check_test_log(test_file, log_file))

  def test_check_test_log_test_crashed(self):
    """"""Test check_test_log returns false if tests are crashed.""""""
    test_file = 'testdata/test_list.txt'
    log_file = 'testdata/log_2.qpa'
    self.assertFalse(self.dependency_collector.check_test_log(test_file, log_file))

  def test_get_test_binary_name(self):
    """"""Test get_test_binary_name gets dEQP binary name based on test name.""""""
    self.assertEqual(self.dependency_collector.get_test_binary_name('vk-32'), 'deqp-binary')
    self.assertEqual(self.dependency_collector.get_test_binary_name('vk-64'), 'deqp-binary64')
    with self.assertRaises(incremental_deqp.TestError):
      self.dependency_collector.get_test_binary_name('test')

  def test_get_test_log_name(self):
    """"""Test get_test_log_name gets correct test log name based on test name.""""""
    self.assertEqual(self.dependency_collector.get_test_log_name('test'), 'test.qpa')

  def test_get_perf_name(self):
    """"""Test get_perf_name gets correct perf file name based on test name.""""""
    self.assertEqual(self.dependency_collector.get_test_perf_name('test'), 'test.data')

  def test_get_perf_dump_name(self):
    """"""Test get_perf_dump_name gets correct perf dump file name based on test name.""""""
    self.assertEqual(self.dependency_collector.get_perf_dump_name('test'), 'test-perf-dump.txt')

  def test_get_test_list_name(self):
    """"""Test get_test_list_name gets test list name based on test name.""""""
    self.assertEqual(self.dependency_collector.get_test_list_name('vk-32'), 'vk-master-subset.txt')
    self.assertEqual(self.dependency_collector.get_test_list_name('gles3-32'),
                     'gles3-master-subset.txt')
    with self.assertRaises(incremental_deqp.TestError):
      self.dependency_collector.get_test_list_name('test')

  def test_valid_dependency(self):
    """"""Test if dependency is valid.""""""
    self.assertTrue(incremental_deqp._is_deqp_dependency('/file/a.so'))
    self.assertFalse(incremental_deqp._is_deqp_dependency('/apex/a.so'))

  def test_build_helper_compare_build_with_device_files_true(self):
    """"""Test BuildHelper.compare_base_build_with_device_files returns true.""""""
    build_helper = incremental_deqp.BuildHelper()
    deqp_deps = ['/system/deqp_dependency_file_a.so', '/vendor/deqp_dependency_file_b.so']
    base_build_file = './testdata/base_build_target-files.zip'

    def side_effect(command):
      if 'file_a.so' in command:
        return b'placeholder\nplaceholder\n'
      if 'file_b.so' in command:
        return b'placeholder\nplaceholder\nplaceholder\n\n'

    adb = incremental_deqp.AdbHelper()
    adb.run_shell_command = MagicMock(side_effect=side_effect)
    self.assertTrue(build_helper.compare_base_build_with_device_files(
        deqp_deps, adb, base_build_file)[0])

  def test_compare_build_with_device_files_false(self):
    """"""Test BuildHelper.compare_base_build_with_device_files returns false.""""""
    deqp_deps = ['/system/deqp_dependency_file_a.so', '/vendor/deqp_dependency_file_b.so']
    build_helper = incremental_deqp.BuildHelper()
    base_build_file = './testdata/base_build_target-files.zip'
    def side_effect(command):
      if 'file_a.so' in command:
        return b'different text'
      if 'file_b.so' in command:
        return b'placeholder\nplaceholder\nplaceholder\n\n'

    adb = incremental_deqp.AdbHelper()
    adb.run_shell_command = MagicMock(side_effect=side_effect)
    self.assertFalse(build_helper.compare_base_build_with_device_files(
        deqp_deps, adb, base_build_file)[0])

  def test_build_helper_compare_build_with_current_build_true(self):
    """"""Test BuildHelper.compare_base_build_with_current_build returns true.""""""
    build_helper = incremental_deqp.BuildHelper()
    deqp_deps = ['/system/deqp_dependency_file_a.so', '/vendor/deqp_dependency_file_b.so']
    base_build_file = './testdata/base_build_target-files.zip'

    self.assertTrue(build_helper.compare_base_build_with_current_build(
        deqp_deps, base_build_file, base_build_file)[0])

  def test_build_helper_compare_build_with_current_build_false(self):
    """"""Test BuildHelper.compare_base_build_with_current_build returns false.""""""
    build_helper = incremental_deqp.BuildHelper()
    deqp_deps = ['/system/deqp_dependency_file_a.so', '/vendor/deqp_dependency_file_b.so']
    base_build_file = './testdata/base_build_target-files.zip'
    current_build_file = './testdata/current_build_target-files.zip'

    self.assertFalse(build_helper.compare_base_build_with_current_build(
        deqp_deps, current_build_file, base_build_file)[0])

  def test_build_helper_get_system_fingerprint(self):
    """"""Test BuildHelper gets system fingerprint.""""""
    build_helper = incremental_deqp.BuildHelper()
    build_file = './testdata/base_build_target-files.zip'

    self.assertEqual(('generic/aosp_cf_x86_64_phone/vsoc_x86_64:S/AOSP.MASTER/7363308:'
                      'userdebug/test-keys'), build_helper.get_system_fingerprint(build_file))


  @patch('incremental_deqp.BuildHelper', autospec=True)
  @patch('incremental_deqp._save_deqp_deps', autospec=True)
  @patch('incremental_deqp.DeqpDependencyCollector', autospec=True)
  @patch('incremental_deqp.AdbHelper', autospec=True)
  def test_local_run_generate_deps_only(self, adb_helper_mock, dependency_collector_mock,
                                        save_deps_mock, build_helper_mock):
    """"""Test generate_deps_only option in local_run.""""""
    dependency_collector_mock.return_value.get_deqp_dependency.return_value = {'a.so'}
    args = self.parser.parse_args(['--generate_deps_only'])
    incremental_deqp._local_run(args, '')
    save_deps_mock.assert_called_once_with({'a.so'}, 'dEQP-dependency.txt')
    build_helper_mock.assert_not_called()

  def test_local_run_missing_extra_deps(self):
    """"""Test local_run throws exception if extra_deqp_dependency.txt is missing.""""""
    args = self.parser.parse_args(['-t ./testdata'])
    with self.assertRaises(incremental_deqp.TestResourceError):
      incremental_deqp._local_run(args, '')

  @patch('incremental_deqp._generate_report', autospec=True)
  @patch('incremental_deqp.BuildHelper', autospec=True)
  @patch('incremental_deqp._save_deqp_deps', autospec=True)
  @patch('incremental_deqp.DeqpDependencyCollector', autospec=True)
  @patch('incremental_deqp.AdbHelper', autospec=True)
  def test_local_run_compare_build(self, adb_helper_mock, dependency_collector_mock,
                                   save_deps_mock, build_helper_mock, generate_report_mock):
    """"""Test local_run could compare build based on dependency.""""""
    dependency_collector_mock.return_value.get_deqp_dependency.return_value = {'a.so'}
    build_helper_mock.return_value.compare_base_build_with_device_files.return_value = [False, {}]
    args = self.parser.parse_args(['-b', 'base_build', '-t', self.testdata_dir])

    incremental_deqp._local_run(args, '')

    save_deps_mock.assert_called_once_with({'a.so', 'extra_a.so'}, 'dEQP-dependency.txt')
    build_helper_mock.assert_called_once_with(False)

if __name__ == '__main__':
  unittest.main()"	"/home/gpoor/cts-12-source/cts/tools/incremental-cts/incremental_deqp_test.py"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.format.f1.Test_f1"	"testVFE10"	""	"1: section"	"public void testVFE10() {
//        try {
//            Class.forName(""dot.junit.format.f1.d.T_f1_10"");
//            fail(""expected a verification exception but this test may fail if this check is not enforced"");
//        } catch (Throwable t) {
//            DxUtil.checkVerifyException(t);
//        }
//    }
    
    /**
     * @constraint n/a
     * @title header and map section mismatch 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/format/f1/Test_f1.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.format.f1.Test_f1"	"testVFE11"	""	"2: section app"	"public void testVFE11() {
        try {
            Class.forName(""dot.junit.format.f1.d.T_f1_11"");
            fail(""expected a verification exception"");
        } catch (Throwable t) {
            DxUtil.checkVerifyException(t);
        }
    }
    
    /**
     * @constraint n/a
     * @title overlapping sections 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/format/f1/Test_f1.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_byte.Test_iput_byte"	"testVFE18"	""	"2: accessed only"	"public void testVFE18() {
        load(""dot.junit.opcodes.iput_byte.d.T_iput_byte_24"", VerifyError.class);
    }


    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_byte/Test_iput_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_byte.Test_iput_byte"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_byte.d.T_iput_byte_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_byte/Test_iput_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_byte.Test_iput_byte"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_byte.d.T_iput_byte_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B14
     * @title put byte into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_byte/Test_iput_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long_2addr.Test_rem_long_2addr"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_rem_long_2addr_1 t = new T_rem_long_2addr_1();
        assertEquals(2000000000l, t.run(10000000000l, 4000000000l));
    }

    /**
     * @title Arguments = 1234567890123l, 123456789l
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long_2addr/Test_rem_long_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long_2addr.Test_rem_long_2addr"	"testN2"	""	"1: 9.1"	"public void testN2() {
        T_rem_long_2addr_1 t = new T_rem_long_2addr_1();
        assertEquals(123l, t.run(1234567890123l, 123456789l));
    }

    /**
     * @title Dividend = 0
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long_2addr/Test_rem_long_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long_2addr.Test_rem_long_2addr"	"testN3"	""	"1: 9.1"	"public void testN3() {
        T_rem_long_2addr_1 t = new T_rem_long_2addr_1();
        assertEquals(0l, t.run(0l, 1234567890123l));
    }

    /**
     * @title Dividend is negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long_2addr/Test_rem_long_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long_2addr.Test_rem_long_2addr"	"testE1"	""	"1: 9.1"	"public void testE1() {
        loadAndRun(""dot.junit.opcodes.rem_long_2addr.d.T_rem_long_2addr_1"",
                   ArithmeticException.class, 1234567890123l, 0l);
    }

    /**
     * @constraint A24 
     * @title number of registers
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long_2addr/Test_rem_long_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_object.Test_sget_object"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_object.d.T_sget_object_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read object from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_object/Test_sget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_object.Test_sget_object"	"testVFE14"	""	"1: only"	"public void testVFE14() {
        load(""dot.junit.opcodes.sget_object.d.T_sget_object_20"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title only field of different type exists)
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_object/Test_sget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testN1"	""	"1: data"	"public void testN1() {
        int arr[] = new int[5];
        T_fill_array_data_1 t = new T_fill_array_data_1();
        t.run(arr);
        for(int i = 0; i < 5; i++)
            assertEquals(i + 1, arr[i]);
     }
    
    /**
     * @title array of doubles
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testN2"	""	"1: data"	"public void testN2() {
        double arr[] = new double[5];
        T_fill_array_data_2 t = new T_fill_array_data_2();
        t.run(arr);
        for(int i = 0; i < 5; i++)
            assertEquals((double)(i + 1), arr[i]);
     }

    /**
     * @title If there are less elements in the table than the array provides space for, 
     * the remaining array elements stay untouched.  
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testN3"	""	"1: data"	"public void testN3() {
        int arr[] = new int[10];
        T_fill_array_data_1 t = new T_fill_array_data_1();
        t.run(arr);
        for(int i = 0; i < 5; i++)
            assertEquals(i + 1, arr[i]);
        for(int i = 5; i < 10; i++)
            assertEquals(0, arr[i]);
     }
    
    /**
     * @title expected NullPointerException  
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testE1"	""	"1: data"	"public void testE1() {
        T_fill_array_data_1 t = new T_fill_array_data_1();
        try {
            t.run(null);
        } catch(NullPointerException npe) {
            // expected
        }
     }
    
    /**
     * @title expected ArrayIndexOutOfBoundsException  
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testE2"	""	"1: data"	"public void testE2() {
        int arr[] = new int[2];
        T_fill_array_data_1 t = new T_fill_array_data_1();
       try {
            t.run(arr);
        } catch(ArrayIndexOutOfBoundsException e) {
            // expected
           }
     }
    
    /**
     * @constraint A23 
     * @title number of registers
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE1"	""	"1: data"	"public void testVFE1() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_3"", VerifyError.class);
    }

    /**
     * @constraint B1 
     * @title type of argument - double
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE2"	""	"1: data"	"public void testVFE2() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_4"", VerifyError.class);
    }
    
    /**
     * @constraint B1 
     * @title type of argument - long
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE3"	""	"1: data"	"public void testVFE3() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_5"", VerifyError.class);
    }
    
    /**
     * @constraint B1 
     * @title type of argument - reference (not array)
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE4"	""	"1: data"	"public void testVFE4() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_6"", VerifyError.class);
    }
    
    /**
     * @constraint B1 
     * @title array of Objects
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE5"	""	"1: data"	"public void testVFE5() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_7"", VerifyError.class);
    }
    
    /**
     * @constraint B1 
     * @title array type and data size shall be consistent
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE6"	""	"1: data"	"public void testVFE6() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_8"", VerifyError.class);
    }

    /**
     * @constraint n/a
     * @title offset to table shall be inside method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE7"	""	"1: data"	"public void testVFE7() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_9"", VerifyError.class);
    }

    /**
     * @constraint n/a
     * @title the size and the list must be consistent. 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE9"	""	"1: data"	"public void testVFE9() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_11"", VerifyError.class);
    }

    
    /**
     * @constraint B22
     * @title packed-switch-data pseudo-instructions must not be reachable by control flow 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE10"	""	"1: data"	"public void testVFE10() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_12"", VerifyError.class);
    }
    
    /**
     * @constraint n/a
     * @title table has wrong ident code
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.fill_array_data.Test_fill_array_dat"	"testVFE11"	""	"1: data"	"public void testVFE11() {
        load(""dot.junit.opcodes.fill_array_data.d.T_fill_array_data_13"", VerifyError.class);
    }
}"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/fill_array_data/Test_fill_array_data.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_float_2addr.Test_rem_float_2addr"	"testVFE4"	""	"1: only"	"public void testVFE4() {
        load(""dot.junit.opcodes.rem_float_2addr.d.T_rem_float_2addr_5"", VerifyError.class);
    }

    /**
     * @constraint B1
     * @title Types of arguments - float, int. The verifier checks that ints
     * and floats are not used interchangeably.
     * Note: This test works only in ICS and beyond.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_float_2addr/Test_rem_float_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_char.Test_iget_char"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget_char.d.T_iget_char_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_char/Test_iget_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_char.Test_iget_char"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_char.d.T_iget_char_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference values.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_char/Test_iget_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_char.Test_iget_char"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_char.d.T_iget_char_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read char from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_char/Test_iget_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super.Test_invoke_super"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_super.d.T_invoke_super_8"", ClassNotFoundException.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke-super
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super/Test_invoke_super.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super.Test_invoke_super"	"testVFE5"	""	"1: called"	"public void testVFE5() {
        //@uses dot.junit.opcodes.invoke_super.d.TSuper
        load(""dot.junit.opcodes.invoke_super.d.T_invoke_super_12"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_super
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super/Test_invoke_super.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super.Test_invoke_super"	"testVFE18"	""	"1: only"	"public void testVFE18() {
        loadAndRun(""dot.junit.opcodes.invoke_super.d.T_invoke_super_24"",
                   AbstractMethodError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super/Test_invoke_super.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super.Test_invoke_super"	"testVFE6"	""	"1: accessing"	"public void testVFE6() {
        load(""dot.junit.opcodes.invoke_super.d.T_invoke_super_16"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super/Test_invoke_super.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super.Test_invoke_super"	"testVFE8"	""	"1: accessing"	"public void testVFE8() {
        //@uses dot.junit.opcodes.invoke_super.d.TSuper
        //@uses dot.junit.opcodes.invoke_super.d.TPlain
        load(""dot.junit.opcodes.invoke_super.d.T_invoke_super_22"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  public method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super/Test_invoke_super.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_byte.Test_iget_byte"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget_byte.d.T_iget_byte_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_byte/Test_iget_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_byte.Test_iget_byte"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_byte.d.T_iget_byte_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference values.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_byte/Test_iget_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_byte.Test_iget_byte"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_byte.d.T_iget_byte_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read byte from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_byte/Test_iget_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.long_to_float.Test_long_to_float"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_long_to_float_1 t = new T_long_to_float_1();
        assertEquals(1.23456788E14f, t.run(123456789012345l), 0f);
    }

    /**
     * @title Argument = 1
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/long_to_float/Test_long_to_float.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long.Test_rem_long"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_rem_long_1 t = new T_rem_long_1();
        assertEquals(2000000000l, t.run(10000000000l, 4000000000l));
    }

    /**
     * @title Arguments = 1234567890123l, 123456789l
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long/Test_rem_long.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long.Test_rem_long"	"testN2"	""	"1: 9.1"	"public void testN2() {
        T_rem_long_1 t = new T_rem_long_1();
        assertEquals(123l, t.run(1234567890123l, 123456789l));
    }

    /**
     * @title Dividend = 0
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long/Test_rem_long.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long.Test_rem_long"	"testN3"	""	"1: 9.1"	"public void testN3() {
        T_rem_long_1 t = new T_rem_long_1();
        assertEquals(0l, t.run(0l, 1234567890123l));
    }

    /**
     * @title Dividend is negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long/Test_rem_long.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.rem_long.Test_rem_long"	"testE1"	""	"1: 9.1"	"public void testE1() {
        loadAndRun(""dot.junit.opcodes.rem_long.d.T_rem_long_1"", ArithmeticException.class,
                   1234567890123l, 0l);
    }

    /**
     * @constraint A24 
     * @title number of registers
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/rem_long/Test_rem_long.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_boolean.Test_iget_boolean"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget_boolean.d.T_iget_boolean_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_boolean/Test_iget_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_boolean.Test_iget_boolean"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_boolean.d.T_iget_boolean_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference values.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_boolean/Test_iget_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_boolean.Test_iget_boolean"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_boolean.d.T_iget_boolean_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read boolean from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_boolean/Test_iget_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_wide.Test_sget_wide"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_sget_wide_1 t = new T_sget_wide_1();
        assertEquals(12345679890123l, t.run());
    }

    /**
     * @title type - double
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_wide/Test_sget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_wide.Test_sget_wide"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_wide.d.T_sget_wide_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read long from integer field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_wide/Test_sget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_wide.Test_iput_wide"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_iput_wide_1 t = new T_iput_wide_1();
        assertEquals(0, t.st_i1);
        t.run();
        assertEquals(778899112233l, t.st_i1);
    }

    /**
     * @title put double into field
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_wide/Test_iput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_wide.Test_iput_wide"	"testVFE6"	""	"2: accessed only"	"public void testVFE6() {
        load(""dot.junit.opcodes.iput_wide.d.T_iput_wide_6"", VerifyError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_wide/Test_iput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_wide.Test_iput_wide"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_wide.d.T_iput_wide_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_wide/Test_iput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_wide.Test_iput_wide"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_wide.d.T_iput_wide_4"", VerifyError.class);
    }

    /**
     *
     * @constraint B14
     * @title put int into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_wide/Test_iput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual.Test_invoke_virtual"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_8"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke-virtual
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual/Test_invoke_virtual.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual.Test_invoke_virtual"	"testVFE5"	""	"1: called"	"public void testVFE5() {
        load(""dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_12"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_virtual
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual/Test_invoke_virtual.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual.Test_invoke_virtual"	"testVFE18"	""	"1: only"	"public void testVFE18() {
        loadAndRun(""dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_24"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual/Test_invoke_virtual.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual.Test_invoke_virtual"	"testVFE6"	""	"1: accessing"	"public void testVFE6() {
        load(""dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_16"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual/Test_invoke_virtual.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual.Test_invoke_virtual"	"testVFE8"	""	"1: accessing"	"public void testVFE8() {
        //@uses dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_22
        //@uses dot.junit.opcodes.invoke_virtual.d.TSuper
        //@uses dot.junit.opcodes.invoke_virtual.d.TPlain
        load(""dot.junit.opcodes.invoke_virtual.d.T_invoke_virtual_22"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  public method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual/Test_invoke_virtual.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.div_int.Test_div_int"	"testN5"	""	"1: 9.1"	"public void testN5() {
        T_div_int_1 t = new T_div_int_1();
        assertEquals(-357913941, t.run(1073741824, -3));
    }

    /**
     * @title Both Dividend and divisor are negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/div_int/Test_div_int.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_boolean.Test_sget_boolean"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_boolean.d.T_sget_boolean_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read boolean from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_boolean/Test_sget_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.const_wide.Test_const_wide"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_const_wide_1 t = new T_const_wide_1();
        double a = 1234567890123232323232232323232323232323232323456788d;
        double b = 1d;
        assertEquals(a + b, t.run(), 0d);
    }
    
    /**
     * @title const-wide v253, 20000000000
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/const_wide/Test_const_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_object.Test_sput_object"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_object.d.T_sput_object_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put object into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_object/Test_sput_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_static_range.Test_invoke_static_range"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_static_range.d.T_invoke_static_range_3"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke_static_range
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_static_range/Test_invoke_static_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_static_range.Test_invoke_static_range"	"testVFE4"	""	"1: called"	"public void testVFE4() {
        load(""dot.junit.opcodes.invoke_static_range.d.T_invoke_static_range_11"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_static_range
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_static_range/Test_invoke_static_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_boolean.Test_sput_boolean"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_boolean.d.T_sput_boolean_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put boolean into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_boolean/Test_sput_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.div_int_2addr.Test_div_int_2addr"	"testN5"	""	"1: 9.1"	"public void testN5() {
        T_div_int_2addr_1 t = new T_div_int_2addr_1();
        assertEquals(-357913941, t.run(1073741824, -3));
    }

    /**
     * @title Both Dividend and divisor are negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/div_int_2addr/Test_div_int_2addr.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_short.Test_iput_short"	"testVFE18"	""	"2: accessed only"	"public void testVFE18() {
        load(""dot.junit.opcodes.iput_short.d.T_iput_short_24"", VerifyError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_short/Test_iput_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_short.Test_iput_short"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_short.d.T_iput_short_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_short/Test_iput_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_short.Test_iput_short"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_short.d.T_iput_short_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B14
     * @title put short into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_short/Test_iput_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.packed_switch.Test_packed_switch"	"testVFE9"	""	"1: data"	"public void testVFE9() {
        load(""dot.junit.opcodes.packed_switch.d.T_packed_switch_11"", VerifyError.class);
    }

    
    /**
     * @constraint B22
     * @title packed-switch-data pseudo-instructions must not be reachable by control flow 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/packed_switch/Test_packed_switch.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_interface.Test_invoke_interface"	"testVFE15"	""	"1: only"	"public void testVFE15() {
        //@uses dot.junit.opcodes.invoke_interface.ITest
        //@uses dot.junit.opcodes.invoke_interface.ITestImpl
        loadAndRun(""dot.junit.opcodes.invoke_interface.d.T_invoke_interface_16"",
                   NoSuchMethodError.class, new ITestImpl());
    }


    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_interface/Test_invoke_interface.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_object.Test_iget_object"	"testVFE17"	""	"2: accessed only"	"public void testVFE17() {
        loadAndRun(""dot.junit.opcodes.iget_object.d.T_iget_object_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_object/Test_iget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_object.Test_iget_object"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_object.d.T_iget_object_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_object/Test_iget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_object.Test_iget_object"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_object.d.T_iget_object_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title  (read object from long field - only field with same name but
     * different type exists)
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_object/Test_iget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_object.Test_iget_object"	"testVFE14"	""	"1: only"	"public void testVFE14() {
        load(""dot.junit.opcodes.iget_object.d.T_iget_object_20"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title  only field of different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_object/Test_iget_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_wide.Test_iget_wide"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_iget_wide_1 t = new T_iget_wide_1();
        assertEquals(12345679890123l, t.run());
    }

    /**
     * @title type - double
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_wide/Test_iget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_wide.Test_iget_wide"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget_wide.d.T_iget_wide_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_wide/Test_iget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_wide.Test_iget_wide"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_wide.d.T_iget_wide_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_wide/Test_iget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_wide.Test_iget_wide"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_wide.d.T_iget_wide_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read long from integer field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_wide/Test_iget_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_interface_range.Test_invoke_interface_range"	"testVFE15"	""	"1: only"	"public void testVFE15() {
        //@uses dot.junit.opcodes.invoke_interface_range.ITest
        //@uses dot.junit.opcodes.invoke_interface_range.ITestImpl
        loadAndRun(""dot.junit.opcodes.invoke_interface_range.d.T_invoke_interface_range_16"",
                   NoSuchMethodError.class, new ITestImpl());
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_interface_range/Test_invoke_interface_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct.Test_invoke_direct"	"testVFE18"	""	"1: called"	"public void testVFE18() {
        load(""dot.junit.opcodes.invoke_direct.d.T_invoke_direct_17"", VerifyError.class);
    }

    /**
     * @constraint B8
     * @title attempt to access inherited instance field before <init> is called
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct/Test_invoke_direct.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct.Test_invoke_direct"	"testVFE17"	""	"1: only"	"public void testVFE17() {
        //@uses dot.junit.opcodes.invoke_direct.TAbstract
        loadAndRun(""dot.junit.opcodes.invoke_direct.d.T_invoke_direct_13"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B5
     * @title An instance initializer must only be invoked on an uninitialized instance.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct/Test_invoke_direct.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct.Test_invoke_direct"	"testVFE20"	""	"1: only"	"public void testVFE20() {
        loadAndRun(""dot.junit.opcodes.invoke_direct.d.T_invoke_direct_26"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct/Test_invoke_direct.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct.Test_invoke_direct"	"testVFE9"	""	"1: accessing"	"public void testVFE9() {
        load(""dot.junit.opcodes.invoke_direct.d.T_invoke_direct_24"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct/Test_invoke_direct.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_object.Test_iput_object"	"testVFE6"	""	"2: accessed only"	"public void testVFE6() {
        load(""dot.junit.opcodes.iput_object.d.T_iput_object_6"", VerifyError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_object/Test_iput_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_object.Test_iput_object"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_object.d.T_iput_object_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_object/Test_iput_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_object.Test_iput_object"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_object.d.T_iput_object_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B14
     * @title put object into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_object/Test_iput_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput.Test_sput"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput.d.T_sput_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title  put integer into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput/Test_sput.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sparse_switch.Test_sparse_switch"	"testVFE10"	""	"1: data"	"public void testVFE10() {
        load(""dot.junit.opcodes.sparse_switch.d.T_sparse_switch_12"", VerifyError.class);
    }
    
    /**
     * @constraint B22
     * @title sparse-switch-data pseudo-instructions must not be reachable by control flow 
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sparse_switch/Test_sparse_switch.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget.Test_sget"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget.d.T_sget_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read integer from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget/Test_sget.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_char.Test_iput_char"	"testVFE18"	""	"2: accessed only"	"public void testVFE18() {
        load(""dot.junit.opcodes.iput_char.d.T_iput_char_24"", VerifyError.class);
    }


    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_char/Test_iput_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_char.Test_iput_char"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_char.d.T_iput_char_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_char/Test_iput_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_char.Test_iput_char"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_char.d.T_iput_char_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B14
     * @title put char into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_char/Test_iput_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_byte.Test_sget_byte"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_byte.d.T_sget_byte_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read byte from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_byte/Test_sget_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput.Test_iput"	"testVFE18"	""	"2: accessed only"	"public void testVFE18() {
        load(""dot.junit.opcodes.iput.d.T_iput_24"", VerifyError.class);
    }


    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput/Test_iput.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput.Test_iput"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput.d.T_iput_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput/Test_iput.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput.Test_iput"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput.d.T_iput_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B14
     * @title put integer into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput/Test_iput.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_short.Test_sget_short"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_short.d.T_sget_short_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read short from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_short/Test_sget_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget.Test_iget"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget.d.T_iget_5"", IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget/Test_iget.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget.Test_iget"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget.d.T_iget_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference values.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget/Test_iget.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget.Test_iget"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget.d.T_iget_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read integer from long field - only field with same name but
     * different type exist
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget/Test_iget.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super_range.Test_invoke_super_range"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_8"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke-super
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super_range/Test_invoke_super_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super_range.Test_invoke_super_range"	"testVFE5"	""	"1: called"	"public void testVFE5() {
        //@uses dot.junit.opcodes.invoke_super_range.d.TSuper
        load(""dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_12"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_super_range
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super_range/Test_invoke_super_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super_range.Test_invoke_super_range"	"testVFE18"	""	"1: only"	"public void testVFE18() {
        //@uses dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_24
        loadAndRun(""dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_24"",
                   AbstractMethodError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super_range/Test_invoke_super_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super_range.Test_invoke_super_range"	"testVFE6"	""	"1: accessing"	"public void testVFE6() {
        load(""dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_16"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super_range/Test_invoke_super_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_super_range.Test_invoke_super_range"	"testVFE8"	""	"1: accessing"	"public void testVFE8() {
        //@uses dot.junit.opcodes.invoke_super_range.d.TSuper
        //@uses dot.junit.opcodes.invoke_super_range.d.TPlain
        load(""dot.junit.opcodes.invoke_super_range.d.T_invoke_super_range_22"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  public method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_super_range/Test_invoke_super_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_short.Test_iget_short"	"testVFE16"	""	"2: accessed only"	"public void testVFE16() {
        loadAndRun(""dot.junit.opcodes.iget_short.d.T_iget_short_5"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_short/Test_iget_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_short.Test_iget_short"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iget_short.d.T_iget_short_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_short/Test_iget_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iget_short.Test_iget_short"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iget_short.d.T_iget_short_3"", VerifyError.class);
    }

    /**
     * @constraint B13
     * @title read short from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iget_short/Test_iget_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual_range.Test_invoke_virtual_range"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_virtual_range.d.T_invoke_virtual_range_8"",
             VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke-virtual
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual_range/Test_invoke_virtual_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual_range.Test_invoke_virtual_range"	"testVFE5"	""	"1: called"	"public void testVFE5() {
        load(""dot.junit.opcodes.invoke_virtual_range.d.T_invoke_virtual_range_12"",
             VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_virtual_range
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual_range/Test_invoke_virtual_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual_range.Test_invoke_virtual_range"	"testVFE18"	""	"1: only"	"public void testVFE18() {
        loadAndRun(""dot.junit.opcodes.invoke_virtual_range.d.T_invoke_virtual_range_24"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual_range/Test_invoke_virtual_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual_range.Test_invoke_virtual_range"	"testVFE6"	""	"1: accessing"	"public void testVFE6() {
        load(""dot.junit.opcodes.invoke_virtual_range.d.T_invoke_virtual_range_16"",
             VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual_range/Test_invoke_virtual_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_virtual_range.Test_invoke_virtual_range"	"testVFE8"	""	"1: accessing"	"public void testVFE8() {
        //@uses dot.junit.opcodes.invoke_virtual_range.d.TSuper
        //@uses dot.junit.opcodes.invoke_virtual_range.d.TPlain
        load(""dot.junit.opcodes.invoke_virtual_range.d.T_invoke_virtual_range_22"",
             VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing
     *                  public method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_virtual_range/Test_invoke_virtual_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_static.Test_invoke_static"	"testN2"	""	"1: called"	"public void testN2() {
        //@uses dot.junit.opcodes.invoke_static.d.T_invoke_static_2
        //@uses dot.junit.opcodes.invoke_static.TestClass
        T_invoke_static_2 t = new T_invoke_static_2();
        assertEquals(777, t.run());
    }

    /**
     * @title Check that <clinit> is called
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_static/Test_invoke_static.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_static.Test_invoke_static"	"testVFE1"	""	"1: called"	"public void testVFE1() {
        load(""dot.junit.opcodes.invoke_static.d.T_invoke_static_3"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;clinit&gt; may not be called using invoke-static
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_static/Test_invoke_static.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_static.Test_invoke_static"	"testVFE4"	""	"1: called"	"public void testVFE4() {
        load(""dot.junit.opcodes.invoke_static.d.T_invoke_static_11"", VerifyError.class);
    }

    /**
     * @constraint A15
     * @title &lt;init&gt; may not be called using invoke_static
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_static/Test_invoke_static.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_byte.Test_sput_byte"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_byte.d.T_sput_byte_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put byte into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_byte/Test_sput_byte.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_boolean.Test_iput_boolean"	"testVFE18"	""	"2: accessed only"	"public void testVFE18() {
        load(""dot.junit.opcodes.iput_boolean.d.T_iput_boolean_24"", VerifyError.class);
    }

    /**
     * @constraint B6
     * @title instance fields may only be accessed on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_boolean/Test_iput_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_boolean.Test_iput_boolean"	"testVFE30"	""	"2: accessed only"	"public void testVFE30() {
        load(""dot.junit.opcodes.iput_boolean.d.T_iput_boolean_30"", VerifyError.class);
    }

    /**
     * @constraint N/A
     * @title instance fields may only be accessed on reference registers.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_boolean/Test_iput_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.iput_boolean.Test_iput_boolean"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.iput_boolean.d.T_iput_boolean_4"", VerifyError.class);
    }

    /**
     * @constraint B14
     * @title put boolean into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/iput_boolean/Test_iput_boolean.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct_range.Test_invoke_direct_range"	"testVFE18"	""	"1: called"	"public void testVFE18() {
        load(""dot.junit.opcodes.invoke_direct_range.d.T_invoke_direct_range_17"", VerifyError.class);
    }

    /**
     * @constraint B8
     * @title attempt to access inherited instance field before <init> is called
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct_range/Test_invoke_direct_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct_range.Test_invoke_direct_range"	"testVFE17"	""	"1: only"	"public void testVFE17() {
        //@uses dot.junit.opcodes.invoke_direct_range.TAbstract
        loadAndRun(""dot.junit.opcodes.invoke_direct_range.d.T_invoke_direct_range_13"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B5
     * @title An instance initializer must only be invoked on an uninitialized instance.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct_range/Test_invoke_direct_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct_range.Test_invoke_direct_range"	"testVFE20"	""	"1: only"	"public void testVFE20() {
        loadAndRun(""dot.junit.opcodes.invoke_direct_range.d.T_invoke_direct_range_26"",
                   IncompatibleClassChangeError.class);
    }

    /**
     * @constraint B6
     * @title instance methods may only be invoked on already initialized instances.
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct_range/Test_invoke_direct_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.invoke_direct_range.Test_invoke_direct_range"	"testVFE9"	""	"1: accessing"	"public void testVFE9() {
        load(""dot.junit.opcodes.invoke_direct_range.d.T_invoke_direct_range_24"", VerifyError.class);
    }

    /**
     * @constraint B10
     * @title assignment incompatible references when accessing protected method
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/invoke_direct_range/Test_invoke_direct_range.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_short.Test_sput_short"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_short.d.T_sput_short_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put short into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_short/Test_sput_short.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_char.Test_sput_char"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_char.d.T_sput_char_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put char into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_char/Test_sput_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.div_int_lit16.Test_div_int_lit16"	"testN5"	""	"1: 9.1"	"public void testN5() {
        T_div_int_lit16_5 t = new T_div_int_lit16_5();
        assertEquals(-357913941, t.run());
    }

    /**
     * @title Both Dividend and divisor are negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/div_int_lit16/Test_div_int_lit16.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.neg_double.Test_neg_double"	"testB4"	""	"1: 9.1"	"public void testB4() {
        T_neg_double_1 t = new T_neg_double_1();
        assertEquals(-1.7976931348623157E308d, t.run(Double.MAX_VALUE));
    }

    /**
     * @title Argument = Double.MIN_VALUE
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/neg_double/Test_neg_double.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.return_object.Test_return_object"	"testVFE9"	""	"1: only"	"public void testVFE9() {
        //@uses dot.junit.opcodes.return_object.d.T_return_object_15
        //@uses dot.junit.opcodes.return_object.Runner
        //@uses dot.junit.opcodes.return_object.RunnerGenerator
        //@uses dot.junit.opcodes.return_object.d.TSuper2
        try {
            RunnerGenerator rg = (RunnerGenerator) Class.forName(
                    ""dot.junit.opcodes.return_object.d.T_return_object_15"").newInstance();
            Runner r = rg.run();
            assertFalse(r instanceof Runner);
            assertFalse(Runner.class.isAssignableFrom(r.getClass()));
            // only upon invocation of a concrete method,
            // a java.lang.IncompatibleClassChangeError is thrown
            r.doit();
            fail(""expected a verification exception"");
        } catch (Throwable t) {
            DxUtil.checkVerifyException(t);
        }
    }


}"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/return_object/Test_return_object.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.new_instance.Test_new_instance"	"testVFE2"	""	"1: called"	"public void testVFE2() {
        load(""dot.junit.opcodes.new_instance.d.T_new_instance_7"", VerifyError.class);
    }

    /**
     * @constraint B6
     * @title Attempt to access uninitialized class (before <init> is
     * called
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/new_instance/Test_new_instance.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sget_char.Test_sget_char"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sget_char.d.T_sget_char_3"", VerifyError.class);
    }

    /**
     *
     * @constraint B13
     * @title read char from long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sget_char/Test_sget_char.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.div_int_lit8.Test_div_int_lit8"	"testN5"	""	"1: 9.1"	"public void testN5() {
        T_div_int_lit8_5 t = new T_div_int_lit8_5();
        assertEquals(-357913941, t.run());
    }

    /**
     * @title Both Dividend and divisor are negative
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/div_int_lit8/Test_div_int_lit8.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_wide.Test_sput_wide"	"testN1"	""	"1: 9.1"	"public void testN1() {
        T_sput_wide_1 t = new T_sput_wide_1();
        assertEquals(0, T_sput_wide_1.st_i1);
        t.run();
        assertEquals(778899112233l, T_sput_wide_1.st_i1);
    }

    /**
     * @title put double into static field
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_wide/Test_sput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"dot.junit.opcodes.sput_wide.Test_sput_wide"	"testVFE2"	""	"1: only"	"public void testVFE2() {
        load(""dot.junit.opcodes.sput_wide.d.T_sput_wide_4"", VerifyError.class);
    }


    /**
     *
     * @constraint B13
     * @title put int into long field - only field with same name but
     * different type exists
     */"	"/home/gpoor/cts-12-source/cts/tools/vm-tests-tf/src/dot/junit/opcodes/sput_wide/Test_sput_wide.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.settings.PrivacyDeviceOwnerTest"	"testNonDeviceOwnerWithoutInfo"	"CtsSettingsHostTestCases"	"5: app(s) apps UI app display"	"public void testNonDeviceOwnerWithoutInfo() throws Exception {
        if (!mHasFeature) {
            return;
        }
        executeDeviceOwnerTest(""testNonDeviceOwnerWithoutInfo"");
    }

    private void executeDeviceOwnerTest(String testMethodName) throws Exception {
        String testClass = DEVICE_OWNER_PKG + "".DeviceOwnerTest"";
        assertTrue(
                testClass + "" failed."",
                runDeviceTests(DEVICE_OWNER_PKG, testClass, testMethodName));
    }

    protected void installPackage(int userId, String appFileName)
            throws FileNotFoundException, DeviceNotAvailableException {
        CLog.d(""Installing app %s on user %d"", appFileName, userId);
        CompatibilityBuildHelper buildHelper = new CompatibilityBuildHelper(mCtsBuild);
        List<String> extraArgs = new LinkedList<>();
        extraArgs.add(""-t"");
        String result =
                getDevice()
                        .installPackageForUser(
                                buildHelper.getTestFile(appFileName),
                                true,
                                true,
                                userId,
                                extraArgs.toArray(new String[extraArgs.size()]));
        assertNull(""Failed to install "" + appFileName + "" on user "" + userId + "": "" + result,
                result);
    }

    protected boolean runDeviceTests(
            String pkgName, @Nullable String testClassName, @Nullable String testMethodName)
            throws DeviceNotAvailableException {
        if (testClassName != null && testClassName.startsWith(""."")) {
            testClassName = pkgName + testClassName;
        }
        RemoteAndroidTestRunner testRunner =
                new RemoteAndroidTestRunner(pkgName, RUNNER, getDevice().getIDevice());
        testRunner.setMaxTimeToOutputResponse(DEFAULT_SHELL_TIMEOUT_MILLIS, TimeUnit.MILLISECONDS);
        testRunner.addInstrumentationArg(
                TEST_TIMEOUT_INST_ARGS_KEY, Long.toString(DEFAULT_TEST_TIMEOUT_MILLIS));

        if (testClassName != null && testMethodName != null) {
            testRunner.setMethodName(testClassName, testMethodName);
        } else if (testClassName != null) {
            testRunner.setClassName(testClassName);
        }

        CollectingTestListener listener = new CollectingTestListener();
        CLog.i(""Running %s.%s on user %d"", testClassName, testMethodName, mTestUserId);
        boolean runResult = getDevice().runInstrumentationTestsAsUser(testRunner, mTestUserId,
                listener);

        final TestRunResult result = listener.getCurrentRunResults();
        if (result.isRunFailure()) {
            throw new AssertionError(
                    ""Failed to successfully run device tests for ""
                            + result.getName()
                            + "": ""
                            + result.getRunFailureMessage());
        }
        if (result.getNumTests() == 0) {
            throw new AssertionError(""No tests were run on the device"");
        }

        if (result.hasFailedTests()) {
            // build a meaningful error message
            StringBuilder errorBuilder = new StringBuilder(""On-device tests failed:\n"");
            for (Map.Entry<TestDescription, TestResult> resultEntry :
                    result.getTestResults().entrySet()) {
                if (!resultEntry.getValue().getStatus().equals(TestStatus.PASSED)) {
                    errorBuilder.append(resultEntry.getKey().toString());
                    errorBuilder.append("":\n"");
                    errorBuilder.append(resultEntry.getValue().getStackTrace());
                }
            }
            throw new AssertionError(errorBuilder.toString());
        }

        return runResult;
    }

    private void setDeviceOwner() throws DeviceNotAvailableException {
        String componentName = DEVICE_OWNER_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS;
        String command = ""dpm set-device-owner '"" + componentName + ""'"";
        String commandOutput = getDevice().executeShellCommand(command);
        CLog.logAndDisplay(LogLevel.INFO, ""Output for command "" + command + "": "" + commandOutput);
        assertTrue(
                commandOutput + "" expected to start with \""Success:\"" "" + commandOutput,
                commandOutput.startsWith(""Success:""));
    }

    protected boolean hasDeviceFeature(String requiredFeature) throws DeviceNotAvailableException {
        String command = ""pm list features"";
        String commandOutput = getDevice().executeShellCommand(command);
        CLog.i(""Output for command "" + command + "": "" + commandOutput);

        Set<String> availableFeatures = new HashSet<>();
        for (String feature : commandOutput.split(""\\s+"")) {
            // Each line in the output of the command has the format ""feature:{FEATURE_VALUE}"".
            String[] tokens = feature.split("":"");
            assertTrue(
                    ""\"""" + feature + ""\"" expected to have format feature:{FEATURE_VALUE}"",
                    tokens.length > 1);
            assertEquals(feature, ""feature"", tokens[0]);
            availableFeatures.add(tokens[1]);
        }
        boolean result = availableFeatures.contains(requiredFeature);
        if (!result) {
            CLog.d(""Device doesn't have required feature "" + requiredFeature + "". Test won't run."");
        }
        return result;
    }

    protected void grantDpmWrapperPermissions(int userId) throws Exception {
        // TODO(b/176993670): INTERACT_ACROSS_USERS is needed by DevicePolicyManagerWrapper to
        // get the current user; the permission is available on mDeviceOwnerUserId because it
        // was installed with -g, but not on mPrimaryUserId as the app is intalled by code
        // (DPMS.manageUserUnchecked(), which don't grant it (as this is a privileged permission
        // that's not available to 3rd party apps). If we get rid of DevicePolicyManagerWrapper,
        // we won't need to grant it anymore.
        CLog.i(""Granting INTERACT_ACROSS_USERS to DO %s on user %d as it will need to send ordered ""
                + ""broadcasts to user 0"", DEVICE_OWNER_PKG, userId);
        getDevice().executeShellCommand(""pm grant --user "" + userId + "" "" + DEVICE_OWNER_PKG
                + "" android.permission.INTERACT_ACROSS_USERS"");
    }

    // TODO (b/174775905) remove after exposing the check from ITestDevice.
    boolean isHeadlessSystemUserMode() throws DeviceNotAvailableException {
        return isHeadlessSystemUserMode(getDevice());
    }

    // TODO (b/174775905) remove after exposing the check from ITestDevice.
    public static boolean isHeadlessSystemUserMode(ITestDevice device)
            throws DeviceNotAvailableException {
        final String result = device
                .executeShellCommand(""getprop ro.fw.mu.headless_system_user"").trim();
        return ""true"".equalsIgnoreCase(result);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/src/com/google/android/cts/settings/PrivacyDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.settings.PrivacyDeviceOwnerTest"	"isHeadlessSystemUserMode"	"CtsSettingsHostTestCases"	"2: UI app"	"public void test/*
 *.
 */
package com.google.android.cts.settings;

import com.android.compatibility.common.tradefed.build.CompatibilityBuildHelper;
import com.android.ddmlib.Log.LogLevel;
import com.android.ddmlib.testrunner.RemoteAndroidTestRunner;
import com.android.ddmlib.testrunner.TestResult.TestStatus;
import com.android.tradefed.build.IBuildInfo;
import com.android.tradefed.device.DeviceNotAvailableException;
import com.android.tradefed.device.ITestDevice;
import com.android.tradefed.log.LogUtil.CLog;
import com.android.tradefed.result.CollectingTestListener;
import com.android.tradefed.result.TestDescription;
import com.android.tradefed.result.TestResult;
import com.android.tradefed.result.TestRunResult;
import com.android.tradefed.testtype.DeviceTestCase;
import com.android.tradefed.testtype.IBuildReceiver;
import java.io.FileNotFoundException;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.TimeUnit;
import javax.annotation.Nullable;

/** Set of tests for Device Owner use cases. */
public class PrivacyDeviceOwnerTest extends DeviceTestCase implements IBuildReceiver {
    private static final String RUNNER = ""androidx.test.runner.AndroidJUnitRunner"";

    private static final String DEVICE_OWNER_APK = ""CtsSettingsDeviceOwnerApp.apk"";
    private static final String DEVICE_OWNER_PKG = ""com.google.android.cts.deviceowner"";

    private static final String ADMIN_RECEIVER_TEST_CLASS = "".DeviceOwnerTest$BasicAdminReceiver"";
    private static final String CLEAR_DEVICE_OWNER_TEST_CLASS = "".ClearDeviceOwnerTest"";

    // TODO (b/174775905) move to ITestDevice.
    private static final int USER_SYSTEM = 0;

    /**
     * The defined timeout (in milliseconds) is used as a maximum waiting time when expecting the
     * command output from the device. At any time, if the shell command does not output anything
     * for a period longer than defined timeout the Tradefed run terminates.
     */
    private static final long DEFAULT_SHELL_TIMEOUT_MILLIS = TimeUnit.MINUTES.toMillis(20);

    /** instrumentation test runner argument key used for individual test timeout */
    protected static final String TEST_TIMEOUT_INST_ARGS_KEY = ""timeout_msec"";

    /**
     * Sets timeout (in milliseconds) that will be applied to each test. In the event of a test
     * timeout it will log the results and proceed with executing the next test.
     */
    private static final long DEFAULT_TEST_TIMEOUT_MILLIS = TimeUnit.MINUTES.toMillis(10);

    protected boolean mHasFeature;
    protected IBuildInfo mCtsBuild;

    private int mDeviceOwnerUserId;
    private int mTestUserId;

    @Override
    public void setBuild(IBuildInfo buildInfo) {
        mCtsBuild = buildInfo;
    }

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        mHasFeature = hasDeviceFeature(""android.software.device_admin"");
        if (!mHasFeature) return;

        mTestUserId = getDevice().getCurrentUser();
        if (isHeadlessSystemUserMode()) {
            mDeviceOwnerUserId = USER_SYSTEM;
        } else {
            mDeviceOwnerUserId = mTestUserId;
        }

        installPackage(mDeviceOwnerUserId, DEVICE_OWNER_APK);

        if (isHeadlessSystemUserMode()) {
            grantDpmWrapperPermissions(mTestUserId);
        }
    }

    @Override
    protected void tearDown() throws Exception {
        if (mHasFeature) {
            assertTrue(
                    ""Failed to remove device owner."",
                    runDeviceTests(
                            DEVICE_OWNER_PKG,
                            DEVICE_OWNER_PKG + CLEAR_DEVICE_OWNER_TEST_CLASS,
                            null));
            getDevice().uninstallPackage(DEVICE_OWNER_PKG);
        }

        super.tearDown();
    }

    /** The case: app is the device owner, has work policy info. */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/src/com/google/android/cts/settings/PrivacyDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.settings.PrivacyDeviceOwnerTest"	"testDeviceOwnerWithInfo"	"CtsSettingsHostTestCases"	"1: app"	"public void testDeviceOwnerWithInfo() throws Exception {
        if (!mHasFeature) {
            return;
        }
        setDeviceOwner();
        executeDeviceOwnerTest(""testDeviceOwnerWithInfo"");
    }

    /** The case: app is NOT the device owner, has work policy info. */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/src/com/google/android/cts/settings/PrivacyDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.settings.PrivacyDeviceOwnerTest"	"testNonDeviceOwnerWithInfo"	"CtsSettingsHostTestCases"	"1: app"	"public void testNonDeviceOwnerWithInfo() throws Exception {
        if (!mHasFeature) {
            return;
        }
        executeDeviceOwnerTest(""testNonDeviceOwnerWithInfo"");
    }

    /** The case: app is the device owner, doesn't have work policy info. */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/src/com/google/android/cts/settings/PrivacyDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.settings.PrivacyDeviceOwnerTest"	"testDeviceOwnerWithoutInfo"	"CtsSettingsHostTestCases"	"1: app"	"public void testDeviceOwnerWithoutInfo() throws Exception {
        if (!mHasFeature) {
            return;
        }
        setDeviceOwner();
        executeDeviceOwnerTest(""testDeviceOwnerWithoutInfo"");
    }

    /** The case: app is NOT the device owner, doesn't have work policy info. */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/src/com/google/android/cts/settings/PrivacyDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.deviceowner.DeviceOwnerTest"	"isTrue"	""	"7: data app(s) accessed apps UI only app"	"public void test/*
 *.
 */
package com.google.android.cts.deviceowner;

import static android.server.wm.WindowManagerState.STATE_RESUMED;

import static com.google.common.truth.Truth.assertWithMessage;

import android.app.admin.DeviceAdminReceiver;
import android.app.admin.DevicePolicyManager;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.os.RemoteException;
import android.provider.Settings;
import android.server.wm.WindowManagerStateHelper;
import android.support.test.uiautomator.By;
import android.support.test.uiautomator.UiDevice;
import android.support.test.uiautomator.Until;
import android.test.InstrumentationTestCase;
import android.util.Log;

import androidx.test.InstrumentationRegistry;

import com.android.bedstead.dpmwrapper.DeviceOwnerHelper;
import com.android.bedstead.dpmwrapper.TestAppSystemServiceFactory;
import com.android.compatibility.common.util.enterprise.DeviceAdminReceiverUtils;

/**
 * Class for device-owner based tests.
 *
 * <p>This class handles making sure that the test is the device owner and that it has an active
 * admin registered if necessary. The admin component can be accessed through {@link #getWho()}.
 */
public final class DeviceOwnerTest extends InstrumentationTestCase {

    private static final String TAG = DeviceOwnerTest.class.getSimpleName();

    private static final String WORK_POLICY_INFO_TEXT = ""Your work policy info"";

    public static final int TIMEOUT_MS = 2_000;

    protected Context mContext;
    protected UiDevice mDevice;

    /** Device Admin receiver for DO. */
    public static final class BasicAdminReceiver extends DeviceAdminReceiver {

        @Override
        public void onReceive(Context context, Intent intent) {
            // Ignore intents used by DpmWrapper IPC between current and system users
            if (DeviceOwnerHelper.runManagerMethod(this, context, intent)) return;

            // Hack used to manually disable the admin during development
            if (DeviceAdminReceiverUtils.disableSelf(context, intent)) return;

            super.onReceive(context, intent);
        }
    }

    static final String PACKAGE_NAME = DeviceOwnerTest.class.getPackage().getName();
    static final ComponentName RECEIVER_COMPONENT =
            new ComponentName(PACKAGE_NAME, BasicAdminReceiver.class.getName());

    protected DevicePolicyManager mDevicePolicyManager;
    protected PackageManager mPackageManager;
    protected boolean mIsDeviceOwner;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mContext = getInstrumentation().getContext();
        mDevice = UiDevice.getInstance(getInstrumentation());
        mPackageManager = mContext.getPackageManager();
        mDevicePolicyManager = TestAppSystemServiceFactory.getDevicePolicyManager(mContext,
                BasicAdminReceiver.class);

        mIsDeviceOwner = mDevicePolicyManager.isDeviceOwnerApp(PACKAGE_NAME);
        Log.d(TAG, ""setup(): dpm="" + mDevicePolicyManager + "", isDO: "" + mIsDeviceOwner);

        if (mIsDeviceOwner) {
            assertWithMessage(""isAdminActive(%s)"", RECEIVER_COMPONENT)
                    .that(mDevicePolicyManager.isAdminActive(RECEIVER_COMPONENT)).isTrue();

            // Note DPM.getDeviceOwner() now always returns null on non-DO users as of NYC.
            assertWithMessage(""%s.getDeviceOwner()"", mDevicePolicyManager)
                    .that(mDevicePolicyManager.getDeviceOwner()).isEqualTo(PACKAGE_NAME);
        }

        try {
            mDevice.setOrientationNatural();
        } catch (RemoteException e) {
            throw new RuntimeException(""failed to freeze device orientation"", e);
        }
        wakeupDeviceAndPressHome();
    }

    private void wakeupDeviceAndPressHome() throws Exception {
        mDevice.wakeUp();
        mDevice.pressMenu();
        mDevice.pressHome();
    }

    @Override
    protected void tearDown() throws Exception {
        mDevice.pressBack();
        mDevice.pressHome();
        mDevice.waitForIdle(TIMEOUT_MS); // give UI time to finish animating
    }

    private boolean launchPrivacyAndCheckWorkPolicyInfo() throws Exception {
        // Launch Settings
        launchSettingsPage(InstrumentationRegistry.getContext(), Settings.ACTION_PRIVACY_SETTINGS);

        // Wait for loading permission usage data.
        mDevice.waitForIdle(TIMEOUT_MS);

        Log.d(TAG, ""Waiting "" + TIMEOUT_MS + ""ms for the '"" + WORK_POLICY_INFO_TEXT + ""' message"");

        return (null != mDevice.wait(Until.findObject(By.text(WORK_POLICY_INFO_TEXT)), TIMEOUT_MS));
    }

    private void launchSettingsPage(Context ctx, String pageName) throws Exception {
        Intent intent = new Intent(pageName);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);

        ComponentName componentName =
                ctx.getPackageManager()
                        .resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY)
                        .getComponentInfo()
                        .getComponentName();
        ctx.startActivity(intent);

        new WindowManagerStateHelper().waitForActivityState(componentName, STATE_RESUMED);
    }

    private void disableWorkPolicyInfoActivity() {
        mContext.getPackageManager()
                .setComponentEnabledSetting(
                        new ComponentName(mContext, WorkPolicyInfoActivity.class),
                        PackageManager.COMPONENT_ENABLED_STATE_DISABLED,
                        PackageManager.DONT_KILL_APP);
    }

    private void launchPrivacySettingsAndAssertWorkPolicyInfoIsShowing() throws Exception {
        assertWithMessage(""Work policy info (%s) on settings entry"", WORK_POLICY_INFO_TEXT)
                .that(launchPrivacyAndCheckWorkPolicyInfo()).isTrue();
    }

    private void launchPrivacySettingsAndAssertWorkPolicyInfoIsNotShowing() throws Exception {
        assertWithMessage(""Work policy info (%s) on settings entry"", WORK_POLICY_INFO_TEXT)
                .that(launchPrivacyAndCheckWorkPolicyInfo()).isFalse();
    }

    /**
     * If the app is the active device owner and has work policy info, then we should have a Privacy
     * entry for it.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/app/DeviceOwnerApp/src/com/google/android/cts/deviceowner/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.deviceowner.DeviceOwnerTest"	"testDeviceOwnerWithInfo"	""	"1: app"	"public void testDeviceOwnerWithInfo() throws Exception {
        assertWithMessage(""is device owner"").that(mIsDeviceOwner).isTrue();

        launchPrivacySettingsAndAssertWorkPolicyInfoIsShowing();
    }

    /**
     * If the app is the active device owner, but doesn't have work policy info, then we shouldn't
     * have a Privacy entry for it.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/app/DeviceOwnerApp/src/com/google/android/cts/deviceowner/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.deviceowner.DeviceOwnerTest"	"testDeviceOwnerWithoutInfo"	""	"1: app"	"public void testDeviceOwnerWithoutInfo() throws Exception {
        assertWithMessage(""is device owner"").that(mIsDeviceOwner).isTrue();

        disableWorkPolicyInfoActivity();

        launchPrivacySettingsAndAssertWorkPolicyInfoIsNotShowing();
    }

    /**
     * If the app is NOT the active device owner, then we should not have a Privacy entry for work
     * policy info.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/app/DeviceOwnerApp/src/com/google/android/cts/deviceowner/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.google.android.cts.deviceowner.DeviceOwnerTest"	"testNonDeviceOwnerWithInfo"	""	"1: app"	"public void testNonDeviceOwnerWithInfo() throws Exception {
        assertWithMessage(""is device owner"").that(mIsDeviceOwner).isFalse();

        launchPrivacySettingsAndAssertWorkPolicyInfoIsNotShowing();
    }

    /**
     * If the app is NOT the active device owner, and doesn't have work policy info, then we should
     * not have a Privacy entry for work policy info.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/settings/app/DeviceOwnerApp/src/com/google/android/cts/deviceowner/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher1.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"2: UI view"	"public void testPreBackup() {
        final Icon icon1 = Icon.createWithBitmap(BitmapFactory.decodeResource(
                getContext().getResources(), R.drawable.black_16x64));
        final Icon icon3 = Icon.createWithResource(getContext(), R.drawable.black_64x16);

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1"")
                .setLongLabel(""longlabel1"")
                .setIcon(icon1)
                .setActivity(getActivity(""MainActivity""))
                .setDisabledMessage(""disabledmessage1"")
                .setIntents(new Intent[]{new Intent(""view"").putExtra(""k1"", ""v1"")})
                .setExtras(makePersistableBundle(""ek1"", ""ev1""))
                .setCategories(set(""cat1""))
                .build();

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2"")
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        final ShortcutInfo s3 = new ShortcutInfo.Builder(getContext(), ""s3"")
                .setShortLabel(""shortlabel2"")
                .setIcon(icon3)
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(s1, s2, s3)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""s2"", ""s3"")
                .areAllNotPinned();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllNotPinned();
   }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher1/src/android/content/pm/cts/shortcut/backup/publisher1/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher3.ShortcutManagerPostBackupTest"	"testWithUninstall_afterAppRestore"	""	"1: app"	"public void testWithUninstall_afterAppRestore() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER1_PKG))
                .haveIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllNotPinned();

        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER2_PKG))
                .haveIds(""ms1"", ""ms2"")
                .areAllEnabled();

        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER3_PKG))
                .haveIds(""ms1"", ""ms2"")
                .areAllEnabled();
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher3/src/android/content/pm/cts/shortcut/backup/launcher3/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher3.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"3: app(s) apps app"	"public void testPreBackup() {
        getLauncherApps().pinShortcuts(PUBLISHER1_PKG, list(""s3"", ""ms1"", ""ms2""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER2_PKG, list(""s1"", ""s3"", ""ms2""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER3_PKG, list(""s1"", ""s3"", ""ms1""),
                getUserHandle());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher3/src/android/content/pm/cts/shortcut/backup/launcher3/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testRestoredOnOldVersion"	""	"1: UI"	"public void testRestoredOnOldVersion() {
        assertWith(getManager().getDynamicShortcuts())
                .isEmpty();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllEnabled();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllPinned()
                .areAllEnabled();

        // At this point, s1 and s2 don't look to exist to the publisher, so it can publish a
        // dynamic shortcut and that should work.
        // But updateShortcuts() don't.

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().addDynamicShortcuts(list(s1)));

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2_updated"")
                .build();
        assertTrue(getManager().updateShortcuts(list(s2)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"") // s2 not in the list.
                .areAllEnabled();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"", ""ms2"", ""s1"") // s2 not in the list.
                .areAllEnabled();

    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testRestoredOnNewVersion"	""	"1: UI"	"public void testRestoredOnNewVersion() {
        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"")
                .areAllEnabled()
                .areAllPinned();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllPinned()
                .areAllEnabled();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllEnabled();

        // This time, update should work.
        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2_updated"")
                .build();
        assertTrue(getManager().updateShortcuts(list(s2)));

        assertWith(getManager().getPinnedShortcuts())
                .selectByIds(""s2"")
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel2_updated"", si.getShortLabel());
                });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testBackupDisabled"	""	"2: UI app"	"public void testBackupDisabled() {
        assertWith(getManager().getDynamicShortcuts())
                .isEmpty();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllEnabled();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllPinned()
                .areAllEnabled();

        // Backup was disabled, so either s1 nor s2 look to be restored to the app.
        // So when the app publishes s1, it'll be published as new.
        // But it'll still be pinned.
        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().addDynamicShortcuts(list(s1)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"") // s2 not in the list.
                .areAllPinned()
                .areAllEnabled()
                .forAllShortcuts(si -> {
                    // The app re-published the shortcut, not updated, so the fields that existed
                    // in the original shortcut is gone now.
                    assertNull(si.getExtras());
                });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testRestoreWrongKey"	""	"1: UI"	"public void testRestoreWrongKey() {
        // Restored pinned shortcuts are from a package with a different signature, so the dynamic
        // pinned shortcuts should be disabled-invisible.

        assertWith(getManager().getDynamicShortcuts())
                .isEmpty();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"", ""ms2"");

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllPinned()
                .areAllEnabled();

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().addDynamicShortcuts(list(s1)));

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2_updated"")
                .build();
        assertTrue(getManager().updateShortcuts(list(s2)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"") // s2 not in the list.
                .areAllEnabled();
    }

    /**
     * Restored on an older version that have no manifest shortcuts.
     *
     * In this case, the publisher wouldn't see the manifest shortcuts, and they're overwritable.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testRestoreNoManifestOnOldVersion"	""	"1: UI"	"public void testRestoreNoManifestOnOldVersion() {
        assertWith(getManager().getManifestShortcuts())
                .isEmpty();

        assertWith(getManager().getDynamicShortcuts())
                .isEmpty();

        assertWith(getManager().getPinnedShortcuts())
                .isEmpty();

        // ms1 was manifest/immutable, but can be overwritten.
        final ShortcutInfo ms1 = new ShortcutInfo.Builder(getContext(), ""ms1"")
                .setShortLabel(""ms1_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(ms1)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""ms1"");
        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms1"");

        // Adding s1 should also work.
        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""s1_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().addDynamicShortcuts(list(s1)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""ms1"");
        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""s1"", ""ms1"");

        // Update on ms2 should be no-op.
        final ShortcutInfo ms2 = new ShortcutInfo.Builder(getContext(), ""ms2"")
                .setShortLabel(""ms2-updated"")
                .build();
        assertTrue(getManager().updateShortcuts(list(ms2)));

        assertWith(getManager().getManifestShortcuts())
                .isEmpty();
        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""ms1"")
                .areAllEnabled()
                .areAllPinned()
                .areAllMutable()

                .selectByIds(""s1"")
                .forAllShortcuts(si -> {
                    assertEquals(""s1_new_one"", si.getShortLabel());
                })

                .revertToOriginalList()
                .selectByIds(""ms1"")
                .forAllShortcuts(si -> {
                    assertEquals(""ms1_new_one"", si.getShortLabel());
                });
    }

    /**
     * Restored on the same (or newer) version that have no manifest shortcuts.
     *
     * In this case, the publisher will see the manifest shortcuts (as immutable pinned),
     * and they *cannot* be overwritten.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPostBackupTest"	"testInvisibleIgnored"	""	"1: UI"	"public void testInvisibleIgnored() throws Exception {
        assertNoShortcuts();

        // Make sure ""disable"" won't change the disabled reason. Also make sure ""enable"" won't
        // enable them.
        getManager().disableShortcuts(list(""s1"", ""s2"", ""ms1""));
        assertNoShortcuts();

        getManager().enableShortcuts(list(""ms1"", ""s2""));
        assertNoShortcuts();

        getManager().enableShortcuts(list(""ms1""));
        assertNoShortcuts();

        getManager().removeDynamicShortcuts(list(""s1"", ""ms1""));
        assertNoShortcuts();

        getManager().removeAllDynamicShortcuts();
        assertNoShortcuts();


        // Force launcher 4 to be the default launcher so it'll receive the pin request.
        setDefaultLauncher(getInstrumentation(),
                ""android.content.pm.cts.shortcut.backup.launcher4"");

        // Update, set and add have been tested already, so let's test ""pin"".

        final CountDownLatch latch = new CountDownLatch(1);

        PersistableBundle pb = new PersistableBundle();
        pb.putBoolean(""acceptit"", true);

        final ShortcutInfo ms2 = new ShortcutInfo.Builder(getContext(), ""ms2"")
                .setShortLabel(""ms2_new_one"")
                .setActivity(getActivity(""MainActivity""))
                .setIntents(new Intent[]{new Intent(""main2"")})
                .setExtras(pb)
                .build();

        final String myIntentAction = ""cts-shortcut-intent_"" + new SecureRandom().nextInt();
        final IntentFilter myFilter = new IntentFilter(myIntentAction);

        final BroadcastReceiver onResult = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                latch.countDown();
            }
        };
        getContext().registerReceiver(onResult, myFilter);
        assertTrue(getManager().requestPinShortcut(ms2,
                PendingIntent.getBroadcast(getContext(), 0, new Intent(myIntentAction),
                        PendingIntent.FLAG_CANCEL_CURRENT | PendingIntent.FLAG_MUTABLE_UNAUDITED).getIntentSender()));

        assertTrue(""Didn't receive requestPinShortcut() callback."",
                latch.await(30, TimeUnit.SECONDS));

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""ms2"")
                .areAllNotDynamic()
                .areAllNotManifest()
                .areAllMutable()
                .areAllPinned()
                .forAllShortcuts(si -> {
                    // requestPinShortcut() acts as an update in this case, so even though
                    // the original shortcut hada  long label, this one does not.
                    assertTrue(TextUtils.isEmpty(si.getLongLabel()));
                });
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher4.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"2: UI view"	"public void testPreBackup() {
        final Icon icon1 = Icon.createWithBitmap(BitmapFactory.decodeResource(
                getContext().getResources(), R.drawable.black_16x64));
        final Icon icon3 = Icon.createWithResource(getContext(), R.drawable.black_64x16);

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1"")
                .setLongLabel(""longlabel1"")
                .setIcon(icon1)
                .setActivity(getActivity(""MainActivity""))
                .setDisabledMessage(""disabledmessage1"")
                .setIntents(new Intent[]{new Intent(""view"").putExtra(""k1"", ""v1"")})
                .setExtras(makePersistableBundle(""ek1"", ""ev1""))
                .setCategories(set(""cat1""))
                .build();

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2"")
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        final ShortcutInfo s3 = new ShortcutInfo.Builder(getContext(), ""s3"")
                .setShortLabel(""shortlabel3"")
                .setIcon(icon3)
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(s1, s2, s3)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""s2"", ""s3"")
                .areAllNotPinned();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllNotPinned();
   }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher4old/src/android/content/pm/cts/shortcut/backup/publisher4/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher2.ShortcutManagerPostBackupTest"	"testWithUninstall_afterAppRestore"	""	"1: app"	"public void testWithUninstall_afterAppRestore() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER1_PKG))
                .haveIds(""ms1"", ""ms2"", ""s3"")
                .areAllEnabled()

                .selectByIds(""s3"", ""ms2"")
                .areAllPinned()

                .revertToOriginalList()
                .selectByIds(""ms1"")
                .areAllNotPinned();

        // Note s3 and ms2 were disabled before backup, so they were not backed up.
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER2_PKG))
                .haveIds(""ms1"", ""ms2"", ""s2"")
                .areAllEnabled()

                .selectByIds(""s2"", ""ms1"")
                .areAllPinned()

                .revertToOriginalList()
                .selectByIds(""ms2"")
                .areAllNotPinned();

        // Package3 doesn't support backup&restore.
        // However, the manifest-shortcuts will be republished anyway, so they're still pinned.
        // The dynamic shortcuts can't be restored, but we'll still restore them as disabled
        // shortcuts that are not visible to the publisher.
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER3_PKG))
                .haveIds(""ms1"", ""ms2"", ""s2"", ""s3"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_NOT_DISABLED)

                .revertToOriginalList()
                .selectByIds(""s2"", ""s3"")
                .areAllDisabled()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_BACKUP_NOT_SUPPORTED)
        ;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher2/src/android/content/pm/cts/shortcut/backup/launcher2/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher2.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"3: app(s) apps app"	"public void testPreBackup() {
        getLauncherApps().pinShortcuts(PUBLISHER1_PKG, list(""s3"", ""ms2""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER2_PKG, list(""s2"", ""s3"", ""ms1""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER3_PKG, list(""s2"", ""s3"", ""ms1"", ""ms2""),
                getUserHandle());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher2/src/android/content/pm/cts/shortcut/backup/launcher2/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher4.ShortcutManagerPostBackupTest"	"testRestoredOnOldVersion"	""	"1: app"	"public void testRestoredOnOldVersion() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER4_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllManifest()

                // s1 is re-published, so it's enabled and dynamic.
                .revertToOriginalList()
                .selectByIds(""s1"")
                .areAllEnabled()
                .areAllDynamic()
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel1_new_one"", si.getShortLabel());

                    // The app re-published the shortcut, not updated, so the fields that existed
                    // in the original shortcut is gone now.
                    assertNull(si.getExtras());
                })

                .revertToOriginalList()
                .selectByIds(""s2"")
                .areAllDisabled()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_VERSION_LOWER)
                .forAllShortcuts(si -> {
                    // Note the label shouldn't be updated with the updateShortcuts() call.
                    assertEquals(""shortlabel2"", si.getShortLabel());
                })
                .areAllNotDynamic();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher4old/src/android/content/pm/cts/shortcut/backup/launcher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher4.ShortcutManagerPostBackupTest"	"testRestoredOnNewVersion"	""	"1: app"	"public void testRestoredOnNewVersion() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER4_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllManifest()

                // s1 is re-published, so it's enabled and dynamic.
                .revertToOriginalList()
                .selectByIds(""s1"", ""s2"")
                .areAllEnabled()

                .revertToOriginalList()
                .selectByIds(""s1"")
                .areAllDynamic()
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel1_new_one"", si.getShortLabel());

                    // The app re-published the shortcut, not updated, so the fields that existed
                    // in the original shortcut is gone now.
                    assertNull(si.getExtras());
                })

                .revertToOriginalList()
                .selectByIds(""s2"")
                .areAllNotDynamic()
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel2_updated"", si.getShortLabel());
                })
                ;
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher4old/src/android/content/pm/cts/shortcut/backup/launcher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher4.ShortcutManagerPostBackupTest"	"testRestoreWrongKey"	""	"1: app"	"public void testRestoreWrongKey() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER4_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllManifest()

                // s1 is re-published, so it's enabled and dynamic.
                .revertToOriginalList()
                .selectByIds(""s1"")
                .areAllEnabled()
                .areAllDynamic()
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel1_new_one"", si.getShortLabel());

                    // The app re-published the shortcut, not updated, so the fields that existed
                    // in the original shortcut is gone now.
                    assertNull(si.getExtras());
                })


                // updateShortcuts() shouldn't work on it, so it keeps the original label.
                .revertToOriginalList()
                .selectByIds(""s2"")
                .areAllNotDynamic()
                .forAllShortcuts(si -> {
                    assertEquals(""shortlabel2"", si.getShortLabel());
                })
        ;
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher4old/src/android/content/pm/cts/shortcut/backup/launcher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher4.ShortcutManagerPostBackupTest"	"testRestoreNoManifestOnNewVersion"	""	"1: app"	"public void testRestoreNoManifestOnNewVersion() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER4_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllDisabled()
                .areAllImmutable()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_APP_CHANGED)

                .revertToOriginalList()
                .selectByIds(""s1"", ""s2"")
                .areAllEnabled()
                .areAllMutable();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher4old/src/android/content/pm/cts/shortcut/backup/launcher4/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher4.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"3: app(s) apps app"	"public void testPreBackup() {
        // Pin all the shortcuts.
        getLauncherApps().pinShortcuts(PUBLISHER4_PKG, list(""s1"", ""s2"", ""ms1"", ""ms2""),
                getUserHandle());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher4old/src/android/content/pm/cts/shortcut/backup/launcher4/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher1.ShortcutManagerPostBackupTest"	"testWithUninstall_beforeAppRestore"	""	"1: app"	"public void testWithUninstall_beforeAppRestore() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER1_PKG)).isEmpty();
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER2_PKG)).isEmpty();
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER3_PKG)).isEmpty();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher1/src/android/content/pm/cts/shortcut/backup/launcher1/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher1.ShortcutManagerPostBackupTest"	"testWithUninstall_afterAppRestore"	""	"1: app"	"public void testWithUninstall_afterAppRestore() {
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER1_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"")
                .areAllEnabled()

                .selectByIds(""s1"", ""ms1"")
                .areAllPinned()

                .revertToOriginalList()
                .selectByIds(""ms2"")
                .areAllNotPinned();

        // Note s3 and ms2 were disabled before backup, so they were not backed up.
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER2_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllEnabled()

                .selectByIds(""s1"", ""s2"")
                .areAllPinned()

                .revertToOriginalList()
                .selectByIds(""ms1"")
                .areAllNotPinned();

        // Package3 doesn't support backup&restore.
        // However, the manifest-shortcuts will be republished anyway, so they're still pinned.
        // The dynamic shortcuts can't be restored, but we'll still restore them as disabled
        // shortcuts that are not visible to the publisher.
        assertWith(getPackageShortcuts(ShortcutManagerPreBackupTest.PUBLISHER3_PKG))
                .haveIds(""ms1"", ""ms2"", ""s1"", ""s2"")
                .areAllPinned()

                .selectByIds(""ms1"", ""ms2"")
                .areAllEnabled()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_NOT_DISABLED)

                .revertToOriginalList()
                .selectByIds(""s1"", ""s2"")
                .areAllDisabled()
                .areAllWithDisabledReason(ShortcutInfo.DISABLED_REASON_BACKUP_NOT_SUPPORTED)
                ;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher1/src/android/content/pm/cts/shortcut/backup/launcher1/ShortcutManagerPostBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.launcher1.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"3: app(s) apps app"	"public void testPreBackup() {
        getLauncherApps().pinShortcuts(PUBLISHER1_PKG, list(""s1"", ""ms1""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER2_PKG, list(""s1"", ""s2"", ""ms2""), getUserHandle());
        getLauncherApps().pinShortcuts(PUBLISHER3_PKG, list(""s1"", ""s2"", ""ms1"", ""ms2""),
                getUserHandle());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/launcher1/src/android/content/pm/cts/shortcut/backup/launcher1/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher2.ShortcutManagerPreBackup2Test"	"testPreBackup"	""	"1: app"	"public void testPreBackup() {
        getManager().removeDynamicShortcuts(list(""s2""));
        getManager().disableShortcuts(list(""s3""));

        getContext().getPackageManager().setComponentEnabledSetting(
                new ComponentName(getContext(), MainActivity.class),
                PackageManager.COMPONENT_ENABLED_STATE_DISABLED,
                PackageManager.DONT_KILL_APP);

        retryUntil(() -> getManager().getManifestShortcuts().size() == 1,
                ""Manifest shortcuts didn't update"");

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"")
                .areAllEnabled();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"")
                .areAllEnabled();

        assertWith(getManager().getPinnedShortcuts())
                .haveIds(""s1"", ""s2"", ""s3"", ""ms1"", ""ms2"")
                .selectByIds(""s1"", ""s2"", ""ms1"")
                .areAllEnabled()

                .revertToOriginalList()
                .selectByIds(""s3"", ""ms2"")
                .areAllDisabled();

   }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher2/src/android/content/pm/cts/shortcut/backup/publisher2/ShortcutManagerPreBackup2Test.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher2.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"2: UI view"	"public void testPreBackup() {
        final Icon icon1 = Icon.createWithBitmap(BitmapFactory.decodeResource(
                getContext().getResources(), R.drawable.black_16x64));
        final Icon icon3 = Icon.createWithResource(getContext(), R.drawable.black_64x16);

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1"")
                .setLongLabel(""longlabel1"")
                .setIcon(icon1)
                .setActivity(getActivity(""MainActivity2""))
                .setDisabledMessage(""disabledmessage1"")
                .setIntents(new Intent[]{new Intent(""view"").putExtra(""k1"", ""v1"")})
                .setExtras(makePersistableBundle(""ek1"", ""ev1""))
                .setCategories(set(""cat1""))
                .build();

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2"")
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        final ShortcutInfo s3 = new ShortcutInfo.Builder(getContext(), ""s3"")
                .setShortLabel(""shortlabel2"")
                .setIcon(icon3)
                .setActivity(getActivity(""MainActivity2""))
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(s1, s2, s3)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""s2"", ""s3"")
                .areAllNotPinned();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllNotPinned()
                // Note MainActivity2 have manifest shortcuts too, but because of the ID overlap,
                // they're ignored at this point.
                .areAllWithActivity(getActivity(""MainActivity""));
   }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher2/src/android/content/pm/cts/shortcut/backup/publisher2/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.backup.publisher3.ShortcutManagerPreBackupTest"	"testPreBackup"	""	"2: UI view"	"public void testPreBackup() {
        final Icon icon1 = Icon.createWithBitmap(BitmapFactory.decodeResource(
                getContext().getResources(), R.drawable.black_16x64));
        final Icon icon3 = Icon.createWithResource(getContext(), R.drawable.black_64x16);

        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1"")
                .setLongLabel(""longlabel1"")
                .setIcon(icon1)
                .setDisabledMessage(""disabledmessage1"")
                .setIntents(new Intent[]{new Intent(""view"").putExtra(""k1"", ""v1"")})
                .setExtras(makePersistableBundle(""ek1"", ""ev1""))
                .setCategories(set(""cat1""))
                .build();

        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2"")
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        final ShortcutInfo s3 = new ShortcutInfo.Builder(getContext(), ""s3"")
                .setShortLabel(""shortlabel2"")
                .setIcon(icon3)
                .setIntents(new Intent[]{new Intent(""main"")})
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(s1, s2, s3)));

        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""s2"", ""s3"")
                .areAllNotPinned();

        assertWith(getManager().getManifestShortcuts())
                .haveIds(""ms1"", ""ms2"")
                .areAllNotPinned();
   }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/backup/publisher3/src/android/content/pm/cts/shortcut/backup/publisher3/ShortcutManagerPreBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.upgrade.ShortcutManagerPreUpgradeTest"	"testPreUpgrade"	""	"5: app(s) apps UI view app"	"public void testPreUpgrade() {
        Log.i(Consts.TAG, ""Pre: ResIDs="" + R.drawable.black_32x32 + "", "" + R.drawable.black_64x64);

        // Publish shortcuts with drawable icons.
        final Icon icon1 = Icon.createWithResource(getContext(), R.drawable.black_32x32);
        final Icon icon2 = Icon.createWithResource(getContext(), R.drawable.black_64x64);

        // Store the original resource ID in the extras.
        final PersistableBundle b1 = new PersistableBundle();
        b1.putInt(Consts.EXTRA_ICON_RES_ID, R.drawable.black_32x32);
        final ShortcutInfo s1 = new ShortcutInfo.Builder(getContext(), ""s1"")
                .setShortLabel(""shortlabel1"")
                .setIcon(icon1)
                .setIntents(new Intent[]{new Intent(Intent.ACTION_VIEW)})
                .setExtras(b1)
                .build();

        final PersistableBundle b2 = new PersistableBundle();
        b2.putInt(Consts.EXTRA_ICON_RES_ID, R.drawable.black_64x64);
        final ShortcutInfo s2 = new ShortcutInfo.Builder(getContext(), ""s2"")
                .setShortLabel(""shortlabel2"")
                .setIcon(icon2)
                .setIntents(new Intent[]{new Intent(Intent.ACTION_VIEW)})
                .setExtras(b2)
                .build();

        assertTrue(getManager().setDynamicShortcuts(list(s1, s2)));

        // Set this package as a default launcher to access LauncherApps.
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        // Check the published icons as a launcher.
        assertIconDimensions(getContext().getPackageName(), ""s1"", icon1);
        assertIconDimensions(getContext().getPackageName(), ""s2"", icon2);

        // Paranoid: this should fail.
        boolean notThrown = false;
        try {
            assertIconDimensions(getContext().getPackageName(), ""s1"", icon2);
            notThrown = true;
        } catch (AssertionFailedError expected) {
            // okay
        }
        assertFalse(notThrown);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/upgrade/src/android/content/pm/cts/shortcut/upgrade/ShortcutManagerPreUpgradeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.upgrade.ShortcutManagerPostUpgradeTest"	"testPostUpgrade"	""	"3: app(s) apps app"	"public void testPostUpgrade() {
        Log.i(Consts.TAG, ""Post: ResIDs="" + R.drawable.black_32x32 + "", "" + R.drawable.black_64x64);

        // Get the shortcuts published by the ""pre"" apk.

        // Check their original res IDs (stored in the extras) and make sure the res IDs are
        // different now.
        assertWith(getManager().getDynamicShortcuts())
                .haveIds(""s1"", ""s2"")
                .forShortcutWithId(""s1"", s -> {
                    assertTrue(
                            R.drawable.black_32x32 !=
                            s.getExtras().getInt(Consts.EXTRA_ICON_RES_ID));
                })
                .forShortcutWithId(""s2"", s -> {
                    assertTrue(
                            R.drawable.black_64x64 !=
                            s.getExtras().getInt(Consts.EXTRA_ICON_RES_ID));
                });

        // Next, actually fetch the icons as a launcher, and make sure the dimensions are correct.
        final Icon icon1 = Icon.createWithResource(getContext(), R.drawable.black_32x32);
        final Icon icon2 = Icon.createWithResource(getContext(), R.drawable.black_64x64);

        // Set this package as a default launcher to access LauncherApps.
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        // Check the published icons as a launcher.
        assertIconDimensions(getContext().getPackageName(), ""s1"", icon1);
        assertIconDimensions(getContext().getPackageName(), ""s2"", icon2);

        // Paranoid: this should fail.
        boolean notThrown = false;
        try {
            assertIconDimensions(getContext().getPackageName(), ""s1"", icon2);
            notThrown = true;
        } catch (AssertionFailedError expected) {
            // okay
        }
        assertFalse(notThrown);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/upgrade/src/android/content/pm/cts/shortcut/upgrade/ShortcutManagerPostUpgradeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerManagedUserTest"	"test01_managedProfileNotStarted"	""	"3: app(s) apps app"	"public void test01_managedProfileNotStarted() {
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        // Get user-0's handle.
        final UserHandle userManaged = getOtherUser();

        final ShortcutQuery q = new ShortcutQuery();

        try {
            getLauncherApps().getShortcuts(q, userManaged);
            fail(""Didn't throw SecurityException"");
        } catch (IllegalStateException e) {
            assertTrue(e.getMessage().contains(""locked or not running""));
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerManagedUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerManagedUserTest"	"test04_getAndLaunch_primary"	""	"3: app(s) apps app"	"public void test04_getAndLaunch_primary() {
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        final UserHandle userCurrent = android.os.Process.myUserHandle();
        final UserHandle userOther = getOtherUser();

        final ShortcutQuery q = new ShortcutQuery()
                .setQueryFlags(ShortcutQuery.FLAG_MATCH_DYNAMIC)
                .setPackage(getContext().getPackageName())
                .setShortcutIds(list(""s1""));
        assertWith(getLauncherApps().getShortcuts(q, userCurrent))
                .haveIds(""s1"")
                .areAllDynamic()
                .forShortcutWithId(""s1"", si -> {
                    assertEquals(""label1"", si.getShortLabel());
                    assertEquals(userCurrent, si.getUserHandle());
                });
        assertWith(getLauncherApps().getShortcuts(q, userOther))
                .haveIds(""s1"")
                .areAllDynamic()
                .forShortcutWithId(""s1"", si -> {
                    assertEquals(""label2"", si.getShortLabel());
                    assertEquals(userOther, si.getUserHandle());
                });

        // Just call start and make sure they don't throw.
        getLauncherApps().startShortcut(getContext().getPackageName(), ""s1"", null, null,
                userCurrent);

        // TODO Make sure the activity actually starts.
        getLauncherApps().startShortcut(getContext().getPackageName(), ""s1"", null, null,
                userOther);
    }

    @Suppress // Having a launcher on managed profile is not supported, so don't run."	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerManagedUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerManagedUserTest"	"test05_getAndLaunch_managed"	""	"4: app(s) apps accessing app"	"public void test05_getAndLaunch_managed() {
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        final UserHandle userCurrent = android.os.Process.myUserHandle();
        final UserHandle userOther = getOtherUser();

        final ShortcutQuery q = new ShortcutQuery()
                .setQueryFlags(ShortcutQuery.FLAG_MATCH_DYNAMIC)
                .setPackage(getContext().getPackageName())
                .setShortcutIds(list(""s1""));

        assertWith(getLauncherApps().getShortcuts(q, userCurrent))
                .haveIds(""s1"")
                .areAllDynamic()
                .forShortcutWithId(""s1"", si -> {
                    assertEquals(""label2"", si.getShortLabel());
                    assertEquals(userCurrent, si.getUserHandle());
                });

        // Accessing the main profile from the managed profile, which will not throw, but will
        // return an empty result.
        assertWith(getLauncherApps().getShortcuts(q, userOther)).isEmpty();

        // TODO Make sure the activity actually starts.
        getLauncherApps().startShortcut(getContext().getPackageName(), ""s1"", null, null,
                userCurrent);

        try {
            // This won't throw SecurityException either.
            getLauncherApps().startShortcut(getContext().getPackageName(), ""s1"", null, null,
                    userOther);
            fail(""Didn't throw ActivityNotFoundException"");
        } catch (ActivityNotFoundException e) {
            // okay
        }
    }

    private UserHandle getOtherUser() {
        for (UserHandle user : getContext().getSystemService(UserManager.class).getUserProfiles()) {
            if (user.equals(android.os.Process.myUserHandle())) {
                continue;
            }
            return user;
        }
        fail(""Other user not found"");
        return null;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerManagedUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerManagedUserTest"	"test02_createShortuctsOnPrimaryUser"	""	"2: UI view"	"public void test02_createShortuctsOnPrimaryUser() {
        assertTrue(getManager().setDynamicShortcuts(list(
                new ShortcutInfo.Builder(getContext(), ""s1"")
                        .setShortLabel(""label1"")
                        .setIntent(new Intent(Intent.ACTION_VIEW).setComponent(
                                new ComponentName(getContext(), MainActivity.class))).build())));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerManagedUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerManagedUserTest"	"test03_createShortuctsOnManagedProfile"	""	"2: UI view"	"public void test03_createShortuctsOnManagedProfile() {
        assertTrue(getManager().setDynamicShortcuts(list(
                new ShortcutInfo.Builder(getContext(), ""s1"")
                        .setShortLabel(""label2"")
                        .setIntent(new Intent(Intent.ACTION_VIEW).setComponent(
                                new ComponentName(getContext(), MainActivity.class))).build())));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerManagedUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerSecondaryUserTest"	"testCreateAndStart"	""	"6: app(s) apps UI view app display"	"public void testCreateAndStart() {
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        // Publish a shortcut.
        final UserHandle user = android.os.Process.myUserHandle();

        assertTrue(getManager().setDynamicShortcuts(list(
                new ShortcutInfo.Builder(getContext(), ""s1"")
                    .setShortLabel(""label"")
                    .setIntent(new Intent(Intent.ACTION_VIEW).setComponent(
                            new ComponentName(getContext(), MainActivity.class))).build())));

        // Retrieve as a launcher.
        final ShortcutQuery q = new ShortcutQuery()
                .setQueryFlags(ShortcutQuery.FLAG_MATCH_DYNAMIC)
                .setPackage(getContext().getPackageName())
                .setShortcutIds(list(""s1""));
        final List<ShortcutInfo> list = getLauncherApps().getShortcuts(q, user);
        assertWith(list)
                .haveIds(""s1"")
                .areAllDynamic()
                .forShortcutWithId(""s1"", si -> {
                    assertEquals(user, si.getUserHandle());
                });

        final ShortcutInfo s1 = list.get(0);

        // Just make sure they don't throw SecurityException.
        getLauncherApps().getShortcutIconDrawable(s1, DisplayMetrics.DENSITY_DEFAULT);
        getLauncherApps().getShortcutBadgedIconDrawable(s1, DisplayMetrics.DENSITY_DEFAULT);

        final long now = System.currentTimeMillis();

        // Start it.
        getLauncherApps().startShortcut(s1, null, null);

        retryUntil(() -> MainActivity.getLastCreateTime() >= now, ""Activity not started"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerSecondaryUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcut.multiuser.ShortcutManagerSecondaryUserTest"	"testDifferentUserNotAccessible"	""	"3: app(s) apps app"	"public void testDifferentUserNotAccessible() throws Exception {
        Launcher.setAsDefaultLauncher(getInstrumentation(), getContext());

        // Get user-0's handle.
        final UserHandle user0 = getUser0Handle();

        final ShortcutQuery q = new ShortcutQuery();

        try {
            getLauncherApps().getShortcuts(q, user0);
            fail(""Didn't throw SecurityException"");
        } catch (SecurityException e) {
            assertTrue(e.getMessage().contains(""unrelated profile""));
        }
    }

    private static UserHandle getUser0Handle() throws Exception {
        Method of = UserHandle.class.getMethod(""of"", int.class);

        return (UserHandle) of.invoke(null, 0);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/deviceside/multiuser/src/android/content/pm/cts/shortcut/multiuser/ShortcutManagerSecondaryUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerMultiuserTest"	"testManagedUser"	"CtsShortcutHostTestCases"	"1: app"	"public void testManagedUser() throws Exception {
        if (!mIsMultiuserSupported || !mIsManagedUserSupported) {
            return;
        }
        // First, create users
        final int profileId = createProfile(getPrimaryUserId());

        installAppAsUser(TARGET_APK, getPrimaryUserId());
        installAppAsUser(TARGET_APK, profileId);

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerManagedUserTest"",
                ""test01_managedProfileNotStarted"", getPrimaryUserId());

        getDevice().startUser(profileId, /* wait */ true);

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerManagedUserTest"",
                ""test02_createShortuctsOnPrimaryUser"", getPrimaryUserId());
        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerManagedUserTest"",
                ""test03_createShortuctsOnManagedProfile"", profileId);

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerManagedUserTest"",
                ""test04_getAndLaunch_primary"", getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerMultiuserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerMultiuserTest"	"testSecondaryUser"	"CtsShortcutHostTestCases"	"1: app"	"public void testSecondaryUser() throws Exception {
        if (!mIsMultiuserSupported) {
            return;
        }
        final int secondUserID = getOrCreateSecondaryUser();

        getDevice().startUser(secondUserID, true);
        getDevice().switchUser(secondUserID);
        Thread.sleep(5000);
        installAppAsUser(TARGET_APK, secondUserID);
        waitForBroadcastIdle();
        Thread.sleep(5000);

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerSecondaryUserTest"", secondUserID);

        getDevice().stopUser(secondUserID);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerMultiuserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        installAppAsUser(LAUNCHER1_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER2_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER3_APK, getPrimaryUserId());

        installAppAsUser(PUBLISHER1_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER2_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER3_APK, getPrimaryUserId());

        // Prepare shortcuts
        runDeviceTestsAsUser(PUBLISHER1_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(PUBLISHER2_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(PUBLISHER3_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER1_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER2_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER3_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        // Tweak shortcuts a little bit to make disabled shortcuts.
        runDeviceTestsAsUser(PUBLISHER2_PKG, "".ShortcutManagerPreBackup2Test"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER1_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER2_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER3_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER1_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER2_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER3_PKG);


        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // First, restore launcher 1, which shouldn't see any shortcuts from the packages yet.
        installAppAsUser(LAUNCHER1_APK, getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER1_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall_beforeAppRestore"",
                getPrimaryUserId());

        // Restore the apps.  Even though launcher 2 hasn't been re-installed yet, they should
        // still have pinned shortcuts by launcher 2.
        installAppAsUser(PUBLISHER1_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER2_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER3_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER1_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER2_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER3_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());

        // Now launcher 1 should see shortcuts from these packages.
        runDeviceTestsAsUser(LAUNCHER1_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall_afterAppRestore"",
                getPrimaryUserId());

        // Then restore launcher 2 and check.
        installAppAsUser(LAUNCHER2_APK, getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER2_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall_afterAppRestore"",
                getPrimaryUserId());


        // Run the same package side check.  The result should be the same.
        runDeviceTestsAsUser(PUBLISHER1_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER2_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER3_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithUninstall"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_downgrade"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_downgrade() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from the new version and pin them.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Restore the old version of the app, and the launcher.
        // (But we don't check the launcher's version, so using old is fine.)
        installAppAsUser(LAUNCHER4_OLD_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_OLD_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoredOnOldVersion"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoredOnOldVersion"",
                getPrimaryUserId());

        // New install the original version. All blocked shortcuts should re-appear.
        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoredOnNewVersion"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoredOnNewVersion"",
                getPrimaryUserId());

    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_backupWasDisabled"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_backupWasDisabled() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from ""nobackup"" version.

        installAppAsUser(PUBLISHER4_NEW_NOBACKUP_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the ""backup-ok"" version. But restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testBackupDisabled"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_backupIsDisabled"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_backupIsDisabled() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from backup-ok version.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the nobackup version. Restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_NEW_NOBACKUP_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testBackupDisabled"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_wrongKey"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_wrongKey() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from backup-ok version.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the nobackup version. Restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_NEW_WRONGKEY_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreWrongKey"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreWrongKey"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_noManifestOnOldVersion"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_noManifestOnOldVersion() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from backup-ok version.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the nobackup version. Restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_OLD_NO_MANIFST_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreNoManifestOnOldVersion"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreNoManifestOnOldVersion"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_noManifestOnNewVersion"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_noManifestOnNewVersion() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from backup-ok version.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the nobackup version. Restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_NEW_NO_MANIFST_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreNoManifestOnNewVersion"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testRestoreNoManifestOnNewVersion"",
                getPrimaryUserId());
    }

    /**
     * Make sure invisible shortcuts are ignored by all API calls.
     *
     * (Restore from new to old-nomanifest)
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_invisibleIgnored"	"CtsShortcutHostTestCases"	"3: app(s) apps app"	"public void testBackupAndRestore_invisibleIgnored() throws Exception {
        if (!mSupportsBackup) {
            return;
        }
        dumpsys(""Test start"");

        // First, publish shortcuts from backup-ok version.

        installAppAsUser(PUBLISHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        dumpsys(""Before backup"");

        // Backup
        doBackup();

        // Uninstall all apps
        uninstallPackageAndWaitUntilBroadcastsDrain(LAUNCHER4_PKG);
        uninstallPackageAndWaitUntilBroadcastsDrain(PUBLISHER4_PKG);

        // Make sure the shortcut service handled all the uninstall broadcasts.
        waitUntilPackagesGone();

        // Do it one more time just in case...
        waitUntilBroadcastsDrain();

        // Then restore
        doRestore();

        dumpsys(""After restore"");

        // Install the nobackup version. Restoration is limited.
        installAppAsUser(LAUNCHER4_NEW_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER4_OLD_NO_MANIFST_APK, getPrimaryUserId());
        waitUntilBroadcastsDrain();

        runDeviceTestsAsUser(PUBLISHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testInvisibleIgnored"",
                getPrimaryUserId());

        runDeviceTestsAsUser(LAUNCHER4_PKG, "".ShortcutManagerPostBackupTest"",
                ""testInvisibleIgnored"",
                getPrimaryUserId());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerBackupTest"	"testBackupAndRestore_withNoUninstall"	"CtsShortcutHostTestCases"	"1: app"	"public void testBackupAndRestore_withNoUninstall() throws Exception {
        if (!mSupportsBackup) {
            return;
        }

        installAppAsUser(PUBLISHER1_APK, getPrimaryUserId());
        installAppAsUser(PUBLISHER3_APK, getPrimaryUserId());

        // Prepare shortcuts
        runDeviceTestsAsUser(PUBLISHER1_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());
        runDeviceTestsAsUser(PUBLISHER3_PKG, "".ShortcutManagerPreBackupTest"", getPrimaryUserId());

        // Backup & restore.
        doBackup();
        doRestore();

        // Make sure the manifest shortcuts are re-published.
        runDeviceTestsAsUser(PUBLISHER1_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithNoUninstall"",
                getPrimaryUserId());

        runDeviceTestsAsUser(PUBLISHER3_PKG, "".ShortcutManagerPostBackupTest"",
                ""testWithNoUninstall"",
                getPrimaryUserId());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerBackupTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"android.content.pm.cts.shortcuthost.ShortcutManagerUpgradeTest"	"testUpgrade"	"CtsShortcutHostTestCases"	"1: app"	"public void testUpgrade() throws Exception {
        installAppAsUser(VERSION1_APK, getPrimaryUserId());

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerPreUpgradeTest"", getPrimaryUserId());

        installAppAsUser(VERSION2_APK, getPrimaryUserId());

        runDeviceTestsAsUser(TARGET_PKG, "".ShortcutManagerPostUpgradeTest"", getPrimaryUserId());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/shortcuts/hostside/src/android/content/pm/cts/shortcuthost/ShortcutManagerUpgradeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.AccountCheckHostSideTest"	"testAccountCheck"	"CtsDevicePolicyManagerTestCases"	"3: UI only app"	"@LargeTest
    public void testAccountCheck() throws Exception {
        installAppAsUser(APK_AUTH, mProfileOwnerUserId);
        installAppAsUser(APK_NON_TEST_ONLY, mProfileOwnerUserId);
        installAppAsUser(APK_TEST_ONLY, mProfileOwnerUserId);
        runCleanupTestOnlyOwnerAllowingFailure(mProfileOwnerUserId);

        // For tests in headless system user mode, test packages need to be installed for
        // system user even for PO tests since PO will be set via adb command which will require
        // TestAuthenticator installed on system user.
        if (mDeviceOwnerUserId != mProfileOwnerUserId) {
            installAppAsUser(APK_AUTH, mDeviceOwnerUserId);
            installAppAsUser(APK_NON_TEST_ONLY, mDeviceOwnerUserId);
            installAppAsUser(APK_TEST_ONLY, mDeviceOwnerUserId);
            runCleanupTestOnlyOwnerAllowingFailure(mDeviceOwnerUserId);
        }

        runCleanupNonTestOnlyOwnerAllowingFailure();
        removeAllAccountsAllowingFailure();
        try {
//            runTest(""testCheckPreconfiguredAccountFeatures"");
//
//            final boolean hasPreconfiguredAccounts = hasAccounts();
//
//            // All pre-configured accounts must be ""compatible"", so the test-only owner can be
//            // installed.
//            assertTestOnlyInstallable();
//
//            if (hasPreconfiguredAccounts) {
//                assertNonTestOnlyNotInstallable();
//            } else {
//                assertNonTestOnlyInstallable();
//            }
//
            // Incompatible, type A.
            runTest(""testAddIncompatibleA"");

            assertTestOnlyNotInstallable();
            assertNonTestOnlyNotInstallable();

            // Incompatible, type B.
            removeAllAccounts();
            runTest(""testAddIncompatibleB"");

            assertTestOnlyNotInstallable();
            assertNonTestOnlyNotInstallable();

            // Incompatible, type C.
            removeAllAccounts();
            runTest(""testAddIncompatibleC"");

            assertTestOnlyNotInstallable();
            assertNonTestOnlyNotInstallable();

            // Compatible.
            removeAllAccounts();
            runTest(""testAddCompatible"");

            assertTestOnlyInstallable(); // Now test-only owner can be accepted.
            assertNonTestOnlyNotInstallable();

            // 2 compatible accounts.
            removeAllAccounts();
            runTest(""testAddCompatible"");
            runTest(""testAddCompatible"");

            assertTestOnlyInstallable(); // Now test-only owner can be accepted.

            assertNonTestOnlyNotInstallable();

            // 2 compatible accounts + 1 incompatible.
            removeAllAccounts();
            runTest(""testAddIncompatibleA"");
            runTest(""testAddCompatible"");
            runTest(""testAddCompatible"");

            assertTestOnlyNotInstallable();
            assertNonTestOnlyNotInstallable();

            // 2 compatible accounts + 1 incompatible, different order.
            removeAllAccounts();
            runTest(""testAddCompatible"");
            runTest(""testAddCompatible"");
            runTest(""testAddIncompatibleB"");

            assertTestOnlyNotInstallable();
            assertNonTestOnlyNotInstallable();
        } catch (Throwable th) {
            CLog.w(""Tests failed; current accounts are:"");
            CLog.w(getDevice().executeShellCommand(""dumpsys account""));

            // Dump accounts
            throw th;
        }
    }

    /**
     * Make sure even if the ""test-only"" flag changes when an app is updated, we still respect
     * the original value.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/AccountCheckHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.AccountCheckHostSideTest"	"runCleanupNonTestOnlyOwnerAllowingFailure"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;
import static org.junit.Assume.assumeTrue;

import android.platform.test.annotations.LargeTest;

import com.android.tradefed.log.LogUtil.CLog;

import org.junit.Test;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Set of tests to test setting DO and PO when there is account on the user.
 *
 * <p>For example, setting DO or PO shall fail at DPMS.hasIncompatibleAccountsOrNonAdbNoLock when
 * there was incompatible account on the user.
 */
public class AccountCheckHostSideTest extends BaseDevicePolicyTest {
    private static final String APK_NON_TEST_ONLY = ""CtsAccountCheckNonTestOnlyOwnerApp.apk"";
    private static final String APK_TEST_ONLY = ""CtsAccountCheckTestOnlyOwnerApp.apk"";
    private static final String APK_TEST_ONLY_UPDATE = ""CtsAccountCheckTestOnlyOwnerUpdateApp.apk"";
    private static final String APK_AUTH = ""CtsAccountCheckAuthApp.apk"";

    private static final String PACKAGE_NON_TEST_ONLY =
            ""com.android.cts.devicepolicy.accountcheck.nontestonly"";
    private static final String PACKAGE_TEST_ONLY =
            ""com.android.cts.devicepolicy.accountcheck.testonly"";
    private static final String PACKAGE_AUTH = ""com.android.cts.devicepolicy.accountcheck.auth"";

    private static final String OWNER_TEST_ONLY = PACKAGE_TEST_ONLY
            + ""/com.android.cts.devicepolicy.accountcheck.owner.AdminReceiver"";
    private static final String OWNER_NON_TEST_ONLY = PACKAGE_NON_TEST_ONLY
            + ""/com.android.cts.devicepolicy.accountcheck.owner.AdminReceiver"";

    private static final String TEST_CLASS =
            ""com.android.cts.devicepolicy.accountcheck.AccountCheckTest"";

    private static final String DISALLOW_MODIFY_ACCOUNTS = ""no_modify_accounts"";

    private boolean mDeviceOwnerCanHaveAccounts;
    private boolean mProfileOwnerCanHaveAccounts;
    private int mProfileOwnerUserId;

    @Override
    public void setUp() throws Exception {
        super.setUp();
        mProfileOwnerUserId = mPrimaryUserId;
        mDeviceOwnerCanHaveAccounts = !isRestrictionSetOnUser(mDeviceOwnerUserId,
                DISALLOW_MODIFY_ACCOUNTS);
        // Optimization to avoid running dumpsys again
        if (mProfileOwnerUserId == mDeviceOwnerUserId) {
            mProfileOwnerCanHaveAccounts = mDeviceOwnerCanHaveAccounts;
        } else {
            mProfileOwnerCanHaveAccounts = !isRestrictionSetOnUser(mProfileOwnerUserId,
                    DISALLOW_MODIFY_ACCOUNTS);
        }
        CLog.d(""mDeviceOwnerUserId: "" +  mDeviceOwnerUserId
                + "" mDeviceOwnerCanHaveAccounts: "" + mDeviceOwnerCanHaveAccounts
                + "" mProfileOwnerUserId: "" + mProfileOwnerUserId
                + "" mProfileOwnerCanHaveAccounts: "" + mProfileOwnerCanHaveAccounts);
        assumeTrue(""Neither primary user or device owner user is allowed to add accounts"",
                mDeviceOwnerCanHaveAccounts || mProfileOwnerCanHaveAccounts);
    }

    @Override
    public void tearDown() throws Exception {
        if (getDevice().getInstalledPackageNames().contains(PACKAGE_AUTH)) {
            runCleanupTestOnlyOwnerAllowingFailure(mProfileOwnerUserId);
            if (mDeviceOwnerUserId != mProfileOwnerUserId) {
                runCleanupTestOnlyOwnerAllowingFailure(mDeviceOwnerUserId);
            }
            runCleanupNonTestOnlyOwnerAllowingFailure();

            // This shouldn't be needed since we're uninstalling the authenticator,
            // but sometimes the account manager fails to clean up?
            removeAllAccountsAllowingFailure();
        }

        getDevice().uninstallPackage(PACKAGE_AUTH);
        getDevice().uninstallPackage(PACKAGE_TEST_ONLY);
        getDevice().uninstallPackage(PACKAGE_NON_TEST_ONLY);

        super.tearDown();
    }

    private void runTest(String method) throws Exception {
        runTestAsUser(method, mProfileOwnerUserId);
        if (mDeviceOwnerCanHaveAccounts && mProfileOwnerUserId != mDeviceOwnerUserId) {
            runTestAsUser(method, mDeviceOwnerUserId);
        }
    }

    private void runTestAsUser(String method, int userId) throws Exception {
        runDeviceTestsAsUser(PACKAGE_AUTH, TEST_CLASS, method, userId);
    }

    private void runCleanupTestOnlyOwner(int userId) throws Exception {
        assertTrue(removeAdmin(OWNER_TEST_ONLY, userId));
    }

    private void runCleanupTestOnlyOwnerAllowingFailure(int userId) throws Exception {
        try {
            runCleanupTestOnlyOwner(userId);
        } catch (AssertionError ignore) {
        }
    }

    private void runCleanupNonTestOnlyOwner() throws Exception {
        runTest(""testCleanUpNonTestOwner"");
    }

    private void runCleanupNonTestOnlyOwnerAllowingFailure() throws Exception {
        try {
            runCleanupNonTestOnlyOwner();
        } catch (AssertionError ignore) {
        }
    }

    private void removeAllAccounts() throws Exception {
        runTest(""testRemoveAllAccounts"");
    }

    private void removeAllAccountsAllowingFailure() throws Exception {
        try {
            removeAllAccounts();
        } catch (AssertionError ignore) {
        }
    }

    private void assertTestOnlyInstallable() throws Exception {
        if (mDeviceOwnerCanHaveAccounts) {
            setDeviceOwnerOrFail(OWNER_TEST_ONLY, mDeviceOwnerUserId);
            runCleanupTestOnlyOwner(mDeviceOwnerUserId);
        }
        if (mProfileOwnerCanHaveAccounts) {
            setProfileOwnerOrFail(OWNER_TEST_ONLY, mProfileOwnerUserId);
            runCleanupTestOnlyOwner(mProfileOwnerUserId);
        }
    }

    private void assertNonTestOnlyInstallable() throws Exception {
        if (mDeviceOwnerCanHaveAccounts) {
            setDeviceOwnerOrFail(OWNER_NON_TEST_ONLY, mDeviceOwnerUserId);
            runCleanupNonTestOnlyOwner();
        }
        if (mProfileOwnerCanHaveAccounts) {
            setProfileOwnerOrFail(OWNER_NON_TEST_ONLY, mProfileOwnerUserId);
            runCleanupNonTestOnlyOwner();
        }
    }

    private void assertTestOnlyNotInstallable() throws Exception {
        if (mDeviceOwnerCanHaveAccounts) {
            setDeviceOwnerExpectingFailure(OWNER_TEST_ONLY, mDeviceOwnerUserId);
            runCleanupTestOnlyOwnerAllowingFailure(mDeviceOwnerUserId);
        }
        if (mProfileOwnerCanHaveAccounts) {
            setProfileOwnerExpectingFailure(OWNER_TEST_ONLY, mProfileOwnerUserId);
            runCleanupTestOnlyOwnerAllowingFailure(mProfileOwnerUserId);
        }
    }

    private void assertNonTestOnlyNotInstallable() throws Exception {
        if (mDeviceOwnerCanHaveAccounts) {
            setDeviceOwnerExpectingFailure(OWNER_NON_TEST_ONLY, mDeviceOwnerUserId);
            runCleanupNonTestOnlyOwnerAllowingFailure();
        }
        if (mProfileOwnerCanHaveAccounts) {
            setProfileOwnerExpectingFailure(OWNER_NON_TEST_ONLY, mProfileOwnerUserId);
            runCleanupNonTestOnlyOwnerAllowingFailure();
        }
    }

    private boolean hasAccounts() throws Exception {
        final String accountDump = getDevice().executeShellCommand(""dumpsys account"");

        final Pattern p = Pattern.compile(""^\\s*Accounts\\:\\s*(\\d+)"", Pattern.MULTILINE);
        final Matcher m = p.matcher(accountDump);
        if (!m.find()) {
            fail(""Unable to obtain # of accounts"");
            return true;
        }
        final String count = m.group(1);

        CLog.i(""# of preconfigured accounts="" + count);

        return Integer.parseInt(count) > 0;
    }

    /**
     * This set of tests will test whether DO and PO can be set on the user when
     * there is/are different types of accounts added on the target test user.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/AccountCheckHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.AccountCheckHostSideTest"	"testInheritTestOnly"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"public void testInheritTestOnly() throws Exception {
        installAppAsUser(APK_TEST_ONLY, mDeviceOwnerUserId);

        // Set as DO.
        try {
            setDeviceOwnerOrFail(OWNER_TEST_ONLY, mDeviceOwnerUserId);
        } catch (Throwable e) {
            CLog.e(""Unable to install DO, can't continue the test. Skipping.  hasAccounts=""
                    + hasAccounts());
            return;
        }
        try {

            // Override with a package that's not test-only.
            installAppAsUser(APK_TEST_ONLY_UPDATE, mDeviceOwnerUserId);

            // But DPMS keeps the original test-only flag, so it's still removable.
            runCleanupTestOnlyOwner(mDeviceOwnerUserId);

            return;
        } catch (Throwable e) {
            // If failed, re-install the APK with test-only=true.
            try {
                installAppAsUser(APK_TEST_ONLY, mDeviceOwnerUserId);
                runCleanupTestOnlyOwner(mDeviceOwnerUserId);
            } catch (Exception inner) {
                CLog.e(""Unable to clean up after a failure: "" + e.getMessage());
            }

            throw e;
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/AccountCheckHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileProvisioningSingleAdminTest"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *
 */
package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import android.platform.test.annotations.FlakyTest;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;

import org.junit.Ignore;
import org.junit.Test;

/**
 * This class tests the provisioning flow with an APK that declares a single receiver with
 * BIND_DEVICE_ADMIN permissions, which was a requirement for the app sending the
 * ACTION_PROVISION_MANAGED_PROFILE intent before Android M.
 */
// We need multi user to be supported in order to create a profile of the user owner.
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class ManagedProfileProvisioningSingleAdminTest extends BaseDevicePolicyTest {

    private static final String SINGLE_ADMIN_PKG = ""com.android.cts.devicepolicy.singleadmin"";
    private static final String SINGLE_ADMIN_APP_APK = ""CtsDevicePolicySingleAdminTestApp.apk"";

    private int mProfileUserId;

    @Override
    public void setUp() throws Exception {
        super.setUp();


        removeTestUsers();
        installAppAsUser(SINGLE_ADMIN_APP_APK, mPrimaryUserId);
        mProfileUserId = 0;
    }

    @Override
    public void tearDown() throws Exception {
        if (mProfileUserId != 0) {
            removeUser(mProfileUserId);
        }
        getDevice().uninstallPackage(SINGLE_ADMIN_PKG);

        super.tearDown();
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileProvisioningSingleAdminTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTimeoutTest"	"testWorkProfileTimeoutBackground"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testWorkProfileTimeoutBackground() throws Exception {
        assumeHasSecureLockScreenFeature();

        setUpWorkProfileTimeout();

        startTestActivity(mPrimaryUserId, true);
        simulateUserInteraction(PROFILE_TIMEOUT_DELAY_MS);

        verifyOnlyProfileLocked(true);
    }

    /** Profile should get locked if it is in foreground but with no user activity. */
    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTimeoutTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTimeoutTest"	"testWorkProfileTimeoutIdleActivity"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testWorkProfileTimeoutIdleActivity() throws Exception {
        assumeHasSecureLockScreenFeature();

        setUpWorkProfileTimeout();

        startTestActivity(mProfileUserId, false);
        Thread.sleep(PROFILE_TIMEOUT_DELAY_MS);

        verifyOnlyProfileLocked(true);
    }

    /** User activity in profile should prevent it from locking. */
    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTimeoutTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTimeoutTest"	"testWorkProfileTimeoutUserActivity"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testWorkProfileTimeoutUserActivity() throws Exception {
        assumeHasSecureLockScreenFeature();

        setUpWorkProfileTimeout();

        startTestActivity(mProfileUserId, false);
        simulateUserInteraction(PROFILE_TIMEOUT_DELAY_MS);

        verifyOnlyProfileLocked(false);
    }

    /** Keep screen on window flag in the profile should prevent it from locking. */
    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTimeoutTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTimeoutTest"	"testWorkProfileTimeoutKeepScreenOnWindow"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testWorkProfileTimeoutKeepScreenOnWindow() throws Exception {
        assumeHasSecureLockScreenFeature();

        setUpWorkProfileTimeout();

        startTestActivity(mProfileUserId, true);
        Thread.sleep(PROFILE_TIMEOUT_DELAY_MS);

        verifyOnlyProfileLocked(false);
    }

    private void setUpWorkProfileTimeout() throws DeviceNotAvailableException {
        // Set separate challenge.
        changeUserCredential(TEST_PASSWORD, null, mProfileUserId);

        // Make sure the profile is not prematurely locked.
        verifyUserCredential(TEST_PASSWORD, mProfileUserId);
        verifyOnlyProfileLocked(false);
        // Set profile timeout to 5 seconds.
        runProfileTimeoutTest(""testSetWorkProfileTimeout"", mProfileUserId);
    }

    private void verifyOnlyProfileLocked(boolean locked) throws DeviceNotAvailableException {
        final String expectedResultTest = locked ? ""testDeviceLocked"" : ""testDeviceNotLocked"";
        runProfileTimeoutTest(expectedResultTest, mProfileUserId);
        // Primary profile shouldn't be locked.
        runProfileTimeoutTest(""testDeviceNotLocked"", mPrimaryUserId);
    }

    private void simulateUserInteraction(int timeMs) throws Exception {
        final long endTime = System.nanoTime() + TimeUnit.MILLISECONDS.toNanos(timeMs);
        final UserActivityEmulator helper = new UserActivityEmulator(getDevice());
        while (System.nanoTime() < endTime) {
            helper.tapScreen();
            // Just in case to prevent busy loop.
            Thread.sleep(100);
        }
    }

    private void runProfileTimeoutTest(String method, int userId)
            throws DeviceNotAvailableException {
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".ProfileTimeoutTestHelper"",
                method, userId);
    }

    private void startTestActivity(int profileUserId, boolean keepScreenOn) throws Exception {
        getDevice().executeShellCommand(String.format(
                ""am start-activity -W --user %d --ez keep_screen_on %s %s/.TimeoutActivity"",
                profileUserId, keepScreenOn, MANAGED_PROFILE_PKG));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTimeoutTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testDisallowFactoryReset"	"CtsDevicePolicyManagerTestCases"	"3: data UI app"	"public void testDisallowFactoryReset() throws Exception {
        int adminVersion = 24;
        // NOTE: the restriction must be set on primary user as it will launch SetPolicyActivity,
        // but the admin must be installed on USER_SYSTEM, otherwise wipeData() on headless system
        // user mode would wipe the current user (instead of factory resetting the device)
        changeUserRestrictionOrFail(""no_factory_reset"", true, mPrimaryUserId, DEVICE_OWNER_PKG);
        int adminUserId = USER_SYSTEM;

        String deviceAdminPkg = DeviceAdminHelper.getDeviceAdminApkPackage(adminVersion);
        String deviceAdminReceiver = DeviceAdminHelper.getAdminReceiverComponent(adminVersion);
        try {
            installAppAsUser(DeviceAdminHelper.getDeviceAdminApkFileName(adminVersion),
                    adminUserId);
            setDeviceAdmin(deviceAdminReceiver, adminUserId);
            runDeviceTestsAsUser(
                    deviceAdminPkg,
                    DeviceAdminHelper.getDeviceAdminJavaPackage() + "".WipeDataTest"",
                    ""testWipeDataThrowsSecurityException"", adminUserId);
        } finally {
            removeAdmin(deviceAdminReceiver, adminUserId);
            getDevice().uninstallPackage(deviceAdminPkg);
        }
    }

    // The backup service cannot be enabled if the backup feature is not supported.
    @RequiresAdditionalFeatures({FEATURE_BACKUP})"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetGlobalSettingLogged"	"CtsDevicePolicyManagerTestCases"	"3: data UI app"	"public void testSetGlobalSettingLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testSetGlobalSettingLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_GLOBAL_SETTING_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .setStrings(GLOBAL_SETTING_AUTO_TIME, ""1"")
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_GLOBAL_SETTING_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .setStrings(GLOBAL_SETTING_AUTO_TIME_ZONE, ""1"")
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_GLOBAL_SETTING_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .setStrings(GLOBAL_SETTING_DATA_ROAMING, ""1"")
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_GLOBAL_SETTING_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .setStrings(GLOBAL_SETTING_USB_MASS_STORAGE_ENABLED, ""1"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_Ephemeral"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testCreateAndManageUser_Ephemeral() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_Ephemeral"");

        List<Integer> newUsers = getUsersCreatedByTests();
        assertEquals(1, newUsers.size());
        int newUserId = newUsers.get(0);

        // Get the flags of the new user and check the user is ephemeral.
        int flags = getUserFlags(newUserId);
        assertEquals(""Ephemeral flag must be set"", FLAG_EPHEMERAL, flags & FLAG_EPHEMERAL);
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method, affiliate
     * the user and start the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#LEAVE_ALL_SYSTEM_APPS_ENABLED} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_LeaveAllSystemApps"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testCreateAndManageUser_LeaveAllSystemApps() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_LeaveAllSystemApps"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testNoHiddenActivityFoundTest"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testNoHiddenActivityFoundTest() throws Exception {
        try {
            // Install app to primary user
            installAppAsUser(BaseLauncherAppsTest.LAUNCHER_TESTS_APK, mPrimaryUserId);
            installAppAsUser(BaseLauncherAppsTest.LAUNCHER_TESTS_SUPPORT_APK, mPrimaryUserId);
            installAppAsUser(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK, mPrimaryUserId);

            // Run test to check if launcher api shows hidden app
            String mSerialNumber = Integer.toString(getUserSerialNumber(mPrimaryUserId));
            runDeviceTestsAsUser(BaseLauncherAppsTest.LAUNCHER_TESTS_PKG,
                    BaseLauncherAppsTest.LAUNCHER_TESTS_CLASS,
                    ""testDoPoNoTestAppInjectedActivityFound"",
                    mPrimaryUserId, Collections.singletonMap(BaseLauncherAppsTest.PARAM_TEST_USER,
                            mSerialNumber));
        } finally {
            getDevice().uninstallPackage(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK);
            getDevice().uninstallPackage(BaseLauncherAppsTest.LAUNCHER_TESTS_SUPPORT_APK);
            getDevice().uninstallPackage(BaseLauncherAppsTest.LAUNCHER_TESTS_APK);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testListForegroundAffiliatedUsers_onlyForegroundUserCalledByDeviceOwner"	"CtsDevicePolicyManagerTestCases"	"2: called only"	"public void testListForegroundAffiliatedUsers_onlyForegroundUserCalledByDeviceOwner()
            throws Exception {
        assumeHeadlessSystemUserMode(""redundant, same as ""
                + ""testListForegroundAffiliatedUsers_onlyForegroundUser"");

        // Must temporarily revoke permission to make sure internal checks are allowing it to be
        // called by profile owner
        revokePermission(DEVICE_OWNER_PKG, PERMISSION_INTERACT_ACROSS_USERS, mDeviceOwnerUserId);

        try {
            executeDeviceOwnerTestMethod("".ListForegroundAffiliatedUsersTest"",
                    ""testListForegroundAffiliatedUsers_onlyForegroundUser"");
        } finally {
            grantPermission(DEVICE_OWNER_PKG, PERMISSION_INTERACT_ACROSS_USERS, mDeviceOwnerUserId,
                    /* reason= */ null);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetSystemUpdatePolicyLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"@Ignore(""b/145932189"")
    public void testSetSystemUpdatePolicyLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SystemUpdatePolicyTest"", ""testSetAutomaticInstallPolicy"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SYSTEM_UPDATE_POLICY_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setInt(TYPE_INSTALL_AUTOMATIC)
                    .build());
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SystemUpdatePolicyTest"", ""testSetWindowedInstallPolicy"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SYSTEM_UPDATE_POLICY_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setInt(TYPE_INSTALL_WINDOWED)
                    .build());
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SystemUpdatePolicyTest"", ""testSetPostponeInstallPolicy"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SYSTEM_UPDATE_POLICY_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setInt(TYPE_POSTPONE)
                    .build());
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SystemUpdatePolicyTest"", ""testSetEmptytInstallPolicy"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SYSTEM_UPDATE_POLICY_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setInt(TYPE_NONE)
                    .build());
    }

    @FlakyTest(bugId = 127101449)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testIsManagedProfileProvisioningAllowed_deviceOwnerIsSet"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
    public void testIsManagedProfileProvisioningAllowed_deviceOwnerIsSet() throws Exception {
        executeDeviceTestMethod("".PreDeviceOwnerTest"",
                ""testIsProvisioningNotAllowedForManagedProfileAction"");
    }

    @FlakyTest(bugId = 137096267)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testAdminActionBookkeeping"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAdminActionBookkeeping() throws Exception {
        if (isHeadlessSystemUserMode()) {
            // TODO(b/176993670):ALLOW_TEST_API_ACCESS is needed by DevicePolicyManagerWrapper to
            // access test apis
            allowTestApiAccess(DEVICE_OWNER_PKG);
            // This test has to run as system user since the test will get KeyStore instance for
            // current user.
            executeDeviceOwnerTestMethod("".AdminActionBookkeepingTest"",
                    ""testGetPolicyInstalledCaCerts"");
        } else {
            // This test will be skipped for headless system user mode since headless system user
            // does not have IME.
            executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                    ""testIsDefaultInputMethodSet"");
            executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                    ""testGetPolicyInstalledCaCerts"");
        }

        executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                ""testRetrieveSecurityLogs"");
        executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                ""testRequestBugreport"");
        executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                ""testGetLastNetworkLogRetrievalTime"");
        executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                ""testDeviceOwnerOrganizationName"");
        executeDeviceTestMethod("".AdminActionBookkeepingTest"",
                ""testIsDeviceManaged"");

        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".AdminActionBookkeepingTest"", ""testRetrieveSecurityLogs"");
        }, new DevicePolicyEventWrapper.Builder(EventId.RETRIEVE_SECURITY_LOGS_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.RETRIEVE_PRE_REBOOT_SECURITY_LOGS_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .build());
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".AdminActionBookkeepingTest"", ""testRequestBugreport"");
        }, new DevicePolicyEventWrapper.Builder(EventId.REQUEST_BUGREPORT_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testPackageInstallCache"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testPackageInstallCache() throws Exception {
        CompatibilityBuildHelper buildHelper = new CompatibilityBuildHelper(getBuild());
        final File apk = buildHelper.getTestFile(TEST_APP_APK);
        try {
            getDevice().uninstallPackage(TEST_APP_PKG);
            assertTrue(getDevice().pushFile(apk, TEST_APP_LOCATION + apk.getName()));

            // Install the package in primary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageInstall"", mPrimaryUserId);
            assertMetricsLogged(getDevice(), () -> {
                runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                        ""testKeepPackageCache"", mPrimaryUserId);
            }, new DevicePolicyEventWrapper.Builder(EventId.SET_KEEP_UNINSTALLED_PACKAGES_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setBoolean(false)
                    .setStrings(TEST_APP_PKG)
                    .build());

            // Remove the package in primary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageUninstall"", mPrimaryUserId);

            assertMetricsLogged(getDevice(), () -> {
                // Should be able to enable the cached package in primary user
                runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                        ""testInstallExistingPackage"", mPrimaryUserId);
            }, new DevicePolicyEventWrapper.Builder(EventId.INSTALL_EXISTING_PACKAGE_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setBoolean(false)
                    .setStrings(TEST_APP_PKG)
                    .build());
        } finally {
            String command = ""rm "" + TEST_APP_LOCATION + apk.getName();
            getDevice().executeShellCommand(command);
            getDevice().uninstallPackage(TEST_APP_PKG);
        }
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testPackageInstallCache_multiUser"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testPackageInstallCache_multiUser() throws Exception {
        assumeCanCreateAdditionalUsers(1);

        final int userId = createAffiliatedSecondaryUser();
        CompatibilityBuildHelper buildHelper = new CompatibilityBuildHelper(getBuild());
        final File apk = buildHelper.getTestFile(TEST_APP_APK);
        try {
            getDevice().uninstallPackage(TEST_APP_PKG);
            assertTrue(getDevice().pushFile(apk, TEST_APP_LOCATION + apk.getName()));

            // Install the package in primary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageInstall"", mPrimaryUserId);

            // Should be able to enable the package in secondary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testInstallExistingPackage"", userId);

            // Remove the package in both user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageUninstall"", mPrimaryUserId);
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageUninstall"", userId);

            // Install the package in secondary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageInstall"", userId);

            // Should be able to enable the package in primary user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testInstallExistingPackage"", mPrimaryUserId);

            // Keep the package in cache
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testKeepPackageCache"", mPrimaryUserId);

            // Remove the package in both user
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageUninstall"", mPrimaryUserId);
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testPackageUninstall"", userId);

            // Should be able to enable the cached package in both users
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testInstallExistingPackage"", userId);
            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PackageInstallTest"",
                    ""testInstallExistingPackage"", mPrimaryUserId);
        } finally {
            String command = ""rm "" + TEST_APP_LOCATION + apk.getName();
            getDevice().executeShellCommand(command);
            getDevice().uninstallPackage(TEST_APP_PKG);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetKeyguardDisabledLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetKeyguardDisabledLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testSetKeyguardDisabledLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_VALUE)
                .setAdminPackageName(DEVICE_OWNER_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetStatusBarDisabledLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetStatusBarDisabledLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testSetStatusBarDisabledLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_STATUS_BAR_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setBoolean(true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_STATUS_BAR_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_OWNER_PKG)
                    .setBoolean(true)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_singleUser_verifyMetricIsLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetUserControlDisabledPackages_singleUser_verifyMetricIsLogged()
            throws Exception {
        final List<Integer> otherUserIds = new ArrayList<>();
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);

            // Set the package under test as a protected package.
            assertMetricsLogged(getDevice(),
                    () -> executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                            ""testSetUserControlDisabledPackages""),
                    new DevicePolicyEventWrapper.Builder(
                            EventId.SET_USER_CONTROL_DISABLED_PACKAGES_VALUE)
                            .setAdminPackageName(DEVICE_OWNER_PKG)
                            .setStrings(new String[] {SIMPLE_APP_PKG})
                            .build());
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_multiUser_verifyMetricIsLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetUserControlDisabledPackages_multiUser_verifyMetricIsLogged()
            throws Exception {
        assumeCanCreateAdditionalUsers(1);
        final int userId = createUser();
        final List<Integer> otherUserIds = new ArrayList<>();
        otherUserIds.add(userId);
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);

            // Set the package under test as a protected package.
            assertMetricsLogged(getDevice(),
                    () -> executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                            ""testSetUserControlDisabledPackages""),
                    new DevicePolicyEventWrapper.Builder(
                            EventId.SET_USER_CONTROL_DISABLED_PACKAGES_VALUE)
                            .setAdminPackageName(DEVICE_OWNER_PKG)
                            .setStrings(new String[] {SIMPLE_APP_PKG})
                            .build());
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, userId);
            removeUser(userId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_multiUser_reboot_verifyPackageNotStopped"	"CtsDevicePolicyManagerTestCases"	"3: UI role app"	"public void testSetUserControlDisabledPackages_multiUser_reboot_verifyPackageNotStopped()
            throws Exception {
        assumeCanCreateAdditionalUsers(1);
        final int userId = createUser();
        final List<Integer> otherUserIds = new ArrayList<>();
        otherUserIds.add(userId);
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);
            // Set the package under test as a protected package.
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testSetUserControlDisabledPackages"");

            // Reboot and verify protected packages are persisted.
            rebootAndWaitUntilReady();

            // The simple app package seems to be set into stopped state on reboot.
            // Launch the activity again to get it out of stopped state for all users.
            startProtectedPackage(otherUserIds);
            // Try to stop the package under test on all users.
            tryStoppingProtectedPackage(otherUserIds, /* canUserStopPackage= */ false);
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, userId);
            removeUser(userId);
        }
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * installs the app and starts the activity for the package that is under test for the primary
     * user and provided users.
     * @param otherUserIds The user Ids apart from the primary user that were created
     */
    private void setupDeviceForSetUserControlDisabledPackagesTesting(List<Integer> otherUserIds)
            throws Exception {
        // Install app on the primary user and other users.
        installAppAsUser(SIMPLE_APP_APK, mPrimaryUserId);
        if (!otherUserIds.isEmpty()) {
            for (Integer userId : otherUserIds) {
                installAppAsUser(SIMPLE_APP_APK, userId);
            }
        }

        // Start the activity of the package under test on the primary user and other users.
        startProtectedPackage(otherUserIds);
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * starts the activity for the package that is under test for the primary user and provided
     * users.
     * @param otherUserIds The user Ids apart from the primary user that were created
     */
    private void startProtectedPackage(List<Integer> otherUserIds) throws Exception {
        startProtectedPackage(mPrimaryUserId);
        if (!otherUserIds.isEmpty()) {
            for (Integer userId : otherUserIds) {
                switchUser(userId);
                startProtectedPackage(userId);
            }
            switchUser(mPrimaryUserId);
        }
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * starts the activity for the package that is under test for a given user.
     * @param userId The user Id to start the package for
     */
    private void startProtectedPackage(int userId) throws Exception {
        // Launch the app once before starting the test.
        startActivityAsUser(userId, SIMPLE_APP_PKG, SIMPLE_APP_ACTIVITY);
        executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                ""testLaunchActivity"");
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * removes the package under test as a protected package and stops the package under test for
     * the primary user and provided users.
     * @param otherUserIds The user Ids apart from the primary user that were created
     */
    private void cleanupProtectedPackage(List<Integer> otherUserIds) throws Exception {
        executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                ""testClearSetUserControlDisabledPackages"");
        tryStoppingProtectedPackage(otherUserIds, /* canUserStopPackage= */ true);
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * attempts to stop protected package under test for the primary user and provided users.
     * @param otherUserIds The user Ids apart from the primary user that were created
     * @param canUserStopPackage Whether the user can force stop the protected package
     */
    private void tryStoppingProtectedPackage(List<Integer> otherUserIds, boolean canUserStopPackage)
            throws Exception {
        if (!otherUserIds.isEmpty()) {
            for (Integer userId : otherUserIds) {
                // TODO(b/188464764): Run device tests on the required user instead of switching
                //  users
                switchUser(userId);
                tryStoppingProtectedPackage(userId, canUserStopPackage);
            }
            switchUser(mPrimaryUserId);
        }
        tryStoppingProtectedPackage(mPrimaryUserId, canUserStopPackage);
    }

    /**
     * Helper when testing {@link DevicePolicyManager#setUserControlDisabledPackages} API that
     * attempts to stop the protected package under test for a given user.
     * @param userId The user Id to stop the package for
     * @param canUserStopPackage Whether the user can force stop the protected package
     */
    private void tryStoppingProtectedPackage(int userId, boolean canUserStopPackage)
            throws Exception {
        forceStopPackageForUser(SIMPLE_APP_PKG, userId);
        if (canUserStopPackage) {
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testForceStopWithUserControlEnabled"");
        } else {
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testForceStopWithUserControlDisabled"");
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testWifiNetworkConfigurationWithoutFineLocationPermission"	"CtsDevicePolicyManagerTestCases"	"3: UI only app"	"public void testWifiNetworkConfigurationWithoutFineLocationPermission() throws Exception {
        executeShellCommand(""pm revoke --user %d %s android.permission.ACCESS_FINE_LOCATION"",
                mPrimaryUserId, DEVICE_OWNER_PKG);

        executeDeviceOwnerTest(""WifiNetworkConfigurationWithoutFineLocationPermissionTest"");
    }

    private int createAffiliatedSecondaryUser() throws Exception {
        final int userId = createUser();
        installAppAsUser(INTENT_RECEIVER_APK, userId);
        // For headless system user mode, after DO is setup, PO is already
        // set on the secondary user. Meanwhile, it requires additional permission while
        // using DevicePolicyManagerWrapper while using DPM APIs from secondary user.
        if (!isHeadlessSystemUserMode()) {
            installAppAsUser(DEVICE_OWNER_APK, userId);
            setProfileOwnerOrFail(DEVICE_OWNER_COMPONENT, userId);
        } else {
            grantDpmWrapperPermissions(DEVICE_OWNER_PKG, userId);
        }
        wakeupAndDismissKeyguard();

        // Setting the same affiliation ids on both users
        CLog.d(""createAffiliatedSecondaryUser(): deviceOwnerId="" + mDeviceOwnerUserId
                + "", primaryUserId="" + mPrimaryUserId + "", newUserId="" + userId);
        affiliateUsers(DEVICE_OWNER_PKG, mDeviceOwnerUserId, userId);

        return userId;
    }

    private void executeDeviceTestMethod(String className, String testName,
            Map<String, String> params) throws Exception {
        runDeviceTestsAsUser(DEVICE_OWNER_PKG, className, testName,
                /* deviceOwnerUserId */ mPrimaryUserId, params);
    }

    private void executeCreateAndManageUserTest(String testMethod) throws Exception {
        // These test must be run on device owner user, as it's the only user that's guaranteed  to
        // be always running (otherwise, the test case would crash on headless system user mode if
        // the current user is switched out)
        executeDeviceOwnerTestMethod("".CreateAndManageUserTest"", testMethod);
    }

    private void executeListForegroundAffiliatedUsersTest(String testMethod) throws Exception {
        // These test must be run on device owner user, as it's the only user that's guaranteed  to
        // be always running (otherwise, the test case would crash on headless system user mode if
        // the current user is switched out)
        executeDeviceOwnerTestMethod("".ListForegroundAffiliatedUsersTest"", testMethod);
    }

    private void assertNewUserStopped() throws Exception {
        List<Integer> newUsers = getUsersCreatedByTests();
        assertEquals(1, newUsers.size());
        int newUserId = newUsers.get(0);

        assertFalse(getDevice().isUserRunning(newUserId));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetLocationEnabled"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testSetLocationEnabled() throws Exception {
        // Currently this method is only available for device owners, so on headless system user
        // it must run on system user.
        executeDeviceOwnerTestOnDeviceOwnerUser(""SetLocationEnabledTest"");
    }

    /**
     *  Only allow provisioning flow to be disabled if Android TV device
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testListForegroundAffiliatedUsers_onlyForegroundUser"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testListForegroundAffiliatedUsers_onlyForegroundUser() throws Exception {
        executeDeviceTestMethod("".ListForegroundAffiliatedUsersTest"",
                ""testListForegroundAffiliatedUsers_onlyForegroundUser"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testListForegroundAffiliatedUsers_extraUser"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testListForegroundAffiliatedUsers_extraUser() throws Exception {
        assumeCanCreateAdditionalUsers(1);
        createAffiliatedSecondaryUser();

        executeDeviceTestMethod("".ListForegroundAffiliatedUsersTest"",
                ""testListForegroundAffiliatedUsers_onlyForegroundUser"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testListForegroundAffiliatedUsers_affiliated"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testListForegroundAffiliatedUsers_affiliated() throws Exception {
        assumeCanCreateAdditionalUsers(1);
        int userId = createAffiliatedSecondaryUser();
        switchUser(userId);

        executeListForegroundAffiliatedUsersTest(
                ""testListForegroundAffiliatedUsers_onlyForegroundUser"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testDeviceOwnerCanGetDeviceIdentifiers"	"CtsDevicePolicyManagerTestCases"	"1: identifier"	"@AsbSecurityTest(cveBugId = 173421434)
    public void testDeviceOwnerCanGetDeviceIdentifiers() throws Exception {
        // The Device Owner should have access to all device identifiers.

        executeDeviceOwnerTestMethod("".DeviceIdentifiersTest"",
                ""testDeviceOwnerCanGetDeviceIdentifiersWithPermission"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_MaxUsers"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_MaxUsers() throws Exception {
        assumeCanCreateOneManagedUser();

        int maxUsers = getDevice().getMaxNumberOfUsersSupported();

        // System user is already there, so we can create up to maxUsers - 1.
        int existingUsers = 1;

        // On headless user mode, current user is also there
        if (isHeadlessSystemUserMode()) {
            existingUsers++;
        }

        CLog.d(""testCreateAndManageUser_MaxUsers(): maxUxers=%d, existingUsers=%d"", maxUsers,
                existingUsers);

        for (int i = 0; i < maxUsers - existingUsers; i++) {
            executeCreateAndManageUserTest(""testCreateAndManageUser"");
        }
        // The next createAndManageUser should return USER_OPERATION_ERROR_MAX_USERS.
        executeCreateAndManageUserTest(""testCreateAndManageUser_MaxUsers"");
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser.
     * {@link android.app.admin.DevicePolicyManager#getSecondaryUsers} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_GetSecondaryUsers"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_GetSecondaryUsers() throws Exception {
        assumeCanCreateOneManagedUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_GetSecondaryUsers"");
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method and switch
     * to the user.
     * {@link android.app.admin.DevicePolicyManager#switchUser} is tested.
     */
    @FlakyTest(bugId = 131743223)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_SwitchUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_SwitchUser() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_SwitchUser"");
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method and switch
     * to the user to test stop user while target user is in foreground.
     * {@link android.app.admin.DevicePolicyManager#stopUser} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_CannotStopCurrentUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_CannotStopCurrentUser() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_CannotStopCurrentUser"");
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method and start
     * the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#startUserInBackground} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_StartInBackground"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_StartInBackground() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_StartInBackground"");
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method and start
     * the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#startUserInBackground} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_StartInBackground_MaxRunningUsers"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_StartInBackground_MaxRunningUsers() throws Exception {
        assumeCanStartNewUser();

        int maxUsers = getDevice().getMaxNumberOfUsersSupported();
        int maxRunningUsers = getDevice().getMaxNumberOfRunningUsersSupported();

        // Primary user is already running, so we can create and start up to minimum of above - 1.
        int usersToCreateAndStart = Math.min(maxUsers, maxRunningUsers) - 1;

        // On headless user mode, system user is also running
        if (isHeadlessSystemUserMode()) {
            usersToCreateAndStart--;
        }

        CLog.d(""testCreateAndManageUser_StartInBackground_MaxRunningUsers(): maxUxers=%d, ""
                + ""maxRunningUsers=%d, usersToCreateAndStart=%d"", maxUsers, maxRunningUsers,
                usersToCreateAndStart);
        for (int i = 0; i < usersToCreateAndStart; i++) {
            executeCreateAndManageUserTest(""testCreateAndManageUser_StartInBackground"");
        }

        if (maxUsers > maxRunningUsers) {
            // The next startUserInBackground should return USER_OPERATION_ERROR_MAX_RUNNING_USERS.
            executeCreateAndManageUserTest(
                    ""testCreateAndManageUser_StartInBackground_MaxRunningUsers"");
        } else {
            // The next createAndManageUser should return USER_OPERATION_ERROR_MAX_USERS.
            executeCreateAndManageUserTest(""testCreateAndManageUser_MaxUsers"");
        }
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method and start
     * the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#stopUser} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_StopEphemeralUser_DisallowRemoveUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_StopEphemeralUser_DisallowRemoveUser() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(
                ""testCreateAndManageUser_StopEphemeralUser_DisallowRemoveUser"");
        assertEquals(0, getUsersCreatedByTests().size());
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method, affiliate
     * the user and start the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#logoutUser} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_LogoutUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_LogoutUser() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_LogoutUser"");
        assertNewUserStopped();
    }

    /**
     * Test creating an user using the DevicePolicyManager's createAndManageUser method, affiliate
     * the user and start the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#isAffiliatedUser} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCreateAndManageUser_Affiliated"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCreateAndManageUser_Affiliated() throws Exception {
        assumeCanStartNewUser();

        executeCreateAndManageUserTest(""testCreateAndManageUser_Affiliated"");
    }

    /**
     * Test creating an ephemeral user using the DevicePolicyManager's createAndManageUser method,
     * affiliate the user and start the user in background to test APIs on that user.
     * {@link android.app.admin.DevicePolicyManager#isEphemeralUser} is tested.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testWifiConfigLockdown"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testWifiConfigLockdown() throws Exception {
        assumeHasWifiFeature();

        try (LocationModeSetter locationModeSetter = new LocationModeSetter(getDevice())) {
            installAppAsUser(WIFI_CONFIG_CREATOR_APK, mPrimaryUserId);
            locationModeSetter.setLocationEnabled(true);
            executeDeviceOwnerTest(""WifiConfigLockdownTest"");
        } finally {
            getDevice().uninstallPackage(WIFI_CONFIG_CREATOR_PKG);
        }
    }

    /**
     * Execute WifiSetHttpProxyTest as device owner.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testCannotSetDeviceOwnerAgain"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotSetDeviceOwnerAgain() throws Exception {
        // verify that we can't set the same admin receiver as device owner again
        assertFalse(setDeviceOwner(
                DEVICE_OWNER_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mPrimaryUserId,
                /*expectFailure*/ true));

        // verify that we can't set a different admin receiver as device owner
        try {
            installAppAsUser(MANAGED_PROFILE_APK, mPrimaryUserId);
            assertFalse(setDeviceOwner(
                    MANAGED_PROFILE_PKG + ""/"" + MANAGED_PROFILE_ADMIN, mPrimaryUserId,
                    /*expectFailure*/ true));
        } finally {
            // Remove the device owner in case the test fails.
            removeAdmin(MANAGED_PROFILE_PKG + ""/"" + MANAGED_PROFILE_ADMIN, mPrimaryUserId);
            getDevice().uninstallPackage(MANAGED_PROFILE_PKG);
        }
    }

    // Execute HardwarePropertiesManagerTest as a device owner."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testDefaultSmsApplication"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDefaultSmsApplication() throws Exception {
        assumeHasTelephonyFeature();

        installAppAsUser(SIMPLE_SMS_APP_APK, mPrimaryUserId);

        executeDeviceTestMethod("".DefaultSmsApplicationTest"", ""testSetDefaultSmsApplication"");

        getDevice().uninstallPackage(SIMPLE_SMS_APP_PKG);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_singleUser_verifyPackageNotStopped"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSetUserControlDisabledPackages_singleUser_verifyPackageNotStopped()
            throws Exception {
        final List<Integer> otherUserIds = new ArrayList<>();
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);
            // Set the package under test as a protected package.
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testSetUserControlDisabledPackages"");

            // Try to stop the package on the primary user.
            tryStoppingProtectedPackage(otherUserIds, /* canUserStopPackage= */ false);
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_singleUser_reboot_verifyPackageNotStopped"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSetUserControlDisabledPackages_singleUser_reboot_verifyPackageNotStopped()
            throws Exception {
        final List<Integer> otherUserIds = new ArrayList<>();
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);
            // Set the package under test as a protected package.
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testSetUserControlDisabledPackages"");

            // Reboot and verify protected packages are persisted
            rebootAndWaitUntilReady();

            // The simple app package seems to be set into stopped state on reboot.
            // Launch the activity again to get it out of stopped state on the primary user.
            startProtectedPackage(otherUserIds);
            // Try to stop the package on the primary user.
            tryStoppingProtectedPackage(otherUserIds, /* canUserStopPackage= */ false);
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerTest"	"testSetUserControlDisabledPackages_multiUser_verifyPackageNotStopped"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSetUserControlDisabledPackages_multiUser_verifyPackageNotStopped()
            throws Exception {
        assumeCanCreateAdditionalUsers(1);
        final int userId = createUser();
        final List<Integer> otherUserIds = new ArrayList<>();
        otherUserIds.add(userId);
        try {
            setupDeviceForSetUserControlDisabledPackagesTesting(otherUserIds);
            // Set the package under test as a protected package.
            executeDeviceTestMethod("".UserControlDisabledPackagesTest"",
                    ""testSetUserControlDisabledPackages"");

            // Try to stop the package under test on all users.
            tryStoppingProtectedPackage(otherUserIds, /* canUserStopPackage= */ false);
        } finally {
            cleanupProtectedPackage(otherUserIds);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, mPrimaryUserId);
            getDevice().uninstallPackageForUser(SIMPLE_APP_APK, userId);
            removeUser(userId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTestApi25"	"testPasswordRequirementsApi"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testPasswordRequirementsApi() throws Exception {
        executeDeviceTestMethod("".PasswordRequirementsTest"",
                ""testPasswordConstraintsDoesntThrowAndPreservesValuesPreR"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTestApi25.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTestApi25"	"testPermissionGrantPreMApp"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrantPreMApp() throws Exception {
        installAppAsUser(SIMPLE_PRE_M_APP_APK, mUserId);
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionGrantState_preMApp_preQDeviceAdmin"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTestApi25.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTestApi25"	"testResetPasswordDeprecated"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testResetPasswordDeprecated() throws Exception {
        assumeHasSecureLockScreenFeature();

        executeDeviceTestMethod("".ResetPasswordTest"", ""testResetPasswordDeprecated"");
    }

    protected void executeDeviceTestClass(String className) throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, className, mUserId);
    }

    protected void executeDeviceTestMethod(String className, String testName) throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, className, testName, mUserId);
    }

    /**
     * Start SimpleActivity synchronously in a particular user.
     */
    protected void startSimpleActivityAsUser(int userId) throws Exception {
        installAppAsUser(TEST_APP_APK, userId);
        String command = ""am start -W --user "" + userId + "" "" + TEST_APP_PKG + ""/""
                + TEST_APP_PKG + "".SimpleActivity"";
        getDevice().executeShellCommand(command);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTestApi25.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import android.platform.test.annotations.FlakyTest;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.tradefed.log.LogUtil.CLog;

import org.junit.Test;

import java.util.Collections;

/**
 * Set of tests for LauncherApps with managed profiles.
 */
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class LauncherAppsProfileTest extends BaseLauncherAppsTest {

    private static final String MANAGED_PROFILE_PKG = ""com.android.cts.managedprofile"";
    private static final String MANAGED_PROFILE_APK = ""CtsManagedProfileApp.apk"";
    private static final String ADMIN_RECEIVER_TEST_CLASS =
            MANAGED_PROFILE_PKG + "".BaseManagedProfileTest$BasicAdminReceiver"";
    private static final String LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK =
            ""CtsHasLauncherActivityApp.apk"";

    private int mProfileUserId;
    private int mParentUserId;
    private String mProfileSerialNumber;
    private String mMainUserSerialNumber;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        // Create a managed profile
        mParentUserId = mPrimaryUserId;
        mProfileUserId = createManagedProfile(mParentUserId);
        installAppAsUser(MANAGED_PROFILE_APK, mProfileUserId);
        setProfileOwnerOrFail(MANAGED_PROFILE_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                mProfileUserId);
        mProfileSerialNumber = Integer.toString(getUserSerialNumber(mProfileUserId));
        mMainUserSerialNumber = Integer.toString(getUserSerialNumber(mParentUserId));
        startUserAndWait(mProfileUserId);

        // Install test APK on primary user and the managed profile.
        installTestApps(USER_ALL);
    }

    @Override
    public void tearDown() throws Exception {
        removeUser(mProfileUserId);
        uninstallTestApps();
        getDevice().uninstallPackage(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK);

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testGetActivitiesWithProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testGetActivitiesWithProfile() throws Exception {
        // Install app for all users.
        installAppAsUser(SIMPLE_APP_APK, mParentUserId);
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);

        // Run tests to check SimpleApp exists in both profile and main user.
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testSimpleAppInstalledForUser"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testSimpleAppInstalledForUser"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mMainUserSerialNumber));

        // Run the same test on the managed profile.  This still works.
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testSimpleAppInstalledForUser"",
                mProfileUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));

        // This tries to access main prorfile from work profiel, which is not allowed.
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testAccessPrimaryProfileFromManagedProfile"",
                mProfileUserId, Collections.singletonMap(PARAM_TEST_USER, mMainUserSerialNumber));

        // Test for getProfiles.
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testGetProfiles_fromMainProfile"",
                mParentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testGetProfiles_fromManagedProfile"",
                mProfileUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testProfileOwnerAppHiddenInPrimaryProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testProfileOwnerAppHiddenInPrimaryProfile() throws Exception {
        String command = ""pm disable --user "" + mParentUserId + "" "" + MANAGED_PROFILE_PKG
                + ""/.PrimaryUserFilterSetterActivity"";
        CLog.d(""Output for command "" + command + "": "" + getDevice().executeShellCommand(command));
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testProfileOwnerInjectedActivityNotFound"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mMainUserSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testNoHiddenActivityInProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNoHiddenActivityInProfile() throws Exception {
        // Install app for all users.
        installAppAsUser(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK, mParentUserId);
        installAppAsUser(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK, mProfileUserId);

        // Run tests to check SimpleApp exists in both profile and main user.
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testDoPoNoTestAppInjectedActivityFound"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testHasLauncherActivityAppHasAppDetailsActivityInjected"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mMainUserSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testLauncherCallbackPackageAddedProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testLauncherCallbackPackageAddedProfile() throws Exception {
        startCallbackService(mPrimaryUserId);
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageAddedCallbackForUser"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testLauncherCallbackPackageRemovedProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testLauncherCallbackPackageRemovedProfile() throws Exception {
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
        startCallbackService(mPrimaryUserId);
        getDevice().uninstallPackage(SIMPLE_APP_PKG);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageRemovedCallbackForUser"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testLauncherCallbackPackageChangedProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testLauncherCallbackPackageChangedProfile() throws Exception {
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
        startCallbackService(mPrimaryUserId);
        installAppAsUser(SIMPLE_APP_APK, /* grantPermissions */ true, /* dontKillApp */ true,
                mProfileUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageChangedCallbackForUser"",
                mParentUserId, Collections.singletonMap(PARAM_TEST_USER, mProfileSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsProfileTest"	"testReverseAccessNoThrow"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testReverseAccessNoThrow() throws Exception {
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);

        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testReverseAccessNoThrow"",
                mProfileUserId, Collections.singletonMap(PARAM_TEST_USER, mMainUserSerialNumber));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAdminHostSideTestApi23"	"testAdminWithNoProtection"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAdminWithNoProtection() throws Exception {
        installAppAsUser(getDeviceAdminApkFileName(), mUserId);
        try {
            setDeviceAdmin(getUnprotectedAdminReceiverComponent(), mUserId);
        } finally {
            runTests(getDeviceAdminApkPackage(), ""ClearDeviceAdminWithNoProtectionTest"");
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAdminHostSideTestApi23.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAdminHostSideTestApi24"	"testAdminWithNoProtection"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAdminWithNoProtection() throws Exception {
        installAppAsUser(getDeviceAdminApkFileName(), mUserId);
        setDeviceAdminExpectingFailure(getUnprotectedAdminReceiverComponent(), mUserId,
                ""must be protected with android.permission.BIND_DEVICE_ADMIN"");
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAdminHostSideTestApi24.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileContactsTest"	"testManagedQuickContacts"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testManagedQuickContacts() throws Exception {
        runManagedContactsTest(() -> {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testQuickContact"", mParentUserId);
            return null;
        });
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileContactsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileContactsTest"	"testManagedContactsPolicies"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testManagedContactsPolicies() throws Exception {
        runManagedContactsTest(() -> {
            ContactsTestSet contactsTestSet = new ContactsTestSet(ManagedProfileContactsTest.this,
                    MANAGED_PROFILE_PKG, mParentUserId, mProfileUserId);
            try {
                contactsTestSet.setCallerIdEnabled(true);
                contactsTestSet.setContactsSearchEnabled(false);
                contactsTestSet.checkIfCanLookupEnterpriseContacts(true);
                contactsTestSet.checkIfCanFilterEnterpriseContacts(false);
                contactsTestSet.checkIfCanFilterSelfContacts();
                contactsTestSet.setCallerIdEnabled(false);
                contactsTestSet.setContactsSearchEnabled(true);
                contactsTestSet.checkIfCanLookupEnterpriseContacts(false);
                contactsTestSet.checkIfCanFilterEnterpriseContacts(true);
                contactsTestSet.checkIfCanFilterSelfContacts();
                contactsTestSet.setCallerIdEnabled(false);
                contactsTestSet.setContactsSearchEnabled(false);
                contactsTestSet.checkIfCanLookupEnterpriseContacts(false);
                contactsTestSet.checkIfCanFilterEnterpriseContacts(false);
                contactsTestSet.checkIfCanFilterSelfContacts();
                contactsTestSet.checkIfNoEnterpriseDirectoryFound();
                assertMetricsLogged(getDevice(), () -> {
                    contactsTestSet.setCallerIdEnabled(true);
                    contactsTestSet.setCallerIdEnabled(false);
                }, new DevicePolicyEventWrapper
                        .Builder(EventId.SET_CROSS_PROFILE_CALLER_ID_DISABLED_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .setBoolean(false)
                        .build(),
                new DevicePolicyEventWrapper
                        .Builder(EventId.SET_CROSS_PROFILE_CALLER_ID_DISABLED_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .setBoolean(true)
                        .build());
                assertMetricsLogged(getDevice(), () -> {
                    contactsTestSet.setContactsSearchEnabled(true);
                    contactsTestSet.setContactsSearchEnabled(false);
                }, new DevicePolicyEventWrapper
                        .Builder(EventId.SET_CROSS_PROFILE_CONTACTS_SEARCH_DISABLED_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .setBoolean(false)
                        .build(),
                new DevicePolicyEventWrapper
                        .Builder(EventId.SET_CROSS_PROFILE_CONTACTS_SEARCH_DISABLED_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .setBoolean(true)
                        .build());
                return null;
            } finally {
                // reset policies
                contactsTestSet.setCallerIdEnabled(true);
                contactsTestSet.setContactsSearchEnabled(true);
            }
        });
    }

    private void setDirectoryPrefix(String directoryName, int userId)
            throws DeviceNotAvailableException {
        String command = ""content call --uri "" + DIRECTORY_PRIVOIDER_URI
                + "" --user "" + userId
                + "" --method "" + SET_CUSTOM_DIRECTORY_PREFIX_METHOD
                + "" --arg "" + directoryName;
        LogUtil.CLog.d(""Output for command "" + command + "": ""
                + getDevice().executeShellCommand(command));
    }

    private void runManagedContactsTest(Callable<Void> callable) throws Exception {
        try {
            // Allow cross profile contacts search.
            // TODO test both on and off.
            getDevice().executeShellCommand(
                    ""settings put --user "" + mProfileUserId
                    + "" secure managed_profile_contact_remote_search 1"");

            // Wait for updating cache
            waitForBroadcastIdle();

            // Add test account
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testAddTestAccount"", mParentUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testAddTestAccount"", mProfileUserId);

            // Install directory provider to both primary and managed profile
            installAppAsUser(DIRECTORY_PROVIDER_APK, USER_ALL);
            setDirectoryPrefix(PRIMARY_DIRECTORY_PREFIX, mParentUserId);
            setDirectoryPrefix(MANAGED_DIRECTORY_PREFIX, mProfileUserId);

            // Check enterprise directory API works
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testGetDirectoryListInPrimaryProfile"", mParentUserId);

            // Insert Primary profile Contacts
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testPrimaryProfilePhoneAndEmailLookup_insertedAndfound"", mParentUserId);
            // Insert Managed profile Contacts
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testManagedProfilePhoneAndEmailLookup_insertedAndfound"", mProfileUserId);
            // Insert a primary contact with same phone & email as other
            // enterprise contacts
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testPrimaryProfileDuplicatedPhoneEmailContact_insertedAndfound"",
                    mParentUserId);
            // Insert a enterprise contact with same phone & email as other
            // primary contacts
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testManagedProfileDuplicatedPhoneEmailContact_insertedAndfound"",
                    mProfileUserId);

            callable.call();

        } finally {
            // Clean up in managed profile and primary profile
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testCurrentProfileContacts_removeContacts"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testCurrentProfileContacts_removeContacts"", mParentUserId);
            getDevice().uninstallPackage(DIRECTORY_PROVIDER_PKG);
        }
    }

    /*
     * Container for running ContactsTest under multi-user environment
     */
    private static class ContactsTestSet {

        private ManagedProfileContactsTest mManagedProfileContactsTest;
        private String mManagedProfilePackage;
        private int mParentUserId;
        private int mProfileUserId;

        public ContactsTestSet(ManagedProfileContactsTest managedProfileContactsTest,
                String managedProfilePackage, int parentUserId, int profileUserId) {
            mManagedProfileContactsTest = managedProfileContactsTest;
            mManagedProfilePackage = managedProfilePackage;
            mParentUserId = parentUserId;
            mProfileUserId = profileUserId;
        }

        private void runDeviceTestsAsUser(String pkgName, String testClassName,
                String testMethodName, Integer userId) throws DeviceNotAvailableException {
            mManagedProfileContactsTest.runDeviceTestsAsUser(pkgName, testClassName, testMethodName,
                    userId);
        }

        // Enable / Disable
        public void setCallerIdEnabled(boolean enabled) throws DeviceNotAvailableException {
            if (enabled) {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testSetCrossProfileCallerIdDisabled_false"", mProfileUserId);
            } else {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testSetCrossProfileCallerIdDisabled_true"", mProfileUserId);
            }
        }

        // Enable / Disable cross profile contacts search
        public void setContactsSearchEnabled(boolean enabled) throws DeviceNotAvailableException {
            if (enabled) {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testSetCrossProfileContactsSearchDisabled_false"", mProfileUserId);
            } else {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testSetCrossProfileContactsSearchDisabled_true"", mProfileUserId);
            }
        }

        public void checkIfCanLookupEnterpriseContacts(boolean expected)
                throws DeviceNotAvailableException {
            // Primary user cannot use ordinary phone/email lookup api to access
            // managed contacts
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfilePhoneLookup_canNotAccessEnterpriseContact"", mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEmailLookup_canNotAccessEnterpriseContact"", mParentUserId);
            // Primary user can use ENTERPRISE_CONTENT_FILTER_URI to access
            // primary contacts
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterprisePhoneLookup_canAccessPrimaryContact"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseEmailLookup_canAccessPrimaryContact"",
                    mParentUserId);
            // When there exist contacts with the same phone/email in primary &
            // enterprise,
            // primary user can use ENTERPRISE_CONTENT_FILTER_URI to access the
            // primary contact.
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseEmailLookupDuplicated_canAccessPrimaryContact"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterprisePhoneLookupDuplicated_canAccessPrimaryContact"",
                    mParentUserId);

            // Managed user cannot use ordinary phone/email lookup api to access
            // primary contacts
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfilePhoneLookup_canNotAccessPrimaryContact"", mProfileUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEmailLookup_canNotAccessPrimaryContact"", mProfileUserId);
            // Managed user can use ENTERPRISE_CONTENT_FILTER_URI to access
            // enterprise contacts
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterprisePhoneLookup_canAccessEnterpriseContact"",
                    mProfileUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterpriseEmailLookup_canAccessEnterpriseContact"",
                    mProfileUserId);
            // Managed user cannot use ENTERPRISE_CONTENT_FILTER_URI to access
            // primary contacts
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterprisePhoneLookup_canNotAccessPrimaryContact"",
                    mProfileUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterpriseEmailLookup_canNotAccessPrimaryContact"",
                    mProfileUserId);
            // When there exist contacts with the same phone/email in primary &
            // enterprise,
            // managed user can use ENTERPRISE_CONTENT_FILTER_URI to access the
            // enterprise contact.
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterpriseEmailLookupDuplicated_canAccessEnterpriseContact"",
                    mProfileUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterprisePhoneLookupDuplicated_canAccessEnterpriseContact"",
                    mProfileUserId);

            // Check if phone lookup can access primary directories
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterprisePhoneLookup_canAccessPrimaryDirectories"",
                    mParentUserId);

            // Check if email lookup can access primary directories
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseEmailLookup_canAccessPrimaryDirectories"",
                    mParentUserId);

            if (expected) {
                // Primary user can use ENTERPRISE_CONTENT_FILTER_URI to access
                // managed profile contacts
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneLookup_canAccessEnterpriseContact"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseEmailLookup_canAccessEnterpriseContact"",
                        mParentUserId);

                // Make sure SIP enterprise lookup works too.
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseSipLookup_canAccessEnterpriseContact"",
                        mParentUserId);

                // Check if phone lookup can access enterprise directories
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneLookup_canAccessManagedDirectories"",
                        mParentUserId);

                // Check if email lookup can access enterprise directories
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseEmailLookup_canAccessManagedDirectories"",
                        mParentUserId);
            } else {
                // Primary user cannot use ENTERPRISE_CONTENT_FILTER_URI to
                // access managed contacts
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneLookup_canNotAccessEnterpriseContact"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneLookup_canNotAccessManagedDirectories"",
                        mParentUserId);

                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseEmailLookup_canNotAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneLookup_canNotAccessManagedDirectories"",
                        mParentUserId);
            }
        }

        public void checkIfCanFilterSelfContacts() throws DeviceNotAvailableException {
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseCallableFilter_canAccessPrimaryDirectories"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterpriseCallableFilter_canAccessManagedDirectories"",
                    mProfileUserId);

            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseEmailFilter_canAccessPrimaryDirectories"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testEnterpriseProfileEnterpriseEmailFilter_canAccessManagedDirectories"",
                    mProfileUserId);

            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseContactFilter_canAccessPrimaryDirectories"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterpriseContactFilter_canAccessManagedDirectories"",
                    mProfileUserId);

            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterprisePhoneFilter_canAccessPrimaryDirectories"",
                    mParentUserId);
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testManagedProfileEnterprisePhoneFilter_canAccessManagedDirectories"",
                    mProfileUserId);
        }

        public void checkIfCanFilterEnterpriseContacts(boolean expected)
                throws DeviceNotAvailableException {
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testFilterUriWhenDirectoryParamMissing"", mParentUserId);
            if (expected) {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseCallableFilter_canAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseEmailFilter_canAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseContactFilter_canAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneFilter_canAccessManagedDirectories"",
                        mParentUserId);
            } else {
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseCallableFilter_canNotAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseEmailFilter_canNotAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterpriseContactFilter_canNotAccessManagedDirectories"",
                        mParentUserId);
                runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                        ""testPrimaryProfileEnterprisePhoneFilter_canNotAccessManagedDirectories"",
                        mParentUserId);
            }
        }

        public void checkIfNoEnterpriseDirectoryFound() throws DeviceNotAvailableException {
            runDeviceTestsAsUser(mManagedProfilePackage, "".ContactsTest"",
                    ""testPrimaryProfileEnterpriseDirectories_canNotAccessManagedDirectories"",
                    mParentUserId);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileContactsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"6: data app(s) called apps UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;
import static com.android.cts.devicepolicy.DeviceAndProfileOwnerTest.DEVICE_ADMIN_COMPONENT_FLATTENED;
import static com.android.cts.devicepolicy.metrics.DevicePolicyEventLogVerifier.assertMetricsLogged;

import static com.google.common.truth.Truth.assertThat;

import static org.junit.Assert.assertTrue;

import android.platform.test.annotations.FlakyTest;
import android.platform.test.annotations.LargeTest;
import android.stats.devicepolicy.EventId;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.cts.devicepolicy.metrics.DevicePolicyEventWrapper;
import com.android.tradefed.device.DeviceNotAvailableException;

import org.junit.Ignore;
import org.junit.Test;

/**
 * Tests for organization-owned Profile Owner.
 */
// We need managed users to be supported in order to create a profile of the user owner.
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class OrgOwnedProfileOwnerTest extends BaseDevicePolicyTest {
    private static final String DEVICE_ADMIN_PKG = DeviceAndProfileOwnerTest.DEVICE_ADMIN_PKG;
    private static final String DEVICE_ADMIN_APK = DeviceAndProfileOwnerTest.DEVICE_ADMIN_APK;
    private static final String CERT_INSTALLER_PKG = DeviceAndProfileOwnerTest.CERT_INSTALLER_PKG;
    private static final String CERT_INSTALLER_APK = DeviceAndProfileOwnerTest.CERT_INSTALLER_APK;
    private static final String DELEGATE_APP_PKG = DeviceAndProfileOwnerTest.DELEGATE_APP_PKG;
    private static final String DELEGATE_APP_APK = DeviceAndProfileOwnerTest.DELEGATE_APP_APK;
    private static final String LOG_TAG_PROFILE_OWNER = ""profile-owner"";

    private static final String ADMIN_RECEIVER_TEST_CLASS =
            DeviceAndProfileOwnerTest.ADMIN_RECEIVER_TEST_CLASS;
    private static final String ACTION_WIPE_DATA =
            ""com.android.cts.deviceandprofileowner.WIPE_DATA"";

    private static final String TEST_APP_APK = ""CtsSimpleApp.apk"";
    private static final String TEST_APP_PKG = ""com.android.cts.launcherapps.simpleapp"";
    private static final String TEST_IME_APK = ""TestIme.apk"";
    private static final String TEST_IME_PKG = ""com.android.cts.testime"";
    private static final String TEST_IME_COMPONENT = TEST_IME_PKG + ""/.TestIme"";
    private static final String SIMPLE_SMS_APP_PKG = ""android.telephony.cts.sms.simplesmsapp"";
    private static final String SIMPLE_SMS_APP_APK = ""SimpleSmsApp.apk"";
    private static final String TEST_LAUNCHER_APK = ""TestLauncher.apk"";
    private static final String TEST_LAUNCHER_COMPONENT =
            ""com.android.cts.testlauncher/android.app.Activity"";
    public static final String SUSPENSION_CHECKER_CLASS =
            ""com.android.cts.suspensionchecker.ActivityLaunchTest"";

    private static final String USER_IS_NOT_STARTED = ""User is not started"";
    private static final long USER_STOP_TIMEOUT_SEC = 60;

    protected int mUserId;
    private static final String DISALLOW_CONFIG_LOCATION = ""no_config_location"";
    private static final String CALLED_FROM_PARENT = ""calledFromParent"";

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        createManagedProfile();
    }

    private void createManagedProfile() throws Exception {
        mUserId = createManagedProfile(mPrimaryUserId);
        switchUser(mPrimaryUserId);
        startUserAndWait(mUserId);

        installAppAsUser(DEVICE_ADMIN_APK, mUserId);
        setProfileOwnerOrFail(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mUserId);
        startUserAndWait(mUserId);
        restrictManagedProfileRemoval();
    }

    @Override
    public void tearDown() throws Exception {
        // Managed profile and other test users will be removed by BaseDevicePolicyTest.tearDown()
        super.tearDown();
    }

    private void restrictManagedProfileRemoval() throws DeviceNotAvailableException {
            getDevice().executeShellCommand(
                    String.format(""dpm mark-profile-owner-on-organization-owned-device --user %d '%s'"",
                            mUserId, DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testSetKeyguardDisabledFeatures"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testSetKeyguardDisabledFeatures() throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".KeyguardDisabledFeaturesTest"",
                ""testSetKeyguardDisabledFeatures_onParent"", mUserId);
    }

    private void removeOrgOwnedProfile() throws Exception {
        sendWipeProfileBroadcast(mUserId);
        waitUntilUserRemoved(mUserId);
    }

    private void sendWipeProfileBroadcast(int userId) throws Exception {
        final String cmd = ""am broadcast --receiver-foreground --user "" + userId
                + "" -a "" + ACTION_WIPE_DATA
                + "" com.android.cts.deviceandprofileowner/.WipeDataReceiver"";
        getDevice().executeShellCommand(cmd);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testPersonalAppsSuspensionNormalApp"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPersonalAppsSuspensionNormalApp() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        // Initially the app should be launchable.
        assertCanStartPersonalApp(DEVICE_ADMIN_PKG, true);
        setPersonalAppsSuspended(true);
        // Now the app should be suspended and not launchable
        assertCanStartPersonalApp(DEVICE_ADMIN_PKG, false);
        setPersonalAppsSuspended(false);
        // Should be launchable again.
        assertCanStartPersonalApp(DEVICE_ADMIN_PKG, true);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testPersonalAppsSuspensionInstalledApp"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPersonalAppsSuspensionInstalledApp() throws Exception {
        setPersonalAppsSuspended(true);

        installAppAsUser(TEST_IME_APK, mPrimaryUserId);

        // Wait until package install broadcast is processed
        waitForBroadcastIdle();

        assertCanStartPersonalApp(TEST_IME_PKG, false);
        setPersonalAppsSuspended(false);
    }

    private void setPersonalAppsSuspended(boolean suspended) throws DeviceNotAvailableException {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                suspended ? ""testSuspendPersonalApps"" : ""testUnsuspendPersonalApps"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testPersonalAppsSuspensionSms"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps role app"	"public void testPersonalAppsSuspensionSms() throws Exception {
        assumeHasTelephonyFeature();

        // Install an SMS app and make it the default.
        installAppAsUser(SIMPLE_SMS_APP_APK, mPrimaryUserId);
        addSmsRole(SIMPLE_SMS_APP_PKG, mPrimaryUserId);
        try {
            setPersonalAppsSuspended(true);
            // Default sms app should not be suspended.
            assertCanStartPersonalApp(SIMPLE_SMS_APP_PKG, true);
            setPersonalAppsSuspended(false);
        } finally {
            removeSmsRole(SIMPLE_SMS_APP_PKG, mPrimaryUserId);
        }
    }

    private void addSmsRole(String app, int userId) throws Exception {
        executeShellCommand(String.format(
                ""cmd role add-role-holder --user %d android.app.role.SMS %s"", userId, app));
    }

    private void removeSmsRole(String app, int userId) throws Exception {
        executeShellCommand(String.format(
                ""cmd role remove-role-holder --user %d android.app.role.SMS %s"", userId, app));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testPersonalAppsSuspensionIme"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPersonalAppsSuspensionIme() throws Exception {
        installAppAsUser(TEST_IME_APK, mPrimaryUserId);
        setupIme(TEST_IME_COMPONENT, mPrimaryUserId);
        setPersonalAppsSuspended(true);
        // Active IME should not be suspended.
        assertCanStartPersonalApp(TEST_IME_PKG, true);
        setPersonalAppsSuspended(false);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testSetPersonalAppsSuspendedLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testSetPersonalAppsSuspendedLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                    runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DevicePolicyLoggingTest"",
                            ""testSetPersonalAppsSuspendedLogged"", mUserId);
                }, new DevicePolicyEventWrapper.Builder(EventId.SET_PERSONAL_APPS_SUSPENDED_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(true)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_PERSONAL_APPS_SUSPENDED_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(false)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testSetManagedProfileMaximumTimeOffLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testSetManagedProfileMaximumTimeOffLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                    runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                            ""testSetManagedProfileMaximumTimeOff"", mUserId);
                }, new DevicePolicyEventWrapper.Builder(
                        EventId.SET_MANAGED_PROFILE_MAXIMUM_TIME_OFF_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setTimePeriod(123456789)
                        .build(),
                new DevicePolicyEventWrapper.Builder(
                        EventId.SET_MANAGED_PROFILE_MAXIMUM_TIME_OFF_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setTimePeriod(0)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testWorkProfileMaximumTimeOff"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testWorkProfileMaximumTimeOff() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                ""testSetManagedProfileMaximumTimeOff1Sec"", mUserId);

        toggleQuietMode(true);
        // Verify that at some point personal app becomes impossible to launch.
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, SUSPENSION_CHECKER_CLASS,
                ""testWaitForActivityNotLaunchable"", mPrimaryUserId);
        toggleQuietMode(false);
        // Ensure the profile is properly started before wipe broadcast is sent in teardown.
        waitForUserUnlock(mUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                ""testPersonalAppsSuspendedByTimeout"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testWorkProfileMaximumTimeOff_complianceRequiredBroadcastDefault"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testWorkProfileMaximumTimeOff_complianceRequiredBroadcastDefault()
            throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        // Very long timeout, won't be triggered
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                ""testSetManagedProfileMaximumTimeOff1Year"", mUserId);

        try {
            toggleQuietMode(true);
            waitForUserStopped(mUserId);
            toggleQuietMode(false);
            waitForUserUnlock(mUserId);
            // Ensure the DPC has handled the broadcast
            waitForBroadcastIdle();
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testComplianceAcknowledgementRequiredReceived"", mUserId);

            // Ensure that the default onComplianceAcknowledgementRequired acknowledged compliance.
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testComplianceAcknowledgementNotRequired"", mUserId);

        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testClearComplianceSharedPreference"", mUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testWorkProfileMaximumTimeOff_complianceRequiredBroadcastOverride"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testWorkProfileMaximumTimeOff_complianceRequiredBroadcastOverride()
            throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        // Very long timeout, won't be triggered
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                ""testSetManagedProfileMaximumTimeOff1Year"", mUserId);
        // Set shared preference that instructs the receiver to NOT call default implementation.
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                ""testSetOverrideOnComplianceAcknowledgementRequired"", mUserId);

        try {
            toggleQuietMode(true);
            waitForUserStopped(mUserId);
            toggleQuietMode(false);
            waitForUserUnlock(mUserId);
            // Ensure the DPC has handled the broadcast
            waitForBroadcastIdle();
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testComplianceAcknowledgementRequiredReceived"", mUserId);

            // Ensure compliance wasn't acknowledged automatically, acknowledge explicitly.
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testAcknowledgeCompliance"", mUserId);
        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                    ""testClearComplianceSharedPreference"", mUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testNetworkLoggingLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testNetworkLoggingLogged() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        assertMetricsLogged(getDevice(), () -> {
            testNetworkLoggingOnWorkProfile(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_NETWORK_LOGGING_ENABLED_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setInt(1)
                .setStrings(LOG_TAG_PROFILE_OWNER)
                .build(),
           new DevicePolicyEventWrapper.Builder(EventId.RETRIEVE_NETWORK_LOGS_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(LOG_TAG_PROFILE_OWNER)
                .build(),
           new DevicePolicyEventWrapper.Builder(EventId.SET_NETWORK_LOGGING_ENABLED_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setInt(0)
                .setStrings(LOG_TAG_PROFILE_OWNER)
                .build());
    }

    private void toggleQuietMode(boolean quietModeEnable) throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".PersonalAppsSuspensionTest"",
                quietModeEnable ? ""testEnableQuietMode"" : ""testDisableQuietMode"", mPrimaryUserId);
    }

    private void setAndStartLauncher(String component) throws Exception {
        String output = getDevice().executeShellCommand(String.format(
                ""cmd package set-home-activity --user %d %s"", mPrimaryUserId, component));
        assertTrue(""failed to set home activity"", output.contains(""Success""));
        executeShellCommand(""am start -W -n "" + component);
    }

    private void waitForUserStopped(int userId) throws Exception {
        waitForOutput(""User is not unlocked."",
                String.format(""am get-started-user-state %d"", userId),
                s -> s.startsWith(USER_IS_NOT_STARTED), USER_STOP_TIMEOUT_SEC);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testCameraDisabledOnParentIsEnforced"	"CtsDevicePolicyManagerTestCases"	"2: camera app"	"public void testCameraDisabledOnParentIsEnforced() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        try {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                    ""testAddUserRestrictionCameraDisabled_onParent"", mUserId);
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                    ""testCannotOpenCamera"", mPrimaryUserId);
        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                    ""testRemoveUserRestrictionCameraEnabled_onParent"", mUserId);
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                    ""testCanOpenCamera"", mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testCameraDisabledOnParentLogged"	"CtsDevicePolicyManagerTestCases"	"4: camera called UI app"	"public void testCameraDisabledOnParentLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                    runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DevicePolicyLoggingParentTest"",
                            ""testCameraDisabledLogged"", mUserId);
                }, new DevicePolicyEventWrapper.Builder(EventId.SET_CAMERA_DISABLED_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(true)
                        .setStrings(CALLED_FROM_PARENT)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_CAMERA_DISABLED_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(false)
                        .setStrings(CALLED_FROM_PARENT)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testUserRestrictionSetOnParentLogged"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testUserRestrictionSetOnParentLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DevicePolicyLoggingParentTest"",
                    ""testUserRestrictionLogged"", mUserId);
                }, new DevicePolicyEventWrapper.Builder(EventId.ADD_USER_RESTRICTION_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setStrings(DISALLOW_CONFIG_LOCATION, CALLED_FROM_PARENT)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.REMOVE_USER_RESTRICTION_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setStrings(DISALLOW_CONFIG_LOCATION, CALLED_FROM_PARENT)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testPermittedInputMethodsLogged"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testPermittedInputMethodsLogged() throws Exception {
        assertMetricsLogged(getDevice(), () ->
                        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".InputMethodsTest"",
                                ""testPermittedInputMethodsOnParent"", mUserId),
                new DevicePolicyEventWrapper.Builder(EventId.SET_PERMITTED_INPUT_METHODS_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setStrings(CALLED_FROM_PARENT, new String[0])
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_PERMITTED_INPUT_METHODS_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setStrings(CALLED_FROM_PARENT, new String[0])
                        .build());
    }

    private void setupIme(String imeComponent, int userId) throws Exception {
        // Wait until IMS service is registered by the system.
        waitForOutput(""Failed waiting for IME to become available"",
                String.format(""ime list --user %d -s -a"", userId),
                s -> s.contains(imeComponent), 10 /* seconds */);

        executeShellCommand(""ime enable "" + imeComponent);
        executeShellCommand(""ime set "" + imeComponent);
    }

    private void assertCanStartPersonalApp(String packageName, boolean canStart)
            throws DeviceNotAvailableException {
        runDeviceTestsAsUser(packageName, ""com.android.cts.suspensionchecker.ActivityLaunchTest"",
                canStart ? ""testCanStartActivity"" : ""testCannotStartActivity"", mPrimaryUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testCanRelinquishControlOverDevice"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanRelinquishControlOverDevice() throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".LockScreenInfoTest"", ""testSetAndGetLockInfo"",
                mUserId);

        removeOrgOwnedProfile();
        assertHasNoUser(mUserId);

        try {
            installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
            assertTrue(setDeviceOwner(DEVICE_ADMIN_COMPONENT_FLATTENED,
                    mPrimaryUserId, /*expectFailure*/false));
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".LockScreenInfoTest"", ""testLockInfoIsNull"",
                    mPrimaryUserId);
        } finally {
            removeAdmin(DEVICE_ADMIN_COMPONENT_FLATTENED, mPrimaryUserId);
            getDevice().uninstallPackage(DEVICE_ADMIN_PKG);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testProfileOwnerCanGetDeviceIdentifiers"	"CtsDevicePolicyManagerTestCases"	"1: identifier"	"public void testProfileOwnerCanGetDeviceIdentifiers() throws Exception {
        // The Profile Owner should have access to all device identifiers.
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DeviceIdentifiersTest"",
                ""testProfileOwnerCanGetDeviceIdentifiersWithPermission"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testUserRestrictionsSetOnParentAreNotPersisted"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testUserRestrictionsSetOnParentAreNotPersisted() throws Exception {
        assumeCanCreateAdditionalUsers(1);

        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                ""testAddUserRestrictionDisallowConfigDateTime_onParent"", mUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                ""testHasUserRestrictionDisallowConfigDateTime"", mPrimaryUserId);
        removeOrgOwnedProfile();
        assertHasNoUser(mUserId);

        // User restrictions are not persist after organization-owned profile owner is removed
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".UserRestrictionsParentTest"",
                ""testUserRestrictionDisallowConfigDateTimeIsNotPersisted"", mPrimaryUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testSecurityLogging"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSecurityLogging() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        testSecurityLoggingOnWorkProfile(DEVICE_ADMIN_PKG, "".SecurityLoggingTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testSecurityLoggingDelegate"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSecurityLoggingDelegate() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        try {
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".SecurityLoggingDelegateTest"",
                    ""testCannotAccessApis"", mUserId);
            // Set security logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".SecurityLoggingTest"",
                    ""testSetDelegateScope_delegationSecurityLogging"", mUserId);

            testSecurityLoggingOnWorkProfile(DELEGATE_APP_PKG,
                    "".SecurityLoggingDelegateTest"");
        } finally {
            // Remove security logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".SecurityLoggingTest"",
                    ""testSetDelegateScope_noDelegation"", mUserId);
        }
    }

    private void testSecurityLoggingOnWorkProfile(String packageName, String testClassName)
            throws Exception {
        // Backup stay awake setting because testGenerateLogs() will turn it off.
        final String stayAwake = getDevice().getSetting(""global"", ""stay_on_while_plugged_in"");
        try {
            // Turn logging on.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testEnablingSecurityLogging"", mUserId);
            // Reboot to ensure ro.organization_owned is set to true in logd and logging is on.
            rebootAndWaitUntilReady();
            waitForUserUnlock(mUserId);

            // Generate various types of events on device side and check that they are logged.
            runDeviceTestsAsUser(packageName, testClassName, ""testGenerateLogs"", mUserId);
            getDevice().executeShellCommand(""whoami""); // Generate adb command securty event
            runDeviceTestsAsUser(packageName, testClassName, ""testVerifyGeneratedLogs"", mUserId);

            // Immediately attempting to fetch events again should fail.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testSecurityLoggingRetrievalRateLimited"", mUserId);
        } finally {
            // Turn logging off.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testDisablingSecurityLogging"", mUserId);
            // Restore stay awake setting.
            if (stayAwake != null) {
                getDevice().setSetting(""global"", ""stay_on_while_plugged_in"", stayAwake);
            }
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testIsDeviceOrganizationOwnedWithManagedProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testIsDeviceOrganizationOwnedWithManagedProfile() throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DeviceOwnershipTest"",
                ""testCallingIsOrganizationOwnedWithManagedProfileExpectingTrue"",
                mUserId);

        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DeviceOwnershipTest"",
                ""testCallingIsOrganizationOwnedWithManagedProfileExpectingTrue"",
                mPrimaryUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testApplicationHiddenParent"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testApplicationHiddenParent() throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".ApplicationHiddenParentTest"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testCanRestrictAccountManagementOnParentProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanRestrictAccountManagementOnParentProfile() throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".AccountManagementParentTest"",
                ""testSetAccountManagementDisabledOnParent"", mUserId);
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        try {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".AccountManagementParentTest"",
                    ""testAccountManagementDisabled"", mPrimaryUserId);
        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".AccountManagementParentTest"",
                    ""testEnableAccountManagement"", mUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testScreenCaptureDisabled"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testScreenCaptureDisabled() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        setPoAsUser(mPrimaryUserId);

        try {
            setScreenCaptureDisabled(true);
        } finally {
            setScreenCaptureDisabled(false);
        }
    }

    private void takeScreenCaptureAsUser(int userId, String testMethodName) throws Exception {
        installAppAsUser(TEST_APP_APK, /* grantPermissions */ true, /* dontKillApp */ true, userId);
        startActivityAsUser(userId, TEST_APP_PKG, TEST_APP_PKG + "".SimpleActivity"");
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".ScreenCaptureDisabledTest"",
                testMethodName, userId);
        forceStopPackageForUser(TEST_APP_PKG, userId);
    }

    private void setScreenCaptureDisabled(boolean disabled) throws Exception {
        String testMethodName = disabled
                ? ""testSetScreenCaptureDisabledOnParent_true""
                : ""testSetScreenCaptureDisabledOnParent_false"";
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".ScreenCaptureDisabledTest"",
                testMethodName, mUserId);

        testMethodName = disabled
                ? ""testScreenCaptureImpossible""
                : ""testScreenCapturePossible"";

        // Test personal profile
        takeScreenCaptureAsUser(mPrimaryUserId, testMethodName);

        // Test managed profile. This should not be disabled when screen capture is disabled on
        // the parent by the profile owner of an organization-owned device.
        takeScreenCaptureAsUser(mUserId, ""testScreenCapturePossible"");
    }

    private void assertHasNoUser(int userId) throws DeviceNotAvailableException {
        int numWaits = 0;
        final int MAX_NUM_WAITS = 15;
        while (listUsers().contains(userId) && (numWaits < MAX_NUM_WAITS)) {
            try {
                Thread.sleep(1000);
                numWaits += 1;
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        assertThat(listUsers()).doesNotContain(userId);
    }

    private void setPoAsUser(int userId) throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, true, true, userId);
        assertTrue(""Failed to set profile owner"",
                setProfileOwner(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                        userId, /* expectFailure */ false));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testDelegatedCertInstallerDeviceIdAttestation"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDelegatedCertInstallerDeviceIdAttestation() throws Exception {
        installAppAsUser(CERT_INSTALLER_APK, mUserId);

        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                ""testManualSetCertInstallerDelegate"", mUserId);

        runDeviceTestsAsUser(CERT_INSTALLER_PKG, "".DelegatedDeviceIdAttestationTest"",
                ""testGenerateKeyPairWithDeviceIdAttestationExpectingSuccess"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testNetworkLogging"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNetworkLogging() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        testNetworkLoggingOnWorkProfile(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.OrgOwnedProfileOwnerTest"	"testNetworkLoggingDelegate"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNetworkLoggingDelegate() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        try {
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".WorkProfileNetworkLoggingDelegateTest"",
                    ""testCannotAccessApis"", mUserId);
            // Set network logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testSetDelegateScope_delegationNetworkLogging"", mUserId);

            testNetworkLoggingOnWorkProfile(DELEGATE_APP_PKG,
                    "".WorkProfileNetworkLoggingDelegateTest"");
        } finally {
            // Remove network logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testSetDelegateScope_noDelegation"", mUserId);
        }
    }

    private void testNetworkLoggingOnWorkProfile(String packageName, String testClassName)
            throws Exception {
        try {
            // Turn network logging on.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testSetNetworkLogsEnabled_true"", mUserId);

            // Connect to websites from work profile, should be logged.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testConnectToWebsites_shouldBeLogged"", mUserId);
            // Connect to websites from personal profile, should not be logged.
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testConnectToWebsites_shouldNotBeLogged"", mPrimaryUserId);

            // Verify all work profile network logs have been received.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testRetrieveNetworkLogs_forceNetworkLogs_receiveNetworkLogs"", mUserId);
        } finally {
            // Turn network logging off.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testSetNetworkLogsEnabled_false"", mUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/OrgOwnedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CustomManagedProfileTest"	"testIsProvisioningAllowed"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testIsProvisioningAllowed() throws Exception {
        // Must install the apk since the test runs in the ManagedProfile apk.
        installAppAsUser(MANAGED_PROFILE_APK, mPrimaryUserId);
        try {
            if (mFeaturesCheckerRule.hasRequiredFeatures()) {
                // Since we assume, in ManagedProfileTest, provisioning has to be successful,
                // DevicePolicyManager.isProvisioningAllowed must return true
                assertIsProvisioningAllowed(true, mPrimaryUserId);
            } else {
                // Test the case when feature flag is off
                assertIsProvisioningAllowed(false, mPrimaryUserId);
            }
        } finally {
            getDevice().uninstallPackage(MANAGED_PROFILE_PKG);
        }
    }

    private void assertIsProvisioningAllowed(boolean expected, int userId)
            throws DeviceNotAvailableException {
        final String testName = expected ? ""testIsProvisioningAllowedTrue""
                : ""testIsProvisioningAllowedFalse"";
        CLog.d(""Running test %s on user %d"", testName, userId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".PreManagedProfileTest"", testName, userId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CustomManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileWipeTest"	"testWipeDataWithReason"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testWipeDataWithReason() throws Exception {
        assertTrue(listUsers().contains(mProfileUserId));

        // testWipeDataWithReason() removes the managed profile,
        // so it needs to separated from other tests.
        // Check and clear the notification is presented after work profile got removed, so profile
        // user no longer exists, verification should be run in primary user.
        // Both the profile wipe and notification verification are done on the device side test
        // because notifications are checked using a NotificationListenerService
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG,
                "".WipeDataNotificationTest"",
                ""testWipeDataWithReasonVerification"",
                mParentUserId,
                mTestArgs);
        // Note: the managed profile is removed by this test, which will make removeUserCommand in
        // tearDown() to complain, but that should be OK since its result is not asserted.
        waitUntilUserRemoved(mProfileUserId);
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileWipeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileWipeTest"	"testWipeDataLogged"	"CtsDevicePolicyManagerTestCases"	"4: data called UI app"	"public void testWipeDataLogged() throws Exception {
        assertTrue(listUsers().contains(mProfileUserId));

        // Both the profile wipe and notification verification are done on the device side test
        // because notifications are checked using a NotificationListenerService
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(
                    MANAGED_PROFILE_PKG,
                    "".WipeDataNotificationTest"",
                    ""testWipeDataWithReasonVerification"",
                    mParentUserId,
                    mTestArgs);
        }, new DevicePolicyEventWrapper.Builder(EventId.WIPE_DATA_WITH_REASON_VALUE)
                .setAdminPackageName(MANAGED_PROFILE_PKG)
                .setInt(0)
                .setStrings(""notCalledFromParent"")
                .build());
        waitUntilUserRemoved(mProfileUserId);
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileWipeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileWipeTest"	"testWipeDataWithoutReason"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testWipeDataWithoutReason() throws Exception {
        assertTrue(listUsers().contains(mProfileUserId));

        // testWipeDataWithoutReason() removes the managed profile,
        // so it needs to separated from other tests.
        // Check the notification is not presented after work profile got removed, so profile user
        // no longer exists, verification should be run in primary user.
        // Both the profile wipe and notification verification are done on the device side test
        // because notifications are checked using a NotificationListenerService
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG,
                "".WipeDataNotificationTest"",
                ""testWipeDataWithoutReasonVerification"",
                mParentUserId,
                mTestArgs);

        // Note: the managed profile is removed by this test, which will make removeUserCommand in
        // tearDown() to complain, but that should be OK since its result is not asserted.
        waitUntilUserRemoved(mProfileUserId);
    }

    /**
     * wipeData() test removes the managed profile, so it needs to be separated from other tests.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileWipeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileWipeTest"	"testWipeData"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testWipeData() throws Exception {
        assertTrue(listUsers().contains(mProfileUserId));

        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG,
                "".WipeDataNotificationTest"",
                ""testWipeDataWithEmptyReasonVerification"",
                mParentUserId,
                mTestArgs);

        // Note: the managed profile is removed by this test, which will make removeUserCommand in
        // tearDown() to complain, but that should be OK since its result is not asserted.
        waitUntilUserRemoved(mProfileUserId);
    }

    private void configureNotificationListener() throws DeviceNotAvailableException {
        getDevice().executeShellCommand(""cmd notification allow_listener ""
                + ""com.android.cts.managedprofile/.NotificationListener"");
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileWipeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileWipeTest"	"configureNotificationListener"	"CtsDevicePolicyManagerTestCases"	"1: app"	"/*
 *
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.metrics.DevicePolicyEventLogVerifier.assertMetricsLogged;

import static org.junit.Assert.assertTrue;

import android.platform.test.annotations.FlakyTest;
import android.stats.devicepolicy.EventId;

import com.android.cts.devicepolicy.metrics.DevicePolicyEventWrapper;
import com.android.tradefed.device.DeviceNotAvailableException;

import org.junit.Test;

import java.util.HashMap;
import java.util.Map;

public class ManagedProfileWipeTest extends BaseManagedProfileTest {

    private static final String KEY_PROFILE_ID = ""profileId"";
    private final Map<String, String> mTestArgs = new HashMap<>();

    @Override
    public void setUp() throws Exception {
        super.setUp();

        mTestArgs.put(KEY_PROFILE_ID, Integer.toString(mProfileUserId));
        configureNotificationListener();
    }

    @Override
    public void tearDown() throws Exception {
        super.tearDown();
        mTestArgs.clear();
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileWipeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTestApi25"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.cts.devicepolicy.annotations.PermissionsTest;

import org.junit.Test;

/**
 * Set of tests for managed profile owner use cases that also apply to device owners.
 * Tests that should be run identically in both cases are added in DeviceAndProfileOwnerTestApi25.
 */
// We need managed users to be supported in order to create a profile of the user owner.
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class MixedManagedProfileOwnerTestApi25 extends DeviceAndProfileOwnerTestApi25 {
    private int mParentUserId = -1;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        mParentUserId = mPrimaryUserId;
        createManagedProfile();
    }

    private void createManagedProfile() throws Exception {
        mUserId = createManagedProfile(mParentUserId);
        switchUser(mParentUserId);
        startUserAndWait(mUserId);

        installAppAsUser(DEVICE_ADMIN_APK, mUserId);
        setProfileOwnerOrFail(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mUserId);
        startUserAndWait(mUserId);
    }

    @Override
    public void tearDown() throws Exception {
        removeUser(mUserId);

        super.tearDown();
    }

    @Override
    @PermissionsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTestApi25.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTestApi25"	"testPermissionGrantPreMApp"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrantPreMApp() throws Exception {
        super.testPermissionGrantPreMApp();
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTestApi25.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"assumeTestEnabled"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import org.junit.Test;

import java.util.Collections;

/**
 * Set of tests for the limit app icon hiding feature.
 */
public class LimitAppIconHidingTest extends BaseLauncherAppsTest {

    private static final String LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK =
            ""CtsHasLauncherActivityApp.apk"";
    private static final String LAUNCHER_TESTS_NO_LAUNCHER_ACTIVITY_APK =
            ""CtsNoLauncherActivityApp.apk"";
    private static final String LAUNCHER_TESTS_NO_PERMISSION_APK =
            ""CtsNoPermissionApp.apk"";

    private String mSerialNumber;
    private int mCurrentUserId;

    @Override
    protected void assumeTestEnabled() throws Exception {
        assumeApiLevel(21);
    }

    @Override
    public void setUp() throws Exception {
        super.setUp();

        mCurrentUserId = getDevice().getCurrentUser();
        mSerialNumber = Integer.toString(getUserSerialNumber(mCurrentUserId));
        uninstallTestApps();
        installTestApps(mCurrentUserId);
    }

    @Override
    public void tearDown() throws Exception {
        uninstallTestApps();

        super.tearDown();
    }

    @Override
    protected void installTestApps(int userId) throws Exception {
        super.installTestApps(mCurrentUserId);
        installAppAsUser(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK, mCurrentUserId);
        installAppAsUser(LAUNCHER_TESTS_NO_LAUNCHER_ACTIVITY_APK, mCurrentUserId);
        installAppAsUser(LAUNCHER_TESTS_NO_PERMISSION_APK, mCurrentUserId);
    }

    @Override
    protected void uninstallTestApps() throws Exception {
        super.uninstallTestApps();
        getDevice().uninstallPackage(LAUNCHER_TESTS_NO_PERMISSION_APK);
        getDevice().uninstallPackage(LAUNCHER_TESTS_NO_LAUNCHER_ACTIVITY_APK);
        getDevice().uninstallPackage(LAUNCHER_TESTS_HAS_LAUNCHER_ACTIVITY_APK);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"testHasLauncherActivityAppHasAppDetailsActivityInjected"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testHasLauncherActivityAppHasAppDetailsActivityInjected() throws Exception {
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testHasLauncherActivityAppHasAppDetailsActivityInjected"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"testNoSystemAppHasSyntheticAppDetailsActivityInjected"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNoSystemAppHasSyntheticAppDetailsActivityInjected() throws Exception {
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testNoSystemAppHasSyntheticAppDetailsActivityInjected"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"testNoLauncherActivityAppNotInjected"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNoLauncherActivityAppNotInjected() throws Exception {
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testNoLauncherActivityAppNotInjected"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"testNoPermissionAppNotInjected"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNoPermissionAppNotInjected() throws Exception {
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testNoPermissionAppNotInjected"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LimitAppIconHidingTest"	"testGetSetSyntheticAppDetailsActivityEnabled"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testGetSetSyntheticAppDetailsActivityEnabled() throws Exception {
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testGetSetSyntheticAppDetailsActivityEnabled"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LimitAppIconHidingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsMultiUserTest"	"assumeTestEnabled"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import org.junit.Test;

import java.util.Collections;

/**
 * Set of tests for LauncherApps attempting to access a non-profiles
 * apps.
 */
public class LauncherAppsMultiUserTest extends BaseLauncherAppsTest {

    private int mSecondaryUserId;
    private String mSecondaryUserSerialNumber;

    @Override
    protected void assumeTestEnabled() throws Exception {
        // We need multi user to be supported in order to create a secondary user
        // and api level 21 to support LauncherApps
        assumeSupportsMultiUser();
        assumeApiLevel(21);
    }

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        uninstallTestApps();
        installTestApps(mPrimaryUserId);
        // Create a secondary user.
        mSecondaryUserId = createUser();
        mSecondaryUserSerialNumber = Integer.toString(getUserSerialNumber(mSecondaryUserId));
        startUser(mSecondaryUserId);
    }

    @Override
    public void tearDown() throws Exception {
        removeUser(mSecondaryUserId);
        uninstallTestApps();

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsMultiUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsMultiUserTest"	"testGetActivitiesForNonProfileFails"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testGetActivitiesForNonProfileFails() throws Exception {
        installAppAsUser(SIMPLE_APP_APK, mPrimaryUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testGetActivitiesForUserFails"",
                mPrimaryUserId,
                Collections.singletonMap(PARAM_TEST_USER, mSecondaryUserSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsMultiUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsMultiUserTest"	"testNoLauncherCallbackPackageAddedSecondaryUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNoLauncherCallbackPackageAddedSecondaryUser() throws Exception {
        startCallbackService(mPrimaryUserId);
        installAppAsUser(SIMPLE_APP_APK, mPrimaryUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testNoPackageAddedCallbackForUser"",
                mPrimaryUserId,
                Collections.singletonMap(PARAM_TEST_USER, mSecondaryUserSerialNumber));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsMultiUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testSetCrossProfilePackages_isLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testSetCrossProfilePackages_isLogged() throws Exception {
        installAllTestApps();
        assertMetricsLogged(
                getDevice(),
                () -> runWorkProfileDeviceTest(
                        "".CrossProfileTest"", ""testSetCrossProfilePackages_noAsserts""),
                new DevicePolicyEventWrapper.Builder(SET_CROSS_PROFILE_PACKAGES_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .setStrings(TEST_APP_1_PKG)
                        .build());
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testSetCrossProfilePackages_resetsAppOps"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testSetCrossProfilePackages_resetsAppOps() throws Exception {
        installAllTestApps();
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_firstTime_doesNotResetAnyAppOps"");
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_unchanged_doesNotResetAnyAppOps"");
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_noPackagesUnset_doesNotResetAnyAppOps"");
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_somePackagesUnset_doesNotResetAppOpsIfStillSet"");
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_resetsAppOpOfUnsetPackages"");
        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_resetsAppOpOfUnsetPackagesOnOtherProfile"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testSetCrossProfilePackages_sendsBroadcastWhenResettingAppOps"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testSetCrossProfilePackages_sendsBroadcastWhenResettingAppOps() throws Exception {
        installAllTestApps();
        setupLogcatForTest();

        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_sendsBroadcastWhenResettingAppOps_noAsserts"");
        waitForBroadcastIdle();

        assertTestAppsReceivedCanInteractAcrossProfilesChangedBroadcast(
                UNSET_CROSS_PROFILE_PACKAGES);
        assertTestAppsDidNotReceiveCanInteractAcrossProfilesChangedBroadcast(
                MAINTAINED_CROSS_PROFILE_PACKAGES);
    }

    private void setupLogcatForTest() throws Exception {
        // Clear and increase logcat buffer size because the test is reading from it.
        final String clearLogcatCommand = ""logcat -c"";
        getDevice().executeShellCommand(clearLogcatCommand);
        final String increaseLogcatBufferCommand = ""logcat -G 16M"";
        getDevice().executeShellCommand(increaseLogcatBufferCommand);
    }

    /** Assumes that logcat is clear before running the test. */
    private void assertTestAppsReceivedCanInteractAcrossProfilesChangedBroadcast(
            Set<String> packageNames)
            throws Exception {
        for (String packageName : packageNames) {
            assertTrue(didTestAppReceiveCanInteractAcrossProfilesChangedBroadcast(
                    packageName, mProfileUserId));
            assertTrue(didTestAppReceiveCanInteractAcrossProfilesChangedBroadcast(
                    packageName, mParentUserId));
        }
    }

    /** Assumes that logcat is clear before running the test. */
    private void assertTestAppsDidNotReceiveCanInteractAcrossProfilesChangedBroadcast(
            Set<String> packageNames)
            throws Exception {
        for (String packageName : packageNames) {
            assertFalse(didTestAppReceiveCanInteractAcrossProfilesChangedBroadcast(
                    packageName, mProfileUserId));
            assertFalse(didTestAppReceiveCanInteractAcrossProfilesChangedBroadcast(
                    packageName, mParentUserId));
        }
    }

    /** Assumes that logcat is clear before running the test. */
    private boolean didTestAppReceiveCanInteractAcrossProfilesChangedBroadcast(
            String packageName, int userId)
            throws Exception {
        // The expected string is defined in the broadcast receiver of the test apps to be
        // packageName#action#userId.
        final String expectedSubstring =
                packageName + ""#"" + ACTION_CAN_INTERACT_ACROSS_PROFILES_CHANGED + ""#"" + userId;
        return readLogcat().contains(expectedSubstring);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testSetCrossProfilePackages_resetsAppOps_isLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testSetCrossProfilePackages_resetsAppOps_isLogged() throws Exception {
        installAllTestApps();
        assertMetricsLogged(
                getDevice(),
                () -> runWorkProfileDeviceTest(
                        "".CrossProfileTest"", ""testSetCrossProfilePackages_resetsAppOps_noAsserts""),
                new DevicePolicyEventWrapper.Builder(SET_INTERACT_ACROSS_PROFILES_APP_OP_VALUE)
                        .setStrings(TEST_APP_4_PKG)
                        .setInt(MODE_DEFAULT)
                        .setBoolean(true) // cross-profile manifest attribute
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testSetCrossProfilePackages_killsApps"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testSetCrossProfilePackages_killsApps() throws Exception {
        installAllTestApps();
        launchAllTestAppsInBothProfiles();
        Map<String, List<String>> maintainedPackagesPids = getPackagesPids(
                MAINTAINED_CROSS_PROFILE_PACKAGES_2);
        Map<String, List<String>> unsetPackagesPids = getPackagesPids(
                UNSET_CROSS_PROFILE_PACKAGES_2);

        runWorkProfileDeviceTest(
                "".CrossProfileTest"",
                ""testSetCrossProfilePackages_resetsAppOps_noAsserts"");

        for (String packageName : MAINTAINED_CROSS_PROFILE_PACKAGES_2) {
            assertAppRunningInBothProfiles(packageName, maintainedPackagesPids.get(packageName));
        }
        for (String packageName : UNSET_CROSS_PROFILE_PACKAGES_2) {
            assertAppKilledInBothProfiles(packageName, unsetPackagesPids.get(packageName));
        }
    }

    private Map<String, List<String>> getPackagesPids(Set<String> packages) throws Exception {
        Map<String, List<String>> pids = new HashMap<>();
        for (String packageName : packages) {
            pids.put(packageName, Arrays.asList(getAppPid(packageName).split("" "")));
        }
        return pids;
    }

    private void launchAllTestAppsInBothProfiles() throws Exception {
        launchAllTestAppsForUser(mParentUserId);
        launchAllTestAppsForUser(mProfileUserId);
    }

    private void launchAllTestAppsForUser(int userId) throws Exception {
        final String testActivity = ""android.app.Activity"";
        startActivityAsUser(userId, TEST_APP_1_PKG, testActivity);
        startActivityAsUser(userId, TEST_APP_2_PKG, testActivity);
        startActivityAsUser(userId, TEST_APP_3_PKG, testActivity);
        startActivityAsUser(userId, TEST_APP_4_PKG, testActivity);
    }

    private void assertAppRunningInBothProfiles(String packageName, List<String> pids)
            throws Exception {
        Set<String> currentPids = new HashSet<>(
                Arrays.asList(getAppPid(packageName).split("" "")));
        assertThat(currentPids).containsAtLeastElementsIn(pids);
    }

    private void assertAppKilledInBothProfiles(String packageName,  List<String> pids)
            throws Exception {
        Set<String> currentPids = new HashSet<>(
                Arrays.asList(getAppPid(packageName).split("" "")));
        assertThat(currentPids).containsNoneIn(pids);
    }

    private String getAppPid(String packageName) throws Exception {
        return getDevice().executeShellCommand(String.format(""pidof %s"", packageName)).trim();
    }

    private void setIdleAllowlist(String packageName, boolean enabled)
            throws DeviceNotAvailableException {
        String command = ""cmd deviceidle whitelist "" + (enabled ? ""+"" : ""-"") + packageName;
        LogUtil.CLog.d(""Output for command "" + command + "": ""
                + getDevice().executeShellCommand(command));
    }

    private String changeCrossProfileWidgetForUser(String packageName, String command, int userId)
            throws DeviceNotAvailableException {
        String adbCommand = ""am start -W --user "" + userId
                + "" -c android.intent.category.DEFAULT ""
                + "" --es extra-command "" + command
                + "" --es extra-package-name "" + packageName
                + "" "" + MANAGED_PROFILE_PKG + ""/.SetPolicyActivity"";
        String commandOutput = getDevice().executeShellCommand(adbCommand);
        LogUtil.CLog.d(""Output for command "" + adbCommand + "": "" + commandOutput);
        return commandOutput;
    }

    private void startWidgetHostService() throws Exception {
        String command = ""am startservice --user "" + mParentUserId
                + "" -a "" + WIDGET_PROVIDER_PKG + "".REGISTER_CALLBACK ""
                + ""--ei user-extra "" + getUserSerialNumber(mProfileUserId)
                + "" "" + WIDGET_PROVIDER_PKG + ""/.SimpleAppWidgetHostService"";
        LogUtil.CLog.d(""Output for command "" + command + "": ""
                + getDevice().executeShellCommand(command));
    }

    private void installAllTestApps() throws Exception {
        installAppAsUser(TEST_APP_1_APK, USER_ALL);
        installAppAsUser(TEST_APP_2_APK, USER_ALL);
        installAppAsUser(TEST_APP_3_APK, USER_ALL);
        installAppAsUser(TEST_APP_4_APK, USER_ALL);
    }

    private void runWorkProfileDeviceTest(String className, String methodName) throws Exception {
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG,
                className,
                methodName,
                mProfileUserId);
    }

    private String readLogcat() throws Exception {
        getDevice().stopLogcat();
        final String logcat;
        try (InputStreamSource logcatStream = getDevice().getLogcat()) {
            logcat = StreamUtil.getStringFromSource(logcatStream);
        }
        getDevice().startLogcat();
        return logcat;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileIntentFilters"	"CtsDevicePolicyManagerTestCases"	"3: UI only app"	"public void testCrossProfileIntentFilters() throws Exception {
        // Set up activities: ManagedProfileActivity will only be enabled in the managed profile and
        // PrimaryUserActivity only in the primary one
        disableActivityForUser(""ManagedProfileActivity"", mParentUserId);
        disableActivityForUser(""PrimaryUserActivity"", mProfileUserId);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                MANAGED_PROFILE_PKG + "".CrossProfileIntentFilterTest"", mProfileUserId);

        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(
                    MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".CrossProfileIntentFilterTest"",
                    ""testAddCrossProfileIntentFilter_all"", mProfileUserId);
        }, new DevicePolicyEventWrapper.Builder(ADD_CROSS_PROFILE_INTENT_FILTER_VALUE)
                .setAdminPackageName(MANAGED_PROFILE_PKG)
                .setInt(1)
                .setStrings(""com.android.cts.managedprofile.ACTION_TEST_ALL_ACTIVITY"")
                .build());

        // Set up filters from primary to managed profile
        String command = ""am start -W --user "" + mProfileUserId + "" "" + MANAGED_PROFILE_PKG
                + ""/.PrimaryUserFilterSetterActivity"";
        LogUtil.CLog.d(""Output for command "" + command + "": ""
                + getDevice().executeShellCommand(command));
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".PrimaryUserTest"", mParentUserId);
        // TODO: Test with startActivity
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileWidgetsLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCrossProfileWidgetsLogged() throws Exception {
        try {
            installAppAsUser(WIDGET_PROVIDER_APK, USER_ALL);
            getDevice().executeShellCommand(""appwidget grantbind --user "" + mParentUserId
                    + "" --package "" + WIDGET_PROVIDER_PKG);
            setIdleAllowlist(WIDGET_PROVIDER_PKG, true);
            startWidgetHostService();

            assertMetricsLogged(getDevice(), () -> {
                changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG,
                        ""add-cross-profile-widget"", mProfileUserId);
                changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG,
                        ""remove-cross-profile-widget"", mProfileUserId);
            }, new DevicePolicyEventWrapper
                        .Builder(ADD_CROSS_PROFILE_WIDGET_PROVIDER_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .build(),
                new DevicePolicyEventWrapper
                        .Builder(REMOVE_CROSS_PROFILE_WIDGET_PROVIDER_VALUE)
                        .setAdminPackageName(MANAGED_PROFILE_PKG)
                        .build());
        } finally {
            changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG, ""remove-cross-profile-widget"",
                    mProfileUserId);
            getDevice().uninstallPackage(WIDGET_PROVIDER_PKG);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileCalendarPackage"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCrossProfileCalendarPackage() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileCalendarTest"",
                    ""testCrossProfileCalendarPackage"", mProfileUserId);
        }, new DevicePolicyEventWrapper.Builder(SET_CROSS_PROFILE_CALENDAR_PACKAGES_VALUE)
                    .setAdminPackageName(MANAGED_PROFILE_PKG)
                    .setStrings(MANAGED_PROFILE_PKG)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileNotificationListeners_EmptyAllowlist"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"public void testCrossProfileNotificationListeners_EmptyAllowlist() throws Exception {

        installAppAsUser(NOTIFICATION_APK, USER_ALL);

        // Profile owner in the profile sets an empty allowlist
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testSetEmptyAllowlist"", mProfileUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
        // Listener outside the profile can only see personal notifications.
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testCannotReceiveProfileNotifications"", mParentUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testDisallowSharingIntoPersonalFromProfile"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testDisallowSharingIntoPersonalFromProfile() throws Exception {
        // Set up activities: PrimaryUserActivity will only be enabled in the personal user
        // This activity is used to find out the ground truth about the system's cross profile
        // intent forwarding activity.
        disableActivityForUser(""PrimaryUserActivity"", mProfileUserId);

        // Tests from the profile side
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                "".DisallowSharingIntoProfileTest"", ""testSharingFromProfile"", mProfileUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testDisallowSharingIntoProfileFromPersonal"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testDisallowSharingIntoProfileFromPersonal() throws Exception {
        // Set up activities: ManagedProfileActivity will only be enabled in the managed profile
        // This activity is used to find out the ground truth about the system's cross profile
        // intent forwarding activity.
        disableActivityForUser(""ManagedProfileActivity"", mParentUserId);

        // Tests from the personal side, which is mostly driven from host side.
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DisallowSharingIntoProfileTest"",
                ""testSetUp"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DisallowSharingIntoProfileTest"",
                ""testDisableSharingIntoProfile"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DisallowSharingIntoProfileTest"",
                ""testSharingFromPersonalFails"", mParentUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DisallowSharingIntoProfileTest"",
                ""testEnableSharingIntoProfile"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DisallowSharingIntoProfileTest"",
                ""testSharingFromPersonalSucceeds"", mParentUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileContent"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileContent() throws Exception {

        // Storage permission shouldn't be granted, we check if missing permissions are respected
        // in ContentTest#testSecurity.
        installAppAsUser(INTENT_SENDER_APK, false /* grantPermissions */, USER_ALL);
        installAppAsUser(INTENT_RECEIVER_APK, USER_ALL);

        // Test from parent to managed
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testRemoveAllFilters"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testAddManagedCanAccessParentFilters"", mProfileUserId);
        runDeviceTestsAsUser(INTENT_SENDER_PKG, "".ContentTest"", mParentUserId);

        // Test from managed to parent
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testRemoveAllFilters"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testAddParentCanAccessManagedFilters"", mProfileUserId);
        runDeviceTestsAsUser(INTENT_SENDER_PKG, "".ContentTest"", mProfileUserId);

    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileNotificationListeners_NullAllowlist"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileNotificationListeners_NullAllowlist() throws Exception {

        installAppAsUser(NOTIFICATION_APK, USER_ALL);

        // Profile owner in the profile sets a null allowlist
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testSetNullAllowlist"", mProfileUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
        // Listener outside the profile can see profile and personal notifications
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testCanReceiveNotifications"", mParentUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileNotificationListeners_InAllowlist"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileNotificationListeners_InAllowlist() throws Exception {

        installAppAsUser(NOTIFICATION_APK, USER_ALL);

        // Profile owner in the profile adds listener to the allowlist
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testAddListenerToAllowlist"", mProfileUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
        // Listener outside the profile can see profile and personal notifications
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testCanReceiveNotifications"", mParentUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileNotificationListeners_setAndGet"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileNotificationListeners_setAndGet() throws Exception {
        installAppAsUser(NOTIFICATION_APK, USER_ALL);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".NotificationListenerTest"",
                ""testSetAndGetPermittedCrossProfileNotificationListeners"", mProfileUserId,
                Collections.singletonMap(PARAM_PROFILE_ID, Integer.toString(mProfileUserId)));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileCopyPaste"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileCopyPaste() throws Exception {
        installAppAsUser(INTENT_RECEIVER_APK, USER_ALL);
        installAppAsUser(INTENT_SENDER_APK, USER_ALL);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testAllowCrossProfileCopyPaste"", mProfileUserId);
        // Test that managed can see what is copied in the parent.
        testCrossProfileCopyPasteInternal(mProfileUserId, true);
        // Test that the parent can see what is copied in managed.
        testCrossProfileCopyPasteInternal(mParentUserId, true);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testDisallowCrossProfileCopyPaste"", mProfileUserId);
        // Test that managed can still see what is copied in the parent.
        testCrossProfileCopyPasteInternal(mProfileUserId, true);
        // Test that the parent cannot see what is copied in managed.
        testCrossProfileCopyPasteInternal(mParentUserId, false);
    }

    private void testCrossProfileCopyPasteInternal(int userId, boolean shouldSucceed)
            throws DeviceNotAvailableException {
        final String direction = (userId == mParentUserId)
                ? ""testAddManagedCanAccessParentFilters""
                : ""testAddParentCanAccessManagedFilters"";
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                ""testRemoveAllFilters"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileUtils"",
                direction, mProfileUserId);
        if (shouldSucceed) {
            runDeviceTestsAsUser(INTENT_SENDER_PKG, "".CopyPasteTest"",
                    ""testCanReadAcrossProfiles"", userId);
        } else {
            runDeviceTestsAsUser(INTENT_SENDER_PKG, "".CopyPasteTest"",
                    ""testCannotReadAcrossProfiles"", userId);
        }
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileCrossProfileTest"	"testCrossProfileWidgets"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCrossProfileWidgets() throws Exception {
        try {
            installAppAsUser(WIDGET_PROVIDER_APK, USER_ALL);
            getDevice().executeShellCommand(""appwidget grantbind --user "" + mParentUserId
                    + "" --package "" + WIDGET_PROVIDER_PKG);
            setIdleAllowlist(WIDGET_PROVIDER_PKG, true);
            startWidgetHostService();

            String commandOutput = changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG,
                    ""add-cross-profile-widget"", mProfileUserId);
            assertTrue(""Command was expected to succeed "" + commandOutput,
                    commandOutput.contains(""Status: ok""));

            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileWidgetTest"",
                    ""testCrossProfileWidgetProviderAdded"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                    "".CrossProfileWidgetPrimaryUserTest"",
                    ""testHasCrossProfileWidgetProvider_true"", mParentUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                    "".CrossProfileWidgetPrimaryUserTest"",
                    ""testHostReceivesWidgetUpdates_true"", mParentUserId);

            commandOutput = changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG,
                    ""remove-cross-profile-widget"", mProfileUserId);
            assertTrue(""Command was expected to succeed "" + commandOutput,
                    commandOutput.contains(""Status: ok""));

            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileWidgetTest"",
                    ""testCrossProfileWidgetProviderRemoved"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                    "".CrossProfileWidgetPrimaryUserTest"",
                    ""testHasCrossProfileWidgetProvider_false"", mParentUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                    "".CrossProfileWidgetPrimaryUserTest"",
                    ""testHostReceivesWidgetUpdates_false"", mParentUserId);
        } finally {
            changeCrossProfileWidgetForUser(WIDGET_PROVIDER_PKG, ""remove-cross-profile-widget"",
                    mProfileUserId);
            getDevice().uninstallPackage(WIDGET_PROVIDER_PKG);
        }
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileCrossProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testPrimaryUserToPrimaryUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPrimaryUserToPrimaryUser() throws Exception {
        verifyCrossProfileAppsApi(mPrimaryUserId, mPrimaryUserId, NON_TARGET_USER_TEST_CLASS);
    }

    @FlakyTest
    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testPrimaryUserToManagedProfile"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPrimaryUserToManagedProfile() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mPrimaryUserId, mProfileId, TARGET_USER_TEST_CLASS);
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testManagedProfileToPrimaryUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testManagedProfileToPrimaryUser() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, TARGET_USER_TEST_CLASS);
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityComponent"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testStartActivityComponent() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartMainActivityByComponent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartNonMainActivityByComponent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCannotStartNotExportedActivityByComponent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCannotStartActivityInOtherPackageByComponent"");
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityIntent"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testStartActivityIntent() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCannotStartActivityWithImplicitIntent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartMainActivityByIntent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartMainActivityByIntent_withOptionsBundle"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartNonMainActivityByIntent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartNotExportedActivityByIntent"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCannotStartActivityInOtherPackageByIntent"");
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityIntentPermissions"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testStartActivityIntentPermissions() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCannotStartActivityByIntentWithNoPermissions"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartActivityByIntentWithInteractAcrossProfilesPermission"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartActivityByIntentWithInteractAcrossUsersPermission"");
        verifyCrossProfileAppsApi(mProfileId, mPrimaryUserId, START_ACTIVITY_TEST_CLASS, ""testCanStartActivityByIntentWithInteractAcrossUsersFullPermission"");
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityIntent_isLogged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testStartActivityIntent_isLogged() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        assertMetricsLogged(
                getDevice(),
                () -> verifyCrossProfileAppsApi(
                        mProfileId,
                        mPrimaryUserId,
                        START_ACTIVITY_TEST_CLASS,
                        ""testStartActivityByIntent_noAsserts""),
                new DevicePolicyEventWrapper
                        .Builder(START_ACTIVITY_BY_INTENT_VALUE)
                        .setStrings(TEST_PACKAGE)
                        .setBoolean(true) // from work profile
                        .build());
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityIntent_sameTaskByDefault"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testStartActivityIntent_sameTaskByDefault() throws Exception {
        // TODO(b/171957840): replace with device-side test using an inter-process communication
        //  library.
        if (!mHasManagedUserFeature) {
            return;
        }
        getDevice().clearLogcat();
        verifyCrossProfileAppsApi(
                mProfileId,
                mPrimaryUserId,
                START_ACTIVITY_TEST_CLASS,
                ""testStartActivityIntent_sameTaskByDefault"");
        assertThat(findTaskId(""CrossProfileSameTaskLauncherActivity""))
                .isEqualTo(findTaskId(""NonMainActivity""));
    }

    private int findTaskId(String className) throws Exception {
        final Matcher matcher =
                Pattern.compile(className + ""#taskId#"" + ""(.*?)"" + ""#"").matcher(readLogcat());
        boolean isFound = matcher.find();
        if (!isFound) {
            fail(""Task not found for "" + className);
            return -1;
        }
        return Integer.parseInt(matcher.group(1));
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartActivityIntent_crossProfile_returnsResult"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testStartActivityIntent_crossProfile_returnsResult() throws Exception {
        // TODO(b/171957840): replace with device-side test using an inter-process communication
        //  library.
        if (!mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(
                mProfileId,
                mPrimaryUserId,
                START_ACTIVITY_TEST_CLASS,
                ""testStartActivityIntent_crossProfile_returnsResult"");
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testPrimaryUserToSecondaryUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testPrimaryUserToSecondaryUser() throws Exception {
        if (!mCanTestMultiUser) {
            return;
        }
        verifyCrossProfileAppsApi(mPrimaryUserId, mSecondaryUserId, NON_TARGET_USER_TEST_CLASS);
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testSecondaryUserToManagedProfile"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testSecondaryUserToManagedProfile() throws Exception {
        if (!mCanTestMultiUser || !mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mSecondaryUserId, mProfileId, NON_TARGET_USER_TEST_CLASS);

    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testManagedProfileToSecondaryUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testManagedProfileToSecondaryUser() throws Exception {
        if (!mCanTestMultiUser || !mHasManagedUserFeature) {
            return;
        }
        verifyCrossProfileAppsApi(mProfileId, mSecondaryUserId, NON_TARGET_USER_TEST_CLASS);
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testStartMainActivity_logged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testStartMainActivity_logged() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        assertMetricsLogged(
                getDevice(),
                () -> {
                    runDeviceTest(
                            mProfileId,
                            mPrimaryUserId,
                            TARGET_USER_TEST_CLASS,
                            ""testStartMainActivity_noAsserts"");
                },
                new DevicePolicyEventWrapper
                        .Builder(CROSS_PROFILE_APPS_START_ACTIVITY_AS_USER_VALUE)
                        .setStrings(new String[] {""com.android.cts.crossprofileappstest""})
                        .build());
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsHostSideTest"	"testGetTargetUserProfiles_logged"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testGetTargetUserProfiles_logged() throws Exception {
        if (!mHasManagedUserFeature) {
            return;
        }
        assertMetricsLogged(
                getDevice(),
                () -> {
                    runDeviceTest(
                            mProfileId,
                            mPrimaryUserId,
                            TARGET_USER_TEST_CLASS,
                            ""testGetTargetUserProfiles_noAsserts"");
                },
                new DevicePolicyEventWrapper
                        .Builder(CROSS_PROFILE_APPS_GET_TARGET_USER_PROFILES_VALUE)
                        .setStrings(new String[] {""com.android.cts.crossprofileappstest""})
                        .build());
    }

    private void verifyCrossProfileAppsApi(int fromUserId, int targetUserId, String testClass)
            throws Exception {
        verifyCrossProfileAppsApi(fromUserId, targetUserId, testClass, /* testMethod= */ null);
    }

    private void verifyCrossProfileAppsApi(int fromUserId, int targetUserId, String testClass, String testMethod)
            throws Exception {
        runDeviceTest(fromUserId, targetUserId, testClass, testMethod);
    }

    private void runDeviceTest(
            int fromUserId, int targetUserId, String testClass, @Nullable String testMethod)
            throws Exception {
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                testClass,
                testMethod,
                fromUserId,
                createTargetUserParam(targetUserId));
    }

    private void createAndStartManagedProfile() throws Exception {
        mProfileId = createManagedProfile(mPrimaryUserId);
        switchUser(mPrimaryUserId);
        startUser(mProfileId);
    }

    private Map<String, String> createTargetUserParam(int targetUserId) throws Exception {
        return Collections.singletonMap(PARAM_TARGET_USER,
                Integer.toString(getUserSerialNumber(targetUserId)));
    }

    private String readLogcat() throws Exception {
        getDevice().stopLogcat();
        final String logcat;
        try (InputStreamSource logcatStream = getDevice().getLogcat()) {
            logcat = StreamUtil.getStringFromSource(logcatStream);
        }
        getDevice().startLogcat();
        return logcat;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.SeparateProfileChallengeTest"	"testSeparateProfileChallengePermissions"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"@AsbSecurityTest(cveBugId = 128599668)
    public void testSeparateProfileChallengePermissions() throws Exception {
        assumeCanCreateOneManagedUser();

        // Create managed profile.
        final int profileUserId = createManagedProfile(mPrimaryUserId);
        // createManagedProfile doesn't start the user automatically.
        startUser(profileUserId);
        installAppAsUser(SEPARATE_PROFILE_APK, profileUserId);
        executeSeparateProfileChallengeTest(profileUserId);
    }

    protected void setHiddenApiPolicyOn() throws Exception {
        mPreviousHiddenApiPolicy = getDevice().executeShellCommand(
                ""settings get global hidden_api_policy_p_apps"");
        executeShellCommand(""settings put global hidden_api_policy_p_apps 1"");
    }

    protected void setHiddenApiPolicyPreviousOrOff() throws Exception {
        executeShellCommand(""settings put global hidden_api_policy_p_apps ""
            + mPreviousHiddenApiPolicy);
    }

    private void executeSeparateProfileChallengeTest(int userId) throws Exception {
        runDeviceTestsAsUser(SEPARATE_PROFILE_PKG, SEPARATE_PROFILE_TEST_CLASS, userId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/SeparateProfileChallengeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.SeparateProfileChallengeTest"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import android.platform.test.annotations.AsbSecurityTest;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;

import org.junit.Test;

/**
 * Host side tests for separate profile challenge permissions.
 * Run the CtsSeparateProfileChallengeApp device side test.
 */
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class SeparateProfileChallengeTest extends BaseDevicePolicyTest {
    private static final String SEPARATE_PROFILE_PKG = ""com.android.cts.separateprofilechallenge"";
    private static final String SEPARATE_PROFILE_APK = ""CtsSeparateProfileChallengeApp.apk"";
    private static final String SEPARATE_PROFILE_TEST_CLASS =
        "".SeparateProfileChallengePermissionsTest"";
    private String mPreviousHiddenApiPolicy = ""0"";

    @Override
    public void setUp() throws Exception {
        super.setUp();

        setHiddenApiPolicyOn();
    }

    @Override
    public void tearDown() throws Exception {

        removeTestUsers();
        getDevice().uninstallPackage(SEPARATE_PROFILE_PKG);
        setHiddenApiPolicyPreviousOrOff();
        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/SeparateProfileChallengeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.EphemeralUserTest"	"testCreateLongLivedUser"	"CtsDevicePolicyManagerTestCases"	"1: live"	"public void testCreateLongLivedUser() throws Exception {
        int userId = createUser();
        int flags = getUserFlags(userId);
        assertTrue(""ephemeral flag must not be set"", 0 == (flags & FLAG_EPHEMERAL));
    }

    /**
     * Ephemeral user should be automatically removed after it is stopped.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/EphemeralUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCanGetWorkShortcutIconDrawableFromPersonalProfile"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testCanGetWorkShortcutIconDrawableFromPersonalProfile()
            throws DeviceNotAvailableException {
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                ""addDynamicShortcuts"", mProfileUserId);
        try {
            Map<String, String> params = new HashMap<>();
            params.put(""otherProfileUserId"", String.valueOf(mProfileUserId));
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                    ""shortcutIconDrawable_currentToOtherProfile_withUsersFullPermission_isNotNull"",
                    mPrimaryUserId, params);
        } finally {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                    ""removeAllDynamicShortcuts"", mProfileUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCanGetPersonalShortcutIconDrawableFromWorkProfile"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testCanGetPersonalShortcutIconDrawableFromWorkProfile()
            throws DeviceNotAvailableException {
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                ""addDynamicShortcuts"", mPrimaryUserId);
        try {
            Map<String, String> params = new HashMap<>();
            params.put(""otherProfileUserId"", String.valueOf(mPrimaryUserId));
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                    ""shortcutIconDrawable_currentToOtherProfile_withUsersFullPermission_isNotNull"",
                    mProfileUserId, params);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                    ""shortcutIconDrawable_currentToOtherProfile_withoutUsersFullPermission_isNull"",
                    mProfileUserId, params);
        } finally {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".LauncherAppsTest"",
                    ""removeAllDynamicShortcuts"", mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCameraPolicy"	"CtsDevicePolicyManagerTestCases"	"1: camera"	"public void testCameraPolicy() throws Exception {
        assumeHasCameraFeature();

        try {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CameraPolicyTest"",
                    ""testDisableCameraInManagedProfile"",
                    mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CameraPolicyTest"",
                    ""testEnableCameraInManagedProfile"",
                    mProfileUserId);
        } finally {
            final String adminHelperClass = "".PrimaryUserAdminHelper"";
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG,
                    adminHelperClass, ""testClearDeviceAdmin"", mParentUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testManagedProfileSetup"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testManagedProfileSetup() throws Exception {
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".ManagedProfileSetupTest"",
                mProfileUserId);
    }

    @DoesNotRequireFeature"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testMaxOneManagedProfile"	"CtsDevicePolicyManagerTestCases"	"2: UI only"	"public void testMaxOneManagedProfile() throws Exception {
        int newUserId = -1;
        try {
            newUserId = createManagedProfile(mParentUserId);
        } catch (AssertionError expected) {
        }
        if (newUserId > 0) {
            removeUser(newUserId);
            if (mFeaturesCheckerRule.hasRequiredFeatures()) {
                // Exception is Android TV which can create multiple managed profiles
                if (!isTv()) {
                    fail(""Device must allow creating only one managed profile"");
                }
            } else {
                fail(""Device must not allow creating a managed profile"");
            }
        }
    }

    /**
     * Verify that removing a managed profile will remove all networks owned by that profile.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testNoDebuggingFeaturesRestriction"	"CtsDevicePolicyManagerTestCases"	"2: UI display"	"public void testNoDebuggingFeaturesRestriction() throws Exception {
        // If adb is running as root, then the adb uid is 0 instead of SHELL_UID,
        // so the DISALLOW_DEBUGGING_FEATURES restriction does not work and this test
        // fails.
        if (getDevice().isAdbRoot()) {
            CLog.logAndDisplay(LogLevel.WARN,
                    ""Cannot test testNoDebuggingFeaturesRestriction() in eng/userdebug build"");
            return;
        }
        String restriction = ""no_debugging_features"";  // UserManager.DISALLOW_DEBUGGING_FEATURES

        changeUserRestrictionOrFail(restriction, true, mProfileUserId);


        // This should now fail, as the shell is not available to start activities under a different
        // user once the restriction is in place.
        String addRestrictionCommandOutput =
                changeUserRestriction(restriction, true, mProfileUserId);
        assertTrue(
                ""Expected SecurityException when starting the activity ""
                        + addRestrictionCommandOutput,
                addRestrictionCommandOutput.contains(""SecurityException""));
    }

    // Test the bluetooth API from a managed profile."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testOrganizationInfo"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testOrganizationInfo() throws Exception {
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".OrganizationInfoTest"",
                ""testDefaultOrganizationColor"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".OrganizationInfoTest"",
                ""testDefaultOrganizationNameIsNull"", mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".OrganizationInfoTest"",
                mProfileUserId);
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(
                    MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".OrganizationInfoTest"",
                    ""testSetOrganizationColor"", mProfileUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_ORGANIZATION_COLOR_VALUE)
                .setAdminPackageName(MANAGED_PROFILE_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testBluetoothContactSharingDisabled"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testBluetoothContactSharingDisabled() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ContactsTest"",
                    ""testSetBluetoothContactSharingDisabled_setterAndGetter"", mProfileUserId);
        }, new DevicePolicyEventWrapper
                    .Builder(EventId.SET_BLUETOOTH_CONTACT_SHARING_DISABLED_VALUE)
                    .setAdminPackageName(MANAGED_PROFILE_PKG)
                    .setBoolean(false)
                    .build(),
            new DevicePolicyEventWrapper
                    .Builder(EventId.SET_BLUETOOTH_CONTACT_SHARING_DISABLED_VALUE)
                    .setAdminPackageName(MANAGED_PROFILE_PKG)
                    .setBoolean(true)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testSetProfileNameLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetProfileNameLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(
                    MANAGED_PROFILE_PKG, MANAGED_PROFILE_PKG + "".DevicePolicyLoggingTest"",
                    ""testSetProfileNameLogged"", mProfileUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PROFILE_NAME_VALUE)
                .setAdminPackageName(MANAGED_PROFILE_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testBasicCheck"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"@FlakyTest
    @Ignore
    public void testBasicCheck() throws Exception {
        // Install SimpleApp in work profile only and check activity in it can be launched.
        installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".BasicTest"", mProfileUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testProfileOwnerOnPersonalDeviceCannotGetDeviceIdentifiers"	"CtsDevicePolicyManagerTestCases"	"1: identifier"	"public void testProfileOwnerOnPersonalDeviceCannotGetDeviceIdentifiers() throws Exception {
        // The Profile Owner should have access to all device identifiers.
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".DeviceIdentifiersTest"",
                ""testProfileOwnerOnPersonalDeviceCannotGetDeviceIdentifiers"", mProfileUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCannotCallMethodsOnParentProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotCallMethodsOnParentProfile() throws Exception {
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ParentProfileTest"",
                ""testCannotWipeParentProfile"", mProfileUserId);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ParentProfileTest"",
                ""testCannotCallAutoTimeMethodsOnParentProfile"", mProfileUserId);

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ParentProfileTest"",
                ""testCannotCallSetDefaultSmsApplicationOnParentProfile"", mProfileUserId);
    }

    // TODO: This test is not specific to managed profiles, but applies to multi-user in general.
    // Move it to a MultiUserTest class when there is one. Should probably move
    // SetPolicyActivity to a more generic apk too as it might be useful for different kinds
    // of tests (same applies to ComponentDisablingActivity)."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCannotSetProfileOwnerAgain"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotSetProfileOwnerAgain() throws Exception {
        // verify that we can't set the same admin receiver as profile owner again
        assertFalse(setProfileOwner(
                MANAGED_PROFILE_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mProfileUserId,
                /*expectFailure*/ true));

        // verify that we can't set a different admin receiver as profile owner
        installAppAsUser(DEVICE_OWNER_APK, mProfileUserId);
        assertFalse(setProfileOwner(DEVICE_OWNER_PKG + ""/"" + DEVICE_OWNER_ADMIN, mProfileUserId,
                /*expectFailure*/ true));
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCannotSetDeviceOwnerWhenProfilePresent"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotSetDeviceOwnerWhenProfilePresent() throws Exception {
        try {
            installAppAsUser(DEVICE_OWNER_APK, mParentUserId);
            assertFalse(setDeviceOwner(DEVICE_OWNER_PKG + ""/"" + DEVICE_OWNER_ADMIN, mParentUserId,
                    /*expectFailure*/ true));
        } finally {
            // make sure we clean up in case we succeeded in setting the device owner
            removeAdmin(DEVICE_OWNER_PKG + ""/"" + DEVICE_OWNER_ADMIN, mParentUserId);
            getDevice().uninstallPackage(DEVICE_OWNER_PKG);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testCanCreateProfile"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanCreateProfile() throws Exception {
        // remove pre-created profile
        removeUser(mProfileUserId);

        // create profile from installed app
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".UserManagerTest"",
                ""testCreateProfile_managedProfile"", mPrimaryUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testResolverActivityLaunchedFromPersonalProfileWithSelectedWorkTab"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testResolverActivityLaunchedFromPersonalProfileWithSelectedWorkTab()
            throws Exception {
        installAppAsUser(SHARING_APP_1_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_2_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_1_APK, mProfileUserId);
        installAppAsUser(SHARING_APP_2_APK, mProfileUserId);
        try {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""addCrossProfileIntents"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""startSwitchToOtherProfileIntent"", mPrimaryUserId);
            assertResolverActivityInForeground(mPrimaryUserId);
        } finally {
            pressHome();
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""clearCrossProfileIntents"", mProfileUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testResolverActivityLaunchedFromWorkProfileWithSelectedPersonalTab"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testResolverActivityLaunchedFromWorkProfileWithSelectedPersonalTab()
            throws Exception {
        installAppAsUser(SHARING_APP_1_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_2_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_1_APK, mProfileUserId);
        installAppAsUser(SHARING_APP_2_APK, mProfileUserId);
        try {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""addCrossProfileIntents"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""startSwitchToOtherProfileIntent"", mProfileUserId);
            assertResolverActivityInForeground(mProfileUserId);
        } finally {
            pressHome();
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""clearCrossProfileIntents"", mProfileUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testChooserActivityLaunchedFromPersonalProfileWithSelectedWorkTab"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testChooserActivityLaunchedFromPersonalProfileWithSelectedWorkTab()
            throws Exception {
        installAppAsUser(SHARING_APP_1_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_2_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_1_APK, mProfileUserId);
        installAppAsUser(SHARING_APP_2_APK, mProfileUserId);
        try {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""addCrossProfileIntents"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""startSwitchToOtherProfileIntent_chooser"", mPrimaryUserId);
            assertChooserActivityInForeground(mPrimaryUserId);
        } finally {
            pressHome();
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""clearCrossProfileIntents"", mProfileUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileTest"	"testChooserActivityLaunchedFromWorkProfileWithSelectedPersonalTab"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testChooserActivityLaunchedFromWorkProfileWithSelectedPersonalTab()
            throws Exception {
        installAppAsUser(SHARING_APP_1_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_2_APK, mPrimaryUserId);
        installAppAsUser(SHARING_APP_1_APK, mProfileUserId);
        installAppAsUser(SHARING_APP_2_APK, mProfileUserId);
        try {
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""addCrossProfileIntents"", mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""startSwitchToOtherProfileIntent_chooser"", mProfileUserId);
            assertChooserActivityInForeground(mProfileUserId);
        } finally {
            pressHome();
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".CrossProfileSharingTest"",
                    ""clearCrossProfileIntents"", mProfileUserId);
        }
    }

    private void pressHome() throws Exception {
        executeShellCommand(""input keyevent KEYCODE_HOME"");
    }

    private void assertChooserActivityInForeground(int userId)
            throws DeviceNotAvailableException {
        assertActivityInForeground(""android/com.android.internal.app.ChooserActivity"", userId);
    }

    private void assertResolverActivityInForeground(int userId)
            throws DeviceNotAvailableException {
        assertActivityInForeground(""android/com.android.internal.app.ResolverActivity"", userId);
    }

    private void assertActivityInForeground(String fullActivityName, int userId)
            throws DeviceNotAvailableException {
        String commandOutput =
                getDevice().executeShellCommand(""dumpsys activity activities | grep Resumed:"");
        assertThat(commandOutput).contains(""u"" + userId + "" "" + fullActivityName);
    }

    private void changeUserRestrictionOrFail(String key, boolean value, int userId)
            throws DeviceNotAvailableException {
        changeUserRestrictionOrFail(key, value, userId, MANAGED_PROFILE_PKG);
    }

    private String changeUserRestriction(String key, boolean value, int userId)
            throws DeviceNotAvailableException {
        return changeUserRestriction(key, value, userId, MANAGED_PROFILE_PKG);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfileRingtoneTest"	"testRingtoneSyncAutoDisableAlarm"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testRingtoneSyncAutoDisableAlarm() throws Exception {
        givePackageWriteSettingsPermission(mProfileUserId);
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".RingtoneSyncTest"",
                ""testAlarmDisableSync"", mProfileUserId);
    }

    private void givePackageWriteSettingsPermission(int userId) throws DeviceNotAvailableException {
        // Allow app to write to settings (for RingtoneManager.setActualDefaultUri to work)
        String command = ""appops set --user "" + userId + "" "" + MANAGED_PROFILE_PKG
                + "" android:write_settings allow"";
        CLog.d(""Output for command "" + command + "": "" + getDevice().executeShellCommand(command));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfileRingtoneTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testCannotAddProfileIfRestrictionSet"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testCannotAddProfileIfRestrictionSet() throws Exception {
        // by default, disallow add managed profile users restriction is set.
        assertCannotCreateManagedProfile(mPrimaryUserId);
    }

    private void sendWipeProfileBroadcast(int userId) throws Exception {
        final String cmd = ""am broadcast --receiver-foreground --user "" + userId
                + "" -a com.android.cts.comp.WIPE_DATA""
                + "" com.android.cts.comp/.WipeDataReceiver"";
        getDevice().executeShellCommand(cmd);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testWipeData_secondaryUser"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testWipeData_secondaryUser() throws Exception {
        assumeCanCreateAdditionalUsers(1);

        int secondaryUserId = setupManagedSecondaryUser();
        addDisallowRemoveUserRestriction();
        // The PO of the managed user should be allowed to delete it, even though the disallow
        // remove user restriction is set.
        sendWipeProfileBroadcast(secondaryUserId);
        waitUntilUserRemoved(secondaryUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testWipeData_secondaryUserLogged"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testWipeData_secondaryUserLogged() throws Exception {
        assumeCanCreateAdditionalUsers(1);

        int secondaryUserId = setupManagedSecondaryUser();
        addDisallowRemoveUserRestriction();
        assertMetricsLogged(getDevice(), () -> {
            sendWipeProfileBroadcast(secondaryUserId);
            waitUntilUserRemoved(secondaryUserId);
        }, WIPE_DATA_WITH_REASON_DEVICE_POLICY_EVENT);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testCannotAddManagedProfileViaManagedProvisioning"	"CtsDevicePolicyManagerTestCases"	"1: called"	"@Ignore(""b/183395856 Migrate to a device side test."")
    public void testCannotAddManagedProfileViaManagedProvisioning()
            throws Exception {
        int profileUserId = provisionCorpOwnedManagedProfile();
        assertFalse(profileUserId >= 0);
    }

    /**
     * Test that isProvisioningAllowed returns false when called with
     * ACTION_PROVISION_MANAGED_PROFILE when there's a device owner.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testBindDeviceAdminServiceAsUser_secondaryUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testBindDeviceAdminServiceAsUser_secondaryUser() throws Exception {
        assumeCanCreateAdditionalUsers(1);

        int secondaryUserId = setupManagedSecondaryUser();

        installAppAsUser(COMP_DPC_APK2, mPrimaryUserId);
        installAppAsUser(COMP_DPC_APK2, secondaryUserId);

        // Shouldn't be possible to bind to each other, as they are not affiliated.
        verifyBindDeviceAdminServiceAsUserFails(secondaryUserId);

        // Set the same affiliation ids, and check that DO and PO can now bind to each other.
        setSameAffiliationId(secondaryUserId);
        verifyBindDeviceAdminServiceAsUser(secondaryUserId);
    }

    @FlakyTest(bugId = 141161038)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceOwnerPlusProfileOwnerTest"	"testRequestBugreportAvailableIfAffiliated"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testRequestBugreportAvailableIfAffiliated() throws Exception {
        assumeCanCreateAdditionalUsers(2);

        final int secondaryUserId = setupManagedSecondaryUser();

        // No affiliation ids have been set on the secondary user, the feature shouldn't be
        // available.
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                DEVICE_WIDE_LOGGING_TEST,
                ""testRequestBugreportThrowsSecurityException"",
                mPrimaryUserId);

        // Affiliate the DO and the secondary user.
        setSameAffiliationId(secondaryUserId);
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                DEVICE_WIDE_LOGGING_TEST,
                ""testRequestBugreportDoesNotThrowException"",
                mPrimaryUserId);

        setDifferentAffiliationId(secondaryUserId, COMP_DPC_PKG);
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                DEVICE_WIDE_LOGGING_TEST,
                ""testRequestBugreportThrowsSecurityException"",
                mPrimaryUserId);
    }

    private void verifyBindDeviceAdminServiceAsUser(int profileOwnerUserId) throws Exception {
        // Installing a non managing app (neither device owner nor profile owner).
        installAppAsUser(COMP_DPC_APK2, mPrimaryUserId);
        installAppAsUser(COMP_DPC_APK2, profileOwnerUserId);

        // Testing device owner -> profile owner.
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                BIND_DEVICE_ADMIN_SERVICE_GOOD_SETUP_TEST,
                mPrimaryUserId);
        // Testing profile owner -> device owner.
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                BIND_DEVICE_ADMIN_SERVICE_GOOD_SETUP_TEST,
                profileOwnerUserId);
    }

    private void verifyBindDeviceAdminServiceAsUserFails(int profileOwnerUserId) throws Exception {
        // Installing a non managing app (neither device owner nor profile owner).
        installAppAsUser(COMP_DPC_APK2, mPrimaryUserId);
        installAppAsUser(COMP_DPC_APK2, profileOwnerUserId);

        // Testing device owner -> profile owner.
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                BIND_DEVICE_ADMIN_SERVICE_FAILS_TEST,
                mPrimaryUserId);
        // Testing profile owner -> device owner.
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                BIND_DEVICE_ADMIN_SERVICE_FAILS_TEST,
                profileOwnerUserId);
    }

    private void setSameAffiliationId(
            int profileOwnerUserId, String profileOwnerPackage) throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                AFFILIATION_TEST,
                ""testSetAffiliationId1"",
                mPrimaryUserId);
        runDeviceTestsAsUser(
                profileOwnerPackage,
                AFFILIATION_TEST,
                ""testSetAffiliationId1"",
                profileOwnerUserId);
    }

    private void setSameAffiliationId(int profileOwnerUserId) throws Exception {
        setSameAffiliationId(profileOwnerUserId, COMP_DPC_PKG);
    }

    private void setDifferentAffiliationId(
            int profileOwnerUserId, String profileOwnerPackage) throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                AFFILIATION_TEST,
                ""testSetAffiliationId1"",
                mPrimaryUserId);
        runDeviceTestsAsUser(
                profileOwnerPackage,
                AFFILIATION_TEST,
                ""testSetAffiliationId2"",
                profileOwnerUserId);
    }

    private void setDifferentAffiliationId(int profileOwnerUserId) throws Exception {
        setDifferentAffiliationId(profileOwnerUserId, COMP_DPC_PKG);
    }

    private void assertProvisionManagedProfileNotAllowed(String packageName) throws Exception {
        runDeviceTestsAsUser(
                packageName,
                MANAGEMENT_TEST,
                ""testProvisionManagedProfileNotAllowed"",
                mPrimaryUserId);
    }

    /** Returns the user id of the newly created managed profile */
    private int setupManagedProfile(String apkName, String packageName,
            String adminReceiverClassName) throws Exception {
        final int userId = createManagedProfile(mPrimaryUserId);
        installAppAsUser(apkName, userId);
        setProfileOwnerOrFail(adminReceiverClassName, userId);
        startUserAndWait(userId);
        runDeviceTestsAsUser(
                packageName,
                MANAGEMENT_TEST,
                ""testIsManagedProfile"",
                userId);
        return userId;
    }

    /** Returns the user id of the newly created secondary user */
    private int setupManagedSecondaryUser() throws Exception {
        assertTrue(""Cannot create 1 additional user"", canCreateAdditionalUsers(1));

        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                MANAGEMENT_TEST,
                ""testCreateSecondaryUser"",
                mPrimaryUserId);
        List<Integer> newUsers = getUsersCreatedByTests();
        assertEquals(1, newUsers.size());
        int secondaryUserId = newUsers.get(0);
        getDevice().startUser(secondaryUserId, /* waitFlag= */ true);
        return secondaryUserId;
    }

    /** Returns the user id of the newly created secondary user */
    private int provisionCorpOwnedManagedProfile() throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                MANAGED_PROFILE_PROVISIONING_TEST,
                ""testProvisioningCorpOwnedManagedProfile"",
                mPrimaryUserId);
        return getFirstManagedProfileUserId();
    }

    /**
     * Add {@link android.os.UserManager#DISALLOW_REMOVE_USER}.
     */
    private void addDisallowRemoveUserRestriction() throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                USER_RESTRICTION_TEST,
                ""testAddDisallowRemoveUserRestriction"",
                mPrimaryUserId);
    }

    /**
     * Clear {@link android.os.UserManager#DISALLOW_REMOVE_USER}.
     */
    private void clearDisallowRemoveUserRestriction() throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                USER_RESTRICTION_TEST,
                ""testClearDisallowRemoveUserRestriction"",
                mPrimaryUserId);
    }

    private void assertOtherProfilesEqualsBindTargetUsers(int otherProfileUserId) throws Exception {
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                MANAGEMENT_TEST,
                ""testOtherProfilesEqualsBindTargetUsers"",
                mPrimaryUserId);
        runDeviceTestsAsUser(
                COMP_DPC_PKG,
                MANAGEMENT_TEST,
                ""testOtherProfilesEqualsBindTargetUsers"",
                otherProfileUserId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerPlusProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedProfileOwnerTest"	"testSetAutoTimeZoneEnabled"	"CtsDevicePolicyManagerTestCases"	"1: called"	"public void testSetAutoTimeZoneEnabled() {
        // Profile owner cannot set auto time zone unless it is called by the profile
        // owner of an organization-owned managed profile or a profile owner on user 0.
    }

    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testWifi"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testWifi() throws Exception {
        assumeHasWifiFeature();

        executeDeviceTestMethod("".WifiTest"", ""testGetWifiMacAddress"");
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".WifiTest"", ""testGetWifiMacAddress"");
        }, new DevicePolicyEventWrapper.Builder(EventId.GET_WIFI_MAC_ADDRESS_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testSetTime"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetTime() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".TimeManagementTest"", ""testSetTime"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_TIME_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());

        executeDeviceTestMethod("".TimeManagementTest"", ""testSetTime_failWhenAutoTimeEnabled"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testSetTimeZone"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetTimeZone() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".TimeManagementTest"", ""testSetTimeZone"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_TIME_ZONE_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());

        executeDeviceTestMethod("".TimeManagementTest"", ""testSetTimeZone_failIfAutoTimeZoneEnabled"");
    }

    Map<String, DevicePolicyEventWrapper[]> getAdditionalDelegationTests() {
        final Map<String, DevicePolicyEventWrapper[]> result = new HashMap<>();
        DevicePolicyEventWrapper[] expectedMetrics = new DevicePolicyEventWrapper[] {
                new DevicePolicyEventWrapper.Builder(EventId.SET_NETWORK_LOGGING_ENABLED_VALUE)
                        .setAdminPackageName(DELEGATE_APP_PKG)
                        .setBoolean(true)
                        .setInt(1)
                        .setStrings(LOG_TAG_DEVICE_OWNER)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.RETRIEVE_NETWORK_LOGS_VALUE)
                        .setAdminPackageName(DELEGATE_APP_PKG)
                        .setBoolean(true)
                        .setStrings(LOG_TAG_DEVICE_OWNER)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_NETWORK_LOGGING_ENABLED_VALUE)
                        .setAdminPackageName(DELEGATE_APP_PKG)
                        .setBoolean(true)
                        .setInt(0)
                        .setStrings(LOG_TAG_DEVICE_OWNER)
                        .build(),
        };
        result.put("".NetworkLoggingDelegateTest"", expectedMetrics);
        return result;
    }

    @Override
    List<String> getAdditionalDelegationScopes() {
        final List<String> result = new ArrayList<>();
        result.add(DELEGATION_NETWORK_LOGGING);
        return result;
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testLockScreenInfo"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testLockScreenInfo() throws Exception {
        executeDeviceTestClass("".LockScreenInfoTest"");

        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".LockScreenInfoTest"", ""testSetAndGetLockInfo"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_DEVICE_OWNER_LOCK_SCREEN_INFO_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testFactoryResetProtectionPolicy"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testFactoryResetProtectionPolicy() throws Exception {
        try {
            executeDeviceTestMethod("".DeviceFeatureUtils"", ""testHasFactoryResetProtectionPolicy"");
        } catch (AssertionError e) {
            // Unable to continue running tests because factory reset protection policy is not
            // supported on the device
            return;
        } catch (Exception e) {
            // Also skip test in case of other exceptions
            return;
        }

        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestClass("".FactoryResetProtectionPolicyTest"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_FACTORY_RESET_PROTECTION_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testInstallUpdateLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testInstallUpdateLogged() throws Exception {
        assumeIsDeviceAb();

        pushUpdateFileToDevice(""wrongHash.zip"");
        assertMetricsLogged(getDevice(), () -> {
            executeInstallUpdateTest(""testInstallUpdate_failWrongHash"");
        }, new DevicePolicyEventWrapper.Builder(EventId.INSTALL_SYSTEM_UPDATE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(/* isDeviceAb */ true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.INSTALL_SYSTEM_UPDATE_ERROR_VALUE)
                    .setInt(UPDATE_ERROR_UPDATE_FILE_INVALID)
                    .build());
    }

    private void executeInstallUpdateTest(String testName) throws Exception {
        // This test must run on system user as it calls installSystemUpdate(), which takes a
        // Runnable callback (InstallSystemUpdateCallback) and hence it cannot be easily passed
        // around through IPC (on headless system user mode).
        executeDeviceTestMethodOnDeviceOwnerUser("".systemupdate.InstallUpdateTest"", testName);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testSecurityLoggingEnabledLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSecurityLoggingEnabledLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SecurityLoggingTest"", ""testEnablingSecurityLogging"");
            executeDeviceTestMethod("".SecurityLoggingTest"", ""testDisablingSecurityLogging"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SECURITY_LOGGING_ENABLED_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(true)
                .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_SECURITY_LOGGING_ENABLED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testDisallowAutofill_allowed"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"@IgnoreOnHeadlessSystemUserMode(reason = ""Headless system user doesn't launch activities"")
    public void testDisallowAutofill_allowed() throws Exception {
        super.testDisallowAutofill_allowed();
    }

    @Override
    public void testApplicationHidden() throws Exception {
        if (isHeadlessSystemUserMode()) {
            // Must run on user 0 because the test has a broadcast receiver that listen to packages
            // added / removed intents
            mUserId = mDeviceOwnerUserId;
            CLog.d(""testApplicationHidden(): setting mUserId as %d before running it"", mUserId);
        }
        super.testApplicationHidden();
    }

    @Override
    protected void installDelegateApp() throws Exception {
        // TODO(b/176993670): must call installDeviceOwnerApp() - even though it's not one - so
        // the permissions required to use DpmWrapper are set on headless system user mode
        installDeviceOwnerApp(DELEGATE_APP_APK);
    }

    @Override
    protected void runDeviceTestsAsUser(String pkgName, String testClassName, String testName,
            int userId, Map<String, String> params) throws DeviceNotAvailableException {
        Map<String, String> newParams = new HashMap(params);
        newParams.putAll(getParamsForDeviceOwnerTest());
        super.runDeviceTestsAsUser(
                pkgName, testClassName, testName, userId, newParams);
    }

    @Override
    protected void executeDeviceTestMethod(String className, String testName,
            Map<String, String> params) throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, className, testName, mUserId, params);
    }

    private void executeDeviceTestMethodOnDeviceOwnerUser(String className, String testName)
            throws Exception {
        executeDeviceTestMethod(className, testName, mDeviceOwnerUserId,
                /* params= */ new HashMap<>());
    }

    private void configureNotificationListener() throws DeviceNotAvailableException {
        getDevice().executeShellCommand(""cmd notification allow_listener ""
                + ""com.android.cts.deviceandprofileowner/.NotificationListener"");
    }

    private void generateTestSecurityLogs() throws Exception {
        // Trigger security events of type TAG_ADB_SHELL_CMD.
        for (int i = 0; i < SECURITY_EVENTS_BATCH_SIZE; i++) {
            getDevice().executeShellCommand(""echo just_testing_"" + i);
        }
    }

    private int createSecondaryUserAsProfileOwner() throws Exception {
        final int userId = createUserAndWaitStart();
        installAppAsUser(INTENT_RECEIVER_APK, userId);
        installAppAsUser(DEVICE_ADMIN_APK, userId);
        // For headless system user mode, PO is set on any secondary user created
        if (!isHeadlessSystemUserMode()) {
            setProfileOwnerOrFail(DEVICE_ADMIN_COMPONENT_FLATTENED, userId);
        }
        return userId;
    }

    private void switchToUser(int userId) throws Exception {
        switchUser(userId);
        waitForBroadcastIdle();
        wakeupAndDismissKeyguard();
    }

    private void setUserAsAffiliatedUserToPrimary(int userId) throws Exception {
        // Setting the same affiliation ids on both users
        runDeviceTestsAsUser(
                DEVICE_ADMIN_PKG, "".AffiliationTest"", ""testSetAffiliationId1"", mPrimaryUserId);
        runDeviceTestsAsUser(
                DEVICE_ADMIN_PKG, "".AffiliationTest"", ""testSetAffiliationId1"", userId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testSecurityLoggingDelegate"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"public void testSecurityLoggingDelegate() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mDeviceOwnerUserId);
        try {
            // Test that the delegate cannot access the logs already
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".SecurityLoggingDelegateTest"",
                    ""testCannotAccessApis"", mDeviceOwnerUserId);

            // Set security logging delegate
            executeDeviceTestMethodOnDeviceOwnerUser("".SecurityLoggingTest"",
                    ""testSetDelegateScope_delegationSecurityLogging"");

            runSecurityLoggingTests(DELEGATE_APP_PKG, "".SecurityLoggingDelegateTest"");
        } finally {
            // Remove security logging delegate
            executeDeviceTestMethodOnDeviceOwnerUser("".SecurityLoggingTest"",
                    ""testSetDelegateScope_noDelegation"");
        }
    }

    /**
     * Test for {@link DevicePolicyManager.setStorageEncryption} and
     * {@link DevicePolicyManager.getStorageEncryption}.
     *
     * <p>This test needs to run as as the device owner user ID since
     * {@link DevicePolicyManager#setStorageEncryption(ComponentName, boolean)}
     * is only allowed for system user.
     */
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"isHeadlessSystemUserMode"	"CtsDevicePolicyManagerTestCases"	"1: app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.metrics.DevicePolicyEventLogVerifier.assertMetricsLogged;

import static org.junit.Assert.fail;

import android.platform.test.annotations.FlakyTest;
import android.platform.test.annotations.LargeTest;
import android.stats.devicepolicy.EventId;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.IgnoreOnHeadlessSystemUserMode;
import com.android.cts.devicepolicy.metrics.DevicePolicyEventWrapper;
import com.android.tradefed.device.DeviceNotAvailableException;
import com.android.tradefed.log.LogUtil.CLog;

import com.google.common.collect.ImmutableMap;

import org.junit.Ignore;
import org.junit.Test;

import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Set of tests for device owner use cases that also apply to profile owners.
 * Tests that should be run identically in both cases are added in DeviceAndProfileOwnerTest.
 */
public final class MixedDeviceOwnerTest extends DeviceAndProfileOwnerTest {

    private static final String DELEGATION_NETWORK_LOGGING = ""delegation-network-logging"";
    private static final String LOG_TAG_DEVICE_OWNER = ""device-owner"";

    private static final String ARG_SECURITY_LOGGING_BATCH_NUMBER = ""batchNumber"";
    private static final int SECURITY_EVENTS_BATCH_SIZE = 100;

    private boolean mDeviceOwnerSet;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        mUserId = mPrimaryUserId;

        CLog.i(""%s.setUp(): mUserId=%d, mPrimaryUserId=%d, mInitialUserId=%d, ""
                + ""mDeviceOwnerUserId=%d"", getClass(), mUserId, mPrimaryUserId, mInitialUserId,
                mDeviceOwnerUserId);

        installDeviceOwnerApp(DEVICE_ADMIN_APK);
        mDeviceOwnerSet = setDeviceOwner(DEVICE_ADMIN_COMPONENT_FLATTENED, mDeviceOwnerUserId,
                /*expectFailure= */ false);

        if (!mDeviceOwnerSet) {
            removeDeviceOwnerAdmin(DEVICE_ADMIN_COMPONENT_FLATTENED);
            getDevice().uninstallPackage(DEVICE_ADMIN_PKG);
            fail(""Failed to set device owner on user "" + mDeviceOwnerUserId);
        }
        if (isHeadlessSystemUserMode()) {
            affiliateUsers(DEVICE_ADMIN_PKG, mDeviceOwnerUserId, mPrimaryUserId);
        }
    }

    @Override
    public void tearDown() throws Exception {
        if (mDeviceOwnerSet) {
            removeDeviceOwnerAdmin(DEVICE_ADMIN_COMPONENT_FLATTENED);
        }

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testApplicationRestrictions"	"CtsDevicePolicyManagerTestCases"	"1: app"	"@IgnoreOnHeadlessSystemUserMode(
            reason = ""Per-user application restriction is not applicable for headless user"")
    public void testApplicationRestrictions() throws Exception {
        super.testApplicationRestrictions();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedDeviceOwnerTest"	"testLocationPermissionGrantNotifies"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testLocationPermissionGrantNotifies() throws Exception {
        installAppPermissionAppAsUser();
        configureNotificationListener();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateGranted_userNotifiedOfLocationPermission"");
    }

    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CustomDeviceOwnerTest"	"testIsProvisioningAllowed"	"CtsDevicePolicyManagerTestCases"	"2: only app"	"public void testIsProvisioningAllowed() throws Exception {
        // Must install the apk since the test runs in the DO apk.
        installAppAsUser(DEVICE_OWNER_APK, mDeviceOwnerUserId);
        try {
            // When CTS runs, setupwizard is complete. Expects it has to return false as DO can
            // only be provisioned before setupwizard is completed.

            runDeviceTestsAsUser(DEVICE_OWNER_PKG, "".PreDeviceOwnerTest"",
                    ""testIsProvisioningAllowedFalse"", mDeviceOwnerUserId);
        } finally {
            getDevice().uninstallPackage(DEVICE_OWNER_PKG);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CustomDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CustomDeviceOwnerTest"	"testOwnerChangedBroadcast"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testOwnerChangedBroadcast() throws Exception {
        installAppAsUser(DEVICE_OWNER_APK, mDeviceOwnerUserId);
        try {
            installAppAsUser(INTENT_RECEIVER_APK, mDeviceOwnerUserId);

            String testClass = INTENT_RECEIVER_PKG + "".OwnerChangedBroadcastTest"";

            // Running this test also gets the intent receiver app out of the stopped state, so it
            // can receive broadcast intents.
            runDeviceTestsAsUser(INTENT_RECEIVER_PKG, testClass,
                    ""testOwnerChangedBroadcastNotReceived"", mDeviceOwnerUserId);

            // Setting the device owner should send the owner changed broadcast.
            assertTrue(setDeviceOwner(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId,
                    /*expectFailure*/ false));

            // Wait broadcast idle to ensure the owner changed broadcast has been sent.
            waitForBroadcastIdle();

            runDeviceTestsAsUser(INTENT_RECEIVER_PKG, testClass,
                    ""testOwnerChangedBroadcastReceived"", mDeviceOwnerUserId);
        } finally {
            getDevice().uninstallPackage(INTENT_RECEIVER_PKG);
            assertTrue(""Failed to remove device owner."",
                    removeAdmin(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId));
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CustomDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CustomDeviceOwnerTest"	"testCannotSetDeviceOwnerWhenSecondaryUserPresent"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotSetDeviceOwnerWhenSecondaryUserPresent() throws Exception {
        assumeSupportsMultiUser();
        int userId = -1;
        installAppAsUser(DEVICE_OWNER_APK, mDeviceOwnerUserId);
        try {
            userId = createUser();
            assertFalse(setDeviceOwner(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId,
                    /*expectFailure*/ true));
        } finally {
            removeUser(userId);
            // make sure we clean up in case we succeeded in setting the device owner
            removeAdmin(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId);
        }
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CustomDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CustomDeviceOwnerTest"	"testCannotSetDeviceOwnerWhenAccountPresent"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCannotSetDeviceOwnerWhenAccountPresent() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mPrimaryUserId);
        installAppAsUser(DEVICE_OWNER_APK, mDeviceOwnerUserId);
        try {
            runDeviceTestsAsUser(ACCOUNT_MANAGEMENT_PKG, "".AccountUtilsTest"",
                    ""testAddAccountExplicitly"", mPrimaryUserId);
            assertFalse(setDeviceOwner(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId,
                    /*expectFailure*/ true));
        } finally {
            // make sure we clean up in case we succeeded in setting the device owner
            removeAdmin(DEVICE_OWNER_ADMIN_COMPONENT, mDeviceOwnerUserId);
            runDeviceTestsAsUser(ACCOUNT_MANAGEMENT_PKG, "".AccountUtilsTest"",
                    ""testRemoveAccountExplicitly"", mPrimaryUserId);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CustomDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"uninstallTestApps"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps live app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static org.junit.Assume.assumeTrue;

import android.platform.test.annotations.FlakyTest;

import org.junit.Test;

import java.util.Collections;

/**
 * Set of tests for LauncherApps with managed profiles.
 */
public class LauncherAppsSingleUserTest extends BaseLauncherAppsTest {

    private final static String FEATURE_INCREMENTAL_DELIVERY =
            ""android.software.incremental_delivery"";
    private boolean mHasLauncherApps;
    private String mSerialNumber;
    private int mCurrentUserId;

    @Override
    public void setUp() throws Exception {
        super.setUp();
        mHasLauncherApps = getDevice().getApiLevel() >= 21;

        if (mHasLauncherApps) {
            mCurrentUserId = getDevice().getCurrentUser();
            mSerialNumber = Integer.toString(getUserSerialNumber(mCurrentUserId));
            uninstallTestApps();
            installTestApps(mCurrentUserId);
        }
    }

    @Override
    public void tearDown() throws Exception {
        if (mHasLauncherApps) {
            uninstallTestApps();
        }
        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testInstallAppMainUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testInstallAppMainUser() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testSimpleAppInstalledForUser"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }

    //TODO(b/171574935): make sure to migrate this to the new test infra"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testInstallAppMainUserIncremental"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps live app"	"public void testInstallAppMainUserIncremental() throws Exception {
        assumeTrue(""true\n"".equals(getDevice().executeShellCommand(
                ""pm has-feature android.software.incremental_delivery"")));
        if (!mHasLauncherApps) {
            return;
        }
        installAppIncremental(SIMPLE_APP_APK);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testSimpleAppInstalledForUser"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLauncherCallbackPackageAddedMainUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLauncherCallbackPackageAddedMainUser() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        startCallbackService(mCurrentUserId);
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);

        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageAddedCallbackForUser"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLauncherCallbackPackageRemovedMainUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLauncherCallbackPackageRemovedMainUser() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        startCallbackService(mCurrentUserId);
        getDevice().uninstallPackage(SIMPLE_APP_PKG);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageRemovedCallbackForUser"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLauncherCallbackPackageChangedMainUser"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLauncherCallbackPackageChangedMainUser() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        startCallbackService(mCurrentUserId);
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS,
                ""testPackageChangedCallbackForUser"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLauncherNonExportedAppFails"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLauncherNonExportedAppFails() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testLaunchNonExportActivityFails"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLaunchNonExportActivityFails"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLaunchNonExportActivityFails() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testLaunchNonExportLauncherFails"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.LauncherAppsSingleUserTest"	"testLaunchMainActivity"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testLaunchMainActivity() throws Exception {
        if (!mHasLauncherApps) {
            return;
        }
        installAppAsUser(SIMPLE_APP_APK, mCurrentUserId);
        runDeviceTestsAsUser(LAUNCHER_TESTS_PKG,
                LAUNCHER_TESTS_CLASS, ""testLaunchMainActivity"",
                mCurrentUserId, Collections.singletonMap(PARAM_TEST_USER, mSerialNumber));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/LauncherAppsSingleUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_layering_profileOwnerNoLeaking"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps only app"	"public void testUserRestrictions_layering_profileOwnerNoLeaking() throws Exception {
        assumeSupportsMultiUser();

        // Set PO on user 0
        setPoAsUser(mDeviceOwnerUserId);

        // Create another user and set PO.
        final int secondaryUserId = createUser();
        setPoAsUser(secondaryUserId);

        // Let user-0 PO sets all restrictions.
        runTests(""userrestrictions.PrimaryProfileOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", mDeviceOwnerUserId);

        // Secondary users shouldn't see any of them. Leaky user restrictions are excluded.
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testDefaultAndLeakyRestrictions"", secondaryUserId);
    }

    /**
     * DO sets profile global restrictions (only ENSURE_VERIFY_APPS), should affect all
     * users (not a particularly special case but to be sure).
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_profileGlobalRestrictionsAsDo"	"CtsDevicePolicyManagerTestCases"	"5: app(s) apps UI only app"	"public void testUserRestrictions_profileGlobalRestrictionsAsDo() throws Exception {
        assumeSupportsMultiUser();
        setDo();
        final int secondaryUserId;
        if (!isHeadlessSystemUserMode()) {
            // Create another user and set PO.
            secondaryUserId = createUserAndWaitStart();
            setPoAsUser(secondaryUserId);
        } else {
            // In headless system user mode, PO is set on primary user when DO is set.
            secondaryUserId = mPrimaryUserId;
        }

        final int[] usersToCheck = {mDeviceOwnerUserId, secondaryUserId};

        // Do sets the restriction.
        setAndCheckProfileGlobalRestriction(mDeviceOwnerUserId, usersToCheck);
    }

    /**
     * Managed profile owner sets profile global restrictions (only ENSURE_VERIFY_APPS), should
     * affect all users.
     */
    @RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"isHeadlessSystemUserMode"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *.
 */
package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import static org.junit.Assert.assertTrue;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.tradefed.device.DeviceNotAvailableException;
import com.android.tradefed.log.LogUtil.CLog;

import org.junit.Test;

import javax.annotation.Nonnull;
import javax.annotation.Nullable;

public class UserRestrictionsTest extends BaseDevicePolicyTest {
    private static final String DEVICE_ADMIN_PKG = ""com.android.cts.deviceandprofileowner"";
    private static final String DEVICE_ADMIN_APK = ""CtsDeviceAndProfileOwnerApp.apk"";
    private static final String ADMIN_RECEIVER_TEST_CLASS
            = "".BaseDeviceAdminTest$BasicAdminReceiver"";

    private static final String GLOBAL_RESTRICTIONS_TEST_CLASS =
            ""userrestrictions.ProfileGlobalRestrictionsTest"";
    private static final String SET_GLOBAL_RESTRICTIONS_TEST =
            ""testSetProfileGlobalRestrictions"";
    private static final String CLEAR_GLOBAL_RESTRICTIONS_TEST =
            ""testClearProfileGlobalRestrictions"";
    private static final String ENSURE_GLOBAL_RESTRICTIONS_TEST =
            ""testProfileGlobalRestrictionsEnforced"";
    private static final String ENSURE_NO_GLOBAL_RESTRICTIONS_TEST =
            ""testProfileGlobalRestrictionsNotEnforced"";

    private boolean mRemoveOwnerInTearDown;
    private int mDeviceOwnerUserId;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        mRemoveOwnerInTearDown = false;
    }

    @Override
    public void tearDown() throws Exception {
        if (mRemoveOwnerInTearDown) {
            String componentName = DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS;
            assertTrue(""Failed to clear owner"", removeAdmin(componentName, mDeviceOwnerUserId));
            runTests(""userrestrictions.CheckNoOwnerRestrictionsTest"", mDeviceOwnerUserId);
            if (isHeadlessSystemUserMode()) {
                boolean removed = removeAdmin(componentName, mPrimaryUserId);
                if (!removed) {
                    CLog.e(""Failed to remove %s on user %d"", componentName, mPrimaryUserId);
                }
            }
        }

        // DO/PO might have set DISALLOW_REMOVE_USER, so it needs to be done after removing
        // them.
        removeTestUsers();
        getDevice().uninstallPackage(DEVICE_ADMIN_PKG);

        super.tearDown();
    }

    private void runTests(@Nonnull String className,
            @Nullable String method, int userId) throws DeviceNotAvailableException {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, ""."" + className, method, userId);
    }

    private void runTests(@Nonnull String className, int userId)
            throws DeviceNotAvailableException {
        runTests(className, null, userId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_secondaryProfileOwnerOnly"	"CtsDevicePolicyManagerTestCases"	"2: UI only"	"public void testUserRestrictions_secondaryProfileOwnerOnly() throws Exception {
        assumeSupportsMultiUser();

        final int secondaryUserId = createUser();
        setPoAsUser(secondaryUserId);

        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testDefaultRestrictions"", secondaryUserId);
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", secondaryUserId);
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testBroadcast"", secondaryUserId);
    }

    // Checks restrictions for managed profile.
    @RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_deviceOwnerOnly"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testUserRestrictions_deviceOwnerOnly() throws Exception {
        setDo();

        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testDefaultRestrictions"", mDeviceOwnerUserId);
        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", mDeviceOwnerUserId);
        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testBroadcast"", mDeviceOwnerUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_primaryProfileOwnerOnly"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testUserRestrictions_primaryProfileOwnerOnly() throws Exception {
        setPoAsUser(mDeviceOwnerUserId);

        runTests(""userrestrictions.PrimaryProfileOwnerUserRestrictionsTest"",
                ""testDefaultRestrictions"", mDeviceOwnerUserId);
        runTests(""userrestrictions.PrimaryProfileOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", mDeviceOwnerUserId);
        runTests(""userrestrictions.PrimaryProfileOwnerUserRestrictionsTest"",
                ""testBroadcast"", mDeviceOwnerUserId);
    }

    // Checks restrictions for managed user (NOT managed profile)."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_managedProfileOwnerOnly"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testUserRestrictions_managedProfileOwnerOnly() throws Exception {
        assumeCanCreateOneManagedUser();

        // Create managed profile.
        final int profileUserId = createManagedProfile(mDeviceOwnerUserId /* parentUserId */);
        // createManagedProfile doesn't start the user automatically.
        startUser(profileUserId);
        setPoAsUser(profileUserId);

        runTests(""userrestrictions.ManagedProfileOwnerUserRestrictionsTest"",
                ""testDefaultRestrictions"", profileUserId);
        runTests(""userrestrictions.ManagedProfileOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", profileUserId);
        runTests(""userrestrictions.ManagedProfileOwnerUserRestrictionsTest"",
                ""testBroadcast"", profileUserId);
    }

    /**
     * DO + PO combination.  Make sure global DO restrictions are visible on secondary users.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_layering"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testUserRestrictions_layering() throws Exception {
        assumeSupportsMultiUser();
        setDo();

        final int secondaryUserId;
        if (!isHeadlessSystemUserMode()) {
            // Create another user and set PO.
            secondaryUserId = createUserAndWaitStart();
            setPoAsUser(secondaryUserId);
        } else {
            // In headless system user mode, PO is set on primary user when DO is set
            secondaryUserId = mPrimaryUserId;
        }

        // Ensure that UserManager differentiates its own restrictions from DO restrictions.
        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testHasBaseUserRestrictions"", mDeviceOwnerUserId);

        // Let DO set all restrictions.
        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", mDeviceOwnerUserId);

        // Make sure the global restrictions are visible to secondary users.
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testHasGlobalRestrictions"", secondaryUserId);

        // Then let PO set all restrictions.
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testSetAllRestrictions"", secondaryUserId);

        // Make sure both local and global restrictions are visible on secondary users.
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testHasBothGlobalAndLocalRestrictions"", secondaryUserId);

        // Let DO clear all restrictions.
        runTests(""userrestrictions.DeviceOwnerUserRestrictionsTest"",
                ""testClearAllRestrictions"", mDeviceOwnerUserId);

        // Now only PO restrictions should be set on the secondary user.
        runTests(""userrestrictions.SecondaryProfileOwnerUserRestrictionsTest"",
                ""testLocalRestrictionsOnly"", secondaryUserId);
    }

    /**
     * PO on user-0.  It can set DO restrictions too, but they shouldn't leak to other users.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.UserRestrictionsTest"	"testUserRestrictions_ProfileGlobalRestrictionsAsPo"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testUserRestrictions_ProfileGlobalRestrictionsAsPo() throws Exception {
        assumeCanCreateOneManagedUser();

        // Set PO on user 0
        setPoAsUser(mDeviceOwnerUserId);

        // Create another user with PO.
        final int secondaryUserId = createManagedProfile(mDeviceOwnerUserId /* parentUserId */);
        setPoAsUser(secondaryUserId);

        final int[] usersToCheck = {mDeviceOwnerUserId, secondaryUserId};

        // Check the case when primary user's PO sets the restriction.
        setAndCheckProfileGlobalRestriction(mDeviceOwnerUserId, usersToCheck);

        // Check the case when managed profile owner sets the restriction.
        setAndCheckProfileGlobalRestriction(secondaryUserId, usersToCheck);
    }

    /** Installs admin package and makes it a profile owner for a given user. */
    private void setPoAsUser(int userId) throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, /* grantPermssions= */true,
                /* dontKillApp= */ true, userId);
        assertTrue(""Failed to set profile owner"",
                setProfileOwner(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                        userId, /* expectFailure */ false));
        // If PO is not in primary user, it will be removed with the user.
        if (userId == mDeviceOwnerUserId) {
            mRemoveOwnerInTearDown = true;
        }
    }

    /** Installs admin package and makes it a device owner. */
    private void setDo() throws Exception {
        installDeviceOwnerApp(DEVICE_ADMIN_APK);

        assertTrue(""Failed to set device owner"",
                setDeviceOwner(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                        mDeviceOwnerUserId, /*expectFailure*/ false));
        mRemoveOwnerInTearDown = true;

        if (isHeadlessSystemUserMode()) {
            affiliateUsers(DEVICE_ADMIN_PKG, mDeviceOwnerUserId, mPrimaryUserId);
        }
    }

    /**
     * Sets user restriction and checks that it applies to all users.
     * @param enforcingUserId user who should set/clear the restriction, should be either
     *        primary or secondary user id and should have device or profile owner active.
     * @param usersToCheck users that should have this restriction enforced.
     */
    private void setAndCheckProfileGlobalRestriction(int enforcingUserId, int usersToCheck[])
            throws Exception {
        // Always try to clear the restriction to avoid undesirable side effects.
        try {
            // Set the restriction.
            runGlobalRestrictionsTest(SET_GLOBAL_RESTRICTIONS_TEST, enforcingUserId);
            // Check that the restriction is in power.
            for (int userId : usersToCheck) {
                runGlobalRestrictionsTest(ENSURE_GLOBAL_RESTRICTIONS_TEST, userId);
            }
        } finally {
            // Clear the restriction.
            runGlobalRestrictionsTest(CLEAR_GLOBAL_RESTRICTIONS_TEST, enforcingUserId);
            // Check that the restriction is not in power anymore.
            for (int userId : usersToCheck) {
                runGlobalRestrictionsTest(ENSURE_NO_GLOBAL_RESTRICTIONS_TEST, userId);
            }
        }
    }

    /** Convenience method to run global user restrictions tests. */
    private void runGlobalRestrictionsTest(String testMethodName, int userId) throws Exception {
        runTests(GLOBAL_RESTRICTIONS_TEST_CLASS, testMethodName, userId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/UserRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.BaseDeviceAdminServiceTest"	"testAll"	"CtsDevicePolicyManagerTestCases"	"3: data only app"	"public void testAll() throws Throwable {
        // Install
        CLog.i(""Installing apk1 (%s)..."", OWNER_APK_1);
        installOwnerApp(OWNER_APK_1);

        CLog.i(""Making it (%s) a device/profile owner..."", OWNER_COMPONENT);
        setAsOwnerOrFail(OWNER_COMPONENT);

        withRetry(() -> assertServiceBound(OWNER_SERVICE));

        // Remove admin.
        CLog.i(""Removing admin..."");
        removeAdmin(OWNER_COMPONENT);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));

        // Overwrite -> update.
        CLog.i(""Re-installing apk1..."");
        installOwnerApp(OWNER_APK_1);

        CLog.i(""Making it a device/profile owner..."");
        setAsOwnerOrFail(OWNER_COMPONENT);
        withRetry(() -> assertServiceBound(OWNER_SERVICE));

        CLog.i(""Installing apk2 (%s)..."", OWNER_APK_2);
        installOwnerApp(OWNER_APK_2);
        withRetry(() -> assertServiceBound(OWNER_SERVICE)); // Should still be bound.

        // Service exported -> not bound.
        CLog.i(""Installing apk3 (%s)..."", OWNER_APK_3);
        installOwnerApp(OWNER_APK_3);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));

        // Recover.
        CLog.i(""Installing apk2 again..."");
        installOwnerApp(OWNER_APK_2);
        withRetry(() -> assertServiceBound(OWNER_SERVICE));

        // Multiple service found -> not bound.
        CLog.i(""Installing apk4 (%s)..."", OWNER_APK_4);
        installOwnerApp(OWNER_APK_4);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE2));

        // Disable service1 -> now there's only one service, so should be bound.
        CLog.i(""Running testDisableService1..."");
        executeDeviceTestMethod("".ComponentController"", ""testDisableService1"");
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));
        withRetry(() -> assertServiceBound(OWNER_SERVICE2));

        CLog.i(""Running testDisableService2..."");
        executeDeviceTestMethod("".ComponentController"", ""testDisableService2"");
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE2));

        CLog.i(""Running testEnableService1..."");
        executeDeviceTestMethod("".ComponentController"", ""testEnableService1"");
        withRetry(() -> assertServiceBound(OWNER_SERVICE));
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE2));

        CLog.i(""Running testEnableService2..."");
        executeDeviceTestMethod("".ComponentController"", ""testEnableService2"");
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE2));

        // Remove admin.
        CLog.i(""Removing admin again..."");
        removeAdmin(OWNER_COMPONENT);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));

        // Retry with package 1 and remove admin.
        CLog.i(""Installing apk1 again..."");
        installOwnerApp(OWNER_APK_1);

        CLog.i(""Making it a device/profile owner again..."");
        setAsOwnerOrFail(OWNER_COMPONENT);
        withRetry(() -> assertServiceBound(OWNER_SERVICE));

        CLog.i(""Removing admin again..."");
        removeAdmin(OWNER_COMPONENT);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));

        // Now install package B and make it the owner.  OWNER_APK_1 still exists, but it shouldn't
        // interfere.
        CLog.i(""Installing apk B (%s)..."", OWNER_APK_B);
        installOwnerApp(OWNER_APK_B);

        CLog.i(""Making it a device/profile owner..."");
        setAsOwnerOrFail(OWNER_COMPONENT_B);
        withRetry(() -> assertServiceNotBound(OWNER_SERVICE));
        withRetry(() -> assertServiceBound(OWNER_SERVICE_B));
    }

    private String rumpDumpSysService(String component) throws Exception {
        final String command = ""dumpsys activity services "" + component;
        final String commandOutput = getDevice().executeShellCommand(command);
        CLog.d(""Output for command %s: \n%s"", command, commandOutput);
        return commandOutput;
    }

    private void assertServiceBound(String component) throws Exception {
        final String commandOutput = rumpDumpSysService(component);
        for (String line : commandOutput.split(""\r*\n"")) {
            if (line.contains(""ConnectionRecord"") && line.contains(component)) {
                return;
            }
        }
        fail(""Service "" + OWNER_SERVICE + "" not bound.  Output was:\n"" + commandOutput);
    }

    private void assertServiceNotBound(String component) throws Exception {
        final String commandOutput = rumpDumpSysService(component);
        for (String line : commandOutput.split(""\r*\n"")) {
            if (line.contains(""ConnectionRecord"") && line.contains(component)) {
                fail(""Service "" + OWNER_SERVICE + "" is bound.  Output was:\n"" + commandOutput);
            }
        }
    }

/* When the service is bound, ""dumpsys activity services"" shows something like this:
  * ServiceRecord{1525afe u0 com.android.cts.deviceadminservice/.MyService}
    intent={cmp=com.android.cts.deviceadminservice/.MyService}
    packageName=com.android.cts.deviceadminservice
    processName=com.android.cts.deviceadminservice
    baseDir=/data/app/com.android.cts.deviceadminservice-kXKTlCILmDfib2P76FI75A==/base.apk
    dataDir=/data/user/0/com.android.cts.deviceadminservice
    app=ProcessRecord{205d686 22751:com.android.cts.deviceadminservice/u0a143}
    createTime=-3s957ms startingBgTimeout=--
    lastActivity=-3s927ms restartTime=-3s927ms createdFromFg=true
    Bindings:
    * IntentBindRecord{57d5b47 CREATE}:
      intent={cmp=com.android.cts.deviceadminservice/.MyService}
      binder=android.os.BinderProxy@819af74
      requested=true received=true hasBound=true doRebind=false
      * Client AppBindRecord{e1d3c9d ProcessRecord{a8162c0 757:system/1000}}
        Per-process Connections:
          ConnectionRecord{10ab6b9 u0 CR FGS com.android.cts.deviceadminservice/.MyService:@51e9080}
    All Connections:
      ConnectionRecord{10ab6b9 u0 CR FGS com.android.cts.deviceadminservice/.MyService:@51e9080}

  * ConnectionRecord{10ab6b9 u0 CR FGS com.android.cts.deviceadminservice/.MyService:@51e9080}
    binding=AppBindRecord{e1d3c9d com.android.cts.deviceadminservice/.MyService:system}
    conn=android.app.LoadedApk$ServiceDispatcher$InnerConnection@51e9080 flags=0x4000001
 */
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/BaseDeviceAdminServiceTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"wakeupAndDismissKeyguard"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import static com.google.common.truth.Truth.assertThat;

import android.platform.test.annotations.LargeTest;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.tradefed.device.DeviceNotAvailableException;

import org.junit.Test;

import java.io.FileNotFoundException;
import java.util.HashMap;
import java.util.Map;

/**
 * CTS to verify toggling quiet mode in work profile by using
 * {@link android.os.UserManager#requestQuietModeEnabled(boolean, android.os.UserHandle)}.
 */
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class QuietModeHostsideTest extends BaseDevicePolicyTest {
    private static final String TEST_PACKAGE = ""com.android.cts.launchertests"";
    private static final String TEST_CLASS = "".QuietModeTest"";
    private static final String PARAM_TARGET_USER = ""TARGET_USER"";
    private static final String PARAM_ORIGINAL_DEFAULT_LAUNCHER = ""ORIGINAL_DEFAULT_LAUNCHER"";
    private static final String TEST_APK = ""CtsLauncherAppsTests.apk"";

    private static final String TEST_LAUNCHER_PACKAGE = ""com.android.cts.launchertests.support"";
    private static final String TEST_LAUNCHER_APK = ""CtsLauncherAppsTestsSupport.apk"";
    private static final String ENABLED_TEST_APK = ""CtsCrossProfileEnabledApp.apk"";
    private static final String USER_ENABLED_TEST_APK = ""CtsCrossProfileUserEnabledApp.apk"";
    private static final String ENABLED_NO_PERMS_TEST_APK = ""CtsCrossProfileEnabledNoPermsApp.apk"";
    private static final String QUIET_MODE_ENABLED_TEST_APK = ""CtsModifyQuietModeEnabledApp.apk"";
    private static final String NOT_ENABLED_TEST_APK = ""CtsCrossProfileNotEnabledApp.apk"";
    private static final String ENABLED_TEST_PACKAGE = ""com.android.cts.crossprofileenabledapp"";
    private static final String USER_ENABLED_TEST_PACKAGE =
            ""com.android.cts.crossprofileuserenabledapp"";
    private static final String ENABLED_NO_PERMS_TEST_PACKAGE =
            ""com.android.cts.crossprofileenablednopermsapp"";
    private static final String NOT_ENABLED_TEST_PACKAGE =
            ""com.android.cts.crossprofilenotenabledapp"";
    private static final String QUIET_MODE_ENABLED_TEST_PACKAGE =
            ""com.android.cts.modifyquietmodeenabledapp"";

    private int mProfileId;
    private String mOriginalLauncher;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        mOriginalLauncher = getDefaultLauncher();

        installAppAsUser(TEST_APK, mPrimaryUserId);
        installAppAsUser(TEST_LAUNCHER_APK, mPrimaryUserId);

        waitForBroadcastIdle();

        createAndStartManagedProfile();
        installAppAsUser(TEST_APK, mProfileId);

        waitForBroadcastIdle();
        wakeupAndDismissKeyguard();
    }

    @Override
    public void tearDown() throws Exception {
        uninstallRequiredApps();
        getDevice().uninstallPackage(TEST_LAUNCHER_PACKAGE);

        super.tearDown();
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testBroadcastManagedProfileAvailable_withoutCrossProfileAppsOp"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testBroadcastManagedProfileAvailable_withoutCrossProfileAppsOp() throws Exception {
        checkBroadcastManagedProfileAvailable(/* withCrossProfileAppOps= */ false);
    }


    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testBroadcastManagedProfileAvailable_withCrossProfileAppsOp"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testBroadcastManagedProfileAvailable_withCrossProfileAppsOp() throws Exception {
        checkBroadcastManagedProfileAvailable(/* withCrossProfileAppOps= */ true);
    }

    private void checkBroadcastManagedProfileAvailable(boolean withCrossProfileAppOps)
            throws Exception {
        installCrossProfileApps();
        if (withCrossProfileAppOps) {
            enableCrossProfileAppsOp();
        }
        clearLogcat();
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                TEST_CLASS,
                ""testTryEnableQuietMode"",
                mPrimaryUserId,
                createParams(mProfileId));
        // In case of a necessary log is not captured
        // cause of too many logs while waiting idle broadcast, capture log previously.
        // This log will be concatenated.
        String log = getDevice().executeAdbCommand(""logcat"", ""-d"");
        waitForBroadcastIdle();
        verifyBroadcastSent(""android.intent.action.MANAGED_PROFILE_UNAVAILABLE"",
                /* needPermissions= */ !withCrossProfileAppOps, log);

        clearLogcat();
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                TEST_CLASS,
                ""testTryDisableQuietMode"",
                mPrimaryUserId,
                createParams(mProfileId));
        log = getDevice().executeAdbCommand(""logcat"", ""-d"");
        waitForBroadcastIdle();
        verifyBroadcastSent(""android.intent.action.MANAGED_PROFILE_AVAILABLE"",
                /* needPermissions= */ !withCrossProfileAppOps, log);

        clearLogcat();
        removeUser(mProfileId);
        log = getDevice().executeAdbCommand(""logcat"", ""-d"");
        waitForBroadcastIdle();
        verifyBroadcastSent(""android.intent.action.MANAGED_PROFILE_REMOVED"",
                /* needPermissions= */ false, log);
    }

    private void clearLogcat() throws DeviceNotAvailableException {
        getDevice().executeAdbCommand(""logcat"", ""-c"");
        getDevice().executeAdbCommand(""logcat"", ""-G"", ""16M"");
    }

    private void verifyBroadcastSent(String actionName, boolean needPermissions, String prevLog)
            throws DeviceNotAvailableException {
        String result = getDevice().executeAdbCommand(""logcat"", ""-d"");
        result = prevLog + result;
        assertThat(result).contains(
                buildReceivedBroadcastRegex(actionName, ""CrossProfileEnabledAppReceiver""));
        assertThat(result).contains(
                buildReceivedBroadcastRegex(actionName, ""CrossProfileUserEnabledAppReceiver""));
        String noPermsString = buildReceivedBroadcastRegex(actionName,
                ""CrossProfileEnabledNoPermsAppReceiver"");
        if (needPermissions) {
            assertThat(result).doesNotContain(noPermsString);
        } else {
            assertThat(result).contains(noPermsString);
        }
        assertThat(result).doesNotContain(
                buildReceivedBroadcastRegex(actionName,
                        ""CrossProfileNotEnabledAppReceiver""));
        assertThat(result).contains(
                buildReceivedBroadcastRegex(actionName, ""ModifyQuietModeEnabledAppReceiver""));
    }

    private String buildReceivedBroadcastRegex(String actionName, String className) {
        return String.format(""%s: onReceive(%s)"", className, actionName);
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testQuietMode_noCredentialRequest"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"public void testQuietMode_noCredentialRequest() throws Exception {
        assumeHasSecureLockScreenFeature();

        // Set a separate work challenge so turning on the profile requires entering the
        // separate challenge.
        changeUserCredential(/* newCredential= */ TEST_PASSWORD, /* oldCredential= */ null,
                mProfileId);
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                TEST_CLASS,
                ""testTryEnableQuietMode_noCredentialRequest"",
                mPrimaryUserId,
                createParams(mProfileId));
    }

    private void createAndStartManagedProfile() throws Exception {
        mProfileId = createManagedProfile(mPrimaryUserId);
        switchUser(mPrimaryUserId);
        startUser(mProfileId);
    }

    private void uninstallRequiredApps()
            throws DeviceNotAvailableException {
        getDevice().uninstallPackage(TEST_PACKAGE);
        getDevice().uninstallPackage(ENABLED_TEST_PACKAGE);
        getDevice().uninstallPackage(USER_ENABLED_TEST_PACKAGE);
        getDevice().uninstallPackage(ENABLED_NO_PERMS_TEST_PACKAGE);
        getDevice().uninstallPackage(NOT_ENABLED_TEST_PACKAGE);
        getDevice().uninstallPackage(QUIET_MODE_ENABLED_TEST_PACKAGE);
    }

    private void installCrossProfileApps()
            throws FileNotFoundException, DeviceNotAvailableException {
        installCrossProfileApp(ENABLED_TEST_APK, /* grantPermissions= */ true);
        installCrossProfileApp(USER_ENABLED_TEST_APK, /* grantPermissions= */ true);
        installCrossProfileApp(NOT_ENABLED_TEST_APK, /* grantPermissions= */ true);
        installCrossProfileApp(ENABLED_NO_PERMS_TEST_APK, /* grantPermissions= */  false);
        installCrossProfileApp(QUIET_MODE_ENABLED_TEST_APK, /* grantPermissions= */  true);
    }

    private void enableCrossProfileAppsOp() throws DeviceNotAvailableException {
        enableCrossProfileAppsOp(ENABLED_NO_PERMS_TEST_PACKAGE, mPrimaryUserId);
    }

    private void installCrossProfileApp(String apkName, boolean grantPermissions)
            throws FileNotFoundException, DeviceNotAvailableException {
        installAppAsUser(apkName, grantPermissions, mPrimaryUserId);
        installAppAsUser(apkName, grantPermissions, mProfileId);
    }

    private void enableCrossProfileAppsOp(String packageName, int userId)
            throws DeviceNotAvailableException {
        getDevice().executeShellCommand(
                String.format(""appops set --user %s %s android:interact_across_profiles 0"",
                        userId, packageName));
        assertThat(getDevice().executeShellCommand(
                String.format(""appops get --user %s %s android:interact_across_profiles"",
                        userId, packageName))).contains(""INTERACT_ACROSS_PROFILES: allow"");
    }

    private Map<String, String> createParams(int targetUserId) throws Exception {
        Map<String, String> params = new HashMap<>();
        params.put(PARAM_TARGET_USER, Integer.toString(getUserSerialNumber(targetUserId)));
        params.put(PARAM_ORIGINAL_DEFAULT_LAUNCHER, mOriginalLauncher);
        return params;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testQuietMode_defaultForegroundLauncher"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testQuietMode_defaultForegroundLauncher() throws Exception {
        assumeHasSecureLockScreenFeature();

        // Add a lockscreen to test the case that profile with unified challenge can still
        // be turned on without asking the user to enter the lockscreen password.
        changeUserCredential(/* newCredential= */ TEST_PASSWORD, /* oldCredential= */ null,
                mPrimaryUserId);
        try {
            runDeviceTestsAsUser(
                    TEST_PACKAGE,
                    TEST_CLASS,
                    ""testTryEnableQuietMode_defaultForegroundLauncher"",
                    mPrimaryUserId,
                    createParams(mProfileId));
        } finally {
            changeUserCredential(/* newCredential= */ null, /* oldCredential= */ TEST_PASSWORD,
                    mPrimaryUserId);
        }
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testQuietMode_notForegroundLauncher"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testQuietMode_notForegroundLauncher() throws Exception {
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                TEST_CLASS,
                ""testTryEnableQuietMode_notForegroundLauncher"",
                mPrimaryUserId,
                createParams(mProfileId));
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.QuietModeHostsideTest"	"testQuietMode_notDefaultLauncher"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testQuietMode_notDefaultLauncher() throws Exception {
        runDeviceTestsAsUser(
                TEST_PACKAGE,
                TEST_CLASS,
                ""testTryEnableQuietMode_notDefaultLauncher"",
                mPrimaryUserId,
                createParams(mProfileId));
    }

    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/QuietModeHostsideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"assumeTestEnabled"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;

import org.junit.Before;
import org.junit.Test;

import java.util.Collections;
import java.util.Map;

/**
 * Tests to verify
 * {@link android.content.pm.crossprofile.CrossProfileApps#canRequestInteractAcrossProfiles()},
 * {@link android.content.pm.crossprofile.CrossProfileApps#canInteractAcrossProfiles()}, and
 * {@link
 * android.content.pm.crossprofile.CrossProfileApps#createRequestInteractAcrossProfilesIntent()}.
 *
 * The rest of the tests for {@link android.content.pm.crossprofile.CrossProfileApps}
 * can be found in {@link CrossProfileAppsHostSideTest}.
 */
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class CrossProfileAppsPermissionHostSideTest extends BaseDevicePolicyTest {
    private static final String TEST_WITH_REQUESTED_PERMISSION_PACKAGE =
            ""com.android.cts.crossprofileappstest"";
    private static final String TEST_WITH_REQUESTED_PERMISSION_CLASS =
            "".CrossProfileAppsPermissionToInteractTest"";
    private static final String TEST_WITH_REQUESTED_PERMISSION_APK = ""CtsCrossProfileAppsTests.apk"";
    private static final String TEST_WITH_REQUESTED_PERMISSION_RECEIVER_TEST_CLASS =
            TEST_WITH_REQUESTED_PERMISSION_PACKAGE + "".AdminReceiver"";

    private static final String TEST_WITH_NO_REQUESTED_PERMISSION_PACKAGE =
            ""com.android.cts.crossprofilenopermissionappstest"";
    private static final String TEST_WITH_NO_REQUESTED_PERMISSION_CLASS =
            "".CrossProfileAppsWithNoPermission"";
    private static final String TEST_WITH_NO_REQUESTED_PERMISSION_APK =
            ""CtsCrossProfileAppsWithNoPermissionTests.apk"";

    private static final String MANAGED_PROFILE_PKG = ""com.android.cts.managedprofile"";
    private static final String MANAGED_PROFILE_APK = ""CtsManagedProfileApp.apk"";
    private static final String ADMIN_RECEIVER_TEST_CLASS =
            MANAGED_PROFILE_PKG + "".BaseManagedProfileTest$BasicAdminReceiver"";
    private static final String PARAM_CROSS_PROFILE_PACKAGE = ""crossProfilePackage"";

    private int mProfileId;

    @Override
    protected void assumeTestEnabled() throws Exception {
        assumeSupportsMultiUser();
    }

    @Before
    @Override
    public void setUp() throws Exception {
        super.setUp();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_fromPersonalProfile_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanRequestInteractAcrossProfiles_fromPersonalProfile_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_fromWorkProfile_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanRequestInteractAcrossProfiles_fromWorkProfile_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsTrue"",
                mProfileId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_packageNotAllowed_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanRequestInteractAcrossProfiles_packageNotAllowed_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_permissionNotRequested_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanRequestInteractAcrossProfiles_permissionNotRequested_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_NO_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_NO_REQUESTED_PERMISSION_APK);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_NO_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_NO_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_NO_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_permissionNotRequested_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withAppOpEnabled_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_withAppOpEnabled_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withAppOpEnabled_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withCrossProfilesPermission_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_withCrossProfilesPermission_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withCrossProfilesPermission_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withCrossUsersPermission_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_withCrossUsersPermission_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withCrossUsersPermission_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withCrossUsersFullPermission_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_withCrossUsersFullPermission_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withCrossUsersFullPermission_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_fromWorkProfile_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_fromWorkProfile_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withAppOpEnabled_returnsTrue"",
                mProfileId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withAppOpDisabled_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCanInteractAcrossProfiles_withAppOpDisabled_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withAppOpDisabled_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCreateRequestInteractAcrossProfilesIntent_canRequestInteraction_returnsIntent"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCreateRequestInteractAcrossProfilesIntent_canRequestInteraction_returnsIntent()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCreateRequestInteractAcrossProfilesIntent_canRequestInteraction_returnsIntent"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCreateRequestInteractAcrossProfilesIntent_fromWorkProfile_returnsIntent"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCreateRequestInteractAcrossProfilesIntent_fromWorkProfile_returnsIntent()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        addManagedProfileAndInstallRequiredPackages(TEST_WITH_REQUESTED_PERMISSION_APK);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCreateRequestInteractAcrossProfilesIntent_canRequestInteraction_returnsIntent"",
                mProfileId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCreateRequestInteractAcrossProfilesIntent_canNotRequestInteraction_throwsSecurityException"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCreateRequestInteractAcrossProfilesIntent_canNotRequestInteraction_throwsSecurityException()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCreateRequestInteractAcrossProfilesIntent_canNotRequestInteraction_throwsSecurityException"",
                mProfileId,
                Collections.EMPTY_MAP);
    }

    private void addManagedProfileAndInstallRequiredPackages(String testPackage) throws Exception {
        mProfileId = createManagedProfile(mPrimaryUserId);
        getDevice().startUser(mProfileId, /*waitFlag= */true);

        installAppAsUser(testPackage, mProfileId);

        installAppAsUser(MANAGED_PROFILE_APK, mProfileId);
        setProfileOwnerOrFail(MANAGED_PROFILE_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                mProfileId);
    }

    private void addDefaultCrossProfilePackage(int userId, String packageName)
            throws Exception {
        runDeviceTestsAsUser(
                MANAGED_PROFILE_PKG,
                "".CrossProfileUtils"",
                ""testSetCrossProfilePackages"",
                userId,
                createCrossProfilePackageParam(packageName));
    }

    private Map<String, String> createCrossProfilePackageParam(String packageName) {
        return Collections.singletonMap(PARAM_CROSS_PROFILE_PACKAGE, packageName);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_noOtherProfiles_ReturnsFalse"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanRequestInteractAcrossProfiles_noOtherProfiles_ReturnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_packageNotInstalled_returnsTrue"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanRequestInteractAcrossProfiles_packageNotInstalled_returnsTrue()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        mProfileId = createManagedProfile(mPrimaryUserId);
        getDevice().startUser(mProfileId, /*waitFlag= */true);
        installAppAsUser(MANAGED_PROFILE_APK, mProfileId);
        setProfileOwnerOrFail(MANAGED_PROFILE_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS,
                mProfileId);
        addDefaultCrossProfilePackage(mProfileId, TEST_WITH_REQUESTED_PERMISSION_PACKAGE);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsTrue"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanRequestInteractAcrossProfiles_profileOwner_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanRequestInteractAcrossProfiles_profileOwner_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);
        mProfileId = createManagedProfile(mPrimaryUserId);
        getDevice().startUser(mProfileId, /* waitFlag= */ true);
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mProfileId);
        final String receiverComponentName =
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE + ""/""
                        + TEST_WITH_REQUESTED_PERMISSION_RECEIVER_TEST_CLASS;
        setProfileOwnerOrFail(receiverComponentName, mProfileId);
        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testSetCrossProfilePackages_noAsserts"",
                mProfileId,
                createCrossProfilePackageParam(TEST_WITH_REQUESTED_PERMISSION_PACKAGE));

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanRequestInteractAcrossProfiles_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withNoOtherProfile_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanInteractAcrossProfiles_withNoOtherProfile_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withNoOtherProfile_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withAppOpDisabledOnCallingProfile_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanInteractAcrossProfiles_withAppOpDisabledOnCallingProfile_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withAppOpDisabledOnCallingProfile_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.CrossProfileAppsPermissionHostSideTest"	"testCanInteractAcrossProfiles_withAppOpDisabledOnOtherProfiles_returnsFalse"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testCanInteractAcrossProfiles_withAppOpDisabledOnOtherProfiles_returnsFalse()
            throws Exception {
        installAppAsUser(TEST_WITH_REQUESTED_PERMISSION_APK, mPrimaryUserId);

        runDeviceTestsAsUser(
                TEST_WITH_REQUESTED_PERMISSION_PACKAGE,
                TEST_WITH_REQUESTED_PERMISSION_CLASS,
                ""testCanInteractAcrossProfiles_withAppOpDisabledOnOtherProfiles_returnsFalse"",
                mPrimaryUserId,
                Collections.EMPTY_MAP);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/CrossProfileAppsPermissionHostSideTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfilePasswordTest"	"testActivePasswordSufficientForDeviceRequirement"	"CtsDevicePolicyManagerTestCases"	"2: data UI"	"public void testActivePasswordSufficientForDeviceRequirement() throws Exception {
        assumeHasSecureLockScreenFeature();

        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".ActivePasswordSufficientForDeviceTest"",
                mProfileUserId);
    }

    private void verifyUnifiedPassword(boolean unified) throws DeviceNotAvailableException {
        final String testMethod =
                unified ? ""testUsingUnifiedPassword"" : ""testNotUsingUnifiedPassword"";
        runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".IsUsingUnifiedPasswordTest"",
                testMethod, mProfileUserId);
    }

    private void lockProfile() throws Exception {
        final String cmd = ""am broadcast --receiver-foreground --user "" + mProfileUserId
                + "" -a com.android.cts.managedprofile.LOCK_PROFILE""
                + "" com.android.cts.managedprofile/.LockProfileReceiver"";
        getDevice().executeShellCommand(cmd);
        waitUntilProfileLocked();
    }

    private void waitUntilProfileLocked() throws Exception {
        final String cmd = String.format(""am get-started-user-state %d"", mProfileUserId);
        tryWaitForSuccess(
                () -> getDevice().executeShellCommand(cmd).startsWith(USER_STATE_LOCKED),
                ""The managed profile has not been locked after calling ""
                        + ""lockNow(FLAG_SECURE_USER_DATA)"",
                TIMEOUT_USER_LOCKED_MILLIS);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfilePasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfilePasswordTest"	"testCreateSeparateChallengeChangedLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testCreateSeparateChallengeChangedLogged() throws Exception {
        assumeHasSecureLockScreenFeature();

        assertMetricsLogged(getDevice(), () -> {
            changeUserCredential(
                    TEST_PASSWORD /* newCredential */, null /* oldCredential */, mProfileUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.SEPARATE_PROFILE_CHALLENGE_CHANGED_VALUE)
                .setBoolean(true)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfilePasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfilePasswordTest"	"testRebootDevice_unifiedPassword"	"CtsDevicePolicyManagerTestCases"	"2: being app"	"public void testRebootDevice_unifiedPassword() throws Exception {
        assumeHasSecureLockScreenFeature();

        // Waiting before rebooting prevents flakiness.
        waitForBroadcastIdle();
        changeUserCredential(TEST_PASSWORD, /* oldCredential= */ null, mPrimaryUserId);
        try {
            rebootAndWaitUntilReady();
            verifyUserCredential(TEST_PASSWORD, mPrimaryUserId);
            waitForUserUnlock(mProfileUserId);
            installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".BasicTest"", mProfileUserId);
        } finally {
            changeUserCredential(/* newCredential= */ null, TEST_PASSWORD, mPrimaryUserId);
            // Work-around for http://b/113866275 - password prompt being erroneously shown at the
            // end.
            pressPowerButton();
        }
    }

    @LargeTest
    @LockSettingsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfilePasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfilePasswordTest"	"testRebootDevice_separatePasswords"	"CtsDevicePolicyManagerTestCases"	"2: being app"	"public void testRebootDevice_separatePasswords() throws Exception {
        assumeHasSecureLockScreenFeature();

        // Waiting before rebooting prevents flakiness.
        waitForBroadcastIdle();
        final String profilePassword = ""profile"";
        final String primaryPassword = TEST_PASSWORD;
        int managedProfileUserId = getFirstManagedProfileUserId();
        changeUserCredential(
                profilePassword, /* oldCredential= */ null, managedProfileUserId);
        changeUserCredential(primaryPassword, /* oldCredential= */ null, mPrimaryUserId);
        try {
            rebootAndWaitUntilReady();
            verifyUserCredential(profilePassword, managedProfileUserId);
            verifyUserCredential(primaryPassword, mPrimaryUserId);
            installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".BasicTest"", mProfileUserId);
        } finally {
            changeUserCredential(
                    /* newCredential= */ null, profilePassword, managedProfileUserId);
            changeUserCredential(/* newCredential= */ null, primaryPassword, mPrimaryUserId);
            // Work-around for http://b/113866275 - password prompt being erroneously shown at the
            // end.
            pressPowerButton();
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfilePasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ManagedProfilePasswordTest"	"testUnlockWorkProfile_deviceWidePassword"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testUnlockWorkProfile_deviceWidePassword() throws Exception {
        assumeHasSecureLockScreenFeature();

        try {
            // Add a device password after the work profile has been created.
            changeUserCredential(TEST_PASSWORD, /* oldCredential= */ null, mPrimaryUserId);
            // Lock the profile with key eviction.
            lockProfile();
            // Turn on work profile, by unlocking the profile with the device password.
            verifyUserCredential(TEST_PASSWORD, mPrimaryUserId);

            // Verify profile user is running unlocked by running a basic test on the work profile.
            installAppAsUser(SIMPLE_APP_APK, mProfileUserId);
            runDeviceTestsAsUser(MANAGED_PROFILE_PKG, "".BasicTest"", mProfileUserId);
        } finally {
            // Clean up
            changeUserCredential(/* newCredential= */ null, TEST_PASSWORD, mPrimaryUserId);
        }
    }

    @FlakyTest
    @LargeTest
    @LockSettingsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ManagedProfilePasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.ProfileOwnerTest"	"testAppUsageObserver"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAppUsageObserver() throws Exception {
        executeProfileOwnerTest(""AppUsageObserverTest"");
    }

    // The backup service cannot be enabled if the backup feature is not supported.
    @RequiresAdditionalFeatures({FEATURE_BACKUP})"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/ProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetMeteredDataDisabledPackages"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testSetMeteredDataDisabledPackages() throws Exception {
        super.testSetMeteredDataDisabledPackages();
    }

    @Override
    @PermissionsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetKeyguardDisabledSecureCameraLogged"	"CtsDevicePolicyManagerTestCases"	"1: camera"	"@Override
    public void testSetKeyguardDisabledSecureCameraLogged() {
        // Managed profiles are not allowed to set keyguard disabled secure camera
    }

    @FlakyTest
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetAutoTimeEnabled"	"CtsDevicePolicyManagerTestCases"	"1: called"	"public void testSetAutoTimeEnabled() {
        // Managed profile owner cannot set auto time unless it is called by the profile owner of
        // an organization-owned managed profile.
    }

    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetAutoTimeZoneEnabled"	"CtsDevicePolicyManagerTestCases"	"1: called"	"public void testSetAutoTimeZoneEnabled() {
        // Managed profile owner cannot set auto time zone unless it is called by the profile
        // owner of an organization-owned managed profile.
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testDelegatedCertInstallerDeviceIdAttestation"	"CtsDevicePolicyManagerTestCases"	"1: live"	"public void testDelegatedCertInstallerDeviceIdAttestation() throws Exception {
        setUpDelegatedCertInstallerAndRunTests(() -> {
            runDeviceTestsAsUser(""com.android.cts.certinstaller"",
                    "".DelegatedDeviceIdAttestationTest"",
                    ""testGenerateKeyPairWithDeviceIdAttestationExpectingFailure"", mUserId);
            // Positive test case lives in
            // OrgOwnedProfileOwnerTest#testDelegatedCertInstallerDeviceIdAttestation
        });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testDeviceIdAttestationForProfileOwner"	"CtsDevicePolicyManagerTestCases"	"1: live"	"public void testDeviceIdAttestationForProfileOwner() throws Exception {
        // Test that Device ID attestation for the profile owner does not work without grant.
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DeviceIdAttestationTest"",
                ""testFailsWithoutProfileOwnerIdsGrant"", mUserId);
        // Positive test case lives in
        // OrgOwnedProfileOwnerTest#testDeviceIdAttestationForProfileOwner
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import android.platform.test.annotations.FlakyTest;
import android.platform.test.annotations.LargeTest;
import android.stats.devicepolicy.EventId;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;
import com.android.cts.devicepolicy.annotations.LockSettingsTest;
import com.android.cts.devicepolicy.annotations.PermissionsTest;
import com.android.cts.devicepolicy.metrics.DevicePolicyEventLogVerifier;
import com.android.cts.devicepolicy.metrics.DevicePolicyEventWrapper;
import com.android.tradefed.device.DeviceNotAvailableException;

import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

/**
 * Set of tests for managed profile owner use cases that also apply to device owners.
 * Tests that should be run identically in both cases are added in DeviceAndProfileOwnerTest.
 */
// We need managed users to be supported in order to create a profile of the user owner.
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class MixedManagedProfileOwnerTest extends DeviceAndProfileOwnerTest {

    private static final String CLEAR_PROFILE_OWNER_NEGATIVE_TEST_CLASS =
            DEVICE_ADMIN_PKG + "".ClearProfileOwnerNegativeTest"";

    private static final String DELEGATION_NETWORK_LOGGING = ""delegation-network-logging"";

    private int mParentUserId = -1;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        mParentUserId = mPrimaryUserId;
        createManagedProfile();
    }

    private void createManagedProfile() throws Exception {
        mUserId = createManagedProfile(mParentUserId);
        switchUser(mParentUserId);
        startUserAndWait(mUserId);

        installAppAsUser(DEVICE_ADMIN_APK, mUserId);
        setProfileOwnerOrFail(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mUserId);
        startUserAndWait(mUserId);
    }

    @Override
    public void tearDown() throws Exception {
        removeUser(mUserId);

        super.tearDown();
    }

    // Most tests for this class are defined in DeviceAndProfileOwnerTest

    /**
     * Verify that screenshots are still possible for activities in the primary user when the policy
     * is set on the profile owner.
     */
    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetPreferentialNetworkServiceStatusLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetPreferentialNetworkServiceStatusLogged() throws Exception {
        DevicePolicyEventLogVerifier.assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"",
                    ""testSetPreferentialNetworkServiceEnabledLogged"");
        }, new DevicePolicyEventWrapper.Builder(
                EventId.SET_PREFERENTIAL_NETWORK_SERVICE_ENABLED_VALUE)
                .setBoolean(true)
                .build(),
        new DevicePolicyEventWrapper.Builder(
                EventId.SET_PREFERENTIAL_NETWORK_SERVICE_ENABLED_VALUE)
                .setBoolean(false)
                .build());
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @FlakyTest
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAlwaysOnVpn"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testAlwaysOnVpn() throws Exception {
        super.testAlwaysOnVpn();
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAlwaysOnVpnLockDown"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testAlwaysOnVpnLockDown() throws Exception {
        super.testAlwaysOnVpnLockDown();
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @Override
    @LargeTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAlwaysOnVpnAcrossReboot"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testAlwaysOnVpnAcrossReboot() throws Exception {
        super.testAlwaysOnVpnAcrossReboot();
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAlwaysOnVpnPackageUninstalled"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testAlwaysOnVpnPackageUninstalled() throws Exception {
        super.testAlwaysOnVpnPackageUninstalled();
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAlwaysOnVpnUnsupportedPackage"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testAlwaysOnVpnUnsupportedPackage() throws Exception {
        super.testAlwaysOnVpnUnsupportedPackage();
    }

    /** VPN tests don't require physical device for managed profile, thus overriding. */
    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testSetAutoTimeRequired"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testSetAutoTimeRequired() {
        // Managed profile owner cannot set auto time required
    }

    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testAudioRestriction"	"CtsDevicePolicyManagerTestCases"	"1: only"	"public void testAudioRestriction() throws Exception {
        // DISALLOW_UNMUTE_MICROPHONE and DISALLOW_ADJUST_VOLUME can only be set by device owners
        // and profile owners on the primary user.
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testScreenCaptureDisabled_allowedPrimaryUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testScreenCaptureDisabled_allowedPrimaryUser() throws Exception {
        // disable screen capture in profile
        setScreenCaptureDisabled(mUserId, true);

        // start the ScreenCaptureDisabledActivity in the parent
        installAppAsUser(DEVICE_ADMIN_APK, mParentUserId);
        startSimpleActivityAsUser(mParentUserId);
        executeDeviceTestMethod("".ScreenCaptureDisabledTest"", ""testScreenCapturePossible"");
    }

    @FlakyTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testScreenCaptureDisabled_assist_allowedPrimaryUser"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testScreenCaptureDisabled_assist_allowedPrimaryUser() throws Exception {
        // disable screen capture in profile
        executeDeviceTestMethod("".ScreenCaptureDisabledTest"", ""testSetScreenCaptureDisabled_true"");
        try {
            // Install and enable assistant in personal side.
            installAppAsUser(ASSIST_APP_APK, mParentUserId);
            waitForBroadcastIdle();
            setVoiceInteractionService(ASSIST_INTERACTION_SERVICE);

            // Start an activity in parent user.
            installAppAsUser(DEVICE_ADMIN_APK, mParentUserId);
            waitForBroadcastIdle();
            startSimpleActivityAsUser(mParentUserId);

            // Verify assistant app can't take a screenshot.
            runDeviceTestsAsUser(
                    DEVICE_ADMIN_PKG,
                    "".AssistScreenCaptureDisabledTest"",
                    ""testScreenCapturePossible_assist"",
                    mPrimaryUserId);
        } finally {
            // enable screen capture in profile
            executeDeviceTestMethod(
                    "".ScreenCaptureDisabledTest"",
                    ""testSetScreenCaptureDisabled_false"");
            clearVoiceInteractionService();
        }
    }

    @Override"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testPermissionAppUpdate"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionAppUpdate() throws Exception {
        super.testPermissionAppUpdate();
    }

    @Override
    @PermissionsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testPermissionGrantPreMApp"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrantPreMApp() throws Exception {
        super.testPermissionGrantPreMApp();
    }

    @Override
    @PermissionsTest"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testNetworkLogging"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNetworkLogging() throws Exception {
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        testNetworkLoggingOnWorkProfile(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTest"	"testNetworkLoggingDelegate"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testNetworkLoggingDelegate() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);
        try {
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".WorkProfileNetworkLoggingDelegateTest"",
                    ""testCannotAccessApis"", mUserId);
            // Set network logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testSetDelegateScope_delegationNetworkLogging"", mUserId);

            testNetworkLoggingOnWorkProfile(DELEGATE_APP_PKG,
                    "".WorkProfileNetworkLoggingDelegateTest"");
        } finally {
            // Remove network logging delegate
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testSetDelegateScope_noDelegation"", mUserId);
        }
    }

    private void testNetworkLoggingOnWorkProfile(String packageName, String testClassName)
            throws Exception {
        try {
            // Turn network logging on.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testSetNetworkLogsEnabled_true"", mUserId);

            // Connect to websites from work profile, should be logged.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testConnectToWebsites_shouldBeLogged"", mUserId);
            // Connect to websites from personal profile, should not be logged.
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".NetworkLoggingTest"",
                    ""testConnectToWebsites_shouldNotBeLogged"", mPrimaryUserId);

            // Verify all work profile network logs have been received.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testRetrieveNetworkLogs_forceNetworkLogs_receiveNetworkLogs"", mUserId);
        } finally {
            // Turn network logging off.
            runDeviceTestsAsUser(packageName, testClassName,
                    ""testSetNetworkLogsEnabled_false"", mUserId);
        }
    }

    @Override
    List<String> getAdditionalDelegationScopes() {
        final List<String> result = new ArrayList<>();
        result.add(DELEGATION_NETWORK_LOGGING);
        return result;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testStateOfSensorsRelatedPermissionsCannotBeRead"	"CtsDevicePolicyManagerTestCases"	"5: data live UI only app"	"public void testStateOfSensorsRelatedPermissionsCannotBeRead() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testStateOfSensorsRelatedPermissionsCannotBeRead"");
    }

    /**
     * Require a device for tests that use the network stack. Headless Androids running in
     * data centres might need their network rules un-tampered-with in order to keep the ADB / VNC
     * connection alive.
     *
     * This is only a problem on device owner / profile owner running on USER_SYSTEM, because
     * network rules for this user will affect UID 0.
     */
    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetMeteredDataDisabledPackages"	"CtsDevicePolicyManagerTestCases"	"2: data app"	"public void testSetMeteredDataDisabledPackages() throws Exception {
        assumeHasWifiFeature();

        installAppAsUser(METERED_DATA_APP_APK, mUserId);

        try (LocationModeSetter locationModeSetter = new LocationModeSetter(getDevice())) {
            locationModeSetter.setLocationEnabled(true);
            executeDeviceTestClass("".MeteredDataRestrictionTest"");
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testClearApplicationData_testPkg"	"CtsDevicePolicyManagerTestCases"	"2: data app"	"public void testClearApplicationData_testPkg() throws Exception {
        installAppAsUser(INTENT_RECEIVER_APK, mUserId);
        runDeviceTestsAsUser(INTENT_RECEIVER_PKG, INTENT_RECEIVER_PKG + "".ClearApplicationDataTest"",
                ""testWriteToSharedPreference"", mUserId);
        executeDeviceTestMethod("".ClearApplicationDataTest"", ""testClearApplicationData_testPkg"");
        runDeviceTestsAsUser(INTENT_RECEIVER_PKG, INTENT_RECEIVER_PKG + "".ClearApplicationDataTest"",
                ""testSharedPreferenceCleared"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testClearApplicationData_deviceProvisioning"	"CtsDevicePolicyManagerTestCases"	"2: data app"	"public void testClearApplicationData_deviceProvisioning() throws Exception {
        // Clearing data of device configuration app should fail
        executeDeviceTestMethod("".ClearApplicationDataTest"",
                ""testClearApplicationData_deviceProvisioning"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testClearApplicationData_activeAdmin"	"CtsDevicePolicyManagerTestCases"	"2: data app"	"public void testClearApplicationData_activeAdmin() throws Exception {
        // Clearing data of active admin should fail
        executeDeviceTestMethod("".ClearApplicationDataTest"",
                ""testClearApplicationData_activeAdmin"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetNearbyAppStreamingPolicy_changesPolicy"	"CtsDevicePolicyManagerTestCases"	"4: data app(s) apps app"	"public void testSetNearbyAppStreamingPolicy_changesPolicy() throws Exception {
        executeDeviceTestMethod(
                "".NearbyAppStreamingPolicyTest"", ""testSetNearbyAppStreamingPolicy_changesPolicy"");
    }

    /**
     * Executes a test class on device. Prior to running, turn off background data usage
     * restrictions, and restore the original restrictions after the test.
     */
    private void executeDeviceTestClassNoRestrictBackground(String className) throws Exception {
        boolean originalRestriction = ensureRestrictBackgroundPolicyOff();
        try {
            executeDeviceTestClass(className);
        } catch (Exception e) {
            throw e;
        } finally {
            // if the test throws exception, still restore the policy
            restoreRestrictBackgroundPolicyTo(originalRestriction);
        }
    }

    protected void executeDeviceTestClass(String className) throws Exception {
        executeDeviceTestMethod(className, /* testName= */ null);
    }

    protected void executeDeviceTestMethod(String className, String testName) throws Exception {
        executeDeviceTestMethod(className, testName, /* params= */ new HashMap<>());
    }

    protected void executeDeviceTestMethod(String className, String testName,
            Map<String, String> params) throws Exception {
        executeDeviceTestMethod(className, testName, mUserId, params);
    }

    protected void executeDeviceTestMethod(String className, String testName, int userId,
            Map<String, String> params) throws Exception {
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, className, testName, userId, params);
    }

    protected void installAppPermissionAppAsUser()
            throws FileNotFoundException, DeviceNotAvailableException {
        installAppAsUser(PERMISSIONS_APP_APK, false, mUserId);
    }

    private void executeSuspendPackageTestMethod(String testName) throws Exception {
        runDeviceTestsAsUser(INTENT_SENDER_PKG, "".SuspendPackageTest"", testName, mUserId);
    }

    private void executeAccountTest(String testName) throws DeviceNotAvailableException {
        runDeviceTestsAsUser(ACCOUNT_MANAGEMENT_PKG, "".AccountManagementTest"",
                testName, mUserId);
        // Send a home intent to dismiss an error dialog.
        String command = ""am start -a android.intent.action.MAIN""
                + "" -c android.intent.category.HOME"";
        CLog.i(""Output for command "" + command + "": "" + getDevice().executeShellCommand(command));
    }

    private void executeAppRestrictionsManagingPackageTest(String testName) throws Exception {
        runDeviceTestsAsUser(DELEGATE_APP_PKG,
                "".AppRestrictionsDelegateTest"", testName, mUserId);
    }

    private void executeDelegationTests(Map<String, DevicePolicyEventWrapper[]> delegationTests,
            boolean positive)
            throws Exception {
        for (Map.Entry<String, DevicePolicyEventWrapper[]> entry : delegationTests.entrySet()) {
            final String delegationTestClass = entry.getKey();
            final DevicePolicyEventWrapper[] expectedMetrics = entry.getValue();
            final DevicePolicyEventLogVerifier.Action testRun = () -> {
                runDeviceTestsAsUser(DELEGATE_APP_PKG, delegationTestClass,
                        positive ? ""testCanAccessApis"" : ""testCannotAccessApis"", mUserId);
            };
            if (expectedMetrics != null && positive) {
                assertMetricsLogged(getDevice(), testRun, expectedMetrics);
            } else {
                testRun.apply();
            }
        }
    }

    private void changeUserRestrictionOrFail(String key, boolean value, int userId)
            throws DeviceNotAvailableException {
        changeUserRestrictionOrFail(key, value, userId, DEVICE_ADMIN_PKG);
    }

    private void changeAccountManagement(String command, String accountType, int userId)
            throws DeviceNotAvailableException {
        changePolicyOrFail(command, ""--es extra-account-type "" + accountType, userId);
    }

    private void changeApplicationRestrictionsManagingPackage(String packageName)
            throws DeviceNotAvailableException {
        String packageNameExtra = (packageName != null)
                ? ""--es extra-package-name "" + packageName : """";
        changePolicyOrFail(""set-app-restrictions-manager"", packageNameExtra, mUserId);
    }

    protected void setDelegatedScopes(String packageName, List<String> scopes)
            throws DeviceNotAvailableException {
        final String packageNameExtra = ""--es extra-package-name "" + packageName;
        String scopesExtra = """";
        if (scopes != null && scopes.size() > 0) {
            scopesExtra = ""--esa extra-scopes-list "" + scopes.get(0);
            for (int i = 1; i < scopes.size(); ++i) {
                scopesExtra += "","" + scopes.get(i);
            }
        }
        final String extras = packageNameExtra + "" "" + scopesExtra;

        changePolicyOrFail(""set-delegated-scopes"", extras, mUserId);
    }

    private void setInstallPackageAppOps(String packageName, boolean allowed, int userId)
            throws DeviceNotAvailableException {
        String command = ""appops set --user "" + userId + "" "" + packageName + "" "" +
                ""REQUEST_INSTALL_PACKAGES ""
                + (allowed ? ""allow"" : ""default"");
        CLog.d(""Output for command "" + command + "": "" + getDevice().executeShellCommand(command));
    }

    private void changePolicyOrFail(String command, String extras, int userId)
            throws DeviceNotAvailableException {
        changePolicyOrFail(command, extras, userId, DEVICE_ADMIN_PKG);
    }

    /**
     * Start SimpleActivity synchronously in a particular user.
     */
    protected void startSimpleActivityAsUser(int userId) throws Exception {
        installAppAsUser(TEST_APP_APK, /* grantPermissions */ true, /* dontKillApp */ true, userId);
        startActivityAsUser(userId, TEST_APP_PKG, TEST_APP_PKG + "".SimpleActivity"");
    }

    protected void setScreenCaptureDisabled(int userId, boolean disabled) throws Exception {
        String testMethodName = disabled
                ? ""testSetScreenCaptureDisabled_true""
                : ""testSetScreenCaptureDisabled_false"";
        executeDeviceTestMethod("".ScreenCaptureDisabledTest"", testMethodName);

        testMethodName = disabled
                ? ""testScreenCaptureImpossible""
                : ""testScreenCapturePossible"";

        startSimpleActivityAsUser(userId);
        executeDeviceTestMethod("".ScreenCaptureDisabledTest"", testMethodName);
        forceStopPackageForUser(TEST_APP_PKG, userId);
    }

    protected void setScreenCaptureDisabled_assist(int userId, boolean disabled) throws Exception {
        // Set the policy.
        String testMethodName = disabled
                ? ""testSetScreenCaptureDisabled_true""
                : ""testSetScreenCaptureDisabled_false"";
        executeDeviceTestMethod("".ScreenCaptureDisabledTest"", testMethodName);
        testMethodName = disabled
                ? ""testScreenCaptureImpossible_assist""
                : ""testScreenCapturePossible_assist"";

        // Check whether the VoiceInteractionService can retrieve the screenshot.
        installAppAsUser(DEVICE_ADMIN_APK, mPrimaryUserId);

        if (userId == mPrimaryUserId) {
            // If testing for user-0, also make sure the existing screen can't be captured.
            runDeviceTestsAsUser(
                    DEVICE_ADMIN_PKG,
                    "".AssistScreenCaptureDisabledTest"",
                    testMethodName,
                    mPrimaryUserId);
        }

        // Make sure the foreground activity is from the target user.
        startSimpleActivityAsUser(userId);

        runDeviceTestsAsUser(
                DEVICE_ADMIN_PKG,
                "".AssistScreenCaptureDisabledTest"",
                testMethodName,
                mPrimaryUserId);
    }

    /**
     * Allows packageName to manage notification policy configuration, which
     * includes toggling zen mode.
     */
    private void allowNotificationPolicyAccess(String packageName, int userId)
            throws DeviceNotAvailableException {
        List<String> enabledPackages = getEnabledNotificationPolicyPackages(userId);
        if (!enabledPackages.contains(packageName)) {
            enabledPackages.add(packageName);
            setEnabledNotificationPolicyPackages(enabledPackages, userId);
        }
    }

    /**
     * Disallows packageName to manage notification policy configuration, which
     * includes toggling zen mode.
     */
    private void disallowNotificationPolicyAccess(String packageName, int userId)
            throws DeviceNotAvailableException {
        List<String> enabledPackages = getEnabledNotificationPolicyPackages(userId);
        if (enabledPackages.contains(packageName)) {
            enabledPackages.remove(packageName);
            setEnabledNotificationPolicyPackages(enabledPackages, userId);
        }
    }

    private void setEnabledNotificationPolicyPackages(List<String> packages, int userId)
            throws DeviceNotAvailableException {
        getDevice().setSetting(userId, ""secure"", ENABLED_NOTIFICATION_POLICY_ACCESS_PACKAGES,
                String.join("":"", packages));
    }

    private List<String> getEnabledNotificationPolicyPackages(int userId)
            throws DeviceNotAvailableException {
        String settingValue = getDevice().getSetting(userId, ""secure"",
                ENABLED_NOTIFICATION_POLICY_ACCESS_PACKAGES);
        if (settingValue == null) {
            return new ArrayList<String>();
        }
        return new ArrayList<String>(Arrays.asList(settingValue.split("":|\n"")));
    }

    protected void setVoiceInteractionService(String componentName)
            throws DeviceNotAvailableException {
        getDevice().setSetting(
                mPrimaryUserId, ""secure"", ""voice_interaction_service"", componentName);
        getDevice().setSetting(mPrimaryUserId, ""secure"", ""assist_structure_enabled"", ""1"");
        getDevice().setSetting(mPrimaryUserId, ""secure"", ""assist_screenshot_enabled"", ""1"");
    }

    protected void clearVoiceInteractionService() throws DeviceNotAvailableException {
        getDevice().executeShellCommand(""settings delete secure voice_interaction_service"");
    }

    /**
     * Ensure that restrict background policy is off.
     * Returns the original status of restrict background policy.
     */
    private boolean ensureRestrictBackgroundPolicyOff() throws Exception {
        String restriction = getDevice().executeShellCommand(RESTRICT_BACKGROUND_GET_CMD);
        if (restriction.contains(""enabled"")) {
            getDevice().executeShellCommand(RESTRICT_BACKGROUND_OFF_CMD);
            return true;
        }
        return false;
    }

    private void restoreRestrictBackgroundPolicyTo(boolean restricted) throws Exception {
        getDevice().executeShellCommand(
                restricted ? RESTRICT_BACKGROUND_ON_CMD : RESTRICT_BACKGROUND_OFF_CMD);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDelegation"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testDelegation() throws Exception {
        // Install relevant apps.
        installDelegateApp();
        installAppAsUser(TEST_APP_APK, mUserId);
        installAppAsUser(APP_RESTRICTIONS_TARGET_APP_APK, mUserId);
        if (isHeadlessSystemUserMode()) {
            installAppAsUser(TEST_APP_APK, mDeviceOwnerUserId);
            installAppAsUser(APP_RESTRICTIONS_TARGET_APP_APK, mDeviceOwnerUserId);
        }

        try {
            final Map<String, DevicePolicyEventWrapper[]> delegationTests = getDelegationTests();
            // APIs are not accessible by default.
            executeDelegationTests(delegationTests, false /* negative result */);

            // Granting the appropriate delegation scopes makes APIs accessible.
            final List<String> scopes = getDelegationScopes();
            setDelegatedScopes(DELEGATE_APP_PKG, scopes);
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".GeneralDelegateTest"", null, mUserId,
                    ImmutableMap.of(""scopes"", String.join("","", scopes)));
            executeDelegationTests(delegationTests, true /* positive result */);

            // APIs are not accessible after revoking delegations.
            setDelegatedScopes(DELEGATE_APP_PKG, null);
            executeDelegationTests(delegationTests, false /* negative result */);

            // Additional delegation tests.
            executeDeviceTestClass("".DelegationTest"");

        } finally {
            // Remove any remaining delegations.
            setDelegatedScopes(DELEGATE_APP_PKG, null);
        }
    }

    protected void installDelegateApp() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testApplicationHidden_cannotHidePolicyExemptApps"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testApplicationHidden_cannotHidePolicyExemptApps() throws Exception {
        executeDeviceTestMethod("".ApplicationHiddenTest"", ""testCannotHidePolicyExemptApps"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetKeyGrant"	"CtsDevicePolicyManagerTestCases"	"4: app(s) apps accessing app"	"public void testSetKeyGrant() throws Exception {
        assumeTrue(mHasAttestation);

        // Install an app
        installAppAsUser(CERT_INSTALLER_APK, mUserId);

        try {
            // First, generate a key and grant the cert installer access to it.
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                    ""testManualGenerateKeyAndGrantAccess"", mUserId);
            // Test the key is usable.
            runDeviceTestsAsUser(""com.android.cts.certinstaller"",
                    "".PreSelectedKeyAccessTest"", ""testAccessingPreSelectedAliasExpectingSuccess"",
                    mUserId);
            // Remove the grant
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                    ""testManualRemoveKeyGrant"", mUserId);
            // Run another test to make sure the app no longer has access to the key.
            runDeviceTestsAsUser(""com.android.cts.certinstaller"",
                    "".PreSelectedKeyAccessTest"", ""testAccessingPreSelectedAliasWithoutGrant"", mUserId);
        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                    ""testManualClearGeneratedKey"", mUserId);
        }
    }

    // Sets restrictions and launches non-admin app, that tries to set wallpaper.
    // Non-admin apps must not violate any user restriction."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testGetNearbyAppStreamingPolicy_getsNearbyStreamingDisabledAsDefault"	"CtsDevicePolicyManagerTestCases"	"3: app(s) apps app"	"public void testGetNearbyAppStreamingPolicy_getsNearbyStreamingDisabledAsDefault()
            throws Exception {
        executeDeviceTestMethod(
                "".NearbyAppStreamingPolicyTest"",
                ""testGetNearbyAppStreamingPolicy_getsNearbyStreamingDisabledAsDefault"");
    }

    // TODO(b/184175078): Migrate test to Bedstead when the infra is ready."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetCameraDisabledLogged"	"CtsDevicePolicyManagerTestCases"	"4: camera called UI app"	"public void testSetCameraDisabledLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".PolicyTransparencyTest"", ""testCameraDisabled"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_CAMERA_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(true)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_CAMERA_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build());
    }

    /** Test for resetPassword for all devices. */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetKeyguardDisabledSecureCameraLogged"	"CtsDevicePolicyManagerTestCases"	"4: camera called UI app"	"public void testSetKeyguardDisabledSecureCameraLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetKeyguardDisabledSecureCameraLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_FEATURES_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setInt(KEYGUARD_DISABLE_SECURE_CAMERA)
                .setStrings(NOT_CALLED_FROM_PARENT)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testApplicationHidden"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testApplicationHidden() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestClass("".ApplicationHiddenTest"");
        installAppAsUser(PERMISSIONS_APP_APK, mUserId);
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".ApplicationHiddenTest"",""testSetApplicationHidden"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_APPLICATION_HIDDEN_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(PERMISSIONS_APP_PKG, ""hidden"", NOT_CALLED_FROM_PARENT)
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_APPLICATION_HIDDEN_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(PERMISSIONS_APP_PKG, ""not_hidden"", NOT_CALLED_FROM_PARENT)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDelegatedCertInstaller"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testDelegatedCertInstaller() throws Exception {
        installAppAsUser(CERT_INSTALLER_APK, mUserId);

        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerTest"", mUserId);
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerTest"",
                    ""testInstallKeyPair"", mUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_CERT_INSTALLER_PACKAGE_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(CERT_INSTALLER_PKG)
                .build());
    }

    public interface DelegatedCertInstallerTestAction {
        void run() throws Exception;
    }

    protected void setUpDelegatedCertInstallerAndRunTests(DelegatedCertInstallerTestAction test)
            throws Exception {
        installAppAsUser(CERT_INSTALLER_APK, mUserId);

        try {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                    ""testManualSetCertInstallerDelegate"", mUserId);

            test.run();
        } finally {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DelegatedCertInstallerHelper"",
                    ""testManualClearCertInstallerDelegate"", mUserId);
        }
    }

    // This test currently duplicates the testDelegatedCertInstaller, with one difference:
    // The Delegated cert installer app is called directly rather than via intents from
    // the DelegatedCertinstallerTest."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermittedInputMethods"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testPermittedInputMethods() throws Exception {
        executeDeviceTestMethod("".InputMethodsTest"", ""testPermittedInputMethodsThrowsIfWrongAdmin"");
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".InputMethodsTest"", ""testPermittedInputMethods"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PERMITTED_INPUT_METHODS_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(NOT_CALLED_FROM_PARENT, new String[0])
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_PERMITTED_INPUT_METHODS_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(NOT_CALLED_FROM_PARENT, new String[0])
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_PERMITTED_INPUT_METHODS_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(NOT_CALLED_FROM_PARENT, ""com.google.pkg.one"", ""com.google.pkg.two"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPasswordMethodsLogged"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testPasswordMethodsLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testPasswordMethodsLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_QUALITY_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(PASSWORD_QUALITY_COMPLEX)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_LENGTH_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(13)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_NUMERIC_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(14)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_NON_LETTER_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(15)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_LETTERS_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(16)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_LOWER_CASE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(17)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_UPPER_CASE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(18)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_MINIMUM_SYMBOLS_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(19)
                    .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_PASSWORD_COMPLEXITY_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setInt(0x50000)
                        .setBoolean(false)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetKeyguardDisabledFeaturesLogged"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testSetKeyguardDisabledFeaturesLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetKeyguardDisabledFeaturesLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_FEATURES_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(KEYGUARD_DISABLE_FEATURES_NONE)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_FEATURES_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(KEYGUARD_DISABLE_FINGERPRINT)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_FEATURES_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(KEYGUARD_DISABLE_TRUST_AGENTS)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_KEYGUARD_DISABLED_FEATURES_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(KEYGUARD_DISABLE_FEATURES_NONE)
                    .setStrings(NOT_CALLED_FROM_PARENT)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetUserRestrictionLogged"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testSetUserRestrictionLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetUserRestrictionLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.ADD_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_CONFIG_LOCATION, NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.REMOVE_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_CONFIG_LOCATION, NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.ADD_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_ADJUST_VOLUME, NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.REMOVE_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_ADJUST_VOLUME, NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.ADD_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_AUTOFILL, NOT_CALLED_FROM_PARENT)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.REMOVE_USER_RESTRICTION_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DISALLOW_AUTOFILL, NOT_CALLED_FROM_PARENT)
                    .build()
        );
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testInstallCaCertLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testInstallCaCertLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".CaCertManagementTest"", ""testCanInstallAndUninstallACaCert"");
        }, new DevicePolicyEventWrapper.Builder(EventId.INSTALL_CA_CERT_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.UNINSTALL_CA_CERTS_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testApplicationRestrictions"	"CtsDevicePolicyManagerTestCases"	"3: UI only app"	"public void testApplicationRestrictions() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
        installAppAsUser(APP_RESTRICTIONS_TARGET_APP_APK, mUserId);

        try {
            // Only the DPC can manage app restrictions by default.
            executeDeviceTestClass("".ApplicationRestrictionsTest"");
            executeAppRestrictionsManagingPackageTest(""testCannotAccessApis"");

            // Letting the DELEGATE_APP_PKG manage app restrictions too.
            changeApplicationRestrictionsManagingPackage(DELEGATE_APP_PKG);
            executeAppRestrictionsManagingPackageTest(""testCanAccessApis"");
            runDeviceTestsAsUser(DELEGATE_APP_PKG, "".GeneralDelegateTest"",
                    ""testSettingAdminComponentNameThrowsException"", mUserId);

            // The DPC should still be able to manage app restrictions normally.
            executeDeviceTestClass("".ApplicationRestrictionsTest"");

            // The app shouldn't be able to manage app restrictions for other users.
            int parentUserId = getPrimaryUser();
            if (parentUserId != mUserId) {
                installAppAsUser(DELEGATE_APP_APK, parentUserId);
                installAppAsUser(APP_RESTRICTIONS_TARGET_APP_APK, parentUserId);
                runDeviceTestsAsUser(DELEGATE_APP_PKG, "".AppRestrictionsDelegateTest"",
                        ""testCannotAccessApis"", parentUserId);
            }

            // Revoking the permission for DELEGAYE_APP_PKG to manage restrictions.
            changeApplicationRestrictionsManagingPackage(null);
            executeAppRestrictionsManagingPackageTest(""testCannotAccessApis"");

            // The DPC should still be able to manage app restrictions normally.
            executeDeviceTestClass("".ApplicationRestrictionsTest"");

            assertMetricsLogged(getDevice(), () -> {
                executeDeviceTestMethod("".ApplicationRestrictionsTest"",
                        ""testSetApplicationRestrictions"");
            }, new DevicePolicyEventWrapper.Builder(EventId.SET_APPLICATION_RESTRICTIONS_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(APP_RESTRICTIONS_TARGET_APP_PKG)
                    .build());
        } finally {
            changeApplicationRestrictionsManagingPackage(null);
        }
    }

    /**
     * Returns a list of delegation tests that should run. Add delegations tests applicable to both
     * device owner and profile owners to this method directly. DO or PO specific tests should be
     * added to {@link #getAdditionalDelegationTests} in the subclass.
     */
    private Map<String, DevicePolicyEventWrapper[]> getDelegationTests() {
        final Map<String, DevicePolicyEventWrapper[]> result = new HashMap<>();
        result.put("".AppRestrictionsDelegateTest"", null);
        result.put("".CertInstallDelegateTest"", null);
        result.put("".BlockUninstallDelegateTest"", null);
        result.put("".PermissionGrantDelegateTest"", null);
        result.put("".PackageAccessDelegateTest"", null);
        result.put("".EnableSystemAppDelegateTest"", null);
        result.putAll(getAdditionalDelegationTests());
        return result;
    }

    Map<String, DevicePolicyEventWrapper[]> getAdditionalDelegationTests() {
        return Collections.<String, DevicePolicyEventWrapper[]>emptyMap();
    }

    /**
     * Returns a list of delegation scopes that are needed to run delegation tests. Add scopes
     * which are applicable to both device owner and profile owners to this method directly.
     * DO or PO specific scopes should be added to {@link #getAdditionalDelegationScopes}
     * in the subclass.
     */
    private List<String> getDelegationScopes() {
        final List<String> result = new ArrayList<>(Arrays.asList(
                DELEGATION_APP_RESTRICTIONS,
                DELEGATION_CERT_INSTALL,
                DELEGATION_BLOCK_UNINSTALL,
                DELEGATION_PERMISSION_GRANT,
                DELEGATION_PACKAGE_ACCESS,
                DELEGATION_ENABLE_SYSTEM_APP,
                // CERT_SELECTION scope is in the list so it still participates GeneralDelegateTest.
                // But its main functionality test is driven by testDelegationCertSelection() and
                // hence missing from getDelegationTests() on purpose.
                DELEGATION_CERT_SELECTION
                ));
        result.addAll(getAdditionalDelegationScopes());
        return result;
    }

    List<String> getAdditionalDelegationScopes() {
        return Collections.<String>emptyList();
    }

    /**
     * General instructions to add a new delegation test:
     * 1. Test primary delegation functionalitiy
     *    Implement the delegate's positive/negate functionaility tests in a new test class
     *    in CtsDelegateApp.apk. Main entry point are {@code testCanAccessApis} and
     *    {@code testCannotAccessApis}. Once implemented, add the delegation scope and the test
     *    class name to {@link #getDelegationScopes}, {@link #getDelegationTests} to make the test
     *    run on DO/PO/PO on primary user.  If the test should only run on a subset of these
     *    combinations, add them to the subclass's {@link #getAdditionalDelegationScopes} and
     *    {@link #getDelegationScopes} intead.
     *    <p>Alternatively, create a separate hostside method to drive the test, similar to
     *    {@link #testDelegationCertSelection}. This is preferred if the delegated functionalities
     *    already exist in another app.
     * 2. Test access control of DO-only delegation
     *    Add the delegation scope to
     *    {@code DelegationTest#testDeviceOwnerOnlyDelegationsOnlyPossibleToBeSetByDeviceOwner} to
     *    test that only DO can delegate this scope.
     * 3. Test behaviour of exclusive delegation
     *    Add the delegation scope to {@code DelegationTest#testExclusiveDelegations} to test that
     *    the scope can only be delegatd to one app at a time.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDelegationCertSelection"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testDelegationCertSelection() throws Exception {
        installAppAsUser(CERT_INSTALLER_APK, mUserId);
        setDelegatedScopes(CERT_INSTALLER_PKG, Arrays.asList(
                DELEGATION_CERT_INSTALL, DELEGATION_CERT_SELECTION));

        assertMetricsLogged(getDevice(), () -> {
                runDeviceTestsAsUser(CERT_INSTALLER_PKG, "".CertSelectionDelegateTest"", mUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.CHOOSE_PRIVATE_KEY_ALIAS_VALUE)
                .setAdminPackageName(CERT_INSTALLER_PKG)
                .setBoolean(true)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpn"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpn() throws Exception {
        installAppAsUser(VPN_APP_APK, mUserId);
        executeDeviceTestClassNoRestrictBackground("".AlwaysOnVpnTest"");
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnLockDown"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnLockDown() throws Exception {
        installAppAsUser(VPN_APP_APK, mUserId);
        try {
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testAlwaysOnSet"");
            forceStopPackageForUser(VPN_APP_PKG, mUserId);
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testNetworkBlocked"");
        } finally {
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testCleanup"");
        }
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnAcrossReboot"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnAcrossReboot() throws Exception {
        try {
            installAppAsUser(VPN_APP_APK, mUserId);
            waitForBroadcastIdle();
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testAlwaysOnSetWithAllowlist"");
            rebootAndWaitUntilReady();
            // Make sure profile user initialization is complete before proceeding.
            waitForBroadcastIdle();
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testAlwaysOnSetAfterReboot"");
        } finally {
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testCleanup"");
        }
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnPackageUninstalled"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnPackageUninstalled() throws Exception {
        installAppAsUser(VPN_APP_APK, mUserId);
        try {
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testAlwaysOnSet"");
            getDevice().uninstallPackage(VPN_APP_PKG);
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testAlwaysOnVpnDisabled"");
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testSetNonExistingPackage"");
        } finally {
            executeDeviceTestMethod("".AlwaysOnVpnMultiStageTest"", ""testCleanup"");
        }
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnUnsupportedPackage"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnUnsupportedPackage() throws Exception {
        try {
            // Target SDK = 23: unsupported
            installAppAsUser(VPN_APP_API23_APK, mUserId);
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testSetUnsupportedVpnAlwaysOn"");

            // Target SDK = 24: supported
            installAppAsUser(VPN_APP_API24_APK, mUserId);
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testSetSupportedVpnAlwaysOn"");
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testClearAlwaysOnVpn"");

            // Explicit opt-out: unsupported
            installAppAsUser(VPN_APP_NOT_ALWAYS_ON_APK, mUserId);
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testSetUnsupportedVpnAlwaysOn"");
        } finally {
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testClearAlwaysOnVpn"");
        }
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnUnsupportedPackageReplaced"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnUnsupportedPackageReplaced() throws Exception {
        try {
            // Target SDK = 24: supported
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testAssertNoAlwaysOnVpn"");
            installAppAsUser(VPN_APP_API24_APK, mUserId);
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testSetSupportedVpnAlwaysOn"");
            // Update the app to target higher API level, but with manifest opt-out
            installAppAsUser(VPN_APP_NOT_ALWAYS_ON_APK, mUserId);
            // wait for the app update install completed, ready to be tested
            waitForBroadcastIdle();
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testAssertNoAlwaysOnVpn"");
        } finally {
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testClearAlwaysOnVpn"");
        }
    }

    @RequiresDevice"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAlwaysOnVpnPackageLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAlwaysOnVpnPackageLogged() throws Exception {
        // Will be uninstalled in tearDown().
        installAppAsUser(VPN_APP_APK, mUserId);
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".AlwaysOnVpnUnsupportedTest"", ""testSetSupportedVpnAlwaysOn"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_ALWAYS_ON_VPN_PACKAGE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(VPN_APP_PKG)
                    .setBoolean(true)
                    .setInt(0)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPersistentIntentResolving"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testPersistentIntentResolving() throws Exception {
        executeDeviceTestClass("".PersistentIntentResolvingTest"");
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".PersistentIntentResolvingTest"",
                    ""testAddPersistentPreferredActivityYieldsReceptionAtTarget"");
        }, new DevicePolicyEventWrapper.Builder(EventId.ADD_PERSISTENT_PREFERRED_ACTIVITY_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(DEVICE_ADMIN_PKG,
                        ""com.android.cts.deviceandprofileowner.EXAMPLE_ACTION"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testScreenCaptureDisabled"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testScreenCaptureDisabled() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            // We need to ensure that the policy is deactivated for the device owner case, so making
            // sure the second test is run even if the first one fails
            try {
                setScreenCaptureDisabled(mUserId, true);
            } finally {
                setScreenCaptureDisabled(mUserId, false);
            }
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SCREEN_CAPTURE_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_SCREEN_CAPTURE_DISABLED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSupportMessage"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSupportMessage() throws Exception {
        executeDeviceTestClass("".SupportMessageTest"");
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SupportMessageTest"", ""testShortSupportMessageSetGetAndClear"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SHORT_SUPPORT_MESSAGE_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".SupportMessageTest"", ""testLongSupportMessageSetGetAndClear"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_LONG_SUPPORT_MESSAGE_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPackageInstallUserRestrictions"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testPackageInstallUserRestrictions() throws Exception {
        boolean mIsWatch = hasDeviceFeature(""android.hardware.type.watch"");
        if (mIsWatch) {
            return;
        }
        // UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES
        final String DISALLOW_INSTALL_UNKNOWN_SOURCES = ""no_install_unknown_sources"";
        // UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY
        final String DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY =
                ""no_install_unknown_sources_globally"";
        final String SECURE_SETTING_CATEGORY = ""secure"";
        final String GLOBAL_SETTING_CATEGORY = ""global"";
        final File apk = mBuildHelper.getTestFile(TEST_APP_APK);
        try {
            // Install the test and prepare the test apk.
            installAppAsUser(PACKAGE_INSTALLER_APK, mUserId);
            assertTrue(getDevice().pushFile(apk, TEST_APP_LOCATION + apk.getName()));
            setInstallPackageAppOps(PACKAGE_INSTALLER_PKG, true, mUserId);

            // Add restrictions and test if we can install the apk.
            getDevice().uninstallPackage(TEST_APP_PKG);
            changeUserRestrictionOrFail(DISALLOW_INSTALL_UNKNOWN_SOURCES, true, mUserId);
            runDeviceTestsAsUser(PACKAGE_INSTALLER_PKG, "".ManualPackageInstallTest"",
                    ""testManualInstallBlocked"", mUserId);

            // Clear restrictions and test if we can install the apk.
            changeUserRestrictionOrFail(DISALLOW_INSTALL_UNKNOWN_SOURCES, false, mUserId);

            // Add global restriction and test if we can install the apk.
            getDevice().uninstallPackage(TEST_APP_PKG);
            changeUserRestrictionOrFail(DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY, true, mUserId);
            runDeviceTestsAsUser(PACKAGE_INSTALLER_PKG, "".ManualPackageInstallTest"",
                    ""testManualInstallBlocked"", mUserId);

            // Clear global restriction and test if we can install the apk.
            changeUserRestrictionOrFail(DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY, false, mUserId);
            runDeviceTestsAsUser(PACKAGE_INSTALLER_PKG, "".ManualPackageInstallTest"",
                    ""testManualInstallSucceeded"", mUserId);
        } finally {
            setInstallPackageAppOps(PACKAGE_INSTALLER_PKG, false, mUserId);
            String command = ""rm "" + TEST_APP_LOCATION + apk.getName();
            getDevice().executeShellCommand(command);
            getDevice().uninstallPackage(TEST_APP_PKG);
            getDevice().uninstallPackage(PACKAGE_INSTALLER_PKG);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDisallowAdjustVolumeMutedLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testDisallowAdjustVolumeMutedLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"",
                    ""testDisallowAdjustVolumeMutedLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_MASTER_VOLUME_MUTED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_MASTER_VOLUME_MUTED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }

    @FlakyTest(bugId = 141314026)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSuspendPackage"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSuspendPackage() throws Exception {
        CLog.i(""runTestSuspendPackage() on user %d"", mUserId);

        installAppAsUser(INTENT_SENDER_APK, mUserId);
        installAppAsUser(INTENT_RECEIVER_APK, mUserId);
        assertMetricsLogged(getDevice(), () -> {
            // Suspend a testing package.
            executeDeviceTestMethod("".SuspendPackageTest"", ""testSetPackagesSuspended"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PACKAGES_SUSPENDED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(INTENT_RECEIVER_PKG)
                    .setBoolean(false)
                    .build());
        // Verify that the package is suspended from the PREVIOUS test and that the dialog is shown
        executeSuspendPackageTestMethod(""testPackageSuspended"");

        // Undo the suspend.
        executeDeviceTestMethod("".SuspendPackageTest"", ""testSetPackagesNotSuspended"");
        // Verify that the package is not suspended from the PREVIOUS test and that the app launches
        executeSuspendPackageTestMethod(""testPackageNotSuspended"");

        // Verify we cannot suspend not suspendable packages.
        executeDeviceTestMethod("".SuspendPackageTest"", ""testSuspendNotSuspendablePackages"");
    }

    @FlakyTest(bugId = 141314026)"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testRequiredStrongAuthTimeout"	"CtsDevicePolicyManagerTestCases"	"1: UI"	"public void testRequiredStrongAuthTimeout() throws Exception {
        assumeHasSecureLockScreenFeature();

        executeDeviceTestClass("".RequiredStrongAuthTimeoutTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPasswordRequirementsApi"	"CtsDevicePolicyManagerTestCases"	"2: UI only"	"public void testPasswordRequirementsApi() throws Exception {
        executeDeviceTestMethod("".PasswordRequirementsTest"",
                ""testSettingConstraintsWithLowQualityThrowsOnRPlus"");
        executeDeviceTestMethod("".PasswordRequirementsTest"",
                ""testSettingConstraintsWithNumericQualityOnlyLengthAllowedOnRPlus"");
        executeDeviceTestMethod("".PasswordRequirementsTest"",
                ""testSettingConstraintsWithComplexQualityAndResetWithLowerQuality"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testKeyManagement"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testKeyManagement() throws Exception {
        installAppAsUser(SHARED_UID_APP1_APK, mUserId);
        installAppAsUser(SHARED_UID_APP2_APK, mUserId);

        executeDeviceTestClass("".KeyManagementTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testInstallKeyPairLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testInstallKeyPairLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                executeDeviceTestMethod("".KeyManagementTest"", ""testCanInstallCertChain"");
                }, new DevicePolicyEventWrapper.Builder(EventId.INSTALL_KEY_PAIR_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(""notCredentialManagementApp"")
                .build(),
                new DevicePolicyEventWrapper.Builder(EventId.REMOVE_KEY_PAIR_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(""notCredentialManagementApp"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testGenerateKeyPairLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testGenerateKeyPairLogged() throws Exception {
        assumeTrue(mHasAttestation);

        assertMetricsLogged(getDevice(), () -> {
                executeDeviceTestMethod(
                        "".KeyManagementTest"", ""testCanGenerateKeyPairWithKeyAttestation"");
                }, new DevicePolicyEventWrapper.Builder(EventId.GENERATE_KEY_PAIR_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setInt(0)
                .setStrings(""RSA"", ""notCredentialManagementApp"")
                .build(),
                new DevicePolicyEventWrapper.Builder(EventId.GENERATE_KEY_PAIR_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setInt(0)
                .setStrings(""EC"", ""notCredentialManagementApp"")
                .build());

    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetKeyPairCertificateLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetKeyPairCertificateLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                executeDeviceTestMethod("".KeyManagementTest"", ""testCanSetKeyPairCert"");
                }, new DevicePolicyEventWrapper.Builder(EventId.SET_KEY_PAIR_CERTIFICATE_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(""notCredentialManagementApp"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermittedAccessibilityServices"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testPermittedAccessibilityServices() throws Exception {
        executeDeviceTestClass("".AccessibilityServicesTest"");
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".AccessibilityServicesTest"",
                    ""testPermittedAccessibilityServices"");
        }, new DevicePolicyEventWrapper
                .Builder(EventId.SET_PERMITTED_ACCESSIBILITY_SERVICES_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings((String[]) null)
                .build(),
        new DevicePolicyEventWrapper
                .Builder(EventId.SET_PERMITTED_ACCESSIBILITY_SERVICES_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings((String[]) null)
                .build(),
        new DevicePolicyEventWrapper
                .Builder(EventId.SET_PERMITTED_ACCESSIBILITY_SERVICES_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(""com.google.pkg.one"", ""com.google.pkg.two"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testLockNowLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testLockNowLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testLockNowLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.LOCK_NOW_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setInt(0)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetSecureSettingLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetSecureSettingLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetSecureSettingLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_SECURE_SETTING_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setStrings(SKIP_FIRST_USE_HINTS, ""1"")
                .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_SECURE_SETTING_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(SKIP_FIRST_USE_HINTS, ""0"")
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_SECURE_SETTING_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DEFAULT_INPUT_METHOD, ""com.example.input"")
                    .build()
                    ,
            new DevicePolicyEventWrapper.Builder(EventId.SET_SECURE_SETTING_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setStrings(DEFAULT_INPUT_METHOD)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetPermissionPolicyLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetPermissionPolicyLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetPermissionPolicyLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_POLICY_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setInt(PERMISSION_POLICY_AUTO_DENY)
                .setBoolean(false)
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_POLICY_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setInt(PERMISSION_POLICY_AUTO_GRANT)
                .setBoolean(false)
                .build(),
        new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_POLICY_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setInt(PERMISSION_POLICY_PROMPT)
                .setBoolean(false)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetPermissionGrantStateLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetPermissionGrantStateLogged() throws Exception {
        installAppPermissionAppAsUser();
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod(
                    "".DevicePolicyLoggingTest"", ""testSetPermissionGrantStateLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_GRANT_STATE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(PERMISSION_GRANT_STATE_GRANTED)
                    .setBoolean(false)
                    .setStrings(""android.permission.READ_CONTACTS"")
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_GRANT_STATE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(PERMISSION_GRANT_STATE_DENIED)
                    .setBoolean(false)
                    .setStrings(""android.permission.READ_CONTACTS"")
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_PERMISSION_GRANT_STATE_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setInt(PERMISSION_GRANT_STATE_DEFAULT)
                    .setBoolean(false)
                    .setStrings(""android.permission.READ_CONTACTS"")
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetAutoTimeRequired"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetAutoTimeRequired() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testSetAutoTimeRequired"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_REQUIRED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_REQUIRED_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetAutoTimeEnabled"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetAutoTimeEnabled() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"", ""testSetAutoTimeEnabled"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(true)
                    .build(),
            new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetAutoTimeZoneEnabled"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetAutoTimeZoneEnabled() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
                    executeDeviceTestMethod("".TimeManagementTest"", ""testSetAutoTimeZoneEnabled"");
                }, new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_ZONE_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(true)
                        .build(),
                new DevicePolicyEventWrapper.Builder(EventId.SET_AUTO_TIME_ZONE_VALUE)
                        .setAdminPackageName(DEVICE_ADMIN_PKG)
                        .setBoolean(false)
                        .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testEnableSystemAppLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testEnableSystemAppLogged() throws Exception {
        final List<String> enabledSystemPackageNames = getEnabledSystemPackageNames();
        // We enable an enabled package to not worry about restoring the state.
        final String systemPackageToEnable = enabledSystemPackageNames.get(0);
        final Map<String, String> params =
                ImmutableMap.of(PARAM_APP_TO_ENABLE, systemPackageToEnable);
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DevicePolicyLoggingTest"",
                    ""testEnableSystemAppLogged"", mUserId, params);
        }, new DevicePolicyEventWrapper.Builder(EventId.ENABLE_SYSTEM_APP_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(systemPackageToEnable)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testEnableSystemAppWithIntentLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testEnableSystemAppWithIntentLogged() throws Exception {
        final String systemPackageToEnable = getLaunchableSystemPackage();
        if (systemPackageToEnable == null) {
            return;
        }
        final Map<String, String> params =
                ImmutableMap.of(PARAM_APP_TO_ENABLE, systemPackageToEnable);
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".DevicePolicyLoggingTest"",
                    ""testEnableSystemAppWithIntentLogged"", mUserId, params);
        }, new DevicePolicyEventWrapper.Builder(EventId.ENABLE_SYSTEM_APP_WITH_INTENT_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(""android.intent.action.MAIN"")
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetUninstallBlockedLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testSetUninstallBlockedLogged() throws Exception {
        installAppAsUser(PERMISSIONS_APP_APK, mUserId);
        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".DevicePolicyLoggingTest"",
                    ""testSetUninstallBlockedLogged"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_UNINSTALL_BLOCKED_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(PERMISSIONS_APP_PKG)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testEnrollmentSpecificIdCorrectCalculationLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testEnrollmentSpecificIdCorrectCalculationLogged() throws Exception {
        boolean isManagedProfile = (mPrimaryUserId != mUserId);

        assertMetricsLogged(getDevice(), () -> {
            executeDeviceTestMethod("".EnrollmentSpecificIdTest"",
                    ""testCorrectCalculationOfEsid"");
        }, new DevicePolicyEventWrapper.Builder(EventId.SET_ORGANIZATION_ID_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(isManagedProfile)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testApplicationRestrictionIsRestricted"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testApplicationRestrictionIsRestricted() throws Exception {
        installAppAsUser(DELEGATE_APP_APK, mUserId);
        runDeviceTestsAsUser(DELEGATE_APP_PKG, "".AppRestrictionsIsCallerDelegateHelper"",
            ""testAssertCallerIsNotApplicationRestrictionsManagingPackage"", mUserId);
        runDeviceTestsAsUser(DEVICE_ADMIN_PKG, "".ApplicationRestrictionsIsCallerDelegateHelper"",
            ""testSetApplicationRestrictionsManagingPackageToDelegate"", mUserId);
        runDeviceTestsAsUser(DELEGATE_APP_PKG, "".AppRestrictionsIsCallerDelegateHelper"",
            ""testAssertCallerIsApplicationRestrictionsManagingPackage"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionGrant"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrant() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateDenied_permissionRemainsDenied"");
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateGranted_permissionRemainsGranted"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionGrant_developmentPermission"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrant_developmentPermission() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod(
                "".PermissionsTest"", ""testPermissionGrantState_developmentPermission"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testGrantOfSensorsRelatedPermissions"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testGrantOfSensorsRelatedPermissions() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testSensorsRelatedPermissionsCannotBeGranted"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDenyOfSensorsRelatedPermissions"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDenyOfSensorsRelatedPermissions() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testSensorsRelatedPermissionsCanBeDenied"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSensorsRelatedPermissionsNotGrantedViaPolicy"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSensorsRelatedPermissionsNotGrantedViaPolicy() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testSensorsRelatedPermissionsNotGrantedViaPolicy"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionPolicy"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionPolicy() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionPolicyAutoDeny_permissionLocked"");
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionPolicyAutoGrant_permissionLocked"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAutoGrantMultiplePermissionsInGroup"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAutoGrantMultiplePermissionsInGroup() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionPolicyAutoGrant_multiplePermissionsInGroup"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionMixedPolicies"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionMixedPolicies() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateDenied_mixedPolicies"");
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateGranted_mixedPolicies"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionGrantOfDisallowedPermissionWhileOtherPermIsGranted"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrantOfDisallowedPermissionWhileOtherPermIsGranted()
            throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"",
                ""testPermissionGrantStateDenied_otherPermissionIsGranted"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionPrompts"	"CtsDevicePolicyManagerTestCases"	"1: app"	"@FlakyTest(bugId = 187862351)
    public void testPermissionPrompts() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionPrompts"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionAppUpdate"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionAppUpdate() throws Exception {
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionGrantStateDenied"");
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testCannotRequestPermission"");

        assertNull(getDevice().uninstallPackage(PERMISSIONS_APP_PKG));
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionGrantStateGranted"");
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testCanRequestPermission"");

        assertNull(getDevice().uninstallPackage(PERMISSIONS_APP_PKG));
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionPolicyAutoDeny"");
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testCannotRequestPermission"");

        assertNull(getDevice().uninstallPackage(PERMISSIONS_APP_PKG));
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionPolicyAutoGrant"");
        installAppPermissionAppAsUser();
        executeDeviceTestMethod("".PermissionsTest"", ""testCanRequestPermission"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPermissionGrantPreMApp"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPermissionGrantPreMApp() throws Exception {
        installAppAsUser(SIMPLE_PRE_M_APP_APK, mUserId);
        executeDeviceTestMethod("".PermissionsTest"", ""testPermissionGrantState_preMApp"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testScreenCaptureDisabled_assist"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testScreenCaptureDisabled_assist() throws Exception {
        try {
            // Install and enable assistant, notice that profile can't have assistant.
            installAppAsUser(ASSIST_APP_APK, mPrimaryUserId);
            waitForBroadcastIdle();
            setVoiceInteractionService(ASSIST_INTERACTION_SERVICE);
            setScreenCaptureDisabled_assist(mUserId, true /* disabled */);
        } finally {
            setScreenCaptureDisabled_assist(mUserId, false /* disabled */);
            clearVoiceInteractionService();
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAccountManagement_deviceAndProfileOwnerAlwaysAllowed"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAccountManagement_deviceAndProfileOwnerAlwaysAllowed() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mUserId);
        executeDeviceTestClass("".AllowedAccountManagementTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAccountManagement_userRestrictionAddAccount"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAccountManagement_userRestrictionAddAccount() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mUserId);
        try {
            changeUserRestrictionOrFail(DISALLOW_MODIFY_ACCOUNTS, true, mUserId);
            executeAccountTest(""testAddAccount_blocked"");
        } finally {
            // Ensure we clear the user restriction
            changeUserRestrictionOrFail(DISALLOW_MODIFY_ACCOUNTS, false, mUserId);
        }
        executeAccountTest(""testAddAccount_allowed"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAccountManagement_userRestrictionRemoveAccount"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAccountManagement_userRestrictionRemoveAccount() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mUserId);
        try {
            changeUserRestrictionOrFail(DISALLOW_MODIFY_ACCOUNTS, true, mUserId);
            executeAccountTest(""testRemoveAccount_blocked"");
        } finally {
            // Ensure we clear the user restriction
            changeUserRestrictionOrFail(DISALLOW_MODIFY_ACCOUNTS, false, mUserId);
        }
        executeAccountTest(""testRemoveAccount_allowed"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAccountManagement_disabledAddAccount"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAccountManagement_disabledAddAccount() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mUserId);
        try {
            changeAccountManagement(COMMAND_BLOCK_ACCOUNT_TYPE, ACCOUNT_TYPE, mUserId);
            executeAccountTest(""testAddAccount_blocked"");
        } finally {
            // Ensure we remove account management policies
            changeAccountManagement(COMMAND_UNBLOCK_ACCOUNT_TYPE, ACCOUNT_TYPE, mUserId);
        }
        executeAccountTest(""testAddAccount_allowed"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testAccountManagement_disabledRemoveAccount"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testAccountManagement_disabledRemoveAccount() throws Exception {
        installAppAsUser(ACCOUNT_MANAGEMENT_APK, mUserId);
        try {
            changeAccountManagement(COMMAND_BLOCK_ACCOUNT_TYPE, ACCOUNT_TYPE, mUserId);
            executeAccountTest(""testRemoveAccount_blocked"");
        } finally {
            // Ensure we remove account management policies
            changeAccountManagement(COMMAND_UNBLOCK_ACCOUNT_TYPE, ACCOUNT_TYPE, mUserId);
        }
        executeAccountTest(""testRemoveAccount_allowed"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDelegatedCertInstallerDirectly"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDelegatedCertInstallerDirectly() throws Exception {
        assumeTrue(mHasAttestation);

        setUpDelegatedCertInstallerAndRunTests(() ->
            runDeviceTestsAsUser(""com.android.cts.certinstaller"",
                    "".DirectDelegatedCertInstallerTest"", mUserId));
    }

    // This test generates a key pair and validates that an app can be silently granted
    // access to it."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSetWallpaper_disallowed"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSetWallpaper_disallowed() throws Exception {
        // UserManager.DISALLOW_SET_WALLPAPER
        final String DISALLOW_SET_WALLPAPER = ""no_set_wallpaper"";
        if (!hasService(""wallpaper"")) {
            CLog.d(""testSetWallpaper_disallowed(): device does not support wallpapers"");
            return;
        }

        installAppAsUser(CUSTOMIZATION_APP_APK, mUserId);
        try {
            changeUserRestrictionOrFail(DISALLOW_SET_WALLPAPER, true, mUserId);
            runDeviceTestsAsUser(CUSTOMIZATION_APP_PKG, "".CustomizationTest"",
                ""testSetWallpaper_disallowed"", mUserId);
        } finally {
            changeUserRestrictionOrFail(DISALLOW_SET_WALLPAPER, false, mUserId);
        }
    }

    // Runs test with admin privileges. The test methods set all the tested restrictions
    // inside. But these restrictions must have no effect on the device/profile owner behavior."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDisallowAutofill_allowed"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDisallowAutofill_allowed() throws Exception {
        boolean hasAutofill = hasDeviceFeature(""android.software.autofill"");
        if (!hasAutofill) {
          return;
        }
        installAppAsUser(AUTOFILL_APP_APK, mUserId);

        executeDeviceTestMethod("".AutofillRestrictionsTest"",
                ""testDisallowAutofill_allowed"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDisallowContentCapture_allowed"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDisallowContentCapture_allowed() throws Exception {
        boolean hasContentCapture = hasService(""content_capture"");
        if (!hasContentCapture) {
            return;
        }
        installAppAsUser(CONTENT_CAPTURE_SERVICE_APK, mUserId);
        installAppAsUser(CONTENT_CAPTURE_APP_APK, mUserId);

        setDefaultContentCaptureServiceEnabled(false);
        try {
            executeDeviceTestMethod("".ContentCaptureRestrictionsTest"",
                    ""testDisallowContentCapture_allowed"");
        } finally {
            setDefaultContentCaptureServiceEnabled(true);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testDisallowContentSuggestions_allowed"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testDisallowContentSuggestions_allowed() throws Exception {
        boolean hasContentSuggestions = hasService(""content_suggestions"");
        if (!hasContentSuggestions) {
            return;
        }
        installAppAsUser(CONTENT_SUGGESTIONS_APP_APK, mUserId);

        setDefaultContentSuggestionsServiceEnabled(false);
        try {
            executeDeviceTestMethod("".ContentSuggestionsRestrictionsTest"",
                    ""testDisallowContentSuggestions_allowed"");
        } finally {
            setDefaultContentSuggestionsServiceEnabled(true);
        }
    }

    private void setDefaultContentSuggestionsServiceEnabled(boolean enabled)
            throws DeviceNotAvailableException {
        CLog.d(""setDefaultContentSuggestionsServiceEnabled("" + mUserId + ""): "" + enabled);
        getDevice().executeShellCommand(
                ""cmd content_suggestions set default-service-enabled "" + mUserId + "" "" + enabled);
    }

    private void setDefaultContentCaptureServiceEnabled(boolean enabled)
            throws Exception {
        CLog.d(""setDefaultServiceEnabled("" + mUserId + ""): "" + enabled);
        getDevice().executeShellCommand(
                ""cmd content_capture set default-service-enabled "" + mUserId + "" "" + enabled);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testSuspendPackageWithPackageManager"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testSuspendPackageWithPackageManager() throws Exception {
        CLog.i(""runTestSuspendPackageWithPackageManager() on user %d"", mUserId);

        installAppAsUser(INTENT_SENDER_APK, mUserId);
        installAppAsUser(INTENT_RECEIVER_APK, mUserId);
        // Suspend a testing package with the PackageManager
        executeDeviceTestMethod("".SuspendPackageTest"",
                ""testSetPackagesSuspendedWithPackageManager"");
        // Verify that the package is suspended from the PREVIOUS test and that the dialog is shown
        executeSuspendPackageTestMethod(""testPackageSuspendedWithPackageManager"");

        // Undo the suspend.
        executeDeviceTestMethod("".SuspendPackageTest"",
                ""testSetPackagesNotSuspendedWithPackageManager"");
        // Verify that the package is not suspended from the PREVIOUS test and that the app launches
        executeSuspendPackageTestMethod(""testPackageNotSuspended"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerTest"	"testPrintingPolicy"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testPrintingPolicy() throws Exception {
        assumeHasPrintFeature();

        installAppAsUser(PRINTING_APP_APK, mUserId);
        executeDeviceTestClass("".PrintingPolicyTest"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testTransferOwnershipNoMetadata"	"CtsDevicePolicyManagerTestCases"	"1: data"	"public void testTransferOwnershipNoMetadata() throws Exception {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
                mOutgoingTestClassName,
                ""testTransferOwnershipNoMetadata"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testTransferCompleteCallback"	"CtsDevicePolicyManagerTestCases"	"1: called"	"public void testTransferCompleteCallback() throws Exception {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
                mOutgoingTestClassName,
                ""testTransferOwnership"", mUserId);

        waitForBroadcastIdle();

        runDeviceTestsAsUser(TRANSFER_OWNER_INCOMING_PKG,
                mIncomingTestClassName,
                ""testTransferCompleteCallbackIsCalled"", mUserId);
    }

    protected void setupTestParameters(int userId, String outgoingTestClassName,
            String incomingTestClassName) {
        mUserId = userId;
        mOutgoingTestClassName = outgoingTestClassName;
        mIncomingTestClassName = incomingTestClassName;
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testGetTransferOwnershipBundleOnlyCalledFromAdmin"	"CtsDevicePolicyManagerTestCases"	"2: called only"	"public void testGetTransferOwnershipBundleOnlyCalledFromAdmin()
            throws DeviceNotAvailableException {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
                mOutgoingTestClassName,
                ""testGetTransferOwnershipBundleOnlyCalledFromAdmin"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testTransferOwnership"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testTransferOwnership() throws Exception {
        final boolean hasManagedProfile = (mUserId != mPrimaryUserId);
        final String expectedManagementType = hasManagedProfile ? ""profile-owner"" : ""device-owner"";
        assertMetricsLogged(getDevice(), () -> {
            runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG, mOutgoingTestClassName,
                    ""testTransferOwnership"", mUserId);
        }, new DevicePolicyEventWrapper.Builder(EventId.TRANSFER_OWNERSHIP_VALUE)
                .setAdminPackageName(TRANSFER_OWNER_OUTGOING_PKG)
                .setStrings(TRANSFER_OWNER_INCOMING_PKG, expectedManagementType)
                .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testTransferInvalidTarget"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testTransferInvalidTarget() throws Exception {
        installAppAsUser(INVALID_TARGET_APK, mUserId);
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
                mOutgoingTestClassName,
                ""testTransferInvalidTarget"", mUserId);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testIsBundleNullNoTransfer"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testIsBundleNullNoTransfer() throws DeviceNotAvailableException {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
                mOutgoingTestClassName,
                ""testIsBundleNullNoTransfer"", mUserId);
    }

    protected int setupManagedProfileOnDeviceOwner(String apkName, String adminReceiverClassName)
            throws Exception {
        return setupManagedProfile(apkName, adminReceiverClassName);
    }

    protected int setupManagedProfile(String apkName, String adminReceiverClassName)
            throws Exception {
        final int userId = createManagedProfile(mPrimaryUserId);
        installAppAsUser(apkName, userId);
        if (!setProfileOwner(adminReceiverClassName, userId, false)) {
            removeAdmin(TRANSFER_OWNER_OUTGOING_TEST_RECEIVER, userId);
            getDevice().uninstallPackage(TRANSFER_OWNER_OUTGOING_PKG);
            fail(""Failed to set device owner"");
            return -1;
        }
        startUserAndWait(userId);
        return userId;
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.DeviceAndProfileOwnerHostSideTransferTest"	"testTargetDeviceAdminServiceBound"	"CtsDevicePolicyManagerTestCases"	"1: app"	"public void testTargetDeviceAdminServiceBound() throws Exception {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
            mOutgoingTestClassName,
            ""testTransferOwnership"", mUserId);
        assertServiceRunning(INCOMING_ADMIN_SERVICE_FULL_NAME);
    }

    private void assertServiceRunning(String serviceName) throws DeviceNotAvailableException {
        final String result = getDevice().executeShellCommand(
                String.format(""dumpsys activity services %s"", serviceName));
        assertThat(result).contains(""app=ProcessRecord"");
    }

    protected void setSameAffiliationId(int profileUserId, String testClassName)
        throws Exception {
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
            testClassName,
            ""testSetAffiliationId1"", mPrimaryUserId);
        runDeviceTestsAsUser(TRANSFER_OWNER_OUTGOING_PKG,
            testClassName,
            ""testSetAffiliationId1"", profileUserId);
    }

    protected void assertAffiliationIdsAreIntact(int profileUserId,
        String testClassName) throws Exception {
        runDeviceTestsAsUser(TRANSFER_OWNER_INCOMING_PKG,
            testClassName,
            ""testIsAffiliationId1"", mPrimaryUserId);
        runDeviceTestsAsUser(TRANSFER_OWNER_INCOMING_PKG,
            testClassName,
            ""testIsAffiliationId1"", profileUserId);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceAndProfileOwnerHostSideTransferTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.MixedManagedProfileOwnerTestApi30"	"removeTestUsers"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.FEATURE_MANAGED_USERS;

import com.android.cts.devicepolicy.DeviceAdminFeaturesCheckerRule.RequiresAdditionalFeatures;

import org.junit.Test;

/**
 * Set of tests for managed profile owner use cases that may also apply to device owner.
 * Tests that should be run identically in both cases are added in DeviceAndProfileOwnerTestApi30.
 */
// We need managed users to be supported in order to create a profile of the user owner.
@RequiresAdditionalFeatures({FEATURE_MANAGED_USERS})
public class MixedManagedProfileOwnerTestApi30 extends DeviceAndProfileOwnerTestApi30 {
    private int mParentUserId = -1;

    @Override
    public void setUp() throws Exception {
        super.setUp();

        removeTestUsers();
        mParentUserId = mPrimaryUserId;
        createManagedProfile();
    }

    private void createManagedProfile() throws Exception {
        mUserId = createManagedProfile(mParentUserId);
        switchUser(mParentUserId);
        startUserAndWait(mUserId);

        installAppAsUser(DEVICE_ADMIN_APK, mUserId);
        setProfileOwnerOrFail(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mUserId);
        startUserAndWait(mUserId);
    }

    @Override
    public void tearDown() throws Exception {
        removeUser(mUserId);

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/MixedManagedProfileOwnerTestApi30.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.AdbProvisioningTests"	"testAdbDeviceOwnerLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAdbDeviceOwnerLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            setDeviceOwner(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mDeviceOwnerUserId,
                    /* expectFailure */ false);
        }, new DevicePolicyEventWrapper.Builder(EventId.PROVISIONING_ENTRY_POINT_ADB_VALUE)
                    .setAdminPackageName(DEVICE_ADMIN_PKG)
                    .setBoolean(false)
                    .setStrings(""device-owner"")
                    .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/AdbProvisioningTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.AdbProvisioningTests"	"testAdbProfileOwnerLogged"	"CtsDevicePolicyManagerTestCases"	"2: UI app"	"public void testAdbProfileOwnerLogged() throws Exception {
        assertMetricsLogged(getDevice(), () -> {
            setProfileOwner(DEVICE_ADMIN_PKG + ""/"" + ADMIN_RECEIVER_TEST_CLASS, mPrimaryUserId,
                    /* expectFailure */ false);
        }, new DevicePolicyEventWrapper.Builder(EventId.PROVISIONING_ENTRY_POINT_ADB_VALUE)
                .setAdminPackageName(DEVICE_ADMIN_PKG)
                .setBoolean(false)
                .setStrings(""profile-owner"")
                .build());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/AdbProvisioningTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.HeadlessSystemUserDeviceOwnerTest"	"isHeadlessSystemUserMode"	"CtsDevicePolicyManagerTestCases"	"1: 9.1"	"/*
 *.
 */

package com.android.cts.devicepolicy;

import static org.junit.Assume.assumeTrue;

import org.junit.Test;

// TODO(b/174859111): move to device-side, automotive specific module
/**
 * Device owner tests specific for devices that use
 * {@link android.os.UserManager#isHeadlessSystemUserMode()}.
 */
public final class HeadlessSystemUserDeviceOwnerTest extends BaseDeviceOwnerTest {

    @Override
    public void setUp() throws Exception {
        assumeTrue(""device is not headless system user mode"", isHeadlessSystemUserMode());

        super.setUp();
    }

    @Override
    public void tearDown() throws Exception {
        if (!isHeadlessSystemUserMode()) return;

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/HeadlessSystemUserDeviceOwnerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.PasswordComplexityTest"	"testGetPasswordComplexity"	"CtsDevicePolicyManagerTestCases"	"3: called UI app"	"public void testGetPasswordComplexity() throws Exception {
        assertMetricsLogged(
                getDevice(),
                () -> runDeviceTestsAsUser(PKG, CLS, mCurrentUserId),
                new DevicePolicyEventWrapper
                        .Builder(EventId.GET_USER_PASSWORD_COMPLEXITY_LEVEL_VALUE)
                        .setStrings(""notCalledFromParent"", PKG).build());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/PasswordComplexityTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.devicepolicy.PasswordComplexityTest"	"assumeTestEnabled"	"CtsDevicePolicyManagerTestCases"	"1: app"	"package com.android.cts.devicepolicy;

import static com.android.cts.devicepolicy.metrics.DevicePolicyEventLogVerifier.assertMetricsLogged;

import static org.junit.Assert.fail;

import android.stats.devicepolicy.EventId;

import com.android.cts.devicepolicy.metrics.DevicePolicyEventWrapper;

import org.junit.Test;

/** Host-side tests to run the CtsPasswordComplexity device-side tests. */
public class PasswordComplexityTest extends BaseDevicePolicyTest {

    private static final String APP = ""CtsPasswordComplexity.apk"";
    private static final String PKG = ""com.android.cts.passwordcomplexity"";
    private static final String CLS = "".GetPasswordComplexityTest"";

    private int mCurrentUserId;

    @Override
    protected void assumeTestEnabled() throws Exception {
        assumeHasSecureLockScreenFeature();
    }

    @Override
    public void setUp() throws Exception {
        super.setUp();

        if (!getDevice().executeShellCommand(""cmd lock_settings verify"")
                .startsWith(""Lock credential verified successfully"")) {
            fail(""Please remove the device screen lock before running this test"");
        }

        mCurrentUserId = getDevice().getCurrentUser();
        installAppAsUser(APP, mCurrentUserId);
    }

    @Override
    public void tearDown() throws Exception {
        getDevice().uninstallPackage(PKG);

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/PasswordComplexityTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.WipeDataTest"	"testWipeDataThrowsSecurityException"	""	"1: data"	"public void testWipeDataThrowsSecurityException() {
        try {
            Log.i(TAG, ""Calling wipeData() on "" + dpm);
            dpm.wipeData(/* flags= */ 0);
            fail(""wipeData didn't throw expected SecurityException. Managed to kick off factory""
                    + "" reset process"");
        } catch (SecurityException expected) {
            Log.v(TAG, ""Got exception as expected: "" + expected);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/WipeDataTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminPasswordTest"	"assertNotDeviceOwner"	""	"1: UI"	"public void test/*
 *.
 */
package com.android.cts.deviceadmin;

import android.os.Build;

/**
 * Tests that:
 * - need to be run as device admin (as opposed to device owner) and
 * - require resetting the password at the end.
 *
 * Note: when adding a new method, make sure to add a corresponding method in
 * BaseDeviceAdminHostSideTest.
 */
public class DeviceAdminPasswordTest extends BaseDeviceAdminTest {

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        assertNotDeviceOwner();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminPasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminPasswordTest"	"testResetPasswordDeprecated"	""	"2: UI app"	"public void testResetPasswordDeprecated() {
        if (getTargetSdkLevel() < Build.VERSION_CODES.N) {
            assertFalse(dpm.resetPassword(""1234"", 0));
        } else {
            try {
                dpm.resetPassword(""1234"", 0);
                fail(""resetPassword() should throw SecurityException"");
            } catch (SecurityException e) { }
        }
    }

    private int getTargetSdkLevel() {
        return mContext.getApplicationContext().getApplicationInfo().targetSdkVersion;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminPasswordTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminTest"	"assertNotDeviceOwner"	""	"2: UI app"	"public void test/*
 *.
 */
package com.android.cts.deviceadmin;

import android.app.admin.DevicePolicyManager;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.os.Build;

/**
 * Device admin device side tests.
 */
public class DeviceAdminTest extends BaseDeviceAdminTest {
    @Override
    protected void setUp() throws Exception {
        super.setUp();

        assertNotDeviceOwner();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminTest"	"testTargetApiLevel"	""	"2: UI app"	"public void testTargetApiLevel() throws Exception {
        final PackageManager pm = mContext.getPackageManager();

        final PackageInfo pi = pm.getPackageInfo(mContext.getPackageName(), /* flags =*/ 0);

        assertTrue(getTargetApiLevel() == pi.applicationInfo.targetSdkVersion ||
                Build.VERSION_CODES.CUR_DEVELOPMENT == pi.applicationInfo.targetSdkVersion);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminTest"	"testPasswordHistoryLength"	""	"1: only"	"public void testPasswordHistoryLength() {
        if (!mHasSecureLockScreen) {
            return;
        }
        // Password history length restriction is only imposed if password quality is at least
        // numeric.
        dpm.setPasswordQuality(mAdminComponent,
                DevicePolicyManager.PASSWORD_QUALITY_ALPHABETIC);
        int originalValue = dpm.getPasswordHistoryLength(mAdminComponent);
        try {
            dpm.setPasswordHistoryLength(mAdminComponent, 3);
            assertEquals(3, dpm.getPasswordHistoryLength(mAdminComponent));
            // Although it would make sense we cannot test if password history restrictions
            // are enforced as DevicePolicyManagerService.resetPassword fails to do so at the
            // moment. See b/17707820
        } finally {
            dpm.setPasswordHistoryLength(mAdminComponent, originalValue);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceadmin.DeviceAdminWithEnterprisePoliciesBlockedTest"	"testCameraDisabled"	""	"1: camera"	"public void testCameraDisabled() {
        boolean originalValue = dpm.getCameraDisabled(mAdminComponent);
        assertSecurityException(() -> dpm.setCameraDisabled(mAdminComponent, true));
        assertEquals(originalValue, dpm.getCameraDisabled(mAdminComponent));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAdmin/src/com.android.cts.deviceadmin/DeviceAdminWithEnterprisePoliciesBlockedTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferOutgoingTest"	"testTransferOwnershipNoMetadata"	""	"1: data"	"public void testTransferOwnershipNoMetadata() throws Throwable {
        PersistableBundle b = new PersistableBundle();
        assertThrows(
                IllegalArgumentException.class,
                () -> {
                    mDevicePolicyManager.transferOwnership(mOutgoingComponentName,
                            INCOMING_NO_METADATA_COMPONENT_NAME, b);
                });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferOutgoingTest"	"testGetTransferOwnershipBundleOnlyCalledFromAdmin"	""	"2: called only"	"public void testGetTransferOwnershipBundleOnlyCalledFromAdmin() throws Throwable {
        PersistableBundle b = new PersistableBundle();
        b.putBoolean(ARE_PARAMETERS_SAVED, true);
        mDevicePolicyManager.transferOwnership(mOutgoingComponentName, INCOMING_COMPONENT_NAME, b);
        assertThrows(SecurityException.class, mDevicePolicyManager::getTransferOwnershipBundle);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferOutgoingTest"	"testTransferOwnershipChangedBroadcast"	""	"1: UI"	"public void testTransferOwnershipChangedBroadcast() throws Throwable {
        BlockingBroadcastReceiver receiver = new BlockingBroadcastReceiver(mContext,
                mOwnerChangedBroadcastAction);
        try {
            receiver.register();
            PersistableBundle b = new PersistableBundle();
            mDevicePolicyManager.transferOwnership(mOutgoingComponentName,
                    INCOMING_COMPONENT_NAME, b);
            Intent intent = receiver.awaitForBroadcast();
            assertNotNull(intent);
        } finally {
            receiver.unregisterQuietly();
        }
    }

    abstract public void testTransferOwnership() throws Throwable;"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferOutgoingTest"	"testIsBundleNullNoTransfer"	""	"1: app"	"public void testIsBundleNullNoTransfer() throws Throwable {
        assertNull(mDevicePolicyManager.getTransferOwnershipBundle());
    }

    private void setUserRestriction(String restriction, boolean add) {
        DevicePolicyManager dpm = mContext.getSystemService(DevicePolicyManager.class);
        if (add) {
            dpm.addUserRestriction(mOutgoingComponentName, restriction);
        } else {
            dpm.clearUserRestriction(mOutgoingComponentName, restriction);
        }
    }

    private void setAffiliationId(String id) {
        ComponentName admin = mOutgoingComponentName;
        DevicePolicyManager dpm = (DevicePolicyManager)
                mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
        Set<String> ids = Collections.singleton(id);
        dpm.setAffiliationIds(admin, ids);
        assertEquals(ids, dpm.getAffiliationIds(admin));
    }

    private static SharedPreferences getPrefs(Context context) {
        return context.getSharedPreferences(SHARED_PREFERENCE_NAME, Context.MODE_PRIVATE);
    }

    private static void putBooleanPref(Context context, String key, boolean value) {
        getPrefs(context).edit().putBoolean(key, value).apply();
    }

    protected static boolean getBooleanPref(Context context, String key) {
        return getPrefs(context).getBoolean(key, false);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferProfileOwnerOutgoingTest"	"testTransferWithPoliciesOutgoing"	""	"1: camera"	"public void testTransferWithPoliciesOutgoing() throws Throwable {
        int passwordLength = 123;
        int passwordExpirationTimeout = 456;
        DevicePolicyManager parentDevicePolicyManager =
                mDevicePolicyManager.getParentProfileInstance(mOutgoingComponentName);
        mDevicePolicyManager.setCameraDisabled(mOutgoingComponentName, true);
        mDevicePolicyManager.setPasswordQuality(
                mOutgoingComponentName, DevicePolicyManager.PASSWORD_QUALITY_NUMERIC);
        mDevicePolicyManager.setPasswordMinimumLength(mOutgoingComponentName, passwordLength);
        mDevicePolicyManager.setCrossProfileCallerIdDisabled(mOutgoingComponentName, true);
        parentDevicePolicyManager.setPasswordExpirationTimeout(
                mOutgoingComponentName, passwordExpirationTimeout);

        PersistableBundle b = new PersistableBundle();
        mDevicePolicyManager.transferOwnership(mOutgoingComponentName, INCOMING_COMPONENT_NAME, b);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/TransferProfileOwnerOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferProfileOwnerOutgoingTest"	"testTransferOwnership"	""	"1: app"	"public void testTransferOwnership() throws Throwable {
        PersistableBundle b = new PersistableBundle();
        mDevicePolicyManager.transferOwnership(mOutgoingComponentName, INCOMING_COMPONENT_NAME, b);
        assertTrue(mDevicePolicyManager.isAdminActive(INCOMING_COMPONENT_NAME));
        assertTrue(mDevicePolicyManager.isProfileOwnerApp(INCOMING_COMPONENT_NAME.getPackageName()));
        assertFalse(
                mDevicePolicyManager.isProfileOwnerApp(mOutgoingComponentName.getPackageName()));
        assertFalse(mDevicePolicyManager.isAdminActive(mOutgoingComponentName));
        assertThrows(SecurityException.class, () -> {
            mDevicePolicyManager.setCrossProfileCallerIdDisabled(mOutgoingComponentName,
                    false);
        });
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/TransferProfileOwnerOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferDeviceOwnerOutgoingTest"	"testTransferWithPoliciesOutgoing"	""	"1: camera"	"public void testTransferWithPoliciesOutgoing() throws Throwable {
        int passwordLength = 123;
        mDevicePolicyManager.setCameraDisabled(mOutgoingComponentName, true);
        mDevicePolicyManager.setPasswordQuality(
                mOutgoingComponentName, DevicePolicyManager.PASSWORD_QUALITY_NUMERIC);
        mDevicePolicyManager.setPasswordMinimumLength(mOutgoingComponentName, passwordLength);
        mDevicePolicyManager.setKeepUninstalledPackages(mOutgoingComponentName,
                Collections.singletonList(""test.package""));
        mDevicePolicyManager.setSystemUpdatePolicy(mOutgoingComponentName,
                SystemUpdatePolicy.createPostponeInstallPolicy());
        PersistableBundle b = new PersistableBundle();
        mDevicePolicyManager.transferOwnership(mOutgoingComponentName, INCOMING_COMPONENT_NAME, b);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/TransferDeviceOwnerOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferDeviceOwnerOutgoingTest"	"testTransferAffiliatedProfileOwnershipCompleteCallbackIsCalled"	""	"1: called"	"public void testTransferAffiliatedProfileOwnershipCompleteCallbackIsCalled() {
        assertTrue(getBooleanPref(mContext, KEY_TRANSFER_AFFILIATED_PROFILE_COMPLETED_CALLED));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/TransferDeviceOwnerOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferDeviceOwnerOutgoingTest"	"testTransferOwnership"	""	"1: app"	"public void testTransferOwnership() throws Throwable {
        PersistableBundle b = new PersistableBundle();
        mDevicePolicyManager.transferOwnership(mOutgoingComponentName, INCOMING_COMPONENT_NAME, b);
        assertTrue(mDevicePolicyManager.isAdminActive(INCOMING_COMPONENT_NAME));
        assertTrue(mDevicePolicyManager.isDeviceOwnerApp(INCOMING_COMPONENT_NAME.getPackageName()));
        assertFalse(
                mDevicePolicyManager.isDeviceOwnerApp(mOutgoingComponentName.getPackageName()));
        assertFalse(mDevicePolicyManager.isAdminActive(mOutgoingComponentName));
        assertThrows(SecurityException.class, () -> {
            mDevicePolicyManager.getSecondaryUsers(mOutgoingComponentName);
        });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerOutgoingApp/src/com/android/cts/transferowner/TransferDeviceOwnerOutgoingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryDisableQuietMode"	""	"4: data live UI app"	"public void testTryDisableQuietMode() throws Exception {
        setTestAppAsDefaultLauncher();
        startLauncherActivityInTestApp();

        Intent intent = trySetQuietModeEnabled(false);
        assertNotNull(""Failed to receive ACTION_MANAGED_PROFILE_AVAILABLE broadcast"", intent);
        assertFalse(mUserManager.isQuietModeEnabled(mTargetUser));
    }

    private Intent trySetQuietModeEnabled(boolean enabled) throws Exception {
        return trySetQuietModeEnabled(enabled, false, 0, true);
    }

    private Intent trySetQuietModeEnabled(boolean enabled, boolean hasFlags, int flags,
            boolean expectsCredentialsNotNeeded) throws Exception {
        final String action = enabled
                ? Intent.ACTION_MANAGED_PROFILE_UNAVAILABLE
                : Intent.ACTION_MANAGED_PROFILE_AVAILABLE;

        BlockingBroadcastReceiver receiver =
                new BlockingBroadcastReceiver(mContext, action);
        try {
            receiver.register();

            boolean credentialNotNeeded = askLauncherSupportAppToSetQuietMode(enabled, hasFlags,
                    flags);
            assertEquals(credentialNotNeeded, expectsCredentialsNotNeeded);
            return receiver.awaitForBroadcast();
        } finally {
            receiver.unregisterQuietly();
        }
    }

    /**
     * Ask launcher support test app to set quiet mode by sending broadcast.
     * <p>
     * We cannot simply make this package the launcher and call the API because instrumentation
     * process would always considered to be in the foreground. The trick here is to send
     * broadcast to another test app which is launcher itself and call the API through it.
     * The receiver will then send back the result, and it should be either true, false or
     * security-exception.
     * <p>
     * All the constants defined here should be aligned with
     * com.android.cts.launchertests.support.QuietModeCommandReceiver.
     */
    private boolean askLauncherSupportAppToSetQuietMode(boolean enabled, boolean hasFlags, int flags) throws Exception {
        Intent intent = new Intent(""toggle_quiet_mode"");
        intent.setComponent(COMMAND_RECEIVER);
        intent.putExtra(""quiet_mode"", enabled);
        intent.putExtra(Intent.EXTRA_USER, mTargetUser);
        if (hasFlags) {
            intent.putExtra(EXTRA_FLAGS, flags);
        }

        // Ask launcher support app to set quiet mode by sending broadcast.
        LinkedBlockingQueue<String> blockingQueue = new LinkedBlockingQueue<>();
        mContext.sendOrderedBroadcast(intent, null, new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                blockingQueue.offer(getResultData());
            }
        }, null, 0, """", null);

        // Wait for the result.
        String result = null;
        for (int i = 0; i < 10; i++) {
            // Broadcast won't be delivered when the device is sleeping, so wake up the device
            // in between each attempt.
            wakeupDeviceAndUnlock();
            result = blockingQueue.poll(10, TimeUnit.SECONDS);
            if (!TextUtils.isEmpty(result)) {
                break;
            }
        }

        // Parse the result.
        assertNotNull(result);
        if (""true"".equalsIgnoreCase(result)) {
            return true;
        } else if (""false"".equalsIgnoreCase(result)) {
            return false;
        } else if (""security-exception"".equals(result)) {
            throw new SecurityException();
        }
        throw new IllegalStateException(""Unexpected result : "" + result);
    }

    private void startActivitySync(String activity) throws Exception {
        mUiDevice.executeShellCommand(""am start -W -n "" + activity);
    }

    /**
     * Start the launcher activity in the test app to make it foreground.
     */
    private void startLauncherActivityInTestApp() throws Exception {
        startActivitySync(LAUNCHER_ACTIVITY.flattenToString());
    }

    private void setTestAppAsDefaultLauncher() {
        setDefaultLauncher(InstrumentationRegistry.getInstrumentation(),
                LAUNCHER_ACTIVITY.getPackageName());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryEnableQuietMode_defaultForegroundLauncher"	""	"2: UI app"	"public void testTryEnableQuietMode_defaultForegroundLauncher() throws Exception {
        setTestAppAsDefaultLauncher();
        startLauncherActivityInTestApp();

        Intent intent = trySetQuietModeEnabled(true);
        assertNotNull(""Failed to receive ACTION_MANAGED_PROFILE_UNAVAILABLE broadcast"", intent);
        assertTrue(mUserManager.isQuietModeEnabled(mTargetUser));

        intent = trySetQuietModeEnabled(false);
        assertNotNull(""Failed to receive ACTION_MANAGED_PROFILE_AVAILABLE broadcast"", intent);
        assertFalse(mUserManager.isQuietModeEnabled(mTargetUser));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryEnableQuietMode_notForegroundLauncher"	""	"2: UI app"	"public void testTryEnableQuietMode_notForegroundLauncher() throws InterruptedException {
        setTestAppAsDefaultLauncher();

        assertThrows(SecurityException.class, () -> trySetQuietModeEnabled(true));
        assertFalse(mUserManager.isQuietModeEnabled(mTargetUser));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryEnableQuietMode_notDefaultLauncher"	""	"2: UI app"	"public void testTryEnableQuietMode_notDefaultLauncher() throws Exception {
        startLauncherActivityInTestApp();

        assertThrows(SecurityException.class, () -> trySetQuietModeEnabled(true));
        assertFalse(mUserManager.isQuietModeEnabled(mTargetUser));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryEnableQuietMode_noCredentialRequest"	""	"4: UI only identifier app"	"public void testTryEnableQuietMode_noCredentialRequest() throws Exception {
        setTestAppAsDefaultLauncher();
        startLauncherActivityInTestApp();

        Intent intent = trySetQuietModeEnabled(true,
                UserManager.QUIET_MODE_DISABLE_ONLY_IF_CREDENTIAL_NOT_REQUIRED, true);
        assertNotNull(""Failed to receive ACTION_MANAGED_PROFILE_UNAVAILABLE broadcast"", intent);
        assertTrue(mUserManager.isQuietModeEnabled(mTargetUser));

        waitForUserLocked();

        intent = trySetQuietModeEnabled(false,
                UserManager.QUIET_MODE_DISABLE_ONLY_IF_CREDENTIAL_NOT_REQUIRED, false);
        assertNull(""Received ACTION_MANAGED_PROFILE_AVAILABLE broadcast"", intent);
        assertTrue(mUserManager.isQuietModeEnabled(mTargetUser));
    }

    private void waitForUserLocked() throws Exception {
        // Should match a line in ""dumpsys mount"" output like this:
        // Local unlocked users: [0, 10]
        final Pattern p = Pattern.compile(""Local unlocked users: \\[(.*)\\]"");
        final long deadline = System.nanoTime() + TimeUnit.SECONDS.toNanos(60);
        while (System.nanoTime() < deadline) {
            final String output = mUiDevice.executeShellCommand(""dumpsys mount"");
            final Matcher matcher = p.matcher(output);
            assertTrue(""Unexpected dupmsys mount output: "" + output, matcher.find());
            final Set<Integer> unlockedUsers = Arrays.stream(matcher.group(1).split("", ""))
                    .map(Integer::valueOf)
                    .collect(Collectors.toSet());
            if (!unlockedUsers.contains(mTargetUser.getIdentifier())) {
                return;
            }
            Thread.sleep(500);
        }
        fail(""Cannot get the profile locked"");
    }

    private Intent trySetQuietModeEnabled(boolean enabled, int flags,
            boolean expectsCredentialsNotNeeded) throws Exception {
        return trySetQuietModeEnabled(enabled, true, flags, expectsCredentialsNotNeeded);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.QuietModeTest"	"testTryEnableQuietMode"	""	"2: UI app"	"public void testTryEnableQuietMode() throws Exception {
        setTestAppAsDefaultLauncher();
        startLauncherActivityInTestApp();

        Intent intent = trySetQuietModeEnabled(true);
        assertNotNull(""Failed to receive ACTION_MANAGED_PROFILE_UNAVAILABLE broadcast"", intent);
        assertTrue(mUserManager.isQuietModeEnabled(mTargetUser));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/QuietModeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testGetActivitiesForUserFails"	""	"3: app(s) apps app"	"public void testGetActivitiesForUserFails() throws Exception {
        expectSecurityException(() -> mLauncherApps.getActivityList(null, mUser),
                ""getActivities for non-profile user failed to throw exception"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testSimpleAppInstalledForUser"	""	"4: app(s) apps UI app"	"public void testSimpleAppInstalledForUser() throws Exception {
        List<LauncherActivityInfo> activities =
                mLauncherApps.getActivityList(null, mUser);
        // Check simple app is there.
        boolean foundSimpleApp = false;
        for (LauncherActivityInfo activity : activities) {
            if (activity.getComponentName().getPackageName().equals(
                    SIMPLE_APP_PACKAGE)) {
                foundSimpleApp = true;
                assertThat(activity.getLoadingProgress()).isWithin(1.0e-10f).of(1.0f);
            }
            assertThat(activity.getUser()).isEqualTo(mUser);
        }
        assertThat(foundSimpleApp).isTrue();

        // Also make sure getApplicationInfo works too.
        ApplicationInfo ai =
                mLauncherApps.getApplicationInfo(SIMPLE_APP_PACKAGE, /* flags= */ 0, mUser);
        assertThat(ai.packageName).isEqualTo(SIMPLE_APP_PACKAGE);
        assertThat(UserHandle.getUserHandleForUid(ai.uid)).isEqualTo(mUser);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testAccessPrimaryProfileFromManagedProfile"	""	"4: app(s) apps view app"	"public void testAccessPrimaryProfileFromManagedProfile() throws Exception {
        assertThat(mLauncherApps.getActivityList(null, mUser)).isEmpty();

        expectNameNotFoundException(
                () -> mLauncherApps.getApplicationInfo(SIMPLE_APP_PACKAGE, /* flags= */ 0, mUser),
                ""get applicationInfo failed to throw name not found exception"");
        assertThat(mLauncherApps.isPackageEnabled(SIMPLE_APP_PACKAGE, mUser)).isFalse();

        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(""http://www.android.com/""));
        assertThat(mLauncherApps.resolveActivity(intent, mUser)).isNull();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testGetProfiles_fromMainProfile"	""	"3: app(s) apps app"	"public void testGetProfiles_fromMainProfile() {
        List<UserHandle> profiles = mLauncherApps.getProfiles();
        assertThat(profiles).hasSize(2);
        assertThat(profiles).contains(myUserHandle());
        assertThat(profiles).containsExactlyElementsIn(mUserManager.getUserProfiles());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testGetProfiles_fromManagedProfile"	""	"3: app(s) apps app"	"public void testGetProfiles_fromManagedProfile() {
        final List<UserHandle> profiles = mLauncherApps.getProfiles();
        assertThat(profiles).containsExactly(myUserHandle());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testLaunchNonExportActivityFails"	""	"3: app(s) apps app"	"public void testLaunchNonExportActivityFails() throws Exception {
        expectSecurityException(() -> mLauncherApps.startMainActivity(new ComponentName(
                SIMPLE_APP_PACKAGE, SIMPLE_APP_PACKAGE + "".NonExportedActivity""),
                mUser, null, null),
                ""starting non-exported activity failed to throw exception"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testLaunchNonExportLauncherFails"	""	"3: app(s) apps app"	"public void testLaunchNonExportLauncherFails() throws Exception {
        expectSecurityException(() -> mLauncherApps.startMainActivity(new ComponentName(
                SIMPLE_APP_PACKAGE, SIMPLE_APP_PACKAGE + "".NonLauncherActivity""),
                mUser, null, null),
                ""starting non-launcher activity failed to throw exception"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testLaunchMainActivity"	""	"3: app(s) apps app"	"public void testLaunchMainActivity() throws Exception {
        ActivityLaunchedReceiver receiver = new ActivityLaunchedReceiver();
        IntentFilter filter = new IntentFilter();
        filter.addAction(ActivityLaunchedReceiver.ACTIVITY_LAUNCHED_ACTION);
        mContext.registerReceiver(receiver, filter);
        ComponentName compName = new ComponentName(SIMPLE_APP_PACKAGE, SIMPLE_APP_PACKAGE
                + "".SimpleActivity"");
        Log.i(TAG, ""Launching "" + compName.flattenToShortString() + "" on user "" + mUser);
        mLauncherApps.startMainActivity(compName, mUser, null, null);
        assertWithMessage(""Activity %s launched for user %s"", compName.flattenToShortString(),
                mUser).that(receiver.waitForActivity()).isEqualTo(RESULT_PASS);
        mContext.unregisterReceiver(receiver);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testReverseAccessNoThrow"	""	"3: app(s) apps app"	"public void testReverseAccessNoThrow() throws Exception {
        // Trying to access the main profile from a managed profile -> shouldn't throw but
        // should just return false.
        assertThat(mLauncherApps.isPackageEnabled(""android"", mUser)).isFalse();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testNoSystemAppHasSyntheticAppDetailsActivityInjected"	""	"5: app(s) apps UI identifier app"	"public void testNoSystemAppHasSyntheticAppDetailsActivityInjected() throws Exception {
        Log.d(TAG, ""testNoSystemAppHasSyntheticAppDetailsActivityInjected() for user "" + mUser);
        List<LauncherActivityInfo> activities = mLauncherApps.getActivityList(null, mUser);
        logActivities(activities);
        for (LauncherActivityInfo activity : activities) {
            if (!activity.getUser().equals(mUser)) {
                continue;
            }
            ApplicationInfo appInfo = activity.getApplicationInfo();
            boolean isSystemApp = ((appInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0)
                    || ((appInfo.flags & ApplicationInfo.FLAG_UPDATED_SYSTEM_APP) != 0);
            if (isSystemApp) {
                // make sure we haven't generated a synthetic app details activity for it
                assertWithMessage(""Found a system app that had a synthetic activity generated,""
                        + "" package name: %s; activity name: %s"",
                        activity.getComponentName().getPackageName(), activity.getName())
                                .that(activity.getName())
                                .isNotEqualTo(SYNTHETIC_APP_DETAILS_ACTIVITY);
            }
        }
    }

    private void disableLauncherActivity() throws IOException {
        runShellCommand(""pm disable --user %d %s"", mUser.getIdentifier(),
                LAUNCHER_ACTIVITY_COMPONENT);
    }

    private void expectSecurityException(ExceptionRunnable action, String failMessage)
            throws Exception {
        try {
            action.run();
            fail(failMessage);
        } catch (SecurityException e) {
            // expected
        }
    }

    private void expectNameNotFoundException(ExceptionRunnable action, String failMessage)
            throws Exception {
        try {
            action.run();
            fail(failMessage);
        } catch (PackageManager.NameNotFoundException e) {
            // expected
        }
    }

    private void assertActivityInjected(String targetPackage) {
        Log.d(TAG, ""Getting activities for package "" + targetPackage + "" on user "" + mUser);
        List<LauncherActivityInfo> activities = mLauncherApps.getActivityList(null, mUser);
        logActivities(activities);

        boolean noLaunchableActivityAppFound = false;
        for (LauncherActivityInfo activity : activities) {
            UserHandle user = activity.getUser();
            if (!user.equals(mUser)) {
                Log.w(TAG, ""Skipping activity "" + toString(activity) + "" from user "" + user);
                continue;
            }
            ComponentName compName = activity.getComponentName();
            if (compName.getPackageName().equals(targetPackage)) {
                noLaunchableActivityAppFound = true;
                // make sure it points to the synthetic app details activity
                assertWithMessage(""name of synthetic app"").that(activity.getName())
                        .isEqualTo(SYNTHETIC_APP_DETAILS_ACTIVITY);
                // make sure it's both exported and enabled
                try {
                    PackageManager pm = mContext.getPackageManager();
                    ActivityInfo ai = pm.getActivityInfo(compName, /* flags= */ 0);
                    assertWithMessage(""component %s enabled"", compName.flattenToShortString())
                            .that(ai.enabled).isTrue();
                    assertWithMessage(""component %s exported"", compName.flattenToShortString())
                            .that(ai.exported).isTrue();
                } catch (NameNotFoundException e) {
                    fail(""Package "" + compName.getPackageName() + "" not found: "" + e);
                }
            }
        }
        assertWithMessage(""user %s has no launchable activity for app %s"", mUser, targetPackage)
                .that(noLaunchableActivityAppFound).isTrue();
    }

    @FunctionalInterface
    public interface ExceptionRunnable {
        void run() throws Exception;
    }

    private UserHandle getUserHandleArgument(String key, Bundle arguments) throws Exception {
        String serial = arguments.getString(key);
        if (serial == null) {
            return null;
        }
        int serialNo = Integer.parseInt(serial);
        return mUserManager.getUserForSerialNumber(serialNo);
    }

    private final class Connection implements ServiceConnection {
        private final Semaphore mSemaphore = new Semaphore(0);

        @Override
        public void onServiceConnected(ComponentName className, IBinder service) {
            mService = new Messenger(service);
            mSemaphore.release();
        }

        @Override
        public void onServiceDisconnected(ComponentName className) {
            mService = null;
        }

        public void waitForService() {
            try {
                if (mSemaphore.tryAcquire(5, TimeUnit.SECONDS)) {
                    return;
                }
            } catch (InterruptedException e) {
            }
            fail(""failed to connec to service"");
        }
    };

    private static final class Result extends Handler {

        private final Semaphore mSemaphore = new Semaphore(0);
        public int result = 0;

        public Result(Looper looper) {
            super(looper);
        }

        @Override
        public void handleMessage(Message msg) {
            if (msg.what == MSG_RESULT) {
                result = msg.arg1;
                mSemaphore.release();
            } else {
                super.handleMessage(msg);
            }
        }

        public int waitForResult() {
            try {
                if (mSemaphore.tryAcquire(120, TimeUnit.SECONDS)) {
                     return result;
                }
            } catch (InterruptedException e) {
            }
            return RESULT_TIMEOUT;
        }
    }

    public final class ActivityLaunchedReceiver extends BroadcastReceiver {
        public static final String ACTIVITY_LAUNCHED_ACTION =
                ""com.android.cts.launchertests.LauncherAppsTests.LAUNCHED_ACTION"";

        private final Semaphore mSemaphore = new Semaphore(0);

        @Override
        public void onReceive(Context context, Intent intent) {
            if (intent.getAction().equals(ACTIVITY_LAUNCHED_ACTION)) {
                mSemaphore.release();
            }
        }

        public int waitForActivity() {
            try {
                if (mSemaphore.tryAcquire(5, TimeUnit.SECONDS)) {
                    return RESULT_PASS;
                }
            } catch (InterruptedException e) {
            }
            return RESULT_TIMEOUT;
        }
    }

    private int sendMessageToCallbacksService(int msg, UserHandle user, String packageName)
            throws Throwable {
        Bundle params = new Bundle();
        params.putParcelable(USER_EXTRA, user);
        params.putString(PACKAGE_EXTRA, packageName);

        Message message = Message.obtain(null, msg, params);
        message.replyTo = mResultMessenger;

        mService.send(message);

        return mResult.waitForResult();
    }

    private void assertInjectedActivityNotFound(String targetPackage) {
        Log.d(TAG, ""Searching for package "" + targetPackage + "" on user "" + mUser);
        List<LauncherActivityInfo> activities = mLauncherApps.getActivityList(null, mUser);
        logActivities(activities);
        for (LauncherActivityInfo activity : activities) {
            if (!activity.getUser().equals(mUser)) {
                continue;
            }
            ComponentName compName = activity.getComponentName();
            if (compName.getPackageName().equals(targetPackage)) {
                fail(""Injected activity found: "" + compName.flattenToString());
            }
        }
    }

    private void logActivities(List<LauncherActivityInfo> activities) {
        Log.d(TAG, ""Got "" + activities.size() + "" activities: "" + activities.stream()
                .map((info) -> toString(info))
                .collect(Collectors.toList()));
    }

    private void runShellCommand(String format, Object...args) throws IOException {
        String command = String.format(format, args);
        Log.i(TAG, ""Running command: "" + command);
        String output = SystemUtil.runShellCommand(mInstrumentation, command);
        Log.d(TAG, ""Output: "" + output);
    }

    private String toString(LauncherActivityInfo info) {
        return info == null ? null : info.getComponentName().flattenToShortString();
    }

    private void assumeNotHeadlessSystemUserMode() {
        // On headless system user mode, the current user is a profile owner, and hence
        // the synthetic activity is not listed by LauncherApps.getActivityList()
        assumeFalse(""test skipped on headless system user mode"",
                UserManager.isHeadlessSystemUserMode());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testDoPoNoTestAppInjectedActivityFound"	""	"3: called being app"	"public void testDoPoNoTestAppInjectedActivityFound() throws Exception {
        // HasLauncherActivityApp is installed for duration of this test - make sure
        // it's NOT present on the activity list For example, DO / PO mode won't show icons.
        // This test is being called by DeviceOwnerTest.
        disableLauncherActivity();
        assertInjectedActivityNotFound(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testGetSetSyntheticAppDetailsActivityEnabled"	""	"2: UI app"	"public void testGetSetSyntheticAppDetailsActivityEnabled() throws Exception {
        assumeNotHeadlessSystemUserMode();

        disableLauncherActivity();
        assertActivityInjected(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE);
        PackageManager pm = mContext.getPackageManager();
        try {
            pm.setSyntheticAppDetailsActivityEnabled(mContext.getPackageName(), false);
            fail(""Should not able to change current app's app details activity state"");
        } catch (SecurityException e) {
            // Expected: No permission
        }
        try {
            pm.setSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE, false);
            fail(""Should not able to change other app's app details activity state"");
        } catch (SecurityException e) {
            // Expected: No permission
        }
        mInstrumentation.getUiAutomation().adoptShellPermissionIdentity();
        try {
            assertThat(pm.getSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE))
                    .isTrue();
            // Disable app details activity and assert if the change is applied
            pm.setSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE, false);
            assertThat(pm.getSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE))
                    .isFalse();
            assertInjectedActivityNotFound(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE);
            // Enable app details activity and assert if the change is applied
            pm.setSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE, true);
            assertThat(pm.getSyntheticAppDetailsActivityEnabled(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE))
                    .isTrue();
            assertActivityInjected(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE);
        } finally {
            mInstrumentation.getUiAutomation().dropShellPermissionIdentity();
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testPackageAddedCallbackForUser"	""	"1: app"	"public void testPackageAddedCallbackForUser() throws Throwable {
        int result = sendMessageToCallbacksService(MSG_CHECK_PACKAGE_ADDED,
                mUser, SIMPLE_APP_PACKAGE);
        assertThat(result).isEqualTo(RESULT_PASS);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testPackageRemovedCallbackForUser"	""	"1: app"	"public void testPackageRemovedCallbackForUser() throws Throwable {
        int result = sendMessageToCallbacksService(MSG_CHECK_PACKAGE_REMOVED,
                mUser, SIMPLE_APP_PACKAGE);
        assertThat(result).isEqualTo(RESULT_PASS);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testPackageChangedCallbackForUser"	""	"1: app"	"public void testPackageChangedCallbackForUser() throws Throwable {
        int result = sendMessageToCallbacksService(MSG_CHECK_PACKAGE_CHANGED,
                mUser, SIMPLE_APP_PACKAGE);
        assertThat(result).isEqualTo(RESULT_PASS);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testNoPackageAddedCallbackForUser"	""	"1: app"	"public void testNoPackageAddedCallbackForUser() throws Throwable {
        int result = sendMessageToCallbacksService(MSG_CHECK_NO_PACKAGE_ADDED,
                mUser, SIMPLE_APP_PACKAGE);
        assertThat(result).isEqualTo(RESULT_PASS);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testHasLauncherActivityAppHasAppDetailsActivityInjected"	""	"1: app"	"public void testHasLauncherActivityAppHasAppDetailsActivityInjected() throws Exception {
        assumeNotHeadlessSystemUserMode();

        // HasLauncherActivityApp is installed for duration of this test - make sure
        // it's present on the activity list, has the synthetic activity generated, and it's
        // enabled and exported
        disableLauncherActivity();
        assertActivityInjected(HAS_LAUNCHER_ACTIVITY_APP_PACKAGE);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testNoLauncherActivityAppNotInjected"	""	"1: app"	"public void testNoLauncherActivityAppNotInjected() throws Exception {
        // NoLauncherActivityApp is installed for duration of this test - make sure
        // it's NOT present on the activity list
        assertInjectedActivityNotFound(NO_LAUNCHER_ACTIVITY_APP_PACKAGE);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.launchertests.LauncherAppsTests"	"testNoPermissionAppNotInjected"	""	"1: app"	"public void testNoPermissionAppNotInjected() throws Exception {
        // NoPermissionApp is installed for duration of this test - make sure
        // it's NOT present on the activity list
        assertInjectedActivityNotFound(NO_PERMISSION_APP_PACKAGE);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/LauncherTests/src/com/android/cts/launchertests/LauncherAppsTests.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"finish"	""	"1: data"	"public void test/*
 *.
 */

package com.android.cts.intent.sender;

import android.content.ClipData;
import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.database.ContentObserver;
import android.net.Uri;
import android.os.Handler;
import android.os.HandlerThread;
import androidx.core.content.FileProvider;
import android.test.InstrumentationTestCase;
import android.util.Log;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.Timer;
import java.util.TimerTask;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.TimeUnit;

public class ContentTest extends InstrumentationTestCase {

    private static final String MESSAGE = ""Sample Message"";

    private static final String ACTION_READ_FROM_URI = ""com.android.cts.action.READ_FROM_URI"";

    private static final String ACTION_WRITE_TO_URI = ""com.android.cts.action.WRITE_TO_URI"";

    private static final String ACTION_TAKE_PERSISTABLE_URI_PERMISSION =
            ""com.android.cts.action.TAKE_PERSISTABLE_URI_PERMISSION"";

    public static final String ACTION_NOTIFY_URI_CHANGE
            = ""com.android.cts.action.NOTIFY_URI_CHANGE"";

    public static final String ACTION_OBSERVE_URI_CHANGE
            = ""com.android.cts.action.OBSERVE_URI_CHANGE"";

    private static final String TAG = ""CrossProfileContentTest"";

    private Context mContext;
    private IntentSenderActivity mActivity;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mContext = getInstrumentation().getTargetContext();
        mActivity = launchActivity(mContext.getPackageName(), IntentSenderActivity.class, null);
    }

    @Override
    public void tearDown() throws Exception {
        mActivity.finish();
        super.tearDown();
    }

    /**
     * This method will send an intent to a receiver in another profile.
     * This intent will have, in the ClipData, a uri whose associated file stores a message.
     * The receiver will read the message from the uri, and put it inside the result intent.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testReceiverCanRead"	""	"1: data"	"public void testReceiverCanRead() throws Exception {
        Uri uri = getUriWithTextInFile(""reading_test"", MESSAGE);
        assertNotNull(uri);
        Intent intent = new Intent(ACTION_READ_FROM_URI);
        intent.setClipData(ClipData.newRawUri("""", uri));
        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);

        final Intent result = mActivity.getCrossProfileResult(intent);
        assertNotNull(result);
        assertEquals(MESSAGE, result.getStringExtra(""extra_response""));
    }

    /**
     * This method will send an intent to a receiver in another profile.
     * This intent will have a message in an extra, and a uri specified by the ClipData.
     * The receiver will read the message from the extra, and write it to the uri in
     * the ClipData.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testReceiverCanWrite"	""	"1: data"	"public void testReceiverCanWrite() throws Exception {
        // It's the receiver of the intent that should write to the uri, not us. So, for now, we
        // write an empty string.
        Uri uri = getUriWithTextInFile(""writing_test"", """");
        assertTrue(uri != null);
        Intent intent = new Intent(ACTION_WRITE_TO_URI);
        intent.setClipData(ClipData.newRawUri("""", uri));
        intent.putExtra(""extra_message"", MESSAGE);
        intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION
                | Intent.FLAG_GRANT_READ_URI_PERMISSION);

        mActivity.getCrossProfileResult(intent);
        assertEquals(MESSAGE, getFirstLineFromUri(uri));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testPersistablePermission"	""	"5: data app(s) apps only app"	"public void testPersistablePermission() throws Exception {
        Uri uri = getUriWithTextInFile(""persistable_test"", MESSAGE);
        grantPersistableReadPermission(uri);

        // Now checking if the receiver can read this uri, without re-granting the read permission.
        Intent intent = new Intent(ACTION_READ_FROM_URI);
        intent.setClipData(ClipData.newRawUri("""", uri));

        final Intent result = mActivity.getCrossProfileResult(intent);
        assertNotNull(result);
        assertEquals(MESSAGE, result.getStringExtra(""extra_response""));
    }

    /**
     * The intent receiver will try to read uriNotGranted.
     * Inside the same user, this uri can be read if the receiver has the
     * com.android.cts.managedprofile.permission.SAMPLE permission. But since we cross
     * user-boundaries, it should not be able to (only uri grants work accross users for apps
     * without special permission).
     * We also grant uriGranted to the receiver (this uri belongs to the same content provider as
     * uriNotGranted), to enforce that even if an app has permission to one uri of a
     * ContentProvider, it still cannot access a uri it does not have access to.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testAppPermissionsDontWorkAcrossProfiles"	""	"3: data only app"	"public void testAppPermissionsDontWorkAcrossProfiles() throws Exception {
        // The FileProvider does not allow to use app permissions. So we need to use another
        // ContentProvider.
        Uri uriGranted = getBasicContentProviderUri(""uri_granted"");
        Uri uriNotGranted = getBasicContentProviderUri(""uri_not_granted"");

        // Granting uriGranted to the receiver
        // Using a persistable permission so that it is kept even after we restart the receiver
        // activity with another intent.
        grantPersistableReadPermission(uriGranted);

        Intent notGrant = new Intent(ACTION_READ_FROM_URI);
        notGrant.setClipData(ClipData.newRawUri("""", uriNotGranted));

        final Intent result = mActivity.getCrossProfileResult(notGrant);
        assertNotNull(result);
        // The receiver did not have permission to read the uri. So it should have caught a security
        // exception.
        assertTrue(result.getBooleanExtra(""extra_caught_security_exception"", false));
    }

    /**
     * Ensure that sender is only able to send data that it has access to.
     */
    // STOPSHIP: enable once b/115619667 is fixed
    public void _testSecurity() throws Exception {
        // Pick a URI that neither of us have access to; it doens't matter if
        // its missing, since we expect a SE before a FNFE.
        final Uri uri = Uri.parse(""content://media/external/images/media/10240"");
        final Intent intent = new Intent(ACTION_READ_FROM_URI);
        intent.setClipData(ClipData.newRawUri("""", uri));
        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);

        // We're expecting to run into a security exception
        final Intent result = mActivity.getCrossProfileResult(intent);
        if (result == null) {
            // This is fine; probably of a SecurityException when off in the
            // system somewhere.
        } else {
            // But if we somehow came through, make sure they threw.
            assertTrue(result.getBooleanExtra(""extra_caught_security_exception"", false));
        }
    }

    /**
     * Test that an app can notify a uri change across profiles.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testCanNotifyAcrossProfiles"	""	"3: data UI app"	"public void testCanNotifyAcrossProfiles() throws Exception {
        Uri uri = getUriWithTextInFile(""notifying_test"", """");
        assertNotNull(uri);
        Intent intent = new Intent(ACTION_NOTIFY_URI_CHANGE);
        intent.setClipData(ClipData.newRawUri("""", uri));
        intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION
                | Intent.FLAG_GRANT_READ_URI_PERMISSION);
        HandlerThread handlerThread = new HandlerThread(""observer"");
        handlerThread.start();
        UriObserver uriObserver = new UriObserver(new Handler(handlerThread.getLooper()));
        try {
            mContext.getContentResolver().registerContentObserver(uri, false, uriObserver);
            // ask the cross-profile receiver to notify the uri
            mActivity.getCrossProfileResult(intent);
            assertEquals(uri, uriObserver.waitForNotify());
        } finally {
            mContext.getContentResolver().unregisterContentObserver(uriObserver);
            handlerThread.quit();
        }
    }

    /**
     * Test that an app can observe a uri change across profiles.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.ContentTest"	"testCanObserveAcrossProfiles"	""	"5: data app(s) apps UI app"	"public void testCanObserveAcrossProfiles() throws Exception {
        final Uri uri = getUriWithTextInFile(""observing_test"", """");
        assertNotNull(uri);
        Intent intent = new Intent(ACTION_OBSERVE_URI_CHANGE);
        intent.setClipData(ClipData.newRawUri("""", uri));
        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);

        Timer timer = new Timer();
        timer.schedule(new TimerTask() {
            @Override
            public void run() {
                mContext.getContentResolver().notifyChange(uri, null);
            }
        }, 5000 /* 5 seconds */);

        // Check that the app in the other profile could be notified of the change.
        // A non-null result intent indicates success.
        assertNotNull(mActivity.getCrossProfileResult(intent));
    }

    private class UriObserver extends ContentObserver {
        private final SynchronousQueue<Uri> mSynchronousQueue;

        public UriObserver(Handler handler) {
           super(handler);
           mSynchronousQueue = new SynchronousQueue<Uri>();
        }

        @Override
        public void onChange(boolean selfChange, Uri uri) {
            super.onChange(selfChange, uri);
            try {
                if (!mSynchronousQueue.offer(uri, 5, TimeUnit.SECONDS)) {
                    Log.e(TAG, ""Failed to offer uri "" + uri + "" to synchronous queue"");
                }
            } catch (InterruptedException e) {
                Log.e(TAG, ""Interrupted while receiving onChange for "" + uri, e);
            }
        }

        private Uri waitForNotify() throws InterruptedException {
            // The uri notification may not come immediately.
            return mSynchronousQueue.poll(30, TimeUnit.SECONDS);
        }
    }

    private void grantPersistableReadPermission(Uri uri) throws Exception {
        Intent grantPersistable = new Intent(ACTION_TAKE_PERSISTABLE_URI_PERMISSION);
        grantPersistable.setClipData(ClipData.newRawUri("""", uri));
        grantPersistable.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION
                | Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION);
        mActivity.getCrossProfileResult(grantPersistable);
    }

    private Uri getBasicContentProviderUri(String path) {
        // The uris created here are not associated with any data. But this does not prevent us from
        // granting these uris to other apps, or these apps from trying to access these uris.
        return new Uri.Builder()
                .scheme(ContentResolver.SCHEME_CONTENT)
                .authority(""com.android.cts.intent.sender.provider"")
                .path(path)
                .build();
    }

    private Uri getUriWithTextInFile(String name, String text) {
        String filename = mContext.getFilesDir() + File.separator + ""texts"" + File.separator
                + name + "".txt"";
        Log.i(TAG, ""Creating file "" + filename + "" with text \"""" + text + ""\"""");
        final File file = new File(filename);
        file.getParentFile().mkdirs(); // If the folder doesn't exists it is created
        try {
            FileWriter writer = new FileWriter(file);
            writer.write(text);
            writer.close();
        } catch(IOException e) {
            Log.e(TAG, ""Could not create file "" + filename + "" with text "" + text);
            return null;
        }
        return FileProvider.getUriForFile(mContext, ""com.android.cts.intent.sender.fileprovider"",
                file);
    }

    /**
     * Returns the first line of the file associated with uri.
     */
    private String getFirstLineFromUri(Uri uri) {
        try {
            InputStream is = mContext.getContentResolver().openInputStream(uri);
            BufferedReader r = new BufferedReader(new InputStreamReader(is));
            return r.readLine();
        } catch (IOException e) {
            Log.e(TAG, ""could not read the uri "" + uri);
            return null;
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/ContentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.CopyPasteTest"	"finish"	""	"1: data"	"public void test/*
 *.
 */

package com.android.cts.intent.sender;

import android.content.ClipboardManager;
import android.content.ClipData;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.test.InstrumentationTestCase;
import android.util.Log;

import java.util.concurrent.Semaphore;
import java.util.concurrent.TimeUnit;

public class CopyPasteTest extends InstrumentationTestCase
        implements ClipboardManager.OnPrimaryClipChangedListener {

    private IntentSenderActivity mActivity;
    private ClipboardManager mClipboard;
    private Semaphore mNotified;

    private static String ACTION_COPY_TO_CLIPBOARD = ""com.android.cts.action.COPY_TO_CLIPBOARD"";

    private static String INITIAL_TEXT = ""initial text"";
    private static String NEW_TEXT = ""sample text"";

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        Context context = getInstrumentation().getTargetContext();
        mActivity = launchActivity(context.getPackageName(), IntentSenderActivity.class, null);
        mClipboard = (ClipboardManager) mActivity.getSystemService(Context.CLIPBOARD_SERVICE);
    }

    @Override
    public void tearDown() throws Exception {
        mActivity.finish();
        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/CopyPasteTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.CopyPasteTest"	"testCanReadAcrossProfiles"	""	"1: data"	"public void testCanReadAcrossProfiles() throws Exception {
        ClipData clip = ClipData.newPlainText(""""/*label*/, INITIAL_TEXT);
        mClipboard.setPrimaryClip(clip);
        assertEquals(INITIAL_TEXT , getTextFromClipboard());

        askCrossProfileReceiverToCopy(NEW_TEXT);

        assertEquals(NEW_TEXT, getTextFromClipboard());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/CopyPasteTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.CopyPasteTest"	"testCannotReadAcrossProfiles"	""	"1: data"	"public void testCannotReadAcrossProfiles() throws Exception {
        ClipData clip = ClipData.newPlainText(""""/*label*/, INITIAL_TEXT);
        mClipboard.setPrimaryClip(clip);
        assertEquals(INITIAL_TEXT , getTextFromClipboard());

        askCrossProfileReceiverToCopy(NEW_TEXT);

        String clipboardText = getTextFromClipboard();
        assertTrue(""The clipboard text is "" + clipboardText + "" but should be <null> or ""
                + INITIAL_TEXT, clipboardText == null || clipboardText.equals(INITIAL_TEXT));
    }

    private void askCrossProfileReceiverToCopy(String text) throws Exception {
        Intent intent = new Intent(ACTION_COPY_TO_CLIPBOARD);
        intent.putExtra(""extra_text"", text);
        mActivity.getCrossProfileResult(intent);
    }

    private String getTextFromClipboard() {
        ClipData clip = mClipboard.getPrimaryClip();
        if (clip == null) {
            return null;
        }
        ClipData.Item item = clip.getItemAt(0);
        if (item == null) {
            return null;
        }
        CharSequence text = item.getText();
        if (text == null) {
            return null;
        }
        return text.toString();
    }


    @Override
    public void onPrimaryClipChanged() {
        mNotified.release();
    }

}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/CopyPasteTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.AppLinkTest"	"testThreeReceivers"	""	"3: data called view"	"public void testThreeReceivers() {
        assertNumberOfReceivers(3);
    }

    // Should not be called if there are several possible receivers to the intent
    // (see getHttpIntent)
    private void checkHttpIntentResult(String receiverClassName, boolean inManagedProfile)
            throws Exception {
        PackageManager pm = mContext.getPackageManager();

        Intent intent = getHttpIntent();
        Intent result = mActivity.getResult(intent);
        assertWithMessage(""result for intent %s"", intent).that(result).isNotNull();

        // If it is received in the other profile, we cannot check the class from the ResolveInfo
        // returned by queryIntentActivities. So we rely on the receiver telling us its class.
        assertWithMessage(""extra %s on intent %s"", EXTRA_RECEIVER_CLASS, result)
                .that(result.getStringExtra(EXTRA_RECEIVER_CLASS)).isEqualTo(receiverClassName);
        assertWithMessage(""has extra %s on intent %s"", EXTRA_IN_MANAGED_PROFILE, result)
                .that(result.hasExtra(EXTRA_IN_MANAGED_PROFILE)).isTrue();
        assertWithMessage(""extra %s on intent %s"", EXTRA_IN_MANAGED_PROFILE, result)
                .that(result.getBooleanExtra(EXTRA_IN_MANAGED_PROFILE, false))
                .isEqualTo(inManagedProfile);
    }

    private void assertNumberOfReceivers(int n) {
        PackageManager pm = mContext.getPackageManager();
        List<ResolveInfo> receivers = pm.queryIntentActivities(getHttpIntent(), /* flags = */ 0);
        assertWithMessage(""receivers"").that(receivers).hasSize(n);
    }

    private Intent getHttpIntent() {
        Intent i = new Intent(Intent.ACTION_VIEW);
        i.addCategory(Intent.CATEGORY_BROWSABLE);
        i.addCategory(Intent.CATEGORY_DEFAULT);
        i.setData(Uri.parse(""http://com.android.cts.intent.receiver""));
        return i;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/AppLinkTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.AppLinkTest"	"finish"	""	"1: app"	"public void test/*
 *.
 */

package com.android.cts.intent.sender;

import static com.google.common.truth.Truth.assertWithMessage;

import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.net.Uri;
import android.test.InstrumentationTestCase;

import java.util.List;

public class AppLinkTest extends InstrumentationTestCase {

    private static final String TAG = ""AppLinkTest"";

    private Context mContext;
    private IntentSenderActivity mActivity;

    private static final String EXTRA_IN_MANAGED_PROFILE = ""extra_in_managed_profile"";
    private static final String EXTRA_RECEIVER_CLASS = ""extra_receiver_class"";
    private static final String APP_LINK_ACTIVITY
            = ""com.android.cts.intent.receiver.AppLinkActivity"";
    private static final String BROWSER_ACTIVITY
            = ""com.android.cts.intent.receiver.BrowserActivity"";

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mContext = getInstrumentation().getTargetContext();
        mActivity = launchActivity(mContext.getPackageName(), IntentSenderActivity.class, null);
    }

    @Override
    public void tearDown() throws Exception {
        mActivity.finish();
        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/AppLinkTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.AppLinkTest"	"testReceivedByAppLinkActivityInPrimary"	""	"1: app"	"public void testReceivedByAppLinkActivityInPrimary() throws Exception {
        checkHttpIntentResult(APP_LINK_ACTIVITY, false);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/AppLinkTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.AppLinkTest"	"testReceivedByAppLinkActivityInManaged"	""	"1: app"	"public void testReceivedByAppLinkActivityInManaged() throws Exception {
        checkHttpIntentResult(APP_LINK_ACTIVITY, true);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/AppLinkTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.SuspendPackageTest"	"isNotNull"	""	"5: app(s) apps UI view app"	"public void testpackage com.android.cts.intent.sender;

import static com.google.common.truth.Truth.assertWithMessage;

import android.app.UiAutomation;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.content.res.Configuration;
import android.os.UserHandle;
import android.os.UserManager;
import android.provider.Settings;
import android.support.test.uiautomator.By;
import android.support.test.uiautomator.BySelector;
import android.support.test.uiautomator.Direction;
import android.support.test.uiautomator.UiDevice;
import android.support.test.uiautomator.UiObject2;
import android.support.test.uiautomator.Until;
import android.test.InstrumentationTestCase;
import android.util.Log;

public class SuspendPackageTest extends InstrumentationTestCase {

    private static final String TAG = ""IntentSender.SuspendPackageTest"";

    private static final int WAIT_DIALOG_TIMEOUT_IN_MS = 5000;
    private static final BySelector POPUP_TITLE_WATCH_SELECTOR = By
            .clazz(android.widget.TextView.class.getName())
            .res(""android:id/alertTitle"")
            .pkg(""com.google.android.apps.wearable.settings"");

    private static final BySelector SUSPEND_BUTTON_SELECTOR = By
            .clazz(android.widget.Button.class.getName())
            .res(""android:id/button1"");

    private IntentSenderActivity mActivity;
    private Context mContext;
    private PackageManager mPackageManager;
    private UiAutomation mUiAutomation;

    private static final String INTENT_RECEIVER_PKG = ""com.android.cts.intent.receiver"";
    private static final String TARGET_ACTIVITY_NAME =
            ""com.android.cts.intent.receiver.SimpleIntentReceiverActivity"";

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mContext = getInstrumentation().getTargetContext();
        String packageName = mContext.getPackageName();
        int userId = mContext.getUserId();
        Class<IntentSenderActivity> activityClass = IntentSenderActivity.class;
        if (temporarilySkipActivityLaunch()) {
            Log.w(TAG, ""setup(): not launching "" + activityClass + "" on user "" + userId
                    + "" as launcher on automotive doesn't support suspended apps yet"");
        } else {
            Log.d(TAG, ""setup(): launching "" + activityClass + "" on user "" + userId);
            mActivity = launchActivity(packageName, activityClass, null);
            assertWithMessage(""activity %s launched on package %s on user %s"",
                    activityClass, packageName, userId).that(mActivity).isNotNull();
            Log.d(TAG, ""setup(): launched activity "" + mActivity);
        }
        mPackageManager = mContext.getPackageManager();
        mUiAutomation = getInstrumentation().getUiAutomation();
    }

    @Override
    public void tearDown() throws Exception {
        if (mActivity != null) {
            mActivity.finish();
        }
        super.tearDown();
    }

    // TODO(b/182387060): STOPSHIP temporarily hack until CarLauncher supports it
    private boolean temporarilySkipActivityLaunch() {
        return UserManager.isHeadlessSystemUserMode();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/SuspendPackageTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.intent.sender.SuspendPackageTest"	"testPackageSuspendedWithPackageManager"	""	"3: UI only view"	"public void testPackageSuspendedWithPackageManager() throws Exception {
        assertPackageSuspended(/* suspended= */ true, /* customDialog= */ true);
    }

    /**
     * Verify that the package is suspended by trying to start the activity inside it. If the
     * package is not suspended, the target activity will return the result.
     */
    private void assertPackageSuspended(boolean suspended, boolean customDialog) throws Exception {
        Intent intent = new Intent();
        intent.setClassName(INTENT_RECEIVER_PKG, TARGET_ACTIVITY_NAME);
        if (!temporarilySkipActivityLaunch()) {
            Intent result = mActivity.getResult(intent);
            Log.d(TAG, ""assertPackageSuspended(suspended="" + suspended
                    + "", customDialog="" + customDialog + ""): result for activity ""
                    + INTENT_RECEIVER_PKG + ""/"" + TARGET_ACTIVITY_NAME + "" on user ""
                    + mContext.getUserId() + "": "" + result);
            if (suspended) {
                if (customDialog) {
                    dismissCustomDialog();
                } else {
                    dismissPolicyTransparencyDialog();
                }
                assertWithMessage(""result for activitiy %s while suspended"", intent).that(result)
                        .isNull();
            } else {
                assertWithMessage(""result for activitiy %s while NOT suspended"", intent)
                        .that(result).isNotNull();
            }
        }
        // No matter if it is suspended or not, we should be able to resolve the activity.
        ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, /* flags= */ 0);
        assertWithMessage(""ResolveInfo for activity %s"", intent).that(resolveInfo).isNotNull();
        Log.d(TAG, ""ResolveInfo: "" + resolveInfo);
    }

    /**
     * Wait for the policy transparency dialog and dismiss it.
     */
    private void dismissPolicyTransparencyDialog() {
        final UiDevice device = UiDevice.getInstance(getInstrumentation());
        if (isWatch()) {
            device.wait(Until.hasObject(POPUP_TITLE_WATCH_SELECTOR), WAIT_DIALOG_TIMEOUT_IN_MS);
            final UiObject2 title = device.findObject(POPUP_TITLE_WATCH_SELECTOR);
            assertWithMessage(""Policy transparency dialog title"").that(title).isNotNull();
            title.swipe(Direction.RIGHT, 1.0f);
        } else {
            device.wait(Until.hasObject(getPopUpImageSelector()), WAIT_DIALOG_TIMEOUT_IN_MS);
            final UiObject2 icon = device.findObject(getPopUpImageSelector());
            assertWithMessage(""Policy transparency dialog icon"").that(icon).isNotNull();
            // ""OK"" button only present in the dialog if it is blocked by policy.
            final UiObject2 button = device.findObject(getPopUpButtonSelector());
            assertWithMessage(""OK button"").that(button).isNotNull();
            button.click();
        }
    }

    private void dismissCustomDialog() {
        final UiDevice device = UiDevice.getInstance(getInstrumentation());
        device.wait(Until.hasObject(SUSPEND_BUTTON_SELECTOR), WAIT_DIALOG_TIMEOUT_IN_MS);

        final UiObject2 button = device.findObject(SUSPEND_BUTTON_SELECTOR);
        assertWithMessage(""OK button"").that(button).isNotNull();
    }

    private boolean isWatch() {
        return (getInstrumentation().getContext().getResources().getConfiguration().uiMode
                & Configuration.UI_MODE_TYPE_MASK) == Configuration.UI_MODE_TYPE_WATCH;
    }

    private String getSettingsPackageName() {
        String settingsPackageName = ""com.android.settings"";
        try {
            mUiAutomation.adoptShellPermissionIdentity(""android.permission.INTERACT_ACROSS_USERS"");
            ResolveInfo resolveInfo = mPackageManager.resolveActivityAsUser(
                    new Intent(Settings.ACTION_SETTINGS), PackageManager.MATCH_SYSTEM_ONLY,
                    UserHandle.USER_SYSTEM);
            if (resolveInfo != null && resolveInfo.activityInfo != null) {
                settingsPackageName = resolveInfo.activityInfo.packageName;
            }
        } finally {
            mUiAutomation.dropShellPermissionIdentity();
        }
        return settingsPackageName;
    }

    private BySelector getPopUpButtonSelector() {
        return By.clazz(android.widget.Button.class.getName())
                .res(""android:id/button1"")
                .pkg(getSettingsPackageName());
    }

    private BySelector getPopUpImageSelector() {
        final String settingsPackageName = getSettingsPackageName();
        return By.clazz(android.widget.ImageView.class.getName())
                .res(settingsPackageName + "":id/admin_support_icon"")
                .pkg(settingsPackageName);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/IntentSender/src/com/android/cts/intent/sender/SuspendPackageTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PrivateDnsPolicyTest"	"testCanSetModeDespiteUserRestriction"	""	"1: app"	"public void testCanSetModeDespiteUserRestriction() {
        // First set a specific host and assert that applied.
        callSetGlobalPrivateDnsHostModeExpectingResult(
                VALID_PRIVATE_DNS_HOST,
                DevicePolicyManager.PRIVATE_DNS_SET_NO_ERROR);
        assertThat(
                mDevicePolicyManager.getGlobalPrivateDnsMode(getWho())).isEqualTo(
                PRIVATE_DNS_MODE_PROVIDER_HOSTNAME);

        // Set a user restriction
        setUserRestriction(UserManager.DISALLOW_CONFIG_PRIVATE_DNS, true);

        // Next, set the mode to automatic and confirm that has applied.
        callSetGlobalPrivateDnsOpportunisticModeExpectingResult(
                DevicePolicyManager.PRIVATE_DNS_SET_NO_ERROR);

        assertThat(
                mDevicePolicyManager.getGlobalPrivateDnsMode(getWho())).isEqualTo(
                PRIVATE_DNS_MODE_OPPORTUNISTIC);
        assertThat(mDevicePolicyManager.getGlobalPrivateDnsHost(getWho())).isNull();
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PrivateDnsPolicyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PackageInstallTest"	"register"	""	"3: data UI app"	"public void testpackage com.android.cts.deviceowner;

import android.app.PendingIntent;
import android.content.Intent;
import android.content.IntentSender;
import android.content.pm.PackageInstaller;
import android.content.pm.PackageManager;

import com.android.compatibility.common.util.BlockingBroadcastReceiver;

import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.Collections;

/**
 * Test case for package install and uninstall.
 */
public class PackageInstallTest extends BaseAffiliatedProfileOwnerTest {
    private static final String TEST_APP_LOCATION =
            ""/data/local/tmp/cts/packageinstaller/CtsEmptyTestApp.apk"";
    private static final String TEST_APP_PKG = ""android.packageinstaller.emptytestapp.cts"";
    private static final int REQUEST_CODE = 0;
    private static final String ACTION_INSTALL_COMMIT =
            ""com.android.cts.deviceowner.INTENT_PACKAGE_INSTALL_COMMIT"";
    private static final int PACKAGE_INSTALLER_STATUS_UNDEFINED = -1000;

    private PackageManager mPackageManager;
    private PackageInstaller mPackageInstaller;
    private PackageInstaller.Session mSession;
    private BlockingBroadcastReceiver mBroadcastReceiver;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mPackageManager = mContext.getPackageManager();
        mPackageInstaller = mPackageManager.getPackageInstaller();
        assertNotNull(mPackageInstaller);

        mBroadcastReceiver = new BlockingBroadcastReceiver(mContext, ACTION_INSTALL_COMMIT);
        mBroadcastReceiver.register();
    }

    @Override
    protected void tearDown() throws Exception {
        mBroadcastReceiver.unregisterQuietly();
        if (mSession != null) {
            mSession.abandon();
        }

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PackageInstallTest"	"testPackageInstall"	""	"1: app"	"public void testPackageInstall() throws Exception {
        assertFalse(isPackageInstalled(TEST_APP_PKG));

        // Install the package.
        installPackage(TEST_APP_LOCATION);

        Intent intent = mBroadcastReceiver.awaitForBroadcast();
        assertNotNull(intent);
        assertEquals(PackageInstaller.STATUS_SUCCESS,
                intent.getIntExtra(PackageInstaller.EXTRA_STATUS,
                        PACKAGE_INSTALLER_STATUS_UNDEFINED));
        assertEquals(TEST_APP_PKG, intent.getStringExtra(
                PackageInstaller.EXTRA_PACKAGE_NAME));
        assertTrue(isPackageInstalled(TEST_APP_PKG));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PackageInstallTest"	"testPackageUninstall"	""	"1: app"	"public void testPackageUninstall() throws Exception {
        assertTrue(isPackageInstalled(TEST_APP_PKG));

        // Uninstall the package.
        mPackageInstaller.uninstall(TEST_APP_PKG, getCommitCallback());

        Intent intent = mBroadcastReceiver.awaitForBroadcast();
        assertNotNull(intent);
        assertEquals(PackageInstaller.STATUS_SUCCESS,
                intent.getIntExtra(PackageInstaller.EXTRA_STATUS,
                        PACKAGE_INSTALLER_STATUS_UNDEFINED));
        assertEquals(TEST_APP_PKG, intent.getStringExtra(
                PackageInstaller.EXTRA_PACKAGE_NAME));
        assertFalse(isPackageInstalled(TEST_APP_PKG));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PackageInstallTest"	"testKeepPackageCache"	""	"1: app"	"public void testKeepPackageCache() throws Exception {
        // Set keep package cache.
        mDevicePolicyManager.setKeepUninstalledPackages(getWho(),
                Collections.singletonList(TEST_APP_PKG));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.PackageInstallTest"	"testInstallExistingPackage"	""	"1: app"	"public void testInstallExistingPackage() throws Exception {
        assertFalse(isPackageInstalled(TEST_APP_PKG));

        // Install the existing package.
        assertTrue(mDevicePolicyManager.installExistingPackage(getWho(), TEST_APP_PKG));
        assertTrue(isPackageInstalled(TEST_APP_PKG));
    }

    private void installPackage(String packageLocation) throws Exception {
        PackageInstaller.SessionParams params = new PackageInstaller.SessionParams(
                PackageInstaller.SessionParams.MODE_FULL_INSTALL);
        params.setAppPackageName(TEST_APP_PKG);
        int sessionId = mPackageInstaller.createSession(params);
        mSession = mPackageInstaller.openSession(sessionId);

        File file = new File(packageLocation);
        InputStream in = new FileInputStream(file);
        OutputStream out = mSession.openWrite(""PackageInstallTest"", 0, file.length());
        byte[] buffer = new byte[65536];
        int c;
        while ((c = in.read(buffer)) != -1) {
            out.write(buffer, 0, c);
        }
        mSession.fsync(out);
        out.close();
        mSession.commit(getCommitCallback());
        mSession.close();
    }

    private IntentSender getCommitCallback() {
        // Create a PendingIntent and use it to generate the IntentSender
        Intent broadcastIntent = new Intent(ACTION_INSTALL_COMMIT);
        PendingIntent pendingIntent = PendingIntent.getBroadcast(
                mContext,
                REQUEST_CODE,
                broadcastIntent,
                PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_MUTABLE_UNAUDITED);
        return pendingIntent.getIntentSender();
    }

    private boolean isPackageInstalled(String packageName) {
        try {
            return mPackageManager.getPackageInfo(packageName, 0) != null;
        } catch (PackageManager.NameNotFoundException e) {
            return false;
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/PackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.BluetoothRestrictionTest"	"testOppDisabledWhenRestrictionSet"	""	"1: app"	"public void testOppDisabledWhenRestrictionSet() throws Exception {
        if (mBluetoothAdapter == null) {
            return;
        }

        // First verify DISALLOW_BLUETOOTH.
        testOppDisabledWhenRestrictionSet(UserManager.DISALLOW_BLUETOOTH);
        // Verify DISALLOW_BLUETOOTH_SHARING which leaves bluetooth workable but the sharing
        // component should be disabled.
        testOppDisabledWhenRestrictionSet(UserManager.DISALLOW_BLUETOOTH_SHARING);
    }

    /** Verifies that a given restriction disables the bluetooth sharing component. */
    private void testOppDisabledWhenRestrictionSet(String restriction) {
        // Add the user restriction.
        mDevicePolicyManager.addUserRestriction(getWho(), restriction);

        // The BluetoothOppLauncherActivity's component should be disabled.
        assertComponentStateAfterTimeout(
                OPP_LAUNCHER_COMPONENT, PackageManager.COMPONENT_ENABLED_STATE_DISABLED);

        // Remove the user restriction.
        mDevicePolicyManager.clearUserRestriction(getWho(), restriction);

        // The BluetoothOppLauncherActivity's component should be in the default state.
        assertComponentStateAfterTimeout(
                OPP_LAUNCHER_COMPONENT, PackageManager.COMPONENT_ENABLED_STATE_DEFAULT);
    }

    /** Helper to turn BT off.
     * This method will either fail on an assert, or return with BT turned off.
     * Behavior of getState() and isEnabled() are validated along the way.
     */
    private void disable() {
        // Can't disable a bluetooth adapter that does not exist.
        if (mBluetoothAdapter == null)
            return;

        sleep(CHECK_WAIT_TIME_MS);
        if (mBluetoothAdapter.getState() == BluetoothAdapter.STATE_OFF) {
            assertFalse(mBluetoothAdapter.isEnabled());
            return;
        }

        assertEquals(BluetoothAdapter.STATE_ON, mBluetoothAdapter.getState());
        assertTrue(mBluetoothAdapter.isEnabled());
        mBluetoothAdapter.disable();
        assertDisabledAfterTimeout();
    }

    /**
     * Helper method which waits for Bluetooth to be disabled. Fails if it doesn't happen in a
     * given time.
     */
    private void assertDisabledAfterTimeout() {
        boolean turnOff = false;
        final long timeout = SystemClock.elapsedRealtime() + DISABLE_TIMEOUT_MS;
        while (SystemClock.elapsedRealtime() < timeout) {
            int state = mBluetoothAdapter.getState();
            switch (state) {
            case BluetoothAdapter.STATE_OFF:
                assertFalse(mBluetoothAdapter.isEnabled());
                return;
            default:
                if (state != BluetoothAdapter.STATE_ON || turnOff) {
                    assertEquals(BluetoothAdapter.STATE_TURNING_OFF, state);
                    turnOff = true;
                }
                break;
            }
            sleep(POLL_TIME_MS);
        }
        fail(""disable() timeout"");
    }

    private void assertComponentStateAfterTimeout(ComponentName component, int expectedState) {
        final long timeout = SystemClock.elapsedRealtime() + COMPONENT_STATE_TIMEOUT_MS;
        int state = -1;
        while (SystemClock.elapsedRealtime() < timeout) {
            state = mPackageManager.getComponentEnabledSetting(component);
            if (expectedState == state) {
                // Success
                return;
            }
            sleep(POLL_TIME_MS);
        }
        fail(""The state of "" + component + "" should have been "" + expectedState + "", it but was ""
                + state + "" after timeout."");
    }

    /** Helper to turn BT on.
     * This method will either fail on an assert, or return with BT turned on.
     * Behavior of getState() and isEnabled() are validated along the way.
     */
    private void enable() {
        // Can't enable a bluetooth adapter that does not exist.
        if (mBluetoothAdapter == null)
            return;

        sleep(CHECK_WAIT_TIME_MS);
        if (mBluetoothAdapter.getState() == BluetoothAdapter.STATE_ON) {
            assertTrue(mBluetoothAdapter.isEnabled());
            return;
        }

        assertEquals(BluetoothAdapter.STATE_OFF, mBluetoothAdapter.getState());
        assertFalse(mBluetoothAdapter.isEnabled());
        mBluetoothAdapter.enable();
        assertEnabledAfterTimeout();
    }

    /**
     * Helper method which waits for Bluetooth to be enabled. Fails if it doesn't happen in a given
     * time.
     */
    private void assertEnabledAfterTimeout() {
        boolean turnOn = false;
        final long timeout = SystemClock.elapsedRealtime() + ENABLE_TIMEOUT_MS;
        while (SystemClock.elapsedRealtime() < timeout) {
            int state = mBluetoothAdapter.getState();
            switch (state) {
            case BluetoothAdapter.STATE_ON:
                assertTrue(mBluetoothAdapter.isEnabled());
                return;
            default:
                if (state != BluetoothAdapter.STATE_OFF || turnOn) {
                    assertEquals(BluetoothAdapter.STATE_TURNING_ON, state);
                    turnOn = true;
                }
                break;
            }
            sleep(POLL_TIME_MS);
        }
        fail(""enable() timeout"");
    }

    private static void sleep(long t) {
        try {
            Thread.sleep(t);
        } catch (InterruptedException e) {}
    }

}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/BluetoothRestrictionTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.SetTimeTest"	"currentTimeMillis"	""	"1: app"	"public void test/*
 *.
 */
package com.android.cts.deviceowner;

import android.app.admin.DevicePolicyManager;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.provider.Settings;

import java.util.Calendar;
import java.util.TimeZone;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

/**
 * Test {@link DevicePolicyManager#setTime} and @link {DevicePolicyManager#setTimeZone}
 */
public class SetTimeTest extends BaseDeviceOwnerTest {

    private static final long TEST_TIME_1 = 10000000;
    private static final long TEST_TIME_2 = 100000000;
    private static final String TEST_TIME_ZONE_1 = ""America/New_York"";
    private static final String TEST_TIME_ZONE_2 = ""America/Los_Angeles"";
    private static final long TIMEOUT_SEC = 60;

    // Real world time to restore after the test.
    private long mStartTimeWallClockMillis;
    // Elapsed time to measure time taken by the test.
    private long mStartTimeElapsedNanos;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        saveTime();
    }

    @Override
    protected void tearDown() throws Exception {
        restoreTime();
        super.tearDown();
    }

    private void testSetTimeWithValue(long testTime) throws Exception {
        final CountDownLatch latch = new CountDownLatch(1);
        BroadcastReceiver receiver = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                latch.countDown();
            }
        };
        mContext.registerReceiver(receiver, new IntentFilter(Intent.ACTION_TIME_CHANGED));

        try {
            assertTrue(""failed to set time"", mDevicePolicyManager.setTime(getWho(), testTime));
            assertTrue(""timed out waiting for time change broadcast"",
                latch.await(TIMEOUT_SEC, TimeUnit.SECONDS));
            assertTrue(""time is different from what was set"",
                System.currentTimeMillis() <= testTime + (TIMEOUT_SEC + 1) * 1000);
        } finally {
            mContext.unregisterReceiver(receiver);
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/SetTimeTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.WifiConfigLockdownTest"	"testRegularAppCannotUpdateDeviceOwnerConfig"	""	"1: app"	"public void testRegularAppCannotUpdateDeviceOwnerConfig() throws Exception {
        List<WifiConfiguration> configs = mWifiConfigCreator.getConfiguredNetworks();
        logConfigs(""testRegularAppCannotUpdateDeviceOwnerConfig()"", configs);
        int updateCount = 0;
        for (WifiConfiguration config : configs) {
            Log.d(TAG, ""testRegularAppCannotUpdateDeviceOwnerConfig(): testing "" + config.SSID);
            if (areMatchingSsids(ORIGINAL_DEVICE_OWNER_SSID, config.SSID)) {
                startRegularActivity(ACTION_UPDATE_WIFI_CONFIG, config.networkId,
                        CHANGED_DEVICE_OWNER_SSID, SECURITY_TYPE_NONE, null);
                ++updateCount;
            }
        }
        // There might be auto-upgrade configs returned.
        assertWithMessage(""number of updated configs (the DO created one)"")
                .that(updateCount).isAtLeast(1);

        // Assert nothing has changed
        configs = mWifiConfigCreator.getConfiguredNetworks();
        int notChangedCount = 0;
        for (WifiConfiguration config : configs) {
            Log.d(TAG, ""testRegularAppCannotUpdateDeviceOwnerConfig(): testing "" + config.SSID);
            assertWithMessage(""matching ssids for %s / %s"", CHANGED_DEVICE_OWNER_SSID, config.SSID)
                    .that(areMatchingSsids(CHANGED_DEVICE_OWNER_SSID, config.SSID)).isFalse();
            if (areMatchingSsids(ORIGINAL_DEVICE_OWNER_SSID, config.SSID)) {
                ++notChangedCount;
            }
        }
        // There might be auto-upgrade configs returned.
        assertWithMessage(""number of unchanged configs"").that(notChangedCount).isAtLeast(1);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/WifiConfigLockdownTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.WifiConfigLockdownTest"	"testRegularAppCannotRemoveDeviceOwnerConfig"	""	"1: app"	"public void testRegularAppCannotRemoveDeviceOwnerConfig() throws Exception {
        List<WifiConfiguration> configs = mWifiConfigCreator.getConfiguredNetworks();
        logConfigs(""testRegularAppCannotUpdateDeviceOwnerConfig()"", configs);
        int removeCount = 0;
        for (WifiConfiguration config : configs) {
            Log.d(TAG, ""testRegularAppCannotRemoveDeviceOwnerConfig(): testing "" + config.SSID);
            if (areMatchingSsids(ORIGINAL_DEVICE_OWNER_SSID, config.SSID)) {
                startRegularActivity(ACTION_REMOVE_WIFI_CONFIG, config.networkId,
                        null, SECURITY_TYPE_NONE, null);
                ++removeCount;
            }
        }

        // There might be auto-upgrade configs returned.
        assertWithMessage(""number of removed configs (the DO created one)"")
                .that(removeCount).isAtLeast(1);

        // Assert nothing has changed
        configs = mWifiConfigCreator.getConfiguredNetworks();
        int notChangedCount = 0;
        for (WifiConfiguration config : configs) {
            Log.d(TAG, ""testRegularAppCannotRemoveDeviceOwnerConfig(): testing "" + config.SSID);
            if (areMatchingSsids(ORIGINAL_DEVICE_OWNER_SSID, config.SSID)) {
                ++notChangedCount;
            }
        }
        // There might be auto-upgrade configs returned.
        assertWithMessage(""number of unchanged configs"").that(notChangedCount).isAtLeast(1);
    }

    private void startRegularActivity(String action, int netId, String ssid, int securityType,
            String password) throws InterruptedException {
        Intent createRegularConfig = new Intent(action);
        createRegularConfig.putExtra(EXTRA_NETID, netId);
        createRegularConfig.putExtra(EXTRA_SSID, ssid);
        createRegularConfig.putExtra(EXTRA_SECURITY_TYPE, securityType);
        createRegularConfig.putExtra(EXTRA_PASSWORD, password);
        createRegularConfig.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        Log.d(TAG, ""Starting "" + action  + "" on user "" + mContext.getUserId());
        mContext.startActivity(createRegularConfig);

        // Give some time for the other app to finish the action
        Log.d(TAG, ""Sleeping 5s"");
        Thread.sleep(5000);
    }

    private boolean areMatchingSsids(String s1, String s2) {
        if (s1 == null || s2 == null) {
            return false;
        }
        return s1.replace(""\"""", """").equals(s2.replace(""\"""", """"));
    }

    private void logConfigs(String prefix, List<WifiConfiguration> configs) {
        if (configs == null) {
            Log.d(TAG, prefix + "": null configs"");
            return;
        }
        Log.d(TAG, prefix + "": "" + configs.size() + "" configs: ""
                + configs.stream().map((c) -> c.SSID).collect(Collectors.toList()));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/WifiConfigLockdownTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.HardwarePropertiesManagerTest"	"testHardwarePropertiesManager"	""	"3: app(s) apps app"	"public void testHardwarePropertiesManager() throws InterruptedException,
            SecurityException {
        HardwarePropertiesManager hm = TestAppSystemServiceFactory
                .getHardwarePropertiesManager(getContext(), BasicAdminReceiver.class);

        float[] oldFanSpeeds = hm.getFanSpeeds();

        float[] cpuTemps = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_CPU,
                HardwarePropertiesManager.TEMPERATURE_CURRENT);
        float[] cpuThrottlingThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_CPU,
                HardwarePropertiesManager.TEMPERATURE_THROTTLING);
        float[] cpuShutdownThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_CPU,
                HardwarePropertiesManager.TEMPERATURE_SHUTDOWN);

        float[] gpuTemps = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_GPU,
                HardwarePropertiesManager.TEMPERATURE_CURRENT);
        float[] gpuThrottlingThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_GPU,
                HardwarePropertiesManager.TEMPERATURE_THROTTLING);
        float[] gpuShutdownThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_GPU,
                HardwarePropertiesManager.TEMPERATURE_SHUTDOWN);

        float[] batteryTemps = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_BATTERY,
                HardwarePropertiesManager.TEMPERATURE_CURRENT);
        float[] batteryThrottlingThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_BATTERY,
                HardwarePropertiesManager.TEMPERATURE_THROTTLING);
        float[] batteryShutdownThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_BATTERY,
                HardwarePropertiesManager.TEMPERATURE_SHUTDOWN);

        float[] skinTemps = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_SKIN,
                HardwarePropertiesManager.TEMPERATURE_CURRENT);
        float[] skinThrottlingThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_SKIN,
                HardwarePropertiesManager.TEMPERATURE_THROTTLING);
        float[] skinShutdownThresholds = hm.getDeviceTemperatures(
                HardwarePropertiesManager.DEVICE_TEMPERATURE_SKIN,
                HardwarePropertiesManager.TEMPERATURE_SHUTDOWN);

        CpuUsageInfo[] oldCpuUsages = hm.getCpuUsages();

        checkFanSpeeds(oldFanSpeeds);
        checkTemps(cpuTemps, cpuThrottlingThresholds, cpuShutdownThresholds);
        checkTemps(gpuTemps, gpuThrottlingThresholds, gpuShutdownThresholds);
        checkTemps(batteryTemps, batteryThrottlingThresholds, batteryShutdownThresholds);
        checkTemps(skinTemps, skinThrottlingThresholds, skinShutdownThresholds);
        checkCpuUsages(oldCpuUsages);

        for (int i = 0; i < MONITORING_ITERATION_NUMBER; i++) {
            Thread.sleep(SLEEP_TIME);

            float[] fanSpeeds = hm.getFanSpeeds();
            cpuTemps = hm.getDeviceTemperatures(
                    HardwarePropertiesManager.DEVICE_TEMPERATURE_CPU,
                    HardwarePropertiesManager.TEMPERATURE_CURRENT);
            gpuTemps = hm.getDeviceTemperatures(
                    HardwarePropertiesManager.DEVICE_TEMPERATURE_GPU,
                    HardwarePropertiesManager.TEMPERATURE_CURRENT);
            batteryTemps = hm.getDeviceTemperatures(
                    HardwarePropertiesManager.DEVICE_TEMPERATURE_BATTERY,
                    HardwarePropertiesManager.TEMPERATURE_CURRENT);
            skinTemps = hm.getDeviceTemperatures(
                    HardwarePropertiesManager.DEVICE_TEMPERATURE_SKIN,
                    HardwarePropertiesManager.TEMPERATURE_CURRENT);
            CpuUsageInfo[] cpuUsages = hm.getCpuUsages();

            checkFanSpeeds(fanSpeeds);
            checkTemps(cpuTemps, cpuThrottlingThresholds, cpuShutdownThresholds);
            checkTemps(gpuTemps, gpuThrottlingThresholds, gpuShutdownThresholds);
            checkTemps(batteryTemps, batteryThrottlingThresholds, batteryShutdownThresholds);
            checkTemps(skinTemps, skinThrottlingThresholds, skinShutdownThresholds);
            checkCpuUsages(cpuUsages);

            // No need to compare length of old and new temperature arrays:
            // they are compared through throttling and shutdown threshold arrays lengths.
            checkFanSpeeds(fanSpeeds, oldFanSpeeds);
            checkCpuUsages(cpuUsages, oldCpuUsages);

            oldFanSpeeds = fanSpeeds;
            oldCpuUsages = cpuUsages;
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/HardwarePropertiesManagerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.DevicePolicyLoggingTest"	"testSetGlobalSettingLogged"	""	"1: data"	"public void testSetGlobalSettingLogged() {
        final String autoTimeOriginalValue =
                Settings.Global.getString(mContext.getContentResolver(), AUTO_TIME);
        final String autoTimeZoneOriginalValue =
                Settings.Global.getString(mContext.getContentResolver(), AUTO_TIME_ZONE);
        final String dataRoamingOriginalValue =
                Settings.Global.getString(mContext.getContentResolver(), DATA_ROAMING);
        final String usbMassStorageOriginalValue =
                Settings.Global.getString(mContext.getContentResolver(), USB_MASS_STORAGE_ENABLED);

        try {
            mDevicePolicyManager.setGlobalSetting(getWho(), AUTO_TIME, ""1"");
            mDevicePolicyManager.setGlobalSetting(getWho(), AUTO_TIME_ZONE, ""1"");
            mDevicePolicyManager.setGlobalSetting(getWho(), DATA_ROAMING, ""1"");
            mDevicePolicyManager.setGlobalSetting(getWho(), USB_MASS_STORAGE_ENABLED, ""1"");
        } finally {
            mDevicePolicyManager.setGlobalSetting(getWho(), AUTO_TIME, autoTimeOriginalValue);
            mDevicePolicyManager.setGlobalSetting(
                    getWho(), AUTO_TIME_ZONE, autoTimeZoneOriginalValue);
            mDevicePolicyManager.setGlobalSetting(getWho(), DATA_ROAMING, dataRoamingOriginalValue);
            mDevicePolicyManager.setGlobalSetting(
                    getWho(), USB_MASS_STORAGE_ENABLED, usbMassStorageOriginalValue);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DevicePolicyLoggingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.CreateAndManageUserTest"	"testCreateAndManageUser_Ephemeral"	""	"3: app(s) apps app"	"public void testCreateAndManageUser_Ephemeral() throws Exception {
        runCrossUserVerification(DevicePolicyManager.MAKE_USER_EPHEMERAL, ""assertEphemeralUser"");
        PrimaryUserService.assertCrossUserCallArrived();
    }

    @SuppressWarnings(""unused"")
    private static void assertAllSystemAppsInstalled(Context context,
            DevicePolicyManager devicePolicyManager, ComponentName componentName,
            Set<String> preInstalledSystemPackages) {
        Log.d(TAG, ""assertAllSystemAppsInstalled(): checking apps for user "" + context.getUserId());

        PackageManager packageManager = context.getPackageManager();
        // First get a set of installed package names
        Set<String> installedPackageNames = packageManager
                .getInstalledApplications(/* flags= */ 0)
                .stream()
                .map(applicationInfo -> applicationInfo.packageName)
                .collect(Collectors.toSet());
        // Then filter all package names by those that are not installed
        Set<String> uninstalledPackageNames = packageManager
                .getInstalledApplications(PackageManager.MATCH_UNINSTALLED_PACKAGES)
                .stream()
                .map(applicationInfo -> applicationInfo.packageName)
                .filter(((Predicate<String>) installedPackageNames::contains).negate())
                .collect(Collectors.toSet());

        // Finally, filter out packages that are not pre-installed for the user
        Iterator<String> iterator = uninstalledPackageNames.iterator();
        while (iterator.hasNext()) {
            String pkg = iterator.next();
            if (!preInstalledSystemPackages.contains(pkg)) {
                Log.i(TAG, ""assertAllSystemAppsInstalled(): ignoring package "" + pkg
                        + "" as it's not pre-installed on current user"");
                iterator.remove();
            }
        }

        // Assert that all expected apps are installed
        assertWithMessage(""uninstalled system apps"").that(uninstalledPackageNames).isEmpty();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/CreateAndManageUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.CreateAndManageUserTest"	"testCreateAndManageUser_LeaveAllSystemApps"	""	"3: app(s) apps app"	"public void testCreateAndManageUser_LeaveAllSystemApps() throws Exception {
        int currentUserId = ActivityManager.getCurrentUser();
        // TODO: instead of hard-coding the user type, calling getPreInstallableSystemPackages(),
        // and passing the packages to runCrossUserVerification() / assertAllSystemAppsInstalled(),
        // ideally the later should call um.getPreInstallableSystemPackages(um.getUsertype())
        // (where um is the UserManager with the context of the newly created user),
        // but currently the list of pre-installed apps is passed to the new user in the bundle.
        // Given that these tests will be refactored anyways, it's not worth to try to change it.
        String newUserType = UserManager.USER_TYPE_FULL_SECONDARY;
        Set<String> preInstalledSystemPackages = SystemUtil.callWithShellPermissionIdentity(
                () -> UserManager.get(mContext).getPreInstallableSystemPackages(newUserType));
        if (preInstalledSystemPackages != null) {
            Log.d(TAG, preInstalledSystemPackages.size() + "" pre-installed system apps for ""
                    + ""new user of type "" + newUserType + "": "" + preInstalledSystemPackages);
        } else {
            Log.d(TAG, ""no pre-installed system apps allowlist for new user of type"" + newUserType);
        }

        runCrossUserVerification(/* callback= */ null,
                DevicePolicyManager.LEAVE_ALL_SYSTEM_APPS_ENABLED, ""assertAllSystemAppsInstalled"",
                preInstalledSystemPackages);
        PrimaryUserService.assertCrossUserCallArrived();
    }

    private UserHandle runCrossUserVerification(int createAndManageUserFlags, String methodName)
            throws Exception {
        return runCrossUserVerification(/* callback= */ null, createAndManageUserFlags, methodName,
                /* currentUserPackages= */ null);
    }

    private UserHandle runCrossUserVerification(UserActionCallback callback,
            int createAndManageUserFlags, String methodName,
            Set<String> currentUserPackages) throws Exception {
        Log.d(TAG, ""runCrossUserVerification(): flags="" + createAndManageUserFlags
                + "", method="" + methodName);
        String testUserName = ""TestUser_"" + System.currentTimeMillis();

        // Set affiliation id to allow communication.
        mDevicePolicyManager.setAffiliationIds(getWho(), Collections.singleton(AFFILIATION_ID));

        ComponentName profileOwner = SecondaryUserAdminReceiver.getComponentName(getContext());

        // Pack the affiliation id in a bundle so the secondary user can get it.
        PersistableBundle bundle = new PersistableBundle();
        bundle.putString(EXTRA_AFFILIATION_ID, AFFILIATION_ID);
        bundle.putString(EXTRA_METHOD_NAME, methodName);
        if (currentUserPackages != null) {
            String[] array = new String[currentUserPackages.size()];
            currentUserPackages.toArray(array);
            bundle.putStringArray(EXTRA_CURRENT_USER_PACKAGES, array);
        }

        Log.d(TAG, ""creating user with PO "" + profileOwner);

        UserHandle userHandle = createAndManageUser(profileOwner, bundle, createAndManageUserFlags);
        if (callback != null) {
            startUserInBackgroundAndWaitForBroadcasts(callback, userHandle);
        } else {
            startUserInBackgroundAndWaitForBroadcasts(userHandle);
        }
        return userHandle;
    }

    // createAndManageUser should circumvent the DISALLOW_ADD_USER restriction"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/CreateAndManageUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.CreateAndManageUserTest"	"testUserAddedOrRemovedBroadcasts"	""	"3: called UI app"	"public void testUserAddedOrRemovedBroadcasts() throws Exception {
        UserHandle userHandle = createAndManageUser();

        List<UserHandle> userHandles = removeUserAndWaitForBroadcasts(userHandle);

        assertWithMessage(""user on broadcasts"").that(userHandles).containsExactly(userHandle);
    }

    private UserHandle createAndManageUser() throws Exception {
        return createAndManageUser(/* flags= */ 0);
    }

    private UserHandle createAndManageUser(int flags) throws Exception {
        return createAndManageUser(/* profileOwner= */ getWho(), /* adminExtras= */ null, flags);
    }

    private UserHandle createAndManageUser(ComponentName profileOwner,
            PersistableBundle adminExtras, int flags) throws Exception {
        String testUserName = ""TestUser_"" + System.currentTimeMillis();

        UserActionCallback callback = UserActionCallback.getCallbackForBroadcastActions(
                getContext(), BasicAdminReceiver.ACTION_USER_ADDED);

        UserHandle userHandle = callback.callAndUnregisterSelf(() ->
                mDevicePolicyManager.createAndManageUser(
                        /* admin= */ getWho(),
                        testUserName,
                        profileOwner,
                        adminExtras,
                        flags));
        Log.d(TAG, ""User '"" + testUserName + ""' created: "" + userHandle);
        return userHandle;
    }

    /**
     * Switches to the given user, or fails if the user could not be switched or if the expected
     * broadcasts were not received in time.
     *
     * @return users received in the broadcasts
     */
    private List<UserHandle> switchUserAndWaitForBroadcasts(UserHandle userHandle)
            throws Exception {
        Log.d(TAG, ""Switching to user "" + userHandle);

        UserActionCallback callback = UserActionCallback.getCallbackForBroadcastActions(
                getContext(),
                BasicAdminReceiver.ACTION_USER_STARTED, BasicAdminReceiver.ACTION_USER_SWITCHED);

        callback.runAndUnregisterSelf(() -> {
            boolean switched = mDevicePolicyManager.switchUser(getWho(), userHandle);
            assertWithMessage(""switched to user %s"", userHandle).that(switched).isTrue();
        });
        return callback.getUsersOnReceivedBroadcasts();
    }

    /**
     * Removes the given user, or fails if the user could not be removed or if the expected
     * broadcasts were not received in time.
     *
     * @return users received in the broadcasts
     */
    private List<UserHandle> removeUserAndWaitForBroadcasts(UserHandle userHandle)
            throws Exception {
        UserActionCallback callback = UserActionCallback.getCallbackForBroadcastActions(
                getContext(), BasicAdminReceiver.ACTION_USER_REMOVED);

        callback.runAndUnregisterSelf(() -> {
            boolean removed = mDevicePolicyManager.removeUser(getWho(), userHandle);
            assertWithMessage(""removed user %s"", userHandle).that(removed).isTrue();
        });

        return callback.getUsersOnReceivedBroadcasts();
    }

    private static String userOperationResultToString(int result) {
        return DebugUtils.constantToString(UserManager.class, ""USER_OPERATION_"", result);
    }

    private static void assertUserOperationResult(int actualResult, int expectedResult,
            String operationFormat, Object... operationArgs) {
        String operation = String.format(operationFormat, operationArgs);
        assertWithMessage(""result for %s (%s instead of %s)"", operation,
                userOperationResultToString(actualResult),
                userOperationResultToString(expectedResult))
                        .that(actualResult).isEqualTo(expectedResult);
    }

    private void startUserInBackgroundAndCheckResult(UserHandle userHandle, int expectedResult) {
        int actualResult = mDevicePolicyManager.startUserInBackground(getWho(), userHandle);
        assertUserOperationResult(actualResult, expectedResult, ""starting user %s in background"",
                userHandle);
    }

    /**
     * Starts the given user in background, or fails if the user could not be started or if the
     * expected broadcasts were not received in time.
     *
     * @return users received in the broadcasts
     */
    private List<UserHandle> startUserInBackgroundAndWaitForBroadcasts(UserHandle userHandle)
            throws Exception {
        UserActionCallback callback = UserActionCallback.getCallbackForBroadcastActions(
                getContext(), BasicAdminReceiver.ACTION_USER_STARTED);
        return startUserInBackgroundAndWaitForBroadcasts(callback, userHandle);
    }

    private List<UserHandle> startUserInBackgroundAndWaitForBroadcasts(UserActionCallback callback,
            UserHandle userHandle) throws Exception {
        callback.runAndUnregisterSelf(() -> startUserInBackgroundAndCheckResult(userHandle,
                UserManager.USER_OPERATION_SUCCESS));
        return callback.getUsersOnReceivedBroadcasts();
    }

    private void stopUserAndCheckResult(UserHandle userHandle, int expectedResult) {
        int actualResult = mDevicePolicyManager.stopUser(getWho(), userHandle);
        assertUserOperationResult(actualResult, expectedResult, ""stopping user %s"", userHandle);
    }

    /**
     * Stops the given user, or fails if the user could not be stop or if the expected broadcasts
     * were not received in time.
     *
     * @return users received in the broadcasts
     */
    private List<UserHandle> stopUserAndWaitForBroadcasts(UserHandle userHandle) throws Exception {
        UserActionCallback callback = UserActionCallback.getCallbackForBroadcastActions(
                getContext(), BasicAdminReceiver.ACTION_USER_STOPPED);
        callback.runAndUnregisterSelf(
                () -> stopUserAndCheckResult(userHandle, UserManager.USER_OPERATION_SUCCESS));
        return callback.getUsersOnReceivedBroadcasts();
    }

    public static final class PrimaryUserService extends Service {
        private static final Semaphore sSemaphore = new Semaphore(0);
        private static String sError = null;

        private final ICrossUserService.Stub mBinder = new ICrossUserService.Stub() {
            public void onEnabledCalled(String error) {
                Log.d(TAG, ""PrimaryUserService.onEnabledCalled() on user ""
                        + getApplicationContext().getUserId() + "" with error "" + error);
                sError = error;
                sSemaphore.release();
            }
        };

        @Override
        public IBinder onBind(Intent intent) {
            Log.d(TAG, ""PrimaryUserService.onBind() on user ""
                    + getApplicationContext().getUserId() + "": "" + intent);
            return mBinder;
        }

        static void assertCrossUserCallArrived() throws Exception {
            assertWithMessage(""cross-user call arrived in %ss"", ON_ENABLED_TIMEOUT_SECONDS)
                    .that(sSemaphore.tryAcquire(ON_ENABLED_TIMEOUT_SECONDS, TimeUnit.SECONDS))
                    .isTrue();
            if (sError != null) {
                Log.e(TAG, ""assertCrossUserCallArrived() had error: "" + sError);
                throw new Exception(sError);
            }
        }
    }

    public static final class SecondaryUserAdminReceiver extends DeviceAdminReceiver {

        @Override
        public void onEnabled(Context context, Intent intent) {
            Log.d(TAG, ""SecondaryUserAdminReceiver.onEnabled() called on user ""
                    + context.getUserId());

            DevicePolicyManager dpm = context.getSystemService(DevicePolicyManager.class);
            ComponentName who = getComponentName(context);

            // Set affiliation ids
            Set<String> ids = Collections.singleton(intent.getStringExtra(EXTRA_AFFILIATION_ID));
            Log.d(TAG, ""setting affiliation ids as "" + ids);
            dpm.setAffiliationIds(who, ids);

            String error = null;
            try {
                Method method;
                if (intent.hasExtra(EXTRA_CURRENT_USER_PACKAGES)) {
                    method = CreateAndManageUserTest.class.getDeclaredMethod(
                            intent.getStringExtra(EXTRA_METHOD_NAME), Context.class,
                            DevicePolicyManager.class, ComponentName.class, Set.class);
                } else {
                    method = CreateAndManageUserTest.class.getDeclaredMethod(
                            intent.getStringExtra(EXTRA_METHOD_NAME), Context.class,
                            DevicePolicyManager.class, ComponentName.class);
                }
                method.setAccessible(true);
                Log.d(TAG, ""Calling method "" + method);
                if (intent.hasExtra(EXTRA_CURRENT_USER_PACKAGES)) {
                    String[] pkgsArray = intent.getStringArrayExtra(EXTRA_CURRENT_USER_PACKAGES);
                    Set<String> pkgs = new HashSet<>(pkgsArray.length);
                    for (String pkg : pkgsArray) {
                        pkgs.add(pkg);
                    }
                    method.invoke(null, context, dpm, who, pkgs);
                } else {
                    method.invoke(null, context, dpm, who);
                }
            } catch (NoSuchMethodException | IllegalAccessException e) {
                error = e.toString();
            } catch (InvocationTargetException e) {
                error = e.getCause().toString();
            }

            // Call all affiliated users
            final List<UserHandle> targetUsers = dpm.getBindDeviceAdminTargetUsers(who);
            assertWithMessage(""target users"").that(targetUsers).hasSize(1);

            pingTargetUser(context, dpm, targetUsers.get(0), error);
        }

        private void pingTargetUser(Context context, DevicePolicyManager dpm,
                UserHandle target, String error) {
            Log.d(TAG, ""Pinging target "" + target + "" with error "" + error);
            final ServiceConnection serviceConnection = new ServiceConnection() {
                @Override
                public void onServiceConnected(ComponentName name, IBinder service) {
                    Log.d(TAG, ""onServiceConnected() is called in "" + Thread.currentThread());
                    ICrossUserService crossUserService = ICrossUserService
                            .Stub.asInterface(service);
                    try {
                        crossUserService.onEnabledCalled(error);
                    } catch (RemoteException re) {
                        Log.e(TAG, ""Error when calling primary user"", re);
                        // Do nothing, primary user will time out
                    }
                }

                @Override
                public void onServiceDisconnected(ComponentName name) {
                    Log.d(TAG, ""onServiceDisconnected() is called"");
                }
            };
            Intent serviceIntent = new Intent(context, PrimaryUserService.class);
            boolean bound = dpm.bindDeviceAdminServiceAsUser(
                    getComponentName(context),
                    serviceIntent,
                    serviceConnection,
                    Context.BIND_AUTO_CREATE,
                    target);
            assertWithMessage(""bound to user %s using intent %s"", target, serviceIntent).that(bound)
                    .isTrue();
        }

        public static ComponentName getComponentName(Context context) {
            return new ComponentName(context, SecondaryUserAdminReceiver.class);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/CreateAndManageUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.HeadlessSystemUserTest"	"isHeadlessSystemUserMode"	""	"2: 9.1 app"	"public void test/*
 *.
 */
package com.android.cts.deviceowner;

import static com.android.compatibility.common.util.SystemUtil.callWithShellPermissionIdentity;
import static com.android.compatibility.common.util.SystemUtil.eventually;

import static com.google.common.truth.Truth.assertWithMessage;

import android.annotation.UserIdInt;
import android.app.admin.DevicePolicyManager;
import android.content.ComponentName;
import android.content.Context;
import android.content.pm.UserInfo;
import android.os.UserHandle;
import android.os.UserManager;
import android.util.Log;

//TODO(b/174859111): move to automotive specific module
/**
 * Device owner tests specific for devices that use
 * {@link android.os.UserManager#isHeadlessSystemUserMode()}.
 */
public final class HeadlessSystemUserTest extends BaseDeviceOwnerTest {

    private static final String TAG = HeadlessSystemUserTest.class.getSimpleName();

    // To be used in cases where it needs to test the DPM of the current user (as
    // mDevicePolicyManager wraps calls to user 0's DeviceOwner DPM);
    private DevicePolicyManager mCurrentUserDpm;

    private UserManager mUserManager;

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        mCurrentUserDpm = mContext.getSystemService(DevicePolicyManager.class);
        mUserManager = mContext.getSystemService(UserManager.class);

        Log.d(TAG, ""setUp(): userId="" + mUserId);

    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/HeadlessSystemUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.HeadlessSystemUserTest"	"testProfileOwnerIsSetOnNewUser"	""	"1: 9.1"	"public void testProfileOwnerIsSetOnNewUser() throws Exception {
        UserInfo user = null;
        try {
            user = callWithShellPermissionIdentity(() -> mUserManager
                    .createUser(""testProfileOwnerIsSetOnNewUser"", /* flags= */ 0));
            assertWithMessage(""new user"").that(user).isNotNull();
            Log.d(TAG, ""Created user "" + user.toFullString());
            final int userId = user.id;

            // Must try a couple times as PO is asynchronously set after user is created.
            // TODO(b/178102911): use a callback instead
            Context newUserContext = mContext.createContextAsUser(UserHandle.of(userId),
                    /* flags=*/ 0);
            DevicePolicyManager newUserDpm = newUserContext
                    .getSystemService(DevicePolicyManager.class);
            eventually(() -> assertProfileOwner(newUserDpm.getProfileOwner(), userId));

        } finally {
            if (user != null) {
                final int userId = user.id;
                Log.d(TAG, ""Removing user "" + userId);
                boolean removed = callWithShellPermissionIdentity(
                        () -> mUserManager.removeUser(userId));
                assertWithMessage(""user %s removed"", userId).that(removed).isTrue();
            }
        }
    }

    private void assertProfileOwner(ComponentName admin, @UserIdInt int userId) {
        assertWithMessage(""Component %s is profile owner for user %s"", admin, userId)
                .that(admin).isEqualTo(getWho());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/HeadlessSystemUserTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.ListForegroundAffiliatedUsersTest"	"testListForegroundAffiliatedUsers_onlyForegroundUser"	""	"1: only"	"public void testListForegroundAffiliatedUsers_onlyForegroundUser() throws Exception {
        List<UserHandle> users = mDevicePolicyManager.listForegroundAffiliatedUsers();

        UserHandle currentUser = invokeStaticMethodWithShellPermissions(() -> getCurrentUser());
        Log.d(TAG, ""currentUser: "" + currentUser + "" users: ""  + users);

        assertWithMessage(""foreground users"").that(users).containsExactly(currentUser);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/ListForegroundAffiliatedUsersTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.NetworkLoggingTest"	"testNetworkLoggingAndRetrieval"	""	"3: data UI app"	"public void testNetworkLoggingAndRetrieval() throws Exception {
        mBatchesRequested =
                Integer.parseInt(
                        InstrumentationRegistry.getArguments().getString(ARG_BATCH_COUNT, ""1""));
        Log.d(TAG, ""batches requested:"" + mBatchesRequested);
        mBatchCountDown = new CountDownLatch(mBatchesRequested);
        // register a receiver that listens for DeviceAdminReceiver#onNetworkLogsAvailable()
        final IntentFilter filterNetworkLogsAvailable = new IntentFilter(
                BasicAdminReceiver.ACTION_NETWORK_LOGS_AVAILABLE);

        registerTestCaseReceiver(mContext, mNetworkLogsReceiver, filterNetworkLogsAvailable);

        // visit websites that shouldn't be logged as network logging isn't enabled yet
        for (int i = 0; i < NOT_LOGGED_URLS_LIST.length; i++) {
            connectToWebsite(NOT_LOGGED_URLS_LIST[i], shouldLog(i));
        }

        // enable network logging and start the logging scenario
        setNetworkLoggingEnabled(true);

        // TODO: here test that facts about logging are shown in the UI

        // Fetch and verify the batches of events.
        generateBatches();
    }

    private boolean shouldLog(int sample) {
        return sample % LOGGING_FREQUENCY == 0;
    }

    private void generateBatches() throws Exception {
        // visit websites to verify their dns lookups are logged
        for (int i = 0; i < LOGGED_URLS_LIST.length; i++) {
            connectToWebsite(LOGGED_URLS_LIST[i], shouldLog(i));
        }

        // generate enough traffic to fill the batches.
        int fakeReqNo = 0;
        for (int i = 0; i < mBatchesRequested; i++) {
            fakeReqNo += generateFakeTraffic();
        }

        // if DeviceAdminReceiver#onNetworkLogsAvailable() hasn't been triggered yet, wait for up to
        // 3 minutes per batch just in case
        final int timeoutMs = TIMEOUT_PER_BATCH_MS * mBatchesRequested;
        Log.d(TAG, ""Waiting up to "" + timeoutMs + ""ms for "" + mBatchesRequested + "" batches"");
        if (!mBatchCountDown.await(timeoutMs, TimeUnit.MILLISECONDS)) {
            Log.e(TAG, ""Timed out!"");
        }

        unregisterTestCaseReceiver(mContext, mNetworkLogsReceiver);

        if (mBatchCountDown.getCount() > 0) {
            fail(""Generated events for "" + mBatchesRequested + "" batches and waited for ""
                    + timeoutMs + "" ms, but still didn't get""
                    + "" DeviceAdminReceiver#onNetworkLogsAvailable() callback"");
        }

        // Verify network logs.
        assertWithMessage(""network events"").that(mNetworkEvents).isNotEmpty();
        assertWithMessage(""first event id"").that(mNetworkEvents.get(0).getId()).isEqualTo(0L);
        // For each of the real URLs we have two events: one DNS and one connect. Fake requests
        // don't require DNS queries.
        final int eventsExpected =
                Math.min(FULL_LOG_BATCH_SIZE * mBatchesRequested,
                        2 * LOGGED_URLS_LIST.length + fakeReqNo);
        verifyNetworkLogs(mNetworkEvents, eventsExpected);
    }

    private void verifyDnsEvent(DnsEvent dnsEvent) {
        // Verify that we didn't log a hostname lookup when network logging was disabled.
        if (dnsEvent.getHostname().contains(NOT_LOGGED_URLS_LIST[0])
                || dnsEvent.getHostname().contains(NOT_LOGGED_URLS_LIST[1])) {
            fail(""A hostname that was looked-up when network logging was disabled""
                    + "" was logged."");
        }

        // Verify that as many IP addresses were logged as were reported (max 10).
        final List<InetAddress> ips = dnsEvent.getInetAddresses();
        assertThat(ips.size()).isAtMost(MAX_IP_ADDRESSES_LOGGED);
        final int expectedAddressCount = Math.min(MAX_IP_ADDRESSES_LOGGED,
                dnsEvent.getTotalResolvedAddressCount());
        assertThat(expectedAddressCount).isEqualTo(ips.size());

        // Verify the IP addresses are valid IPv4 or IPv6 addresses.
        for (final InetAddress ipAddress : ips) {
            assertTrue(isIpv4OrIpv6Address(ipAddress));
        }

        //Verify writeToParcel.
        Parcel parcel = Parcel.obtain();
        try {
            dnsEvent.writeToParcel(parcel, 0);
            parcel.setDataPosition(0);
            final DnsEvent dnsEventOut = DnsEvent.CREATOR.createFromParcel(parcel);
            assertThat(dnsEventOut).isNotNull();
            verifyDnsEventsEqual(dnsEvent, dnsEventOut);
        } finally {
            parcel.recycle();
        }
    }

    private void verifyDnsEventsEqual(DnsEvent event1, DnsEvent event2) {
        assertThat(event1.getHostname()).isEqualTo(event2.getHostname());
        assertThat(new HashSet<InetAddress>(event1.getInetAddresses())).isEqualTo(
                        new HashSet<InetAddress>(event2.getInetAddresses()));
        assertThat(event1.getTotalResolvedAddressCount()).isEqualTo(
                event2.getTotalResolvedAddressCount());
        assertThat(event1.getPackageName()).isEqualTo(event2.getPackageName());
        assertThat(event1.getTimestamp()).isEqualTo(event2.getTimestamp());
        assertThat(event1.getId()).isEqualTo(event2.getId());
    }

    private void verifyConnectEvent(ConnectEvent connectEvent) {
        // Verify the IP address is a valid IPv4 or IPv6 address.
        final InetAddress ip = connectEvent.getInetAddress();
        assertThat(isIpv4OrIpv6Address(ip)).isTrue();

        // Verify that the port is a valid port.
        assertThat(connectEvent.getPort()).isAtLeast(0);
        assertThat(connectEvent.getPort()).isAtMost(65535);

        // Verify writeToParcel.
        Parcel parcel = Parcel.obtain();
        try {
            connectEvent.writeToParcel(parcel, 0);
            parcel.setDataPosition(0);
            final ConnectEvent connectEventOut = ConnectEvent.CREATOR.createFromParcel(parcel);
            assertThat(connectEventOut).isNotNull();
            verifyConnectEventsEqual(connectEvent, connectEventOut);
        } finally {
             parcel.recycle();
        }
    }

    private void verifyConnectEventsEqual(ConnectEvent event1, ConnectEvent event2) {
        assertThat(event1.getInetAddress()).isEqualTo(event2.getInetAddress());
        assertThat(event1.getPort()).isEqualTo(event2.getPort());
        assertThat(event1.getPackageName()).isEqualTo(event2.getPackageName());
        assertThat(event1.getTimestamp()).isEqualTo(event2.getTimestamp());
        assertThat(event1.getId()).isEqualTo(event2.getId());
    }

    private void verifyNetworkLogs(List<NetworkEvent> networkEvents, int eventsExpected) {
        Log.d(TAG, ""verifyNetworkLogs(): expected "" + eventsExpected + "", got ""
                + ((networkEvents == null) ? ""null"" : String.valueOf(networkEvents.size())));
        // allow a batch to be slightly smaller or larger.
        assertTrue(Math.abs(eventsExpected - networkEvents.size()) <= 150);
        int ctsPackageNameCounter = 0;
        // allow a small down margin for verification, to avoid flakiness
        final int eventsExpectedWithMargin = eventsExpected - 50;
        final boolean[] visited = new boolean[LOGGED_URLS_LIST.length];

        for (int i = 0; i < networkEvents.size(); i++) {
            final NetworkEvent currentEvent = networkEvents.get(i);
            // verify that the events are in chronological order
            if (i > 0) {
                assertTrue(currentEvent.getTimestamp() >= networkEvents.get(i - 1).getTimestamp());
            }
            // verify that the event IDs are monotonically increasing
            if (i > 0) {
                assertTrue(currentEvent.getId() == (networkEvents.get(i - 1).getId() + 1));
            }
            // count how many events come from the CTS app
            if (CTS_APP_PACKAGE_NAME.equals(currentEvent.getPackageName())) {
                ctsPackageNameCounter++;
                if (currentEvent instanceof DnsEvent) {
                    final DnsEvent dnsEvent = (DnsEvent) currentEvent;
                    // Mark which addresses from LOGGED_URLS_LIST were visited.
                    for (int j = 0; j < LOGGED_URLS_LIST.length; j++) {
                        if (dnsEvent.getHostname().contains(LOGGED_URLS_LIST[j])) {
                            visited[j] = true;
                            break;
                        }
                    }

                    verifyDnsEvent(dnsEvent);
                } else if (currentEvent instanceof ConnectEvent) {
                    final ConnectEvent connectEvent = (ConnectEvent) currentEvent;
                    verifyConnectEvent(connectEvent);
                } else {
                    fail(""An unknown NetworkEvent type logged: ""
                            + currentEvent.getClass().getName());
                }
            }
        }

        // verify that each hostname from LOGGED_URLS_LIST was looked-up
        for (int i = 0; i < 10; i++) {
            assertTrue(LOGGED_URLS_LIST[i] + "" wasn't visited"", visited[i]);
        }
        // verify that sufficient iterations done by the CTS app were logged
        assertTrue(ctsPackageNameCounter >= eventsExpectedWithMargin);
    }

    private void connectToWebsite(String server, boolean shouldLog) {
        HttpURLConnection urlConnection = null;
        try {
            final URL url = new URL(""http://"" + server);
            if (shouldLog || VERBOSE) {
                Log.d(TAG, ""Connecting to "" + server + "" with "" + CONNECTION_TIMEOUT_MS
                        + ""ms timeout"");
            }
            urlConnection = (HttpURLConnection) url.openConnection();
            urlConnection.setConnectTimeout(CONNECTION_TIMEOUT_MS);
            urlConnection.setReadTimeout(CONNECTION_TIMEOUT_MS);
            final int responseCode = urlConnection.getResponseCode();
            if (shouldLog || VERBOSE) {
                Log.d(TAG, ""Got response code: "" + responseCode);
            }
        } catch (IOException e) {
            Log.w(TAG, ""Failed to connect to "" + server, e);
        } finally {
            if (urlConnection != null) {
                urlConnection.disconnect();
            }
        }
    }

    /** Quickly generate loads of events by repeatedly connecting to a local server. */
    private int generateFakeTraffic() throws IOException, InterruptedException {
        final ServerSocket serverSocket = new ServerSocket(0);
        final Thread serverThread = startFakeServer(serverSocket);

        final int reqNo = makeFakeRequests(serverSocket.getLocalPort());

        serverSocket.close();
        serverThread.join();

        return reqNo;
    }

    private int makeFakeRequests(int port) {
        int reqNo;
        final String FAKE_SERVER = ""127.0.0.1:"" + port;
        Log.d(TAG, ""Making a fake request to "" + FAKE_SERVER);
        for (reqNo = 0; reqNo < FULL_LOG_BATCH_SIZE && mBatchCountDown.getCount() > 0; reqNo++) {
            connectToWebsite(FAKE_SERVER, shouldLog(reqNo));
            // Just to prevent choking the server.
            sleep(10);
        }
        Log.d(TAG, ""Returning reqNo="" + reqNo);
        return reqNo;
    }

    private Thread startFakeServer(ServerSocket serverSocket) throws InterruptedException {
        final Thread serverThread = new Thread(() -> {
            while (!serverSocket.isClosed()) {
                try {
                    final Socket socket = serverSocket.accept();
                    // Consume input.
                    final BufferedReader input =
                            new BufferedReader(new InputStreamReader(socket.getInputStream()));
                    String line;
                    do {
                        line = input.readLine();
                    } while (line != null && !line.equals(""""));
                    // Return minimum valid response.
                    final PrintStream output = new PrintStream(socket.getOutputStream());
                    output.println(""HTTP/1.0 200 OK"");
                    output.println(""Content-Length: 0"");
                    output.println();
                    output.flush();
                    output.close();
                } catch (IOException e) {
                    if (!serverSocket.isClosed()) {
                        Log.w(TAG, ""Failed to serve connection"", e);
                    }
                }
            }
            Log.i(TAG, ""Fake server closed"");
        }, ""FakeServerThread"");
        Log.i(TAG, ""starting a fake server ("" + serverSocket + "") on thread "" + serverThread);
        serverThread.start();

        // Allow the server to start accepting.
        sleep(1_000);

        return serverThread;
    }

    private boolean isIpv4OrIpv6Address(InetAddress addr) {
        return ((addr instanceof Inet4Address) || (addr instanceof Inet6Address));
    }

    private void sleep(int timeMs) {
        if (VERBOSE) Log.v(TAG, ""Sleeping for "" + timeMs + ""ms"");
        SystemClock.sleep(timeMs);
        if (VERBOSE) Log.v(TAG, ""Woke up"");
    }

    private void setNetworkLoggingEnabled(boolean enabled) {
        ComponentName admin = getWho();
        Log.d(TAG, ""Calling setNetworkLoggingEnabled("" + enabled + "") for "" + admin);
        mDevicePolicyManager.setNetworkLoggingEnabled(admin, enabled);
        boolean reallyEnabled = mDevicePolicyManager.isNetworkLoggingEnabled(admin);
        Log.d(TAG, ""getNetworkLoggingEnabled() result:"" + reallyEnabled);
        assertWithMessage(""network logging enabled for %s"", admin).that(reallyEnabled)
                .isEqualTo(enabled);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/NetworkLoggingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.NetworkLoggingTest"	"testProvidingWrongBatchTokenReturnsNull"	""	"1: app"	"public void testProvidingWrongBatchTokenReturnsNull() {
        setNetworkLoggingEnabled(true);

        assertNull(mDevicePolicyManager.retrieveNetworkLogs(getWho(), FAKE_BATCH_TOKEN));
    }

    /**
     * Test: test that the actual logging happens when the network logging is enabled and doesn't
     * happen before it's enabled; for this test to work we need to generate enough internet
     * traffic, so that the batch of logs is created
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/NetworkLoggingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.WifiNetworkConfigurationWithoutFineLocationPermissionTest"	"isWifiEnabled"	""	"1: UI"	"public void test/*
 *.
 */

package com.android.cts.deviceowner;

import static com.android.compatibility.common.util.WifiConfigCreator.SECURITY_TYPE_NONE;

import static com.google.common.truth.Truth.assertWithMessage;

import android.Manifest;
import android.content.pm.PackageManager;
import android.net.wifi.WifiConfiguration;
import android.os.SystemClock;
import android.util.Log;

import com.android.compatibility.common.util.SystemUtil;

import java.util.List;
import java.util.concurrent.TimeUnit;

public class WifiNetworkConfigurationWithoutFineLocationPermissionTest extends BaseDeviceOwnerTest {
    private static final String TAG = ""WifiNetworkConfigurationWithoutFineLocationPermissionTest"";

    // Unique SSID to use for this test (max SSID length is 32)
    private static final String NETWORK_SSID = ""com.android.cts.abcdefghijklmnop"";
    private static final int INVALID_NETWORK_ID = -1;

    // Time duration to allow before assuming that a WiFi operation failed and ceasing to wait.
    private static final long UPDATE_TIMEOUT_MS = TimeUnit.MINUTES.toMillis(5);
    private static final long UPDATE_INTERVAL_MS = TimeUnit.SECONDS.toMillis(1);

    @Override
    public void setUp() throws Exception {
        super.setUp();

        // WiFi is supposed to be a prerequisite of CTS but sometimes it's not enabled
        // for some unknown reason. Check it here just in case.
        if (!mWifiManager.isWifiEnabled()) {
            Log.d(TAG, ""Enabling wifi using shell"");
            SystemUtil.runShellCommand(""svc wifi enable"");
            awaitWifiEnabled();
            Log.d(TAG, ""Done: "" + mWifiManager.isWifiEnabled());
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/WifiNetworkConfigurationWithoutFineLocationPermissionTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.DeviceIdentifiersTest"	"testDeviceOwnerCanGetDeviceIdentifiersWithPermission"	""	"2: UI identifier"	"public void testDeviceOwnerCanGetDeviceIdentifiersWithPermission() {
        // The device owner with the READ_PHONE_STATE permission should have access to all device
        // identifiers. However since the TelephonyManager methods can return null this method
        // verifies that the device owner with the READ_PHONE_STATE permission receives the same
        // value that the shell identity receives with the READ_PRIVILEGED_PHONE_STATE permission.
        TelephonyManager telephonyManager = (TelephonyManager) mContext.getSystemService(
                Context.TELEPHONY_SERVICE);
        try {
            assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getDeviceId""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getDeviceId), telephonyManager.getDeviceId());
            assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getImei""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getImei), telephonyManager.getImei());
            assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getMeid""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getMeid), telephonyManager.getMeid());
            assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getSubscriberId""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getSubscriberId), telephonyManager.getSubscriberId());
            assertEquals(
                    String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getSimSerialNumber""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getSimSerialNumber),
                    telephonyManager.getSimSerialNumber());
            assertEquals(
                    String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getNai""),
                    ShellIdentityUtils.invokeMethodWithShellPermissions(telephonyManager,
                            TelephonyManager::getNai), telephonyManager.getNai());
            assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""Build#getSerial""),
                    ShellIdentityUtils.invokeStaticMethodWithShellPermissions(Build::getSerial),
                    Build.getSerial());
            SubscriptionManager subscriptionManager =
                    (SubscriptionManager) mContext.getSystemService(
                            Context.TELEPHONY_SUBSCRIPTION_SERVICE);
            int subId = subscriptionManager.getDefaultSubscriptionId();
            if (subId != SubscriptionManager.INVALID_SUBSCRIPTION_ID) {
                SubscriptionInfo expectedSubInfo =
                        ShellIdentityUtils.invokeMethodWithShellPermissions(subscriptionManager,
                                (sm) -> sm.getActiveSubscriptionInfo(subId));
                SubscriptionInfo actualSubInfo = subscriptionManager.getActiveSubscriptionInfo(
                        subId);
                assertEquals(String.format(DEVICE_ID_WITH_PERMISSION_ERROR_MESSAGE, ""getIccId""),
                        expectedSubInfo.getIccId(), actualSubInfo.getIccId());
            }
        } catch (SecurityException e) {
            fail(""The device owner with the READ_PHONE_STATE permission must be able to access ""
                    + ""the device IDs: "" + e);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DeviceIdentifiersTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.OverrideApnTest"	"testUpdateConflictingApn"	""	"1: UI"	"public void testUpdateConflictingApn() {
        mDevicePolicyManager.addOverrideApn(getWho(), testApnFull);

        final ApnSetting apnToBeUpdated = (new ApnSetting.Builder())
            .setEntryName(UPDATE_ETNRY_NAME)
            .setApnName(UPDATE_APN_NAME)
            .setApnTypeBitmask(ApnSetting.TYPE_DEFAULT)
            .build();
        int apnIdToUpdate = mDevicePolicyManager.addOverrideApn(getWho(), apnToBeUpdated);
        assertNotSame(-1, apnIdToUpdate);
        assertFalse(mDevicePolicyManager.updateOverrideApn(getWho(), apnIdToUpdate, testApnFull));
        assertTrue(mDevicePolicyManager.removeOverrideApn(getWho(), apnIdToUpdate));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/OverrideApnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.OverrideApnTest"	"testUpdateOverrideApn"	""	"1: UI"	"public void testUpdateOverrideApn() throws Exception {
        int insertedId = mDevicePolicyManager.addOverrideApn(getWho(), testApnFull);
        assertNotSame(-1, insertedId);

        final ApnSetting updateApn = new ApnSetting.Builder()
            .setApnName(UPDATE_APN_NAME)
            .setEntryName(UPDATE_ETNRY_NAME)
            .setOperatorNumeric(TEST_OPERATOR_NUMERIC)
            .setProxyAddress(TEST_PROXY_ADDRESS)
            .setProxyPort(TEST_PROXY_PORT)
            .setMmsc(TEST_MMSC)
            .setMmsProxyAddress(TEST_PROXY_ADDRESS)
            .setMmsProxyPort(TEST_PROXY_PORT)
            .setUser(TEST_USER_NAME)
            .setPassword(TEST_PASSWORD)
            .setAuthType(TEST_AUTH_TYPE)
            .setApnTypeBitmask(TEST_APN_TYPE_BITMASK)
            .setProtocol(TEST_PROTOCOL)
            .setRoamingProtocol(TEST_PROTOCOL)
            .setNetworkTypeBitmask(TEST_NETWORK_TYPE_BITMASK)
            .setMvnoType(TEST_MVNO_TYPE)
            .setCarrierEnabled(TEST_ENABLED)
            .setCarrierId(UPDATE_CARRIER_ID)
            .build();
        assertTrue(mDevicePolicyManager.updateOverrideApn(getWho(), insertedId, updateApn));

        List <ApnSetting> apnList = mDevicePolicyManager.getOverrideApns(getWho());

        assertEquals(1, apnList.size());
        assertEquals(TEST_OPERATOR_NUMERIC, apnList.get(0).getOperatorNumeric());
        assertEquals(UPDATE_ETNRY_NAME, apnList.get(0).getEntryName());
        assertEquals(UPDATE_APN_NAME, apnList.get(0).getApnName());
        assertEquals(getProxyInetAddress(TEST_PROXY_ADDRESS), apnList.get(0).getProxyAddress());
        assertEquals(TEST_PROXY_ADDRESS, apnList.get(0).getProxyAddressAsString());
        assertEquals(TEST_PROXY_PORT, apnList.get(0).getProxyPort());
        assertEquals(TEST_MMSC, apnList.get(0).getMmsc());
        assertEquals(getProxyInetAddress(TEST_PROXY_ADDRESS), apnList.get(0).getMmsProxyAddress());
        assertEquals(TEST_PROXY_ADDRESS, apnList.get(0).getMmsProxyAddressAsString());
        assertEquals(TEST_PROXY_PORT, apnList.get(0).getMmsProxyPort());
        assertEquals(TEST_USER_NAME, apnList.get(0).getUser());
        assertEquals(TEST_PASSWORD, apnList.get(0).getPassword());
        assertEquals(TEST_AUTH_TYPE, apnList.get(0).getAuthType());
        assertEquals(TEST_APN_TYPE_BITMASK, apnList.get(0).getApnTypeBitmask());
        assertEquals(TEST_PROTOCOL, apnList.get(0).getProtocol());
        assertEquals(TEST_PROTOCOL, apnList.get(0).getRoamingProtocol());
        assertEquals(TEST_ENABLED, apnList.get(0).isEnabled());
        assertEquals(TEST_MVNO_TYPE, apnList.get(0).getMvnoType());
        assertEquals(UPDATE_CARRIER_ID, apnList.get(0).getCarrierId());

        assertTrue(mDevicePolicyManager.removeOverrideApn(getWho(), insertedId));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/OverrideApnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.OverrideApnTest"	"testOverrideApnDefaultValues"	""	"1: UI"	"public void testOverrideApnDefaultValues() {
        final ApnSetting emptyApn = new ApnSetting.Builder()
            .setApnName(TEST_APN_NAME)
            .setEntryName(TEST_ENTRY_NAME)
            .setApnTypeBitmask(TEST_APN_TYPE_BITMASK)
            .build();

        int insertedId = mDevicePolicyManager.addOverrideApn(getWho(), emptyApn);
        assertNotSame(-1, insertedId);

        List <ApnSetting> apnList = mDevicePolicyManager.getOverrideApns(getWho());
        assertEquals(1, apnList.size());
        assertEquals("""", apnList.get(0).getOperatorNumeric());
        assertEquals(TEST_ENTRY_NAME, apnList.get(0).getEntryName());
        assertEquals(TEST_APN_NAME, apnList.get(0).getApnName());
        assertEquals(null, apnList.get(0).getProxyAddress());
        assertEquals("""", apnList.get(0).getProxyAddressAsString());
        assertEquals(-1, apnList.get(0).getProxyPort());
        assertEquals(null, apnList.get(0).getMmsc());
        assertEquals(null, apnList.get(0).getMmsProxyAddress());
        assertEquals("""", apnList.get(0).getMmsProxyAddressAsString());
        assertEquals(-1, apnList.get(0).getMmsProxyPort());
        assertEquals("""", apnList.get(0).getUser());
        assertEquals("""", apnList.get(0).getPassword());
        assertEquals(0, apnList.get(0).getAuthType());
        assertEquals(TEST_APN_TYPE_BITMASK, apnList.get(0).getApnTypeBitmask());
        assertEquals(-1, apnList.get(0).getProtocol());
        assertEquals(-1, apnList.get(0).getRoamingProtocol());
        assertEquals(false, apnList.get(0).isEnabled());
        assertEquals(-1, apnList.get(0).getMvnoType());
        assertEquals(-1, apnList.get(0).getCarrierId());

        assertTrue(mDevicePolicyManager.removeOverrideApn(getWho(), insertedId));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/OverrideApnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.OverrideApnTest"	"testBuildApnSettingFailsWithoutRequiredField"	""	"1: UI"	"public void testBuildApnSettingFailsWithoutRequiredField() {
        assertNull(new ApnSetting.Builder()
            .setEntryName(UPDATE_ETNRY_NAME)
            .setApnName(UPDATE_APN_NAME)
            .build());

        assertNull(new ApnSetting.Builder()
            .setEntryName(UPDATE_ETNRY_NAME)
            .setApnName(UPDATE_APN_NAME)
            .setApnTypeBitmask(1 << 30)
            .build());

        assertNull(new ApnSetting.Builder()
            .setApnName(UPDATE_APN_NAME)
            .setApnTypeBitmask(TEST_APN_TYPE_BITMASK)
            .build());

        assertNull(new ApnSetting.Builder()
            .setEntryName(UPDATE_ETNRY_NAME)
            .setApnTypeBitmask(TEST_APN_TYPE_BITMASK)
            .build());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/OverrideApnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	Test Available	"com.android.cts.deviceowner.DevicePolicySafetyCheckerIntegrationTest"	"DevicePolicySafetyCheckerIntegrationTester"	""	"7: data 9.1 camera UI only section app"	"public void test/*
 *.
 */
package com.android.cts.deviceowner;

import static android.app.admin.DevicePolicyManager.OPERATION_CREATE_AND_MANAGE_USER;
import static android.app.admin.DevicePolicyManager.OPERATION_REBOOT;
import static android.app.admin.DevicePolicyManager.OPERATION_REMOVE_USER;
import static android.app.admin.DevicePolicyManager.OPERATION_REQUEST_BUGREPORT;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_APPLICATION_HIDDEN;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_APPLICATION_RESTRICTIONS;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_CAMERA_DISABLED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_FACTORY_RESET_PROTECTION_POLICY;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_GLOBAL_PRIVATE_DNS;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_KEEP_UNINSTALLED_PACKAGES;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_KEYGUARD_DISABLED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_LOCK_TASK_FEATURES;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_LOCK_TASK_PACKAGES;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_LOGOUT_ENABLED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_OVERRIDE_APNS_ENABLED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_PACKAGES_SUSPENDED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_STATUS_BAR_DISABLED;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_SYSTEM_SETTING;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_SYSTEM_UPDATE_POLICY;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_TRUST_AGENT_CONFIGURATION;
import static android.app.admin.DevicePolicyManager.OPERATION_SET_USER_CONTROL_DISABLED_PACKAGES;
import static android.app.admin.DevicePolicyManager.OPERATION_START_USER_IN_BACKGROUND;
import static android.app.admin.DevicePolicyManager.OPERATION_STOP_USER;
import static android.app.admin.DevicePolicyManager.OPERATION_SWITCH_USER;
import static android.app.admin.DevicePolicyManager.OPERATION_UNINSTALL_CA_CERT;
import static android.app.admin.DevicePolicyManager.OPERATION_WIPE_DATA;

import android.app.admin.DevicePolicyManager;
import android.app.admin.FactoryResetProtectionPolicy;
import android.content.ComponentName;
import android.os.Bundle;
import android.os.UserHandle;

import com.android.cts.devicepolicy.DevicePolicySafetyCheckerIntegrationTester;
import com.android.internal.util.ArrayUtils;

import java.util.Arrays;
import java.util.List;

// TODO(b/174859111): move to automotive-only section
/**
 * Tests that DPM calls fail when determined by the
 * {@link android.app.admin.DevicePolicySafetyChecker}.
 */
public final class DevicePolicySafetyCheckerIntegrationTest extends BaseDeviceOwnerTest {
    private static final int NO_FLAGS = 0;
    private static final UserHandle USER_HANDLE = UserHandle.of(42);
    public static final String TEST_PACKAGE = BasicAdminReceiver.class.getPackage().getName();
    public static final ComponentName TEST_COMPONENT = new ComponentName(
            TEST_PACKAGE, BasicAdminReceiver.class.getName());
    public static final List<String> TEST_ACCOUNTS = Arrays.asList(""Account 1"");
    public static final List<String> TEST_PACKAGES = Arrays.asList(TEST_PACKAGE);
    private static final String TEST_CA =
            ""-----BEGIN CERTIFICATE-----\n""
            + ""MIICVzCCAgGgAwIBAgIJAMvnLHnnfO/IMA0GCSqGSIb3DQEBBQUAMIGGMQswCQYD\n""
            + ""VQQGEwJJTjELMAkGA1UECAwCQVAxDDAKBgNVBAcMA0hZRDEVMBMGA1UECgwMSU1G\n""
            + ""TCBQVlQgTFREMRAwDgYDVQQLDAdJTUZMIE9VMRIwEAYDVQQDDAlJTUZMLklORk8x\n""
            + ""HzAdBgkqhkiG9w0BCQEWEHJhbWVzaEBpbWZsLmluZm8wHhcNMTMwODI4MDk0NDA5\n""
            + ""WhcNMjMwODI2MDk0NDA5WjCBhjELMAkGA1UEBhMCSU4xCzAJBgNVBAgMAkFQMQww\n""
            + ""CgYDVQQHDANIWUQxFTATBgNVBAoMDElNRkwgUFZUIExURDEQMA4GA1UECwwHSU1G\n""
            + ""TCBPVTESMBAGA1UEAwwJSU1GTC5JTkZPMR8wHQYJKoZIhvcNAQkBFhByYW1lc2hA\n""
            + ""aW1mbC5pbmZvMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ738cbTQlNIO7O6nV/f\n""
            + ""DJTMvWbPkyHYX8CQ7yXiAzEiZ5bzKJjDJmpRAkUrVinljKns2l6C4++l/5A7pFOO\n""
            + ""33kCAwEAAaNQME4wHQYDVR0OBBYEFOdbZP7LaMbgeZYPuds2CeSonmYxMB8GA1Ud\n""
            + ""IwQYMBaAFOdbZP7LaMbgeZYPuds2CeSonmYxMAwGA1UdEwQFMAMBAf8wDQYJKoZI\n""
            + ""hvcNAQEFBQADQQBdrk6J9koyylMtl/zRfiMAc2zgeC825fgP6421NTxs1rjLs1HG\n""
            + ""VcUyQ1/e7WQgOaBHi9TefUJi+4PSVSluOXon\n""
            + ""-----END CERTIFICATE-----"";
    private final DevicePolicySafetyCheckerIntegrationTester mTester =
            new DevicePolicySafetyCheckerIntegrationTester() {

        @Override
        protected int[] getSafetyAwareOperations() {
            int[] operations = new int [] {
                    OPERATION_CREATE_AND_MANAGE_USER,
                    // TODO(b/175245108) Add test for this operation; testing
                    // dpm.installSystemUpdate will require upload a test system update file.
                    // OPERATION_INSTALL_SYSTEM_UPDATE,
                    OPERATION_REBOOT,
                    OPERATION_REMOVE_USER,
                    OPERATION_REQUEST_BUGREPORT,
                    OPERATION_SET_APPLICATION_HIDDEN,
                    OPERATION_SET_APPLICATION_RESTRICTIONS,
                    OPERATION_SET_CAMERA_DISABLED,
                    OPERATION_SET_FACTORY_RESET_PROTECTION_POLICY,
                    OPERATION_SET_GLOBAL_PRIVATE_DNS,
                    OPERATION_SET_KEEP_UNINSTALLED_PACKAGES,
                    OPERATION_SET_KEYGUARD_DISABLED,
                    OPERATION_SET_LOCK_TASK_FEATURES,
                    OPERATION_SET_LOCK_TASK_PACKAGES,
                    OPERATION_SET_LOGOUT_ENABLED,
                    OPERATION_SET_PACKAGES_SUSPENDED,
                    OPERATION_SET_STATUS_BAR_DISABLED,
                    OPERATION_SET_SYSTEM_SETTING,
                    OPERATION_SET_SYSTEM_UPDATE_POLICY,
                    OPERATION_SET_USER_CONTROL_DISABLED_PACKAGES,
                    OPERATION_START_USER_IN_BACKGROUND,
                    OPERATION_STOP_USER,
                    OPERATION_SWITCH_USER,
                    OPERATION_UNINSTALL_CA_CERT,
                    OPERATION_WIPE_DATA
            };

            if (mHasTelephonyFeature) {
                operations = ArrayUtils.appendInt(operations, OPERATION_SET_OVERRIDE_APNS_ENABLED);
            }
            if (mHasSecureLockScreen) {
                operations = ArrayUtils.appendInt(operations,
                        OPERATION_SET_TRUST_AGENT_CONFIGURATION);
            }

            return operations;
        }

        @Override
        protected int[] getOverloadedSafetyAwareOperations() {
            return new int [] {
                OPERATION_WIPE_DATA
            };
        }

        @Override
        protected void runOperation(DevicePolicyManager dpm, ComponentName admin, int operation,
                boolean overloaded) {
            switch (operation) {
                case OPERATION_CREATE_AND_MANAGE_USER:
                    dpm.createAndManageUser(admin, /* name= */ null, admin, /* adminExtras= */ null,
                            NO_FLAGS);
                    break;
                case OPERATION_REBOOT:
                    dpm.reboot(admin);
                    break;
                case OPERATION_REMOVE_USER:
                    dpm.removeUser(admin, USER_HANDLE);
                    break;
                case OPERATION_REQUEST_BUGREPORT:
                    dpm.requestBugreport(admin);
                    break;
                case OPERATION_SET_APPLICATION_HIDDEN:
                    dpm.setApplicationHidden(admin, TEST_PACKAGE, /* hidden= */true);
                    break;
                case OPERATION_SET_APPLICATION_RESTRICTIONS:
                    dpm.setApplicationRestrictions(admin, TEST_PACKAGE, new Bundle());
                    break;
                case OPERATION_SET_CAMERA_DISABLED:
                    dpm.setCameraDisabled(admin, /* disabled= */ true);
                    break;
                case OPERATION_SET_FACTORY_RESET_PROTECTION_POLICY:
                    dpm.setFactoryResetProtectionPolicy(admin,
                            new FactoryResetProtectionPolicy.Builder()
                                    .setFactoryResetProtectionAccounts(TEST_ACCOUNTS)
                                    .setFactoryResetProtectionEnabled(false)
                                    .build());
                    break;
                case OPERATION_SET_GLOBAL_PRIVATE_DNS:
                    dpm.setGlobalPrivateDnsModeOpportunistic(admin);
                    break;
                case OPERATION_SET_KEEP_UNINSTALLED_PACKAGES:
                    dpm.setKeepUninstalledPackages(admin, TEST_PACKAGES);
                    break;
                case OPERATION_SET_KEYGUARD_DISABLED:
                    dpm.setKeyguardDisabled(admin, true);
                    break;
                case OPERATION_SET_LOCK_TASK_FEATURES:
                    dpm.setLockTaskFeatures(admin, NO_FLAGS);
                    break;
                case OPERATION_SET_LOCK_TASK_PACKAGES:
                    dpm.setLockTaskPackages(admin, new String[] { TEST_PACKAGE });
                    break;
                case OPERATION_SET_LOGOUT_ENABLED:
                    dpm.setLogoutEnabled(admin, /* enabled */ true);
                    break;
                case OPERATION_SET_OVERRIDE_APNS_ENABLED:
                    dpm.setOverrideApnsEnabled(admin, /* enabled */ true);
                    break;
                case OPERATION_SET_PACKAGES_SUSPENDED:
                    dpm.setPackagesSuspended(admin,  new String[] { TEST_PACKAGE },
                            /* suspend= */ true);
                    break;
                case OPERATION_SET_STATUS_BAR_DISABLED:
                    dpm.setStatusBarDisabled(admin, true);
                    break;
                case OPERATION_SET_SYSTEM_SETTING:
                    dpm.setSystemSetting(admin, ""TestSetting"", ""0"");
                    break;
                case OPERATION_SET_SYSTEM_UPDATE_POLICY:
                    dpm.setSystemUpdatePolicy(admin, null);
                    break;
                case OPERATION_SET_TRUST_AGENT_CONFIGURATION:
                    dpm.setTrustAgentConfiguration(admin, TEST_COMPONENT,
                            /* configuration= */ null);
                    break;
                case OPERATION_SET_USER_CONTROL_DISABLED_PACKAGES:
                    dpm.setUserControlDisabledPackages(admin, TEST_PACKAGES);
                    break;
                case OPERATION_START_USER_IN_BACKGROUND:
                    dpm.startUserInBackground(admin, USER_HANDLE);
                    break;
                case OPERATION_STOP_USER:
                    dpm.stopUser(admin, USER_HANDLE);
                    break;
                case OPERATION_SWITCH_USER:
                    dpm.switchUser(admin, USER_HANDLE);
                    break;
                case OPERATION_UNINSTALL_CA_CERT:
                    dpm.uninstallCaCert(admin, TEST_CA.getBytes());
                    break;
                case OPERATION_WIPE_DATA:
                    if (overloaded) {
                        dpm.wipeData(NO_FLAGS,
                                /* reason= */ ""DevicePolicySafetyCheckerIntegrationTest"");
                    } else {
                        dpm.wipeData(NO_FLAGS);
                    }
                    break;
                default:
                    throwUnsupportedOperationException(operation, overloaded);
            }
        }
    };

    /**
     * Tests that all safety-aware operations are properly implemented.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DevicePolicySafetyCheckerIntegrationTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.DevicePolicySafetyCheckerIntegrationTest"	"testIsSafeOperation"	""	"1: app"	"public void testIsSafeOperation() {
        mTester.testIsSafeOperation(mDevicePolicyManager);
    }

    /**
     * Tests {@link android.app.admin.UnsafeStateException} properties.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DevicePolicySafetyCheckerIntegrationTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.DevicePolicySafetyCheckerIntegrationTest"	"testUnsafeStateException"	""	"1: app"	"public void testUnsafeStateException() {
        mTester.testUnsafeStateException(mDevicePolicyManager, getWho());
    }

    /**
     * Tests {@link android.app.admin.DeviceAdminReceiver#onOperationSafetyStateChanged()}.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DevicePolicySafetyCheckerIntegrationTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.SensorToggleRestrictionTest"	"testCameraToggle_RestrictionSet_CannotChangeSensorPrivacy"	""	"1: camera"	"public void testCameraToggle_RestrictionSet_CannotChangeSensorPrivacy() {
        if (!mSensorPrivacyManager.supportsSensorToggle(SensorPrivacyManager.Sensors.CAMERA)) {
            return;
        }
        assertFalse(""Camera sensor privacy should be off by default"",
                ShellIdentityUtils.invokeMethodWithShellPermissions(mSensorPrivacyManager,
                        m -> m.isSensorPrivacyEnabled(SensorPrivacyManager.Sensors.CAMERA)));

        mDevicePolicyManager.addUserRestriction(getWho(), UserManager.DISALLOW_CAMERA_TOGGLE);
        ShellIdentityUtils.invokeMethodWithShellPermissionsNoReturn(mSensorPrivacyManager,
                m -> m.setSensorPrivacy(OTHER, SensorPrivacyManager.Sensors.CAMERA, true));

        assertFalse(""Camera sensor privacy should not be enabled given admin restriction"",
                ShellIdentityUtils.invokeMethodWithShellPermissions(mSensorPrivacyManager,
                        m -> m.isSensorPrivacyEnabled(SensorPrivacyManager.Sensors.CAMERA)));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/SensorToggleRestrictionTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.SensorToggleRestrictionTest"	"testCameraToggle_RestrictionSet_ResetSensorPrivacy"	""	"1: camera"	"public void testCameraToggle_RestrictionSet_ResetSensorPrivacy() {
        if (!mSensorPrivacyManager.supportsSensorToggle(SensorPrivacyManager.Sensors.CAMERA)) {
            return;
        }
        ShellIdentityUtils.invokeMethodWithShellPermissionsNoReturn(mSensorPrivacyManager,
                m -> m.setSensorPrivacy(OTHER, SensorPrivacyManager.Sensors.CAMERA, true));

        mDevicePolicyManager.addUserRestriction(getWho(), UserManager.DISALLOW_CAMERA_TOGGLE);

        long deadline = System.nanoTime() + RESTRICTION_WAITING_TIMEOUT_NANO;
        while (System.nanoTime() < deadline) {
            if (!ShellIdentityUtils.invokeMethodWithShellPermissions(mSensorPrivacyManager,
                    m -> m.isSensorPrivacyEnabled(SensorPrivacyManager.Sensors.CAMERA))) {
                return;
            }
        }
        fail(""Camera sensor privacy did not get reset in time"");
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/SensorToggleRestrictionTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.DefaultSmsApplicationTest"	"testSetDefaultSmsApplication"	""	"1: app"	"public void testSetDefaultSmsApplication() {
        // Must use a DPM associated with the current user because the Telephony.Sms methods will
        // return the app for the calling user, and on headless system user, mDevicePolicyManager
        // wraps the calls to the DeviceOwner user (which fails the test because the value didn't
        // change as expected).
        DevicePolicyManager dpm = mContext.getSystemService(DevicePolicyManager.class);

        String previousSmsAppName = Telephony.Sms.getDefaultSmsPackage(mContext);
        String newSmsAppName = ""android.telephony.cts.sms.simplesmsapp"";
        Log.v(TAG, ""testSetDefaultSmsApplication(): previous="" + previousSmsAppName
                + "", new="" + newSmsAppName + "", user="" + mContext.getUserId()
                + "", isAffiliated="" + dpm.isAffiliatedUser());

        dpm.setDefaultSmsApplication(getWho(), newSmsAppName);
        String defaultSmsApp = Telephony.Sms.getDefaultSmsPackage(mContext);
        assertWithMessage(""default app returned by Telephony.Sms after set by DPM"")
                .that(defaultSmsApp).isNotNull();
        assertWithMessage(""default app returned by Telephony.Sms after set by DPM"")
                .that(defaultSmsApp).isEqualTo(newSmsAppName);

        // Restore previous default sms application
        dpm.setDefaultSmsApplication(getWho(), previousSmsAppName);
        defaultSmsApp = Telephony.Sms.getDefaultSmsPackage(mContext);
        assertWithMessage(""default app returned by Telephony.Sms after restored by DPM"")
                .that(defaultSmsApp).isNotNull();
        assertWithMessage(""default app returned by Telephony.Sms after restored by DPM"")
                .that(defaultSmsApp).isEqualTo(previousSmsAppName);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/DefaultSmsApplicationTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.UserControlDisabledPackagesTest"	"testForceStopWithUserControlEnabled"	""	"4: data identifier role app"	"public void testForceStopWithUserControlEnabled() throws Exception {
        assertPackageStopped(/* stopped= */ true);
        assertThat(mDevicePolicyManager.getUserControlDisabledPackages(getWho())).isEmpty();
    }

    private boolean isPackageStopped(String packageName) throws Exception {
        PackageInfo packageInfo = mContext.getPackageManager()
                .getPackageInfoAsUser(packageName, PackageManager.GET_META_DATA,
                        getCurrentUser().getIdentifier());
        boolean stopped = (packageInfo.applicationInfo.flags & ApplicationInfo.FLAG_STOPPED)
                == ApplicationInfo.FLAG_STOPPED;
        Log.d(TAG, ""Application flags for "" + packageName + "" on user ""
                + getCurrentUser().getIdentifier() + "" = ""
                + Integer.toHexString(packageInfo.applicationInfo.flags) + "". Stopped: "" + stopped);
        return stopped;
    }

    private void assertPackageStopped(boolean stopped) throws Exception {
        assertWithMessage(""Package %s stopped for user %s"", SIMPLE_APP_PKG,
                getCurrentUser().getIdentifier())
                .that(isPackageStopped(SIMPLE_APP_PKG)).isEqualTo(stopped);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/UserControlDisabledPackagesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.UserControlDisabledPackagesTest"	"testLaunchActivity"	""	"2: identifier app"	"public void testLaunchActivity() throws Exception {
        // Launch an activity so that the app exits stopped state.
        Intent intent = new Intent(Intent.ACTION_MAIN);
        intent.setClassName(SIMPLE_APP_PKG, SIMPLE_APP_ACTIVITY);
        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        Log.d(TAG, ""Starting "" + intent + "" on user "" + getCurrentUser().getIdentifier());
        mContext.startActivityAsUser(intent, getCurrentUser());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/UserControlDisabledPackagesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.UserControlDisabledPackagesTest"	"testSetUserControlDisabledPackages"	""	"1: app"	"public void testSetUserControlDisabledPackages() throws Exception {
        ArrayList<String> protectedPackages = new ArrayList<>();
        protectedPackages.add(SIMPLE_APP_PKG);
        mDevicePolicyManager.setUserControlDisabledPackages(getWho(), protectedPackages);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/UserControlDisabledPackagesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.UserControlDisabledPackagesTest"	"testForceStopWithUserControlDisabled"	""	"1: app"	"public void testForceStopWithUserControlDisabled() throws Exception {
        final ArrayList<String> pkgs = new ArrayList<>();
        pkgs.add(SIMPLE_APP_PKG);
        // Check if package is part of UserControlDisabledPackages before checking if
        // package is stopped since it is a necessary condition to prevent stopping of
        // package

        assertThat(mDevicePolicyManager.getUserControlDisabledPackages(getWho()))
                .containsExactly(SIMPLE_APP_PKG);
        assertPackageStopped(/* stopped= */ false);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/UserControlDisabledPackagesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.proxy.StaticProxyTest"	"testBroadcast"	""	"1: UI"	"public void testBroadcast() throws Exception {
    ProxyInfo proxy = ProxyInfo.buildDirectProxy(mProxyHost, PROXY_PORT, mExclList);
    assertTrue(""No broadcast after setting proxy"", setProxyAndWaitForBroadcast(proxy));

    assertTrue(isProxyStatic());
    assertNotNull(""Broadcast must contain proxy"", mProxy);
    assertEquals(ProxyInfo.buildDirectProxy(mProxyHost, PROXY_PORT, mExclList), mProxy);
  }

  /**
   * Verify that we get a clear broadcast after we clear the global
   * proxy.
   */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/proxy/StaticProxyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.proxy.PacProxyTest"	"testProxyIsUp"	""	"1: data"	"public void testProxyIsUp() throws Exception {
    testBroadcast();

    assertNotNull(""Broadcast must contain proxy"", mProxy);
    try {
      Socket s = new Socket(mProxy.getHost(), mProxy.getPort());
      assertTrue(""Must connect to proxy"", s.isConnected());
      s.close();
    } catch (UnknownHostException e) {
      fail(""Proxy contained invalid host - "" + mProxy.getHost() + "":"" + mProxy.getPort());
    } catch (IOException e) {
      fail(""Unable to connect to proxy - "" + mProxy.getHost() + "":"" + mProxy.getPort());
    }
  }

  /**
   * The local legacy proxy described above needs to support HTTP CONNECT
   * requests where data should be passed through without interference.
   * This test hosts a socket and uses this functionality to connect through
   * the proxy and pass data back and forth.  See PassthroughTestHelper for
   * more details.
   */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/proxy/PacProxyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.proxy.PacProxyTest"	"testClearBroadcast"	""	"3: app(s) apps app"	"public void testClearBroadcast() throws Exception {
    testBroadcast();
    assertTrue(""No broadcast after clearing proxy."", clearProxyAndWaitForBroadcast());
    assertTrue(isProxyEmpty());
  }

  /**
   * Verify that the locally-hosted android backup proxy is up and
   * running.
   * Android hosts a proxy server that provides legacy support for apps that
   * don't use the apache HTTP stack, but still read the static proxy
   * settings.  The static settings point to a server that will handle
   * the PAC parsing for them.
   */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/proxy/PacProxyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.proxy.PacProxyTest"	"testLocalPlusDirect"	""	"2: accessed being"	"public void testLocalPlusDirect() throws Exception {
    mPacServer.setPacFile(LOCAL_PLUS_DIRECT_PAC);
    setPacURLAndWaitForDownload();

    waitForSetProxySysProp();

    URI uri = new URI(""http://localhost/test/my/url"");

    ProxySelector selector = ProxySelector.getDefault();
    List<Proxy> list = selector.select(uri);
    assertEquals(""Must return multiple proxies"", newArrayList(
        new Proxy(Type.HTTP, InetSocketAddress.createUnresolved(""localhost"", 8080)),
        new Proxy(Type.HTTP, InetSocketAddress.createUnresolved(""localhost"", 8081)),
        Proxy.NO_PROXY), list);
  }

  /**
   * Tests a PAC file that returns different proxies depending on
   * the host that is being accessed.
   */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/proxy/PacProxyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceowner.proxy.PacProxyTest"	"testHostPassthrough"	""	"2: accessed being"	"public void testHostPassthrough() throws Exception {
    mPacServer.setPacFile(HOST_PAC);
    setPacURLAndWaitForDownload();

    waitForSetProxySysProp();
    String host = ""testhost"";
    URI uri = new URI(""http://"" + host + ""/test/my/url"");
    ProxySelector selector = ProxySelector.getDefault();
    List<Proxy> list = selector.select(uri);

    assertEquals(""Proxy must have correct port"", newArrayList(
        new Proxy(Type.HTTP, InetSocketAddress.createUnresolved(""localhost"", 8080))),
        list);
  }

  /**
   * Tests a PAC file that returns different proxies depending on
   * the url that is being accessed.
   */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceOwner/src/com/android/cts/deviceowner/proxy/PacProxyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.packageinstaller.ManualPackageInstallTest"	"testManualInstallBlocked"	""	"4: UI only view app"	"public void testManualInstallBlocked() throws Exception {
        synchronized (mPackageInstallerTimeoutLock) {
            mCallbackReceived = false;
            mCallbackStatus = PACKAGE_INSTALLER_STATUS_UNDEFINED;
        }
        // Calls the original installPackage which does not click through the install button.
        Log.d(TAG, ""Installing "" + TEST_APP_LOCATION);
        super.installPackage(TEST_APP_LOCATION);
        synchronized (mPackageInstallerTimeoutLock) {
            try {
                mPackageInstallerTimeoutLock.wait(PACKAGE_INSTALLER_TIMEOUT_MS);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                Log.e(TAG, ""Interrupted"", e);
            }
            assertTrue(mCallbackReceived);
            assertEquals(PackageInstaller.STATUS_PENDING_USER_ACTION, mCallbackStatus);
        }

        mCallbackIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        Log.d(TAG, ""Starting "" + mCallbackIntent + "" on user "" + UserHandle.myUserId());
        mContext.startActivity(mCallbackIntent);

        automateDismissInstallBlockedDialog();

        // Assuming installation is not synchronous, we should wait a while before checking.
        Thread.sleep(INSTALL_WAIT_TIME);
        assertFalse(isPackageInstalled(TEST_APP_PKG));
    }

    @Override
    protected void installPackage(String packageLocation) throws Exception {
        super.installPackage(packageLocation);

        synchronized (mPackageInstallerTimeoutLock) {
            try {
                mPackageInstallerTimeoutLock.wait(PACKAGE_INSTALLER_TIMEOUT_MS);
            } catch (InterruptedException e) {
            }
            assertTrue(mCallbackReceived);
            assertEquals(PackageInstaller.STATUS_PENDING_USER_ACTION, mCallbackStatus);
        }

        // Use a receiver to listen for package install.
        synchronized (mPackageInstallerTimeoutLock) {
            mCallbackReceived = false;
            mCallbackStatus = PACKAGE_INSTALLER_STATUS_UNDEFINED;
        }

        mCallbackIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        mContext.startActivity(mCallbackIntent);

        automateInstallClick();
    }

    private void automateInstallClick() {
        mDevice.wait(Until.hasObject(INSTALL_BUTTON_SELECTOR), AUTOMATOR_WAIT_TIMEOUT);
        UiObject2 button = mDevice.findObject(INSTALL_BUTTON_SELECTOR);
        assertNotNull(""Install button not found"", button);
        button.click();
    }

    private void automateDismissInstallBlockedDialog() {
        BySelector selector = getPopUpImageSelector();
        mDevice.wait(Until.hasObject(selector), AUTOMATOR_WAIT_TIMEOUT);
        UiObject2 icon = mDevice.findObject(selector);
        assertNotNull(""Policy transparency dialog icon not found: "" + selector, icon);
        // ""OK"" button only present in the dialog if it is blocked by policy.
        UiObject2 button = mDevice.findObject(getPopUpButtonSelector());
        assertNotNull(""OK button not found"", button);
        button.click();
    }

    private String getSettingsPackageName() {
        String settingsPackageName = mIsAutomotive
                ? ""com.android.car.settings""
                : ""com.android.settings"";
        mUiAutomation.adoptShellPermissionIdentity(""android.permission.INTERACT_ACROSS_USERS"");
        try {
            ResolveInfo resolveInfo = mPackageManager.resolveActivityAsUser(
                    new Intent(Settings.ACTION_SETTINGS), PackageManager.MATCH_SYSTEM_ONLY,
                    UserHandle.USER_SYSTEM);
            if (resolveInfo != null && resolveInfo.activityInfo != null) {
                settingsPackageName = resolveInfo.activityInfo.packageName;
            }
        } finally {
            mUiAutomation.dropShellPermissionIdentity();
        }
        Log.d(TAG, ""getSettingsPackageName(): returning "" + settingsPackageName);
        return settingsPackageName;
    }

    private BySelector getPopUpButtonSelector() {
        return By.clazz(android.widget.Button.class.getName())
                .res(""android:id/button1"")
                .pkg(getSettingsPackageName());
    }

    private BySelector getPopUpImageSelector() {
        final String settingsPackageName = getSettingsPackageName();
        final String resId = mIsAutomotive ? ""car_ui_alert_icon"" : ""admin_support_icon"";
        return By.clazz(android.widget.ImageView.class.getName())
                .res(settingsPackageName + "":id/"" + resId)
                .pkg(settingsPackageName);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/PackageInstaller/src/com/android/cts/packageinstaller/ManualPackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.packageinstaller.SilentPackageInstallTest"	"testSilentInstallUninstall"	""	"1: app"	"public void testSilentInstallUninstall() throws Exception {
        // install the app
        assertInstallPackage();

        // uninstall the app again
        assertTrue(tryUninstallPackage());
        assertFalse(isPackageInstalled(TEST_APP_PKG));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/PackageInstaller/src/com/android/cts/packageinstaller/SilentPackageInstallTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferDeviceOwnerIncomingTest"	"testTransferPoliciesAreRetainedAfterTransfer"	""	"2: camera app"	"public void testTransferPoliciesAreRetainedAfterTransfer() {
        assertTrue(mDevicePolicyManager.isAdminActive(mIncomingComponentName));
        assertTrue(mDevicePolicyManager.isDeviceOwnerApp(mIncomingComponentName.getPackageName()));
        assertTrue(mDevicePolicyManager.getCameraDisabled(mIncomingComponentName));
        assertEquals(Collections.singletonList(""test.package""),
                mDevicePolicyManager.getKeepUninstalledPackages(mIncomingComponentName));
        assertEquals(
                DevicePolicyManager.PASSWORD_QUALITY_NUMERIC,
                mDevicePolicyManager.getPasswordQuality(mIncomingComponentName));
        assertEquals(123, mDevicePolicyManager.getPasswordMinimumLength(mIncomingComponentName));
        assertSystemPoliciesEqual(SystemUpdatePolicy.createPostponeInstallPolicy(),
                mDevicePolicyManager.getSystemUpdatePolicy());
        assertThrows(SecurityException.class, () -> {
            mDevicePolicyManager.getParentProfileInstance(mIncomingComponentName);
        });
    }

    private void assertSystemPoliciesEqual(SystemUpdatePolicy policy1, SystemUpdatePolicy policy2) {
        assertTrue(policy1.getPolicyType() == policy2.getPolicyType()
                && policy1.getInstallWindowStart() == policy2.getInstallWindowStart()
                && policy1.getInstallWindowEnd() == policy2.getInstallWindowEnd());
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerIncomingApp/src/com/android/cts/transferowner/TransferDeviceOwnerIncomingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.TransferProfileOwnerIncomingTest"	"testTransferPoliciesAreRetainedAfterTransfer"	""	"2: camera app"	"public void testTransferPoliciesAreRetainedAfterTransfer() {
        int passwordLength = 123;
        int passwordExpirationTimeout = 456;
        assertTrue(mDevicePolicyManager.isAdminActive(mIncomingComponentName));
        assertTrue(mDevicePolicyManager.isProfileOwnerApp(mIncomingComponentName.getPackageName()));
        assertTrue(mDevicePolicyManager.getCameraDisabled(mIncomingComponentName));
        assertTrue(mDevicePolicyManager.getCrossProfileCallerIdDisabled(mIncomingComponentName));
        assertEquals(
                DevicePolicyManager.PASSWORD_QUALITY_NUMERIC,
                mDevicePolicyManager.getPasswordQuality(mIncomingComponentName));
        assertEquals(
                passwordLength,
                mDevicePolicyManager.getPasswordMinimumLength(mIncomingComponentName));


        DevicePolicyManager targetParentProfileInstance =
                mDevicePolicyManager.getParentProfileInstance(mIncomingComponentName);
        if (mHasSecureLockScreen) {
            assertEquals(
                    passwordExpirationTimeout,
                    targetParentProfileInstance.getPasswordExpirationTimeout(mIncomingComponentName));
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerIncomingApp/src/com/android/cts/transferowner/TransferProfileOwnerIncomingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferIncomingTest"	"testTransferCompleteCallbackIsCalled"	""	"1: called"	"public void testTransferCompleteCallbackIsCalled() {
        assertTrue(getBooleanPref(mContext, KEY_TRANSFER_COMPLETED_CALLED));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerIncomingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferIncomingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.transferowner.DeviceAndProfileOwnerTransferIncomingTest"	"testTransferOwnershipEmptyBundleLoaded"	""	"1: app"	"public void testTransferOwnershipEmptyBundleLoaded() throws Throwable {
        PersistableBundle bundle = mDevicePolicyManager.getTransferOwnershipBundle();
        assertNotNull(bundle);
        assertTrue(bundle.isEmpty());
    }

    private static SharedPreferences getPrefs(Context context) {
        return context.getSharedPreferences(SHARED_PREFERENCE_NAME, Context.MODE_PRIVATE);
    }

    private static void putBooleanPref(Context context, String key, boolean value) {
        getPrefs(context).edit().putBoolean(key, value).apply();
    }

    protected static boolean getBooleanPref(Context context, String key) {
        return getPrefs(context).getBoolean(key, false);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/TransferOwnerIncomingApp/src/com/android/cts/transferowner/DeviceAndProfileOwnerTransferIncomingTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AlwaysOnVpnTest"	"testAllowedApps"	""	"3: app(s) apps app"	"public void testAllowedApps() throws Exception {
        final Bundle restrictions = new Bundle();
        restrictions.putStringArray(RESTRICTION_ALLOWED, new String[] {mPackageName});
        mDevicePolicyManager.setApplicationRestrictions(ADMIN_RECEIVER_COMPONENT, VPN_PACKAGE,
                restrictions);
        VpnTestHelper.waitForVpn(mContext, VPN_PACKAGE,
                /* usable */ true,  /* lockdown */ true, /* allowlist */ false);
        assertTrue(VpnTestHelper.isNetworkVpn(mContext));
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AlwaysOnVpnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AlwaysOnVpnTest"	"testDisallowedApps"	""	"3: app(s) apps app"	"public void testDisallowedApps() throws Exception {
        final Bundle restrictions = new Bundle();
        restrictions.putStringArray(RESTRICTION_DISALLOWED, new String[] {mPackageName});
        mDevicePolicyManager.setApplicationRestrictions(ADMIN_RECEIVER_COMPONENT, VPN_PACKAGE,
                restrictions);
        VpnTestHelper.waitForVpn(mContext, VPN_PACKAGE,
                /* usable */ false,  /* lockdown */ true, /* allowlist */ false);
        assertFalse(VpnTestHelper.isNetworkVpn(mContext));
    }

    // Tests that changes to lockdown allowlist are applied correctly."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AlwaysOnVpnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AlwaysOnVpnTest"	"testVpnLockdownUpdateAllowlist"	""	"2: UI app"	"public void testVpnLockdownUpdateAllowlist() throws Exception {
        waitForConnectivity(""VPN is off"");

        // VPN won't start.
        final Bundle restrictions = new Bundle();
        restrictions.putBoolean(RESTRICTION_DONT_ESTABLISH, true);
        mDevicePolicyManager.setApplicationRestrictions(
                ADMIN_RECEIVER_COMPONENT, VPN_PACKAGE, restrictions);

        // VPN service is started asynchronously, we need to wait for it to avoid stale service
        // instance interfering with the next test.
        final BlockingBroadcastReceiver receiver = VpnTestHelper.registerOnStartReceiver(mContext);

        VpnTestHelper.setAlwaysOnVpn(
                mContext, VPN_PACKAGE, /* lockdown */ false, /* allowlist */ false);
        assertConnectivity(true, ""VPN service not started, no lockdown"");
        assertNotNull(receiver.awaitForBroadcast(VPN_ON_START_TIMEOUT_MS));

        VpnTestHelper.setAlwaysOnVpn(
                mContext, VPN_PACKAGE, /* lockdown */ true, /* allowlist */ false);
        // Wait for loss of connectivity instead of assertConnectivity(false)
        // to mitigate flakiness due to asynchronicity.
        waitForNoConnectivity(""VPN in lockdown, service not started"");
        assertNotNull(receiver.awaitForBroadcast(VPN_ON_START_TIMEOUT_MS));

        VpnTestHelper.setAlwaysOnVpn(
                mContext, VPN_PACKAGE, /* lockdown */ true, /* allowlist */ true);
        assertConnectivity(true, ""VPN in lockdown, service not started, app allowlisted"");
        assertNotNull(receiver.awaitForBroadcast(VPN_ON_START_TIMEOUT_MS));

        VpnTestHelper.setAlwaysOnVpn(
                mContext, VPN_PACKAGE, /* lockdown */ true, /* allowlist */ false);
        // Wait for loss of connectivity instead of assertConnectivity(false)
        // to mitigate flakiness due to asynchronicity.
        waitForNoConnectivity(""VPN in lockdown, service not started"");
        assertNotNull(receiver.awaitForBroadcast(VPN_ON_START_TIMEOUT_MS));

        receiver.unregisterQuietly();
    }

    // Tests that when VPN comes up, allowlisted app switches over to it."	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AlwaysOnVpnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AlwaysOnVpnTest"	"testVpnLockdownAllowlistVpnComesUp"	""	"2: UI app"	"public void testVpnLockdownAllowlistVpnComesUp() throws Exception {
        waitForConnectivity(""VPN is off"");

        // VPN won't start initially.
        final Bundle restrictions = new Bundle();
        restrictions.putBoolean(RESTRICTION_DONT_ESTABLISH, true);
        mDevicePolicyManager.setApplicationRestrictions(
                ADMIN_RECEIVER_COMPONENT, VPN_PACKAGE, restrictions);

        // VPN service is started asynchronously, we need to wait for it to avoid stale service
        // instance interfering with the next test.
        final BlockingBroadcastReceiver receiver = VpnTestHelper.registerOnStartReceiver(mContext);

        VpnTestHelper.setAlwaysOnVpn(
                mContext, VPN_PACKAGE,  /* lockdown */ true, /* allowlist */ true);
        assertConnectivity(true, ""VPN in lockdown, service not started, app allowlisted"");
        assertNotNull(receiver.awaitForBroadcast(VPN_ON_START_TIMEOUT_MS));

        // Make VPN workable again and restart.
        mDevicePolicyManager.setApplicationRestrictions(
                ADMIN_RECEIVER_COMPONENT, VPN_PACKAGE, null);
        VpnTestHelper.waitForVpn(mContext, VPN_PACKAGE,
                /* usable */ true,  /* lockdown */ true, /* allowlist */ true);

        // Now we should be on VPN.
        VpnTestHelper.checkPing(TEST_ADDRESS);

        receiver.unregisterQuietly();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AlwaysOnVpnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AlwaysOnVpnTest"	"testSetNonVpnAlwaysOn"	""	"1: app"	"public void testSetNonVpnAlwaysOn() throws Exception {
        // Treat this CTS DPC as an non-vpn app, since it doesn't register
        // android.net.VpnService intent filter in AndroidManifest.xml.
        try {
            mDevicePolicyManager.setAlwaysOnVpnPackage(
                    ADMIN_RECEIVER_COMPONENT, mPackageName, true);
            fail(""setAlwaysOnVpnPackage should not accept non-vpn package"");
        } catch (UnsupportedOperationException e) {
            // success
        }
        assertNull(mDevicePolicyManager.getAlwaysOnVpnPackage(ADMIN_RECEIVER_COMPONENT));
    }

    private void waitForConnectivity(String message) throws InterruptedException {
        long deadline = System.nanoTime() + CONNECTIVITY_WAIT_TIME_NS;
        while (System.nanoTime() < deadline) {
            try {
                new Socket(CONNECTIVITY_CHECK_HOST, 80);
                // Domain resolved, we have connectivity.
                return;
            } catch (IOException e) {
                // Log.e(String, String, Throwable) will swallow UnknownHostException,
                // so manually print it out here.
                Log.e(TAG, ""No connectivity yet: "" + e.toString());
                Thread.sleep(2000);
            }
        }
        fail(""Connectivity isn't available: "" + message);
    }

    private void waitForNoConnectivity(String message) throws Exception {
        long deadline = System.nanoTime() + CONNECTIVITY_WAIT_TIME_NS;
        while (System.nanoTime() < deadline) {
            try {
                new Socket(CONNECTIVITY_CHECK_HOST, 80);
                // Domain resolved, we have connectivity.
            } catch (IOException e) {
                // No connectivity
                return;
            }
            Thread.sleep(2000);
        }
        fail(""Connectivity still available after deadline: "" + message);
    }

    private void assertConnectivity(boolean shouldHaveConnectivity, String message) {
        try {
            new Socket(CONNECTIVITY_CHECK_HOST, 80);
            if (!shouldHaveConnectivity) {
                fail(""Connectivity available while not expected: "" + message);
            }
        } catch (IOException e) {
            if (shouldHaveConnectivity) {
                Log.e(TAG, ""Connectivity check failed"", e);
                fail(""Connectivity isn't available while expected: "" + message);
            }
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AlwaysOnVpnTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.DelegatedCertInstallerTest"	"testCanReadEnrollmentSpecificId"	""	"3: data UI only"	"public void testCanReadEnrollmentSpecificId() throws InterruptedException {
        // Set the organization ID only if not already set, to avoid potential conflict
        // with other tests.
        if (mDpm.getEnrollmentSpecificId().isEmpty()) {
            mDpm.setOrganizationId(""SOME_ID"");
        }
        mDpm.setDelegatedScopes(ADMIN_RECEIVER_COMPONENT, CERT_INSTALLER_PACKAGE,
                CERT_INSTALL_SCOPES);

        readEnrollmentId();
        assertResult(""testCanReadEnrollmentSpecificId"", true);
    }

    private void installCaCert(byte[] cert) {
        Intent intent = new Intent();
        intent.setAction(ACTION_INSTALL_CERT);
        intent.setComponent(CERT_INSTALLER_COMPONENT);
        intent.putExtra(EXTRA_CERT_DATA, cert);
        intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        mContext.sendBroadcast(intent);
    }

    private void removeCaCert(byte[] cert) {
        Intent intent = new Intent();
        intent.setAction(ACTION_REMOVE_CERT);
        intent.setComponent(CERT_INSTALLER_COMPONENT);
        intent.putExtra(EXTRA_CERT_DATA, cert);
        intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        mContext.sendBroadcast(intent);
    }

    private void verifyCaCert(byte[] cert) {
        Intent intent = new Intent();
        intent.setAction(ACTION_VERIFY_CERT);
        intent.setComponent(CERT_INSTALLER_COMPONENT);
        intent.putExtra(EXTRA_CERT_DATA, cert);
        intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        mContext.sendBroadcast(intent);
    }

    private void verifyOwnerInstalledStatus(String alias, boolean expectOwnerInstalled) {
        final List<String> ownerInstalledCerts =
                mDpm.getOwnerInstalledCaCerts(Process.myUserHandle());
        assertNotNull(ownerInstalledCerts);
        assertEquals(expectOwnerInstalled, ownerInstalledCerts.contains(alias));
    }

    private void assertResult(String testName, Boolean expectSuccess) throws InterruptedException {
        assertTrue(""Cert installer did not respond in time."",
                mAvailableResultSemaphore.tryAcquire(180, TimeUnit.SECONDS));
        synchronized (this) {
            if (expectSuccess) {
                assertTrue(testName + "" failed unexpectedly."", mReceivedResult);
                assertNull(testName + "" raised exception"", mReceivedException);
            } else {
                assertFalse(testName + "" succeeded unexpectedly."", mReceivedResult);
                assertTrue(testName + "" did not raise SecurityException"",
                        mReceivedException != null &&
                        mReceivedException instanceof SecurityException);
            }
        }
    }

    private void installKeyPair(String key, String cert, String alias) {
        Intent intent = new Intent();
        intent.setAction(ACTION_INSTALL_KEYPAIR);
        intent.setComponent(CERT_INSTALLER_COMPONENT);
        intent.putExtra(EXTRA_CERT_DATA, cert);
        intent.putExtra(EXTRA_KEY_DATA, key);
        intent.putExtra(EXTRA_KEY_ALIAS, alias);
        intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        mContext.sendBroadcast(intent);
    }

    private void readEnrollmentId() {
        Intent intent = new Intent();
        intent.setAction(ACTION_READ_ENROLLMENT_SPECIFIC_ID);
        intent.setComponent(CERT_INSTALLER_COMPONENT);
        intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        mContext.sendBroadcast(intent);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/DelegatedCertInstallerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.DelegatedCertInstallerTest"	"testSetNotExistCertInstallerPackage"	""	"1: UI"	"public void testSetNotExistCertInstallerPackage() throws Exception {
        boolean shouldThrowException = getTargetApiLevel() >= Build.VERSION_CODES.N;
        try {
            mDpm.setCertInstallerPackage(
                    ADMIN_RECEIVER_COMPONENT, NOT_EXIST_CERT_INSTALLER_PACKAGE);
            if (shouldThrowException) {
                fail(""Did not throw IllegalArgumentException"");
            }
        } catch (IllegalArgumentException ex) {
            if (!shouldThrowException) {
                fail(""Should not throw exception"");
            }
            MoreAsserts.assertContainsRegex(""is not installed on the current user"",
                        ex.getMessage());
        }
        if (!shouldThrowException) {
            assertTrue(""Cert install delegate was not set on uninstalled package"",
                    NOT_EXIST_CERT_INSTALLER_PACKAGE.equals(
                            mDpm.getCertInstallerPackage(ADMIN_RECEIVER_COMPONENT)));
        }
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/DelegatedCertInstallerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.DelegatedCertInstallerTest"	"testInstallKeyPair"	""	"1: app"	"public void testInstallKeyPair() throws InterruptedException, KeyChainException {
        final String alias = ""delegated-cert-installer-test-key"";

        // Clear delegated cert installer.
        mDpm.setCertInstallerPackage(ADMIN_RECEIVER_COMPONENT, null);
        // The app is not the cert installer , it shouldn't have have privilege to call
        // installKeyPair().
        installKeyPair(TestCertificates.TEST_KEY, TestCertificates.TEST_CERT, alias);
        assertResult(""installKeyPair"", false);

        // Set the app to be cert installer.
        mDpm.setCertInstallerPackage(ADMIN_RECEIVER_COMPONENT, CERT_INSTALLER_PACKAGE);
        assertEquals(CERT_INSTALLER_PACKAGE,
                mDpm.getCertInstallerPackage(ADMIN_RECEIVER_COMPONENT));

        // Exercise installKeyPair()
        installKeyPair(TestCertificates.TEST_KEY, TestCertificates.TEST_CERT, alias);
        assertResult(""installKeyPair"", true);
    }

    /**
     * If DPC is targeting N+, @{link IllegalArgumentException } should be thrown if the package
     * is missing.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/DelegatedCertInstallerTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.AssistScreenCaptureDisabledTest"	"testScreenCapturePossible_assist"	""	"1: UI"	"public void testScreenCapturePossible_assist() throws Exception {
        assertScreenCapturePossible(true);
    }

    private void assertScreenCapturePossible(boolean possible) throws InterruptedException {
        // Wait until voice interaction service is ready by sending broadcast to ask for status.
        Intent checkIsReadyIntent = new Intent(ACTION_CHECK_IS_READY);
        checkIsReadyIntent.setFlags(Intent.FLAG_RECEIVER_FOREGROUND);
        checkIsReadyIntent.setPackage(ASSIST_PACKAGE);
        boolean isAssistReady = false;
        for (int i = 0; i < MAX_ATTEMPTS_COUNT && !isAssistReady; i++) {
            Log.d(TAG, ""assertScreenCapturePossible: wait for assist service ready, attempt "" + i);
            final LinkedBlockingQueue<Boolean> q = new LinkedBlockingQueue<>();
            mContext.sendOrderedBroadcast(checkIsReadyIntent, null, new BroadcastReceiver() {
                @Override
                public void onReceive(Context context, Intent intent) {
                    q.offer(getResultCode() == Activity.RESULT_OK);
                }
            }, null, Activity.RESULT_CANCELED, null, null);
            Boolean result = q.poll(WAIT_IN_SECOND, TimeUnit.SECONDS);
            isAssistReady = result != null && result;
        }
        Assert.assertTrue(isAssistReady);

        // Send broadcast to voice interaction service and ask for screnshot.
        BlockingBroadcastReceiver receiver = new BlockingBroadcastReceiver(
                mContext, ACTION_HANDLE_SCREENSHOT);
        try {
            receiver.register();
            Intent showSessionIntent = new Intent(ACTION_SHOW_SESSION);
            showSessionIntent.setPackage(ASSIST_PACKAGE);
            mContext.sendBroadcast(showSessionIntent);
            Intent screenShotIntent = null;
            for (int i = 0; i < MAX_ATTEMPTS_COUNT && (screenShotIntent == null); ++ i) {
                Log.d(TAG, ""has not received intent yet: wait for intent, attempt "" + i);
                screenShotIntent = receiver.awaitForBroadcast();
            }
            Assert.assertNotNull(screenShotIntent);
            Assert.assertTrue(screenShotIntent.hasExtra(KEY_HAS_SCREENSHOT));
            assertEquals(possible, screenShotIntent.getBooleanExtra(KEY_HAS_SCREENSHOT, false));
        } finally {
            receiver.unregisterQuietly();
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/AssistScreenCaptureDisabledTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ApplicationHiddenParentTest"	"isNotNull"	""	"1: app"	"public void test/*
 *.
 */

package com.android.cts.deviceandprofileowner;

import static com.google.common.truth.Truth.assertThat;

import static org.testng.Assert.assertThrows;

import android.app.admin.DevicePolicyManager;
import android.content.pm.PackageManager;

public class ApplicationHiddenParentTest extends BaseDeviceAdminTest {

    private DevicePolicyManager mParentDevicePolicyManager;
    private PackageManager mPackageManager;

    private static final String SYSTEM_PACKAGE_TO_HIDE = ""com.android.keychain"";
    private static final String NON_SYSTEM_NON_INSTALLED_PACKAGE = ""com.android.cts.permissionapp"";
    private static final String NON_SYSTEM_INSTALLED_PACKAGE =
            ""com.android.cts.deviceandprofileowner"";

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        mParentDevicePolicyManager =
                mDevicePolicyManager.getParentProfileInstance(ADMIN_RECEIVER_COMPONENT);
        mPackageManager = mContext.getPackageManager();
        assertThat(mParentDevicePolicyManager).isNotNull();

        assertThat(mDevicePolicyManager.isProfileOwnerApp(ADMIN_RECEIVER_COMPONENT.getPackageName())).isTrue();
        assertThat(mDevicePolicyManager.isOrganizationOwnedDeviceWithManagedProfile()).isTrue();
    }

    @Override
    protected void tearDown() throws Exception {
        mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                SYSTEM_PACKAGE_TO_HIDE, false);
        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ApplicationHiddenParentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ApplicationHiddenParentTest"	"testSetApplicationHidden_systemPackage"	""	"1: app"	"public void testSetApplicationHidden_systemPackage()
            throws PackageManager.NameNotFoundException {
        assertThat(mPackageManager.getPackageInfo(SYSTEM_PACKAGE_TO_HIDE, 0)).isNotNull();

        assertThat(mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                SYSTEM_PACKAGE_TO_HIDE, true)).isTrue();
        assertThat(mParentDevicePolicyManager.isApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                SYSTEM_PACKAGE_TO_HIDE)).isTrue();
        assertThat(mPackageManager.getPackageInfo(SYSTEM_PACKAGE_TO_HIDE,
                PackageManager.MATCH_UNINSTALLED_PACKAGES)).isNotNull();

        assertThat(mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                SYSTEM_PACKAGE_TO_HIDE, false)).isTrue();
        assertThat(mParentDevicePolicyManager.isApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                SYSTEM_PACKAGE_TO_HIDE)).isFalse();
        assertThat(mPackageManager.getPackageInfo(SYSTEM_PACKAGE_TO_HIDE, 0)).isNotNull();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ApplicationHiddenParentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ApplicationHiddenParentTest"	"testSetApplicationHidden_nonSystemPackage"	""	"1: app"	"public void testSetApplicationHidden_nonSystemPackage() {
        assertThrows(IllegalArgumentException.class, () -> {
            mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_NON_INSTALLED_PACKAGE, true);
            mParentDevicePolicyManager.isApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_NON_INSTALLED_PACKAGE);
        });
        assertThrows(IllegalArgumentException.class, () -> {
            mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_NON_INSTALLED_PACKAGE, false);
            mParentDevicePolicyManager.isApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_NON_INSTALLED_PACKAGE);
        });
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ApplicationHiddenParentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ApplicationHiddenParentTest"	"testSetApplicationHidden_nonSystemPackageStackTrace"	""	"1: app"	"public void testSetApplicationHidden_nonSystemPackageStackTrace() {
        StackTraceElement[] stackTrace1 = new StackTraceElement[0];
        StackTraceElement[] stackTrace2 = new StackTraceElement[0];
        String message1 = """";
        String message2 = """";

        // Scenario 1: Non-system non-installed package
        try {
            mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_NON_INSTALLED_PACKAGE, true);
        } catch (IllegalArgumentException e) {
            stackTrace1 = e.getStackTrace();
            message1 = e.getMessage();
        }

        // Scenario 2: Non-system installed package
        try {
            mParentDevicePolicyManager.setApplicationHidden(ADMIN_RECEIVER_COMPONENT,
                    NON_SYSTEM_INSTALLED_PACKAGE, true);
        } catch (IllegalArgumentException e) {
            stackTrace2 = e.getStackTrace();
            message2 = e.getMessage();
        }

        // Ensure the messages and stack traces of both scenarios are equal
        assertThat(message1).isEqualTo(message2);
        assertThat(stackTrace1.length).isEqualTo(stackTrace2.length);
        for (int i = 0; i < stackTrace1.length; i++) {
            if (stackTrace1[i].getClassName().equals(this.getClass().getName())) {
                continue;
            }
            assertThat(stackTrace1[i].toString()).isEqualTo(stackTrace2[i].toString());
        }
    }

}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ApplicationHiddenParentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.DevicePolicyLoggingParentTest"	"testCameraDisabledLogged"	""	"1: camera"	"public void testCameraDisabledLogged() {
        mParentDevicePolicyManager.setCameraDisabled(ADMIN_RECEIVER_COMPONENT, true);
        mParentDevicePolicyManager.setCameraDisabled(ADMIN_RECEIVER_COMPONENT, false);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/DevicePolicyLoggingParentTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.WifiTest"	"emptyList"	""	"1: UI"	"public void test/*
 *.
 */
package com.android.cts.deviceandprofileowner;

import static com.android.cts.devicepolicy.TestCertificates.getCaCert;
import static com.android.cts.devicepolicy.TestCertificates.getTestKey;
import static com.android.cts.devicepolicy.TestCertificates.getUserCert;

import static org.junit.Assert.assertNotEquals;

import android.content.ComponentName;
import android.content.pm.PackageManager;
import android.net.wifi.WifiConfiguration;
import android.net.wifi.WifiEnterpriseConfig;
import android.net.wifi.WifiManager;
import android.net.wifi.WifiNetworkSuggestion;
import android.text.TextUtils;

import java.security.cert.Certificate;
import java.security.cert.X509Certificate;
import java.util.Collections;

/**
 * Tests that require the WiFi feature.
 */
public class WifiTest extends BaseDeviceAdminTest {
    /** Mac address returned when the caller doesn't have access. */
    private static final String DEFAULT_MAC_ADDRESS = ""02:00:00:00:00:00"";

    public static final ComponentName ADMIN = new ComponentName(
            BasicAdminReceiver.class.getPackage().getName(),
            BasicAdminReceiver.class.getName());

    private static final String TEST_ALIAS = ""test_alias"";
    private static final String TEST_SSID = ""\""SomeNet\"""";

    private WifiManager mWm;
    private int mNetId = -1;

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        mWm = mContext.getSystemService(WifiManager.class);
    }

    @Override
    protected void tearDown() throws Exception {
        if (mNetId != -1) {
            mWm.removeNetwork(mNetId);
        }
        // Remove all suggestions if any were added.
        mWm.removeNetworkSuggestions(Collections.emptyList());
        mDevicePolicyManager.removeKeyPair(ADMIN, TEST_ALIAS);

        super.tearDown();
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/WifiTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.WifiTest"	"testAddNetworkSuggestionWithKeychainKey_notGranted"	""	"1: UI"	"public void testAddNetworkSuggestionWithKeychainKey_notGranted() throws Exception {
        prepareTestKeyPair(/* allowForWifi= */ false);
        final WifiNetworkSuggestion suggestion = makeWifiNetworkSuggestion();

        assertEquals(WifiManager.STATUS_NETWORK_SUGGESTIONS_ERROR_ADD_INVALID,
                mWm.addNetworkSuggestions(Collections.singletonList(suggestion)));
    }

    private WifiEnterpriseConfig makeWifiEnterpriseConfig() throws Exception {
        WifiEnterpriseConfig enterpriseConfig = new WifiEnterpriseConfig();
        enterpriseConfig.setEapMethod(WifiEnterpriseConfig.Eap.TLS);
        enterpriseConfig.setDomainSuffixMatch(""some-domain.com"");
        enterpriseConfig.setIdentity(""user"");
        enterpriseConfig.setCaCertificate((X509Certificate) getCaCert());
        enterpriseConfig.setClientKeyPairAlias(TEST_ALIAS);
        return enterpriseConfig;
    }

    private WifiNetworkSuggestion makeWifiNetworkSuggestion() throws Exception {
        return new WifiNetworkSuggestion.Builder()
                .setSsid(TEST_SSID)
                .setWpa2EnterpriseConfig(makeWifiEnterpriseConfig())
                .build();
    }

    private void prepareTestKeyPair(boolean allowForWifi) throws Exception {
        assertTrue(mDevicePolicyManager.installKeyPair(ADMIN, getTestKey(),
                new Certificate[]{getUserCert()}, TEST_ALIAS,
                /* requestAccess= */ false));
        if (allowForWifi) {
            assertTrue(mDevicePolicyManager.grantKeyPairToWifiAuth(TEST_ALIAS));
        }
    }

    private WifiConfiguration makeTestWifiConfig() throws Exception {
        WifiConfiguration config = new WifiConfiguration();
        config.SSID = TEST_SSID;
        config.allowedKeyManagement.set(WifiConfiguration.KeyMgmt.WPA_EAP);
        config.enterpriseConfig = makeWifiEnterpriseConfig();
        return config;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/WifiTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordMetricAfterResetPassword"	""	"2: UI app"	"public void testPasswordMetricAfterResetPassword() {
        if (!mShouldRun) {
            return;
        }
        mDevicePolicyManager.setPasswordQuality(ADMIN_RECEIVER_COMPONENT,
                PASSWORD_QUALITY_COMPLEX);
        mDevicePolicyManager.setPasswordMinimumNumeric(ADMIN_RECEIVER_COMPONENT, 1);
        mDevicePolicyManager.setPasswordMinimumLetters(ADMIN_RECEIVER_COMPONENT, 1);
        mDevicePolicyManager.setPasswordMinimumSymbols(ADMIN_RECEIVER_COMPONENT, 0);
        assertTrue(mDevicePolicyManager.resetPasswordWithToken(ADMIN_RECEIVER_COMPONENT,
                COMPLEX_PASSWORD, TOKEN0, 0));

        // Change required complexity and verify new password satisfies it
        // First set a slightly stronger requirement and expect password sufficiency is false
        mDevicePolicyManager.setPasswordMinimumNumeric(ADMIN_RECEIVER_COMPONENT, 3);
        mDevicePolicyManager.setPasswordMinimumLetters(ADMIN_RECEIVER_COMPONENT, 3);
        mDevicePolicyManager.setPasswordMinimumSymbols(ADMIN_RECEIVER_COMPONENT, 2);
        assertPasswordSufficiency(false);
        // Then sets the appropriate quality and verify it should pass
        mDevicePolicyManager.setPasswordMinimumSymbols(ADMIN_RECEIVER_COMPONENT, 1);
        assertPasswordSufficiency(true);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordComplexity_settingComplexityClearsQuality"	""	"1: UI"	"public void testPasswordComplexity_settingComplexityClearsQuality() {
        if (!mShouldRun) {
            return;
        }

        mDevicePolicyManager.setPasswordQuality(ADMIN_RECEIVER_COMPONENT, PASSWORD_QUALITY_COMPLEX);
        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_MEDIUM);
        assertEquals(PASSWORD_QUALITY_UNSPECIFIED,
                mDevicePolicyManager.getPasswordQuality(ADMIN_RECEIVER_COMPONENT));
        assertEquals(PASSWORD_COMPLEXITY_MEDIUM,
                mDevicePolicyManager.getRequiredPasswordComplexity());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordComplexity_settingQualityResetsComplexity"	""	"1: UI"	"public void testPasswordComplexity_settingQualityResetsComplexity() {
        if (!mShouldRun) {
            return;
        }

        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_MEDIUM);
        mDevicePolicyManager.setPasswordQuality(ADMIN_RECEIVER_COMPONENT, PASSWORD_QUALITY_COMPLEX);
        assertEquals(PASSWORD_QUALITY_COMPLEX,
                mDevicePolicyManager.getPasswordQuality(ADMIN_RECEIVER_COMPONENT));
        assertEquals(PASSWORD_COMPLEXITY_NONE,
                mDevicePolicyManager.getRequiredPasswordComplexity());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordComplexity_Low"	""	"1: UI"	"public void testPasswordComplexity_Low() {
        if (!mShouldRun) {
            return;
        }

        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_LOW);
        assertEquals(PASSWORD_COMPLEXITY_LOW,
                mDevicePolicyManager.getRequiredPasswordComplexity());

        String caseDescription = ""low quality password"";
        assertPasswordSucceeds(""abcd"", caseDescription);
        assertPasswordFails(""123"", caseDescription);
        assertEquals(PASSWORD_COMPLEXITY_LOW, mDevicePolicyManager.getPasswordComplexity());
        assertPasswordSucceeds(""1a2b3c4d"", caseDescription);
        assertEquals(PASSWORD_COMPLEXITY_HIGH, mDevicePolicyManager.getPasswordComplexity());
        assertPasswordSucceeds(""162534"", caseDescription); // 6 digits.
        assertEquals(PASSWORD_COMPLEXITY_MEDIUM, mDevicePolicyManager.getPasswordComplexity());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordComplexity_Medium"	""	"1: UI"	"public void testPasswordComplexity_Medium() {
        if (!mShouldRun) {
            return;
        }

        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_MEDIUM);
        assertEquals(PASSWORD_QUALITY_UNSPECIFIED,
                mDevicePolicyManager.getPasswordQuality(ADMIN_RECEIVER_COMPONENT));
        assertEquals(PASSWORD_COMPLEXITY_MEDIUM,
                mDevicePolicyManager.getRequiredPasswordComplexity());

        String caseDescription = ""medium quality password"";
        assertPasswordSucceeds(""axtd"", caseDescription);
        assertPasswordSucceeds(""1axc"", caseDescription);
        assertPasswordSucceeds(""1363"", caseDescription);
        assertPasswordFails(""4444"", caseDescription);
        assertEquals(PASSWORD_COMPLEXITY_MEDIUM, mDevicePolicyManager.getPasswordComplexity());
        assertPasswordSucceeds(""1axc352ae63"", caseDescription);
        assertEquals(PASSWORD_COMPLEXITY_HIGH, mDevicePolicyManager.getPasswordComplexity());
        assertPasswordFails(""1234"", caseDescription); // repeating pattern
        assertEquals(PASSWORD_COMPLEXITY_HIGH, mDevicePolicyManager.getPasswordComplexity());
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testPasswordComplexity_High"	""	"2: UI only"	"public void testPasswordComplexity_High() {
        if (!mShouldRun) {
            return;
        }

        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_HIGH);
        assertEquals(PASSWORD_COMPLEXITY_HIGH,
                mDevicePolicyManager.getRequiredPasswordComplexity());

        String caseDescription = ""high quality password"";
        assertPasswordFails(""abcd"", caseDescription);
        assertPasswordFails(""123"", caseDescription);
        assertPasswordSucceeds(""1a2b3c4d5e"", caseDescription);
        assertEquals(PASSWORD_COMPLEXITY_HIGH, mDevicePolicyManager.getPasswordComplexity());
        assertPasswordFails(""162534"", caseDescription); // Only 6 digits.
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ResetPasswordWithTokenTest"	"testResetPasswordWithTokenLogging"	""	"1: UI"	"public void testResetPasswordWithTokenLogging() {
        if (!mShouldRun) {
            return;
        }

        try (EnterpriseMetricsRecorder metrics = EnterpriseMetricsRecorder.create()) {
            mDevicePolicyManager.resetPasswordWithToken(ADMIN_RECEIVER_COMPONENT,
                    SHORT_PASSWORD, TOKEN0, 0);

            assertNotNull(metrics.query()
                    .whereType().isEqualTo(EventId.RESET_PASSWORD_WITH_TOKEN_VALUE)
                    .whereAdminPackageName().isEqualTo(PACKAGE_NAME)
                    .poll());
        }
    }

    private boolean setUpResetPasswordToken(boolean acceptFailure) {
        // set up a token
        assertFalse(mDevicePolicyManager.isResetPasswordTokenActive(ADMIN_RECEIVER_COMPONENT));

        try {
            // On devices with password token disabled, calling this method will throw
            // a security exception. If that's anticipated, then return early without failing.
            assertTrue(mDevicePolicyManager.setResetPasswordToken(ADMIN_RECEIVER_COMPONENT,
                    TOKEN0));
        } catch (SecurityException e) {
            if (acceptFailure &&
                    e.getMessage().equals(""Escrow token is disabled on the current user"")) {
                return false;
            } else {
                throw e;
            }
        }
        assertTrue(mDevicePolicyManager.isResetPasswordTokenActive(ADMIN_RECEIVER_COMPONENT));
        return true;
    }

    private void cleanUpResetPasswordToken() {
        // First remove device lock
        mDevicePolicyManager.setPasswordQuality(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.PASSWORD_QUALITY_UNSPECIFIED);
        mDevicePolicyManager.setRequiredPasswordComplexity(PASSWORD_COMPLEXITY_NONE);
        assertTrue(mDevicePolicyManager.resetPasswordWithToken(ADMIN_RECEIVER_COMPONENT, null,
                TOKEN0, 0));

        // Then remove token and check it succeeds
        assertTrue(mDevicePolicyManager.clearResetPasswordToken(ADMIN_RECEIVER_COMPONENT));
        assertFalse(mDevicePolicyManager.isResetPasswordTokenActive(ADMIN_RECEIVER_COMPONENT));
        assertFalse(mDevicePolicyManager.resetPasswordWithToken(ADMIN_RECEIVER_COMPONENT,
                SHORT_PASSWORD, TOKEN0, 0));
    }

    private void assertPasswordFails(String password, String restriction) {
        try {
            boolean passwordResetResult = mDevicePolicyManager.resetPasswordWithToken(
                    ADMIN_RECEIVER_COMPONENT, password, TOKEN0, /* flags= */0);
            assertFalse(""Password '"" + password + ""' should have failed on "" + restriction,
                    passwordResetResult);
        } catch (IllegalArgumentException e) {
            // yesss, we have failed!
        }
    }

    private void assertPasswordSucceeds(String password, String restriction) {
        boolean passwordResetResult = mDevicePolicyManager.resetPasswordWithToken(
                ADMIN_RECEIVER_COMPONENT, password, TOKEN0, /* flags= */0);
        assertTrue(""Password '"" + password + ""' failed on "" + restriction, passwordResetResult);
        assertPasswordSufficiency(true);
    }

    private void resetComplexPasswordRestrictions() {
        final int quality = mDevicePolicyManager.getPasswordQuality(ADMIN_RECEIVER_COMPONENT);
        if (quality < PASSWORD_QUALITY_NUMERIC) {
            return;
        }
        mDevicePolicyManager.setPasswordMinimumLength(ADMIN_RECEIVER_COMPONENT, 0);
        if (quality < PASSWORD_QUALITY_COMPLEX) {
            return;
        }
        mDevicePolicyManager.setPasswordMinimumUpperCase(ADMIN_RECEIVER_COMPONENT, 0);
        mDevicePolicyManager.setPasswordMinimumLowerCase(ADMIN_RECEIVER_COMPONENT, 0);
        mDevicePolicyManager.setPasswordMinimumLetters(ADMIN_RECEIVER_COMPONENT, 0);
        mDevicePolicyManager.setPasswordMinimumNumeric(ADMIN_RECEIVER_COMPONENT, 0);
        mDevicePolicyManager.setPasswordMinimumSymbols(ADMIN_RECEIVER_COMPONENT, 0);
        mDevicePolicyManager.setPasswordMinimumNonLetter(ADMIN_RECEIVER_COMPONENT, 0);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ResetPasswordWithTokenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.UnavailableSecureLockScreenTest"	"testResetWithTokenAndPasswordSufficiency"	""	"1: UI"	"public void testResetWithTokenAndPasswordSufficiency() throws Exception {
        // The password is always empty on devices which don't support the secure lock screen
        // feature.

        // Initially, when no password quality requirements are set, the empty password is
        // sufficient.
        assertPasswordSufficiency(true);
        try {

            // Resetting password should fail - it is not possible to set a password reset token or
            // a password on a device without the secure lock screen feature.
            assertFalse(mDevicePolicyManager.setResetPasswordToken(ADMIN_RECEIVER_COMPONENT, TOKEN));
            assertFalse(mDevicePolicyManager.resetPasswordWithToken(ADMIN_RECEIVER_COMPONENT,
                    COMPLEX_PASSWORD, TOKEN, 0));

            // As soon as some requirement for minimal password quality is set...
            mDevicePolicyManager.setPasswordQuality(
                    ADMIN_RECEIVER_COMPONENT, DevicePolicyManager.PASSWORD_QUALITY_SOMETHING);

            // ... the password is not sufficient any more.
            assertPasswordSufficiency(false);

            // If the requirement for minimal password quality is removed later...
            mDevicePolicyManager.setPasswordQuality(
                    ADMIN_RECEIVER_COMPONENT, DevicePolicyManager.PASSWORD_QUALITY_UNSPECIFIED);

            // The empty password is sufficient again.
            assertPasswordSufficiency(true);
        } finally {
            mDevicePolicyManager.clearResetPasswordToken(ADMIN_RECEIVER_COMPONENT);
            mDevicePolicyManager.setPasswordQuality(
                    ADMIN_RECEIVER_COMPONENT, DevicePolicyManager.PASSWORD_QUALITY_UNSPECIFIED);
        }
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/UnavailableSecureLockScreenTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.CustomizationRestrictionsTest"	"testDisallowSetWallpaper_allowed"	""	"1: app"	"public void testDisallowSetWallpaper_allowed() throws Exception {
        final WallpaperManager wallpaperManager = WallpaperManager.getInstance(mContext);
        final Bitmap originalWallpaper = BitmapUtils.getWallpaperBitmap(mContext);
        final Bitmap originalWallpaperCopy =
                originalWallpaper.copy(originalWallpaper.getConfig(), false);

        try (
                // Set restriction and subscribe for the broadcast.
                final RestrictionApplicator restr =
                        new RestrictionApplicator(UserManager.DISALLOW_SET_WALLPAPER);
                final BroadcastReceiverRegistrator bcast =
                        new BroadcastReceiverRegistrator(Intent.ACTION_WALLPAPER_CHANGED);
        ) {
            assertTrue(mUserManager.hasUserRestriction(UserManager.DISALLOW_SET_WALLPAPER));

            // Checking setBitmap() method.
            Bitmap oldWallpaper = originalWallpaperCopy;
            wallpaperManager.setBitmap(BitmapUtils.generateRandomBitmap(97, 73));
            bcast.waitForBroadcast();
            Bitmap newWallpaper = BitmapUtils.getWallpaperBitmap(mContext);
            assertFalse(BitmapUtils.compareBitmaps(newWallpaper, oldWallpaper));

            // Checking setStream() method.
            oldWallpaper = newWallpaper;
            final Bitmap wallpaperForStream = BitmapUtils.generateRandomBitmap(83, 69);
            wallpaperManager.setStream(BitmapUtils.bitmapToInputStream(wallpaperForStream));
            bcast.waitForBroadcast();
            newWallpaper = BitmapUtils.getWallpaperBitmap(mContext);
            assertFalse(BitmapUtils.compareBitmaps(newWallpaper, oldWallpaper));

            // Checking setResource() method.
            oldWallpaper = newWallpaper;
            wallpaperManager.setResource(R.raw.wallpaper);
            bcast.waitForBroadcast();
            newWallpaper = BitmapUtils.getWallpaperBitmap(mContext);
            assertFalse(BitmapUtils.compareBitmaps(newWallpaper, oldWallpaper));
        } finally {
            wallpaperManager.setBitmap(originalWallpaperCopy);
        }
        assertFalse(mUserManager.hasUserRestriction(UserManager.DISALLOW_SET_WALLPAPER));
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/CustomizationRestrictionsTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.EnrollmentSpecificIdTest"	"testCorrectCalculationOfEsid"	""	"5: data UI section identifier app"	"public void testCorrectCalculationOfEsid() {
        mUiAutomation.adoptShellPermissionIdentity(PERMISSIONS_TO_ADOPT);
        mDevicePolicyManager.setOrganizationId(ORGANIZATION_ID);
        final String esidFromDpm = mDevicePolicyManager.getEnrollmentSpecificId();
        final String calculatedEsid = calculateEsid(ADMIN_RECEIVER_COMPONENT.getPackageName(),
                ORGANIZATION_ID);
        assertThat(esidFromDpm).isEqualTo(calculatedEsid);
    }

    private String calculateEsid(String profileOwnerPackage, String enterpriseIdString) {
        TelephonyManager telephonyService = mContext.getSystemService(TelephonyManager.class);
        assertThat(telephonyService).isNotNull();

        WifiManager wifiManager = mContext.getSystemService(WifiManager.class);
        assertThat(wifiManager).isNotNull();

        final byte[] serialNumber = getPaddedHardwareIdentifier(Build.getSerial()).getBytes();
        final byte[] imei = getPaddedHardwareIdentifier(telephonyService.getImei(0)).getBytes();
        final byte[] meid = getPaddedHardwareIdentifier(telephonyService.getMeid(0)).getBytes();

        final byte[] macAddress;
        final String[] macAddresses = wifiManager.getFactoryMacAddresses();
        if (macAddresses == null || macAddresses.length == 0) {
            macAddress = """".getBytes();
        } else {
            macAddress = macAddresses[0].getBytes();
        }

        final int totalIdentifiersLength = serialNumber.length + imei.length + meid.length
                + macAddress.length;
        final ByteBuffer fixedIdentifiers = ByteBuffer.allocate(totalIdentifiersLength);
        fixedIdentifiers.put(serialNumber);
        fixedIdentifiers.put(imei);
        fixedIdentifiers.put(meid);
        fixedIdentifiers.put(macAddress);

        final byte[] dpcPackage = getPaddedProfileOwnerName(profileOwnerPackage).getBytes();
        final byte[] enterpriseId = getPaddedEnterpriseId(enterpriseIdString).getBytes();
        final ByteBuffer info = ByteBuffer.allocate(dpcPackage.length + enterpriseId.length);
        info.put(dpcPackage);
        info.put(enterpriseId);
        final byte[] esidBytes = computeHkdf(""HMACSHA256"", fixedIdentifiers.array(), null,
                info.array(), 16);
        ByteBuffer esidByteBuffer = ByteBuffer.wrap(esidBytes);

        return encodeBase32(esidByteBuffer.getLong()) + encodeBase32(esidByteBuffer.getLong());
    }

    private static String getPaddedHardwareIdentifier(String hardwareIdentifier) {
        if (hardwareIdentifier == null) {
            hardwareIdentifier = """";
        }
        return String.format(""%16s"", hardwareIdentifier);
    }

    private static String getPaddedProfileOwnerName(String profileOwnerPackage) {
        return String.format(""%64s"", profileOwnerPackage);
    }

    private static String getPaddedEnterpriseId(String enterpriseId) {
        return String.format(""%64s"", enterpriseId);
    }

    // Copied from android.security.identity.Util, here to make sure Enterprise-Specific ID is
    // calculated according to spec.
    @NonNull
    private static byte[] computeHkdf(
            @NonNull String macAlgorithm, @NonNull final byte[] ikm, @NonNull final byte[] salt,
            @NonNull final byte[] info, int size) {
        Mac mac = null;
        try {
            mac = Mac.getInstance(macAlgorithm);
        } catch (NoSuchAlgorithmException e) {
            throw new RuntimeException(""No such algorithm: "" + macAlgorithm, e);
        }
        if (size > 255 * mac.getMacLength()) {
            throw new RuntimeException(""size too large"");
        }
        try {
            if (salt == null || salt.length == 0) {
                // According to RFC 5869, Section 2.2 the salt is optional. If no salt is provided
                // then HKDF uses a salt that is an array of zeros of the same length as the hash
                // digest.
                mac.init(new SecretKeySpec(new byte[mac.getMacLength()], macAlgorithm));
            } else {
                mac.init(new SecretKeySpec(salt, macAlgorithm));
            }
            byte[] prk = mac.doFinal(ikm);
            byte[] result = new byte[size];
            int ctr = 1;
            int pos = 0;
            mac.init(new SecretKeySpec(prk, macAlgorithm));
            byte[] digest = new byte[0];
            while (true) {
                mac.update(digest);
                mac.update(info);
                mac.update((byte) ctr);
                digest = mac.doFinal();
                if (pos + digest.length < size) {
                    System.arraycopy(digest, 0, result, pos, digest.length);
                    pos += digest.length;
                    ctr++;
                } else {
                    System.arraycopy(digest, 0, result, pos, size - pos);
                    break;
                }
            }
            return result;
        } catch (InvalidKeyException e) {
            throw new RuntimeException(""Error MACing"", e);
        }
    }

    private static final char[] ENCODE = {
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
            'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
            'Y', 'Z', '2', '3', '4', '5', '6', '7',
    };

    private static final char SEPARATOR = '-';
    private static final int LONG_SIZE = 13;
    private static final int GROUP_SIZE = 4;

    private static String encodeBase32(long input) {
        final char[] alphabet = ENCODE;

        /*
         * Make a character array with room for the separators between each
         * group.
         */
        final char[] encoded = new char[LONG_SIZE + (LONG_SIZE / GROUP_SIZE)];

        int index = encoded.length;
        for (int i = 0; i < LONG_SIZE; i++) {
            /*
             * Make sure we don't put a separator at the beginning. Since we're
             * building from the rear of the array, we use (LONG_SIZE %
             * GROUP_SIZE) to make the odd-size group appear at the end instead
             * of the beginning.
             */
            if (i > 0 && (i % GROUP_SIZE) == (LONG_SIZE % GROUP_SIZE)) {
                encoded[--index] = SEPARATOR;
            }

            /*
             * Extract 5 bits of data, then shift it out.
             */
            final int group = (int) (input & 0x1F);
            input >>>= 5;

            encoded[--index] = alphabet[group];
        }

        return String.valueOf(encoded);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/EnrollmentSpecificIdTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.EnrollmentSpecificIdTest"	"testThrowsWhenTryingToReSetOrganizationId"	""	"1: UI"	"public void testThrowsWhenTryingToReSetOrganizationId() {
        mUiAutomation.adoptShellPermissionIdentity(PERMISSIONS_TO_ADOPT);

        mDevicePolicyManager.setOrganizationId(""abc"");
        final String firstEsid = mDevicePolicyManager.getEnrollmentSpecificId();
        assertThat(firstEsid).isNotEmpty();

        assertThrows(IllegalStateException.class,
                () -> mDevicePolicyManager.setOrganizationId(""xyz""));
    }

    /**
     * This test tests that the platform calculates the ESID according to the specification and
     * does not, for example, return the same ESID regardless of the managing package.
     */"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/EnrollmentSpecificIdTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.NearbyAppStreamingPolicyTest"	"testGetNearbyAppStreamingPolicy_getsNearbyStreamingDisabledAsDefault"	""	"3: app(s) apps app"	"public void testGetNearbyAppStreamingPolicy_getsNearbyStreamingDisabledAsDefault() {
        assertThat(mDevicePolicyManager.getNearbyAppStreamingPolicy())
                .isEqualTo(DevicePolicyManager.NEARBY_STREAMING_DISABLED);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/NearbyAppStreamingPolicyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.NearbyAppStreamingPolicyTest"	"testSetNearbyAppStreamingPolicy_changesPolicy"	""	"3: app(s) apps app"	"public void testSetNearbyAppStreamingPolicy_changesPolicy() {
        mDevicePolicyManager.setNearbyAppStreamingPolicy(
                DevicePolicyManager.NEARBY_STREAMING_ENABLED);

        assertThat(mDevicePolicyManager.getNearbyAppStreamingPolicy())
                .isEqualTo(DevicePolicyManager.NEARBY_STREAMING_ENABLED);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/NearbyAppStreamingPolicyTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.ScreenCaptureDisabledTest"	"testScreenCapturePossible"	""	"1: UI"	"public void testScreenCapturePossible() throws Exception {
        Bitmap screenshot = null;
        for (int i = 1; i <= MAX_ATTEMPTS_COUNT; i++) {
            Log.d(TAG, ""testScreenCapturePossible): attempt #"" + i);
            sleep(WAIT_IN_MILLISECOND);
            screenshot = takeScreenshot();
            if (screenshot != null) break;
        }
        assertWithMessage(""screenshot"").that(screenshot).isNotNull();
    }

    private Bitmap takeScreenshot() {
        Bitmap screenshot = getInstrumentation().getUiAutomation().takeScreenshot();
        Log.d(TAG, ""takeScreenshot(): got "" + screenshot);
        return screenshot;
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/ScreenCaptureDisabledTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.KeyguardDisabledFeaturesTest"	"testSetKeyguardDisabledFeatures"	""	"1: camera"	"public void testSetKeyguardDisabledFeatures() {
        mDevicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_CAMERA);

        // Check if the admin has disabled the camera specifically for the keyguard
        assertThat(mDevicePolicyManager.getKeyguardDisabledFeatures(
                ADMIN_RECEIVER_COMPONENT)).isEqualTo(
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_CAMERA);

        removeKeyguardDisableFeatures(mDevicePolicyManager);
        mDevicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_NOTIFICATIONS);

        // Check if the admin has disabled notifications specifically for the keyguard
        assertThat(mDevicePolicyManager.getKeyguardDisabledFeatures(
                ADMIN_RECEIVER_COMPONENT)).isEqualTo(
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_NOTIFICATIONS);
        removeKeyguardDisableFeatures(mDevicePolicyManager);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/KeyguardDisabledFeaturesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.KeyguardDisabledFeaturesTest"	"testSetKeyguardDisabledFeatures_onParentSilentIgnoreWhenCallerIsNotOrgOwnedPO"	""	"1: camera"	"public void testSetKeyguardDisabledFeatures_onParentSilentIgnoreWhenCallerIsNotOrgOwnedPO() {
        DevicePolicyManager parentDevicePolicyManager =
                mDevicePolicyManager.getParentProfileInstance(ADMIN_RECEIVER_COMPONENT);

        parentDevicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_CAMERA);

        assertThat(mDevicePolicyManager.getKeyguardDisabledFeatures(
                ADMIN_RECEIVER_COMPONENT)).isEqualTo(0);
    }"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/KeyguardDisabledFeaturesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.KeyguardDisabledFeaturesTest"	"testSetKeyguardDisabledFeatures_onParent"	""	"1: camera"	"public void testSetKeyguardDisabledFeatures_onParent() {
        DevicePolicyManager parentDevicePolicyManager =
                mDevicePolicyManager.getParentProfileInstance(ADMIN_RECEIVER_COMPONENT);

        parentDevicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_CAMERA);

        // Check if the admin has disabled the camera specifically for the keyguard
        assertThat(parentDevicePolicyManager.getKeyguardDisabledFeatures(
                ADMIN_RECEIVER_COMPONENT)).isEqualTo(
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_CAMERA);

        removeKeyguardDisableFeatures(parentDevicePolicyManager);
        parentDevicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_NOTIFICATIONS);

        // Check if the admin has disabled notifications specifically for the keyguard
        assertThat(parentDevicePolicyManager.getKeyguardDisabledFeatures(
                ADMIN_RECEIVER_COMPONENT)).isEqualTo(
                DevicePolicyManager.KEYGUARD_DISABLE_SECURE_NOTIFICATIONS);
        removeKeyguardDisableFeatures(parentDevicePolicyManager);
    }

    private void removeKeyguardDisableFeatures(DevicePolicyManager devicePolicyManager) {
        devicePolicyManager.setKeyguardDisabledFeatures(ADMIN_RECEIVER_COMPONENT,
                DevicePolicyManager.KEYGUARD_DISABLE_FEATURES_NONE);
    }
}"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/KeyguardDisabledFeaturesTest.java"	""	""	""
"2.2.5  . Security Model"	"9.8.2"	"H-5-1"	"9.8.2/H-5-1"	"display UI view camera indicator app  accessing live camera data  accessed app(s) holding  role section 9.1  CDD identifier"	"""[9.8.2/H-5-1] MUST display the camera indicator when an app is accessing live camera data, but not when the camera is only being accessed by app(s) holding the roles called out in section 9.1 with CDD identifier [C-4-X]. """	""	"com.android.cts.deviceandprofileowner.KeyguardDisabledFeaturesTest"	""	""	"1: app"	"public void test/*
 *.
 */

package com.android.cts.deviceandprofileowner;

import static com.google.common.truth.Truth.assertThat;

import android.app.admin.DevicePolicyManager;

public class KeyguardDisabledFeaturesTest extends BaseDeviceAdminTest {"	"/home/gpoor/cts-12-source/cts/hostsidetests/devicepolicy/app/DeviceAndProfileOwner/src/com/android/cts/deviceandprofileowner/KeyguardDisabledFeaturesTest.java"	""	""	""
