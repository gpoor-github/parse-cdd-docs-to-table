"Section"	"section_id"	"req_id"	"full_key"	"key_as_number"	"requirement"	"Test Availability"	"search_roots"	"search_terms"	"manual_search_terms"	"not_search_terms"	"not_files"	"max_matches"	"class_defs"	"methods"	"modules"	"protected"	"class_def"	"method"	"module"	"file_name"	"matched_files"	"methods_string"	"urls"	"method_text"	"matched_terms"	"qualified_method"	"Annotation?"	"New Req for S?"	"New CTS for S?"	"Comment(internal) e.g. why a test is not possible"	"CTS Bug Id"	"CDD Bug Id"	"Area"	"Shortened"	"Test Level"
"2.2.5  . Security Model"	"9.8"	"H-1-9"	"9.8/H-1-9"	"09080000.720109"	"""[9.8/H-1-9] MUST NOT allow a user-installable application to provide the hotword detection service. """	"Test Available"	"voicei"	""	"user role install permission application to provide process hotword detection service"	""	""	""	""	""	""	""	"android.cts.statsdatom.appops.AppOpsTests"	"isNotNull"	"CtsStatsdAtomHostTestCases"	"/home/gpoor/cts-12-source/cts/hostsidetests/statsdatom/src/android/cts/statsdatom/appops/AppOpsTests.java"	"[('(11,hotword,/android/voiceinteraction/service/MainInteractionService.java)', 1), ('(10,to,/android/voiceinteraction/service/MainInteractionService.java)', 1), ('(14,service,/android/voiceinteraction/service/MainInteractionService.java)', 1), ('(3,detection,/android/voiceinteraction/service/MainInteractionService.java)', 1), ('(2,permission,/android/voiceinteraction/service/MainInteractionService.java)', 1), ('(4,to,/android/voiceinteraction/service/MainRecognitionService.java)', 1), ('(6,service,/android/voiceinteraction/service/MainRecognitionService.java)', 1), ('(31,hotword,/android/voiceinteraction/common/Utils.java)', 1), ('(3,process,/android/voiceinteraction/common/Utils.java)', 1), ('(13,to,/android/voiceinteraction/common/Utils.java)', 1), ('(32,service,/android/voiceinteraction/common/Utils.java)', 1), ('(25,detection,/android/voiceinteraction/common/Utils.java)', 1), ('(2,permission,/android/voiceinteraction/common/Utils.java)', 1), ('(1,provide,/android/voiceinteraction/common/Utils.java)', 1), ('(7,to,/android/voiceinteraction/cts/LocalVoiceInteractionTest.java)', 1), ('(1,to,/android/voiceinteraction/cts/VoiceInteractionTestReceiver.java)', 1), ('(4,service,/android/voiceinteraction/cts/VoiceInteractionTestReceiver.java)', 1), ('(1,hotword,/android/voiceinteraction/cts/AbstractVoiceInteractionBasicTestCase.java)', 1), ('(2,to,/android/voiceinteraction/cts/AbstractVoiceInteractionBasicTestCase.java)', 1), ('(8,service,/android/voiceinteraction/cts/AbstractVoiceInteractionBasicTestCase.java)', 1), ('(1,detection,/android/voiceinteraction/cts/AbstractVoiceInteractionBasicTestCase.java)', 1), ('(1,provide,/android/voiceinteraction/cts/AbstractVoiceInteractionBasicTestCase.java)', 1), ('(122,hotword,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(6,process,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(66,to,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(84,service,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(101,detection,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(9,permission,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(1,provide,/android/voiceinteraction/cts/HotwordDetectionServiceBasicTest.java)', 1), ('(124,hotword,/android/voiceinteraction/cts/HotwordDetectedResultTest.java)', 1), ('(15,to,/android/voiceinteraction/cts/HotwordDetectedResultTest.java)', 1), ('(1,service,/android/voiceinteraction/cts/HotwordDetectedResultTest.java)', 1), ('(8,detection,/android/voiceinteraction/cts/HotwordDetectedResultTest.java)', 1), ('(34,to,/android/voiceinteraction/service/MainInteractionSession.java)', 1), ('(3,service,/android/voiceinteraction/service/MainInteractionSession.java)', 1), ('(2,permission,/android/voiceinteraction/service/MainInteractionSession.java)', 1), ('(3,to,/android/voiceinteraction/cts/TestStartActivity.java)', 1), ('(2,service,/android/voiceinteraction/cts/TestStartActivity.java)', 1), ('(38,hotword,/android/voiceinteraction/service/MainHotwordDetectionService.java)', 1), ('(5,process,/android/voiceinteraction/service/MainHotwordDetectionService.java)', 1), ('(31,to,/android/voiceinteraction/service/MainHotwordDetectionService.java)', 1), ('(15,service,/android/voiceinteraction/service/MainHotwordDetectionService.java)', 1), ('(25,detection,/android/voiceinteraction/service/MainHotwordDetectionService.java)', 1), ('(11,hotword,/android/voiceinteraction/cts/HotwordDetectionServiceNonExistenceTest.java)', 1), ('(1,to,/android/voiceinteraction/cts/HotwordDetectionServiceNonExistenceTest.java)', 1), ('(14,service,/android/voiceinteraction/cts/HotwordDetectionServiceNonExistenceTest.java)', 1), ('(11,detection,/android/voiceinteraction/cts/HotwordDetectionServiceNonExistenceTest.java)', 1), ('(9,hotword,/android/voiceinteraction/cts/HotwordDetectionServiceDefaultMethodTest.java)', 1), ('(6,to,/android/voiceinteraction/cts/HotwordDetectionServiceDefaultMethodTest.java)', 1), ('(8,service,/android/voiceinteraction/cts/HotwordDetectionServiceDefaultMethodTest.java)', 1), ('(7,detection,/android/voiceinteraction/cts/HotwordDetectionServiceDefaultMethodTest.java)', 1), ('(9,to,/android/voiceinteraction/cts/TestLocalInteractionActivity.java)', 1), ('(3,process,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(4,user,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(8,to,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(13,service,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(3,application,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(5,permission,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(55,role,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(3,provide,/android/voiceinteraction/cts/VoiceInteractionRoleTest.java)', 1), ('(4,hotword,/android/voiceinteraction/cts/TestVoiceInteractionServiceActivity.java)', 1), ('(26,service,/android/voiceinteraction/cts/TestVoiceInteractionServiceActivity.java)', 1), ('(4,detection,/android/voiceinteraction/cts/TestVoiceInteractionServiceActivity.java)', 1), ('(45,to,/android/voiceinteraction/testapp/TestApp.java)', 1), ('(91,hotword,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(1,process,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(71,to,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(50,service,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(43,detection,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(20,permission,/android/voiceinteraction/service/BasicVoiceInteractionService.java)', 1), ('(2,to,/android/voiceinteraction/service/SettingsActivity.java)', 1), ('(1,service,/android/voiceinteraction/service/SettingsActivity.java)', 1), ('(28,to,/android/voiceinteraction/testapp/DirectActionsActivity.java)', 1), ('(6,service,/android/voiceinteraction/service/VoiceInteractionMain.java)', 1), ('(6,to,/android/voiceinteraction/cts/VoiceInteractionTest.java)', 1), ('(2,user,/android/voiceinteraction/cts/DirectActionsTest.java)', 1), ('(26,to,/android/voiceinteraction/cts/DirectActionsTest.java)', 1), ('(3,service,/android/voiceinteraction/cts/DirectActionsTest.java)', 1), ('(6,hotword,/android/voiceinteraction/cts/NoOpHotwordDetectionService.java)', 1), ('(6,to,/android/voiceinteraction/cts/NoOpHotwordDetectionService.java)', 1), ('(6,service,/android/voiceinteraction/cts/NoOpHotwordDetectionService.java)', 1), ('(6,detection,/android/voiceinteraction/cts/NoOpHotwordDetectionService.java)', 1), ('(16,hotword,/android/voiceinteraction/service/EventPayloadParcelable.java)', 1), ('(13,to,/android/voiceinteraction/service/EventPayloadParcelable.java)', 1), ('(3,service,/android/voiceinteraction/service/EventPayloadParcelable.java)', 1), ('(9,to,/android/voiceinteraction/service/DirectActionsSession.java)', 1), ('(2,service,/android/voiceinteraction/service/DirectActionsSession.java)', 1), ('(1,to,/android/voiceinteraction/cts/AbstractVoiceInteractionTestCase.java)', 1), ('(3,service,/android/voiceinteraction/cts/AbstractVoiceInteractionTestCase.java)', 1), ('(1,provide,/android/voiceinteraction/cts/AbstractVoiceInteractionTestCase.java)', 1), ('(23,hotword,/android/voiceinteraction/cts/HotwordRejectedResultTest.java)', 1), ('(4,to,/android/voiceinteraction/cts/HotwordRejectedResultTest.java)', 1), ('(1,service,/android/voiceinteraction/cts/HotwordRejectedResultTest.java)', 1)]"	"public void test/*
 *.
 */

package android.cts.statsdatom.appops;

import static com.google.common.truth.Truth.assertThat;
import static com.google.common.truth.Truth.assertWithMessage;

import android.cts.statsdatom.lib.AtomTestUtils;
import android.cts.statsdatom.lib.ConfigUtils;
import android.cts.statsdatom.lib.DeviceUtils;
import android.cts.statsdatom.lib.ReportUtils;

import com.android.os.AtomsProto;
import com.android.tradefed.build.IBuildInfo;
import com.android.tradefed.testtype.DeviceTestCase;
import com.android.tradefed.testtype.IBuildReceiver;

import com.google.protobuf.Descriptors;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

public class AppOpsTests extends DeviceTestCase implements IBuildReceiver {
    private static final int NUM_APP_OPS = AtomsProto.AttributedAppOps.getDefaultInstance().getOp().
            getDescriptorForType().getValues().size() - 1;

    /**
     * Some ops are only available to specific dynamic uids and are otherwise transformed to less
     * privileged ops. For example, RECORD_AUDIO_HOTWORD is downgraded to RECORD_AUDIO. This stores
     * a mapping from an op to the op it can be transformed from.
     */
    private static final Map<Integer, Integer> TRANSFORMED_FROM_OP = new HashMap<>();

    static {
        final int APP_OP_RECORD_AUDIO = 27;
        final int APP_OP_RECORD_AUDIO_HOTWORD = 102;

        // Temporarily commented out until the Trusted Hotword requirement is enforced again.
//        TRANSFORMED_FROM_OP.put(APP_OP_RECORD_AUDIO, APP_OP_RECORD_AUDIO_HOTWORD);
    }

    private IBuildInfo mCtsBuild;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        assertThat(mCtsBuild).isNotNull();
        ConfigUtils.removeConfig(getDevice());
        ReportUtils.clearReports(getDevice());
        DeviceUtils.installStatsdTestApp(getDevice(), mCtsBuild);
        Thread.sleep(AtomTestUtils.WAIT_TIME_LONG);
    }

    @Override
    protected void tearDown() throws Exception {
        ConfigUtils.removeConfig(getDevice());
        ReportUtils.clearReports(getDevice());
        DeviceUtils.uninstallStatsdTestApp(getDevice());
        super.tearDown();
    }

    @Override
    public void setBuild(IBuildInfo buildInfo) {
        mCtsBuild = buildInfo;
    }"	""	""	"3: to install hotword hotword"	"[('[android.voiceinteraction.common.Utils isVirtualDevice None]', 7), ('[android.voiceinteraction.cts.VoiceInteractionRoleTest getAssistRoleHolders CtsVoiceInteractionTestCases]', 7), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_concurrentCapture CtsVoiceInteractionTestCases]', 6), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_processDied_triggerOnError CtsVoiceInteractionTestCases]', 6), ('[android.voiceinteraction.cts.VoiceInteractionRoleTest testAssistRole_noRecognitionService CtsVoiceInteractionTestCases]', 6), ('[android.voiceinteraction.service.BasicVoiceInteractionService dropShellPermissionIdentity None]', 6), ('[android.voiceinteraction.service.MainHotwordDetectionService PersistableBundle None]', 5), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_getMaxCustomInitializationStatus CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testVoiceInteractionService_withoutManageHotwordDetectionPermission_triggerFailure CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testVoiceInteractionService_holdBindHotwordDetectionPermission_triggerFailure CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_onDetectFromDsp_success CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_onDetectFromDsp_rejection CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_onDetectFromExternalSource_success CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_onDetectFromMic_success CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_onStopDetection CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceNonExistenceTest testHotwordDetectionService_noHotwordDetectionComponentName_triggerFailure CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceDefaultMethodTest testHotwordDetectionService_onDetect_fromDsp CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceDefaultMethodTest testHotwordDetectionService_onDetect_fromExternalSource CtsVoiceInteractionTestCases]', 4), ('[android.voiceinteraction.cts.HotwordDetectionServiceBasicTest testHotwordDetectionService_validHotwordDetectionComponentName_triggerSuccess CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_totalSize CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResultParcelizeDeparcelize CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.service.MainInteractionSession hasShortcutHostPermission None]', 3), ('[android.voiceinteraction.cts.HotwordDetectionServiceDefaultMethodTest testHotwordDetectionService_onDetect_fromMic CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.cts.TestVoiceInteractionServiceActivity finish CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.cts.DirectActionsTest testNotifyDirectActionsChanged CtsVoiceInteractionTestCases]', 3), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_bundleExceedMaxBundleSize CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidHotwordDurationMillis CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResultBuilder CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.VoiceInteractionRoleTest testAssistRole_hasRecognitionService CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.VoiceInteractionTest testAll CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.service.DirectActionsSession finish None]', 2), ('[android.voiceinteraction.cts.HotwordRejectedResultTest testHotwordRejectedResultBuilder CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.HotwordRejectedResultTest testHotwordRejectedResultParcelizeDeparcelize CtsVoiceInteractionTestCases]', 2), ('[android.voiceinteraction.cts.LocalVoiceInteractionTest startTestActivity CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.LocalVoiceInteractionTest testLifecycle CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_getMaxBundleSize CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_getMaxHotwordPhraseId CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidHotwordPhraseId CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_getMaxScore CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidScore CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidPersonalizedScore CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidHotwordOffsetMillis CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.HotwordDetectedResultTest testHotwordDetectedResult_setInvalidAudioChannel CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.testapp.TestApp continueTests None]', 1), ('[android.voiceinteraction.testapp.DirectActionsActivity emptyList None]', 1), ('[android.voiceinteraction.service.VoiceInteractionMain finish None]', 1), ('[android.voiceinteraction.cts.DirectActionsTest testPerformDirectAction CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.DirectActionsTest testCancelPerformedDirectAction CtsVoiceInteractionTestCases]', 1), ('[android.voiceinteraction.cts.DirectActionsTest testVoiceInteractorDestroy CtsVoiceInteractionTestCases]', 1)]"	""	""	""	""	""	""	""	""	""
